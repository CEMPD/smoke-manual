<?xml version="1.0" encoding="UTF-8"?>

<chapter id="ch_quality_assurance">

<title>SMOKE Quality Assurance</title>

<section>

<title>Introduction</title>

<para>This chapter provides documentation on SMOKE's quality assurance (QA) capabilities. Quality assurance of emissions modeling results is a very important component of using SMOKE. Because emission modeling is a complex procedure that includes many disparate data sets and many processing steps, it is critical that quality assurance be performed on the emissions modeling results prior to using the model-ready emissions in air quality modeling. Failure to quality assure the results will almost surely result in undesirable errors in SMOKE's output caused by factors such as user inexperience, file formatting errors, misunderstanding of software capabilities, and software bugs. It is far preferable to catch emissions modeling problems during emissions modeling rather than after the emissions results have already been used and policy decisions made based on them.</para>

<para>SMOKE quality assurance consists of at least the following components:</para>

<itemizedlist>
<listitem>
<para>Setting up SMOKE using available documentation (this manual) on file formats and script setup.</para>
</listitem>
<listitem>
<para>Reviewing log files for errors and warnings, then resolving any problems.</para>
</listitem>
<listitem>
<para>Reviewing reports generated by SMOKE core programs (e.g., reports from the <command>Cntlmat</command> program indicating which controls were applied and the changes made to the inventory emissions).</para>
</listitem>
<listitem>
<para>Reviewing and customizing reports generated by the <command>Smkreport</command> program, and comparing these to one another and to totals from the emission inventory.</para>
</listitem>
</itemizedlist>

<para>In this chapter, we provide documentation on the <command>Smkreport</command> program (<xref linkend="sect_qa_smkreport" />), on its main input file <envar>REPCONFIG</envar> (<xref linkend="sect_qa_repconfig" />), and on the <command>Smkreport</command> output reports (<xref linkend="sect_qa_output" />). In the final section of this chapter (<xref linkend="sect_qa_methods" />), we outline QA methods that SMOKE users can apply to ensure that their inventory and emissions modeling efforts are as correct as possible.</para>

</section>

<section id="sect_qa_smkreport">

<title><command>Smkreport</command> Program</title>

<section>

<title>Description</title>

<para><command>Smkreport</command> uses the SMOKE intermediate files generated by other SMOKE programs to create a large variety of emissions and activity data totals to be used for QA of the emissions data. This QA is in addition to the QA performed by other SMOKE programs for checking file formats and input quality, and it focuses on analysis of the emissions values processed and output by SMOKE. <command>Smkreport</command> operates on one source category (area, mobile, or point) in a given run, though it does not operate on biogenic emissions because biogenic does not have the same structure of intermediate files that <command>Smkreport</command> uses for inputs. Each run of <command>Smkreport</command> is also limited to one speciation scenario, one grid projection and resolution, and one hourly emissions file. <command>Smkreport</command> can also read in growth or multiplicative control matrices, but not reactivity control matrices. All of these component datasets are optional, however, and their use is controlled by the settings in the Report Configuration File (<envar>REPCONFIG</envar>), described in <xref linkend="sect_qa_repconfig" />. Analysis of multiple source categories (area/mobile/point) in the same report is a postprocessing step in which the user can import multiple reports from different source categories and analyze across multiple source categories.</para>

<para>The most important input file to <command>Smkreport</command> is the <envar>REPCONFIG</envar> file. Through this file, you have a tremendous amount of flexibility in generating different types of reports. Options are invoked by using reporting "instructions," which you prepares before using <command>Smkreport</command>. See the <envar>REPCONFIG</envar> documentation in <xref linkend="sect_qa_repconfig" /> for more information on the reporting options. Additionally, in <xref linkend="sect_qa_methods" /> we provide some guidance on the types of analyses you can perform using reports created by <command>Smkreport</command>, and reasons why you might want to use those analyses.</para>

<para><command>Smkreport</command> can generate multiple reports with a single run of the program. Multiple report writing is helpful, because a large part of the time that the program takes to run is reading in the SMOKE intermediate files. Note that the multiple reports are all for a single source category for one run of <command>Smkreport</command>. As described in the <xref linkend="sect_qa_output" />, the report output names are configured by the <envar>REPCONFIG</envar> file. You may specify either physical file names (including the path) in <envar>REPCONFIG</envar>, or you may specify logical file names and then make sure your script sets the logical file names to physical file names. <xref linkend="ch_scripts" /> describes the default configuration of reports in the default SMOKE scripts. At the end of <xref linkend="ch_scripts" />, we also provide information about how to configure the scripts to change the output reports that SMOKE will create.</para>

</section>

<section>

<title>Processing Order</title>

<para><command>Smkreport</command> can only be used after <emphasis>at least</emphasis> <command>Smkinven</command> (for inventory import) has been run. Depending on the reporting options selected in the <envar>REPCONFIG</envar> input file, other processing steps may need to have been run. For example, to create a report of county total emissions after gridding, the <command>Grdmat</command> (for spatial allocation) program must have been run already to create the gridding matrix. <command>Smkreport</command> can use output files from the following programs: <command>Smkinven</command>, <command>Temporal</command> (for temporal allocation), <command>Spcmat</command> (for chemical speciation), <command>Grdmat</command>, <command>Elevpoint</command> (for elevated source selection), <command>Laypoint</command> (for plume rise calculations), and <command>Cntlmat</command>.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<section>

<title>Input Files</title>

<para>The input files depend upon the <envar>SMK_SOURCE</envar> input instruction in the <envar>REPCONFIG</envar> input file setting when the program is started. With the exception of the SMOKE intermediate inventory file (<envar>AREA</envar>, <envar>MOBL</envar>, <envar>PNTS</envar>), whether a file is optional or not depends on the settings in <envar>REPCONFIG</envar>. If <command>Smkreport</command> is being executed to produce speciated, gridded, temporally allocated area sources, for instance, then the area-source inventory, speciation matrix, gridding matrix, and hourly emissions are required. Also, the source category of the input file depends on the <envar>REPCONFIG</envar> file setting for <envar>SMK_SOURCE</envar>. For example, if only area sources are being merged (<envar>SMK_SOURCE</envar> is set to A), then only area-source-related inputs are required.</para>

<informaltable>
<tgroup cols="4">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="10*" />
<colspec colwidth="52*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Source Type</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[A|M|P]CMAT</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>A, M, P</entry>
<entry>Multiplicative control matrix from <command>Cntlmat</command></entry>
</row>
<row>
<entry><envar>[A|M|P]GMAT</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>A, M, P</entry>
<entry>Gridding matrix from <command>Grdmat</command></entry>
</row>
<row>
<entry><envar>[A|M]GSUP</envar></entry>
<entry>ASCII</entry>
<entry>A, M</entry>
<entry>Supplementary file from <command>Grdmat</command> that contains all gridding surrogate codes assigned to each source</entry>
</row>
<row>
<entry><envar>[A|M|P]PMAT</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>A, M, P</entry>
<entry>Growth matrix from <command>Cntlmat</command></entry>
</row>
<row>
<entry><envar>[A|M|P]RMAT</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>A, M, P</entry>
<entry>Mass-based or mole-based reactivity matrix from <command>Cntlmat</command> (optional, <emphasis>not yet supported by SMOKE</emphasis>)</entry>
</row>
<row>
<entry><envar>[A|M|P]SMAT</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>A, M, P</entry>
<entry>Mass-based or mole-based speciation matrix from <command>Spcmat</command></entry>
</row>
<row>
<entry><envar>[A|M|P]SSUP</envar></entry>
<entry>ASCII</entry>
<entry>A, M, P</entry>
<entry>Supplementary file from <command>Spcmat</command> that contains all speciation profile codes assigned to each source</entry>
</row>
<row>
<entry><envar>[A|M|P]TMP</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>A, M, P</entry>
<entry>Temporally allocated emissions from <command>Temporal</command></entry>
</row>
<row>
<entry><envar>[A|M|P]TSUP</envar></entry>
<entry>ASCII</entry>
<entry>A, M, P</entry>
<entry>Supplementary file from <command>Temporal</command> that contains all monthly, weekly, and diurnal profile codes assigned to each source. <emphasis role="bold">This file will only work when profiles have not been applied by pollutant.</emphasis></entry>
</row>
<row>
<entry><envar>AREA</envar></entry>
<entry>SMOKE map</entry>
<entry>A</entry>
<entry>Intermediate area-source emissions inventory from <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>COSTCY</envar></entry>
<entry>ASCII</entry>
<entry>A, M, P</entry>
<entry>Country, state and county file with time zones and, optionally, population</entry>
</row>
<row>
<entry><envar>ELEVTS_[L|S]</envar></entry>
<entry>ASCII</entry>
<entry>P</entry>
<entry>Elevated point-source file written by <command>Smkmerge</command> for REMSAD, UAM, and CAM<subscript>X</subscript> modeling. See <envar>MRG_GRDOUT_UNIT</envar> environment variable setting in <xref linkend="sect_qa_smkreport_envar" />.</entry>
</row>
<row>
<entry><envar>GRIDDESC</envar></entry>
<entry>ASCII</entry>
<entry>A, M, P</entry>
<entry>Contains description of the modeling grid</entry>
</row>
<row>
<entry><envar>MOBL</envar></entry>
<entry>SMOKE map</entry>
<entry>M</entry>
<entry>Intermediate mobile-source emissions and/or activity inventory from <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>PELV</envar></entry>
<entry>ASCII</entry>
<entry>P</entry>
<entry>Elevated point-sources identification file; if reporting based on elevated point sources</entry>
</row>
<row>
<entry><envar>PLAY</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>P</entry>
<entry>Layer fractions file output by the <command>Laypoint</command> program</entry>
</row>
<row>
<entry><envar>PNTS</envar></entry>
<entry>SMOKE map</entry>
<entry>P</entry>
<entry>Intermediate point-source emissions inventory from <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>REPCONFIG</envar></entry>
<entry>ASCII</entry>
<entry>A, M, P</entry>
<entry>Report configuration file</entry>
</row>
<row>
<entry><envar>SCCDESC</envar></entry>
<entry>ASCII</entry>
<entry>A, M, P</entry>
<entry>SCC descriptions</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section id="sect_qa_smkreport_envar">

<title>Input Environment Variables</title>

<itemizedlist>
<listitem>
<para><envar>MRG_GRDOUT_UNIT</envar>: [default: blank]</para>

<para>This variable is the same one used to control the <command>Smkmerge</command> output units. For <command>Smkreport</command>, it controls which ASCII elevated file to use, when the ASCIIELEV instruction is included in the <envar>REPCONFIG</envar> file. If the first letter of this setting is an "m" (for mole), then <command>Smkreport</command> opens the <envar>ELEVTS_L</envar> file to use in the report; otherwise, <command>Smkreport</command> opens and uses the <envar>ELEVTS_S</envar> file. This setting does not do anything to the behavior of <command>Smkreport</command> unless the ASCIIELEV setting is included in the <envar>REPCONFIG</envar> file. The default setting of <envar>MRG_GRDOUT_UNIT</envar> results in the <envar>ELEVTS_S</envar> file being used by <command>Smkreport</command>.</para>
</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Smkreport</command></entry>
</row>
<row>
<entry><envar>REPORT[#]</envar></entry>
<entry>ASCII</entry>
<entry>Multiple ASCII reports. <command>Smkreport</command> will output file names of <envar>REPORT1</envar>, <envar>REPORT2</envar>, <envar>REPORT3</envar>, etc., if no other file names are given with the /NEWFILE/ instruction (see the <envar>REPCONFIG</envar> file documentation in <xref linkend="sect_qa_repconfig" />). If the /NEWFILE/ instructions include physical file names, <command>Smkreport</command> will open those files. If the /NEWFILE/ instructions include logical file names (<envar>REPORT1</envar>, etc.), <command>Smkreport</command> will attempt to find the value of the logical file name in the run-time UNIX shell environment. It the logical file name is defined, <command>Smkreport</command> will open the physical file associated with the logical file name; otherwise <command>Smkreport</command> opens a physical file with the same name as the logical file name.</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

</section>

<section id="sect_qa_repconfig">

<title><envar>REPCONFIG</envar> Input File</title>

<para>The <envar>REPCONFIG</envar> file is used to control the <command>Smkreport</command> program. As noted earlier, each run of <command>Smkreport</command> is constrained to a single source category (area, mobile, or point), at most one speciation scenario, at most one grid, and at most one hourly emissions file. All of these component datasets are optional, however, and their use is controlled by the settings in <envar>REPCONFIG</envar>. This file also controls the number and types of reports created by <command>Smkreport</command>, which can create an unlimited number of reports in each program run.</para>

<para>The file works on the principles of "packets" and "instructions". Packets are groups of instructions or a single action that have been predefined by the <envar>REPCONFIG</envar> file format to control the <command>Smkreport</command> outputs; instructions are settings that tell <command>Smkreport</command> what to do. Some types of packets must appear in one of three sections, while other packets can appear anywhere in the <envar>REPCONFIG</envar> file. The three sections are: "One-time" (see <xref linkend="sect_qa_repconfig_one_time" />), "Define-group" (see <xref linkend="sect_qa_repconfig_define_group" />), and "Create-report" (see <xref linkend="sect_qa_repconfig_create_report" />); each file section has a large number of options. In this section of the chapter, we first provide details on these three file sections and their packets, and then we describe four additional packets that can appear between other packets at any point in the <envar>REPCONFIG</envar> file.</para>

<para>The full list of packets that one can use in the <envar>REPCONFIG</envar> input file are as follows:</para>

<para>One-time section (<xref linkend="sect_qa_repconfig_one_time" />)</para>

<itemizedlist>
<listitem>
<para>SMK_SOURCE</para>
</listitem>
</itemizedlist>

<para>Define-group section (<xref linkend="sect_qa_repconfig_define_group" />)</para>

<itemizedlist>
<listitem>
<para>/DEFINE GROUP REGION/</para>
</listitem>
<listitem>
<para>/DEFINE SUBGRID/</para>
</listitem>
</itemizedlist>

<para>Create-report section (<xref linkend="sect_qa_repconfig_create_report" />)</para>

<itemizedlist>
<listitem>
<para>/CREATE REPORT/</para>
</listitem>
</itemizedlist>

<para>Packets that can appear anywhere in the file</para>

<itemizedlist>
<listitem>
<para>/DELIMITER/ (<xref linkend="sect_qa_repconfig_delimiter" />)</para>
</listitem>
<listitem>
<para>/AVEDAY/ (<xref linkend="sect_qa_repconfig_aveday" />)</para>
</listitem>
<listitem>
<para>/REPORT TIME/ (<xref linkend="sect_qa_repconfig_report_time" />)</para>
</listitem>
<listitem>
<para>/NEWFILE/ (<xref linkend="sect_qa_repconfig_newfile" />)</para>
</listitem>
</itemizedlist>

<para>Comments can be put in the file using a pound sign (#) at the first column of a line, or a double pound sign (##) anywhere else on a line. The double pound can appear after packet labels or instructions in the file.</para>

<para>Finally, note that the maximum number of characters that can be read on any line in this file is 300. This can be important in particular for the SELECT DATA instruction.</para>

<section id="sect_qa_repconfig_one_time">

<title>One-time section</title>

<para>The first section of the file is the One-time section, and it is a required section. This section is used for setting the environment variables that control <command>Smkreport</command> for all reports in a given run. The variables are set by listing the environment variable as an instruction, followed by its value. No <command>setenv</command> command (used in the C shell) is needed, because SMOKE is interpreting these values directly. At this time, the one instruction available in the One-time section is the SMK_SOURCE variable:</para>

<para><envar>SMK_SOURCE</envar>: Set as "A", "M", or "P", for area-source reporting, mobile-source reporting, and point-source reporting, respectively.</para>

<para>An example of the way this setting would appear in the <envar>REPCONFIG</envar> file is the following:</para>

<programlisting>SMK_SOURCE   A</programlisting>

</section>

<section id="sect_qa_repconfig_define_group">

<title>Define-group section</title>

<para>The second section of the <envar>REPCONFIG</envar> file is the Define-group section. This optional section is used for defining groups of source characteristics for use later in the Create-reports section. The Define-group section uses packets for defining groups. There are currently two types of groupings, and therefore two packet types for this section: regions and subgrids.</para>

<section>

<title>/DEFINE GROUP REGION/ packet</title>

<para>The /DEFINE GROUP REGION/ packet is used for defining groups by the country, state, and county codes in the inventory. The packet contains the following entries.</para>

<itemizedlist>
<listitem>
<para>/DEFINE GROUP REGION/ &lt;Label&gt;</para>

<para>Must appear to start the packet. A label (see below) is required for naming the group.</para>
</listitem>
<listitem>
<para>INCLUDE and/or EXCLUDE instruction(s) (see below). These are optional.</para>

<para>Country, state, and county codes in format NSSCCC, where N is the country number, SS is the state code, and CCC is the county code. Zeros can be used in place of CCC to select all counties in a state, or in place of SSCCC to select all counties and states in a country.</para>
</listitem>
<listitem>
<para>/END/</para>

<para>Must appear to end the packet.</para>
</listitem>
</itemizedlist>

</section>

<section>

<title>/DEFINE SUBGRID/ packet</title>

<para>The /DEFINE SUBGRID/ packet is used for defining subdomains based on cell numbers from the full grid being applied using the gridding matrices. The packet contains the following entries.</para>

<itemizedlist>
<listitem>
<para>/DEFINE SUBGRID/ &lt;Label&gt;</para>

<para>Must appear to start the packet. A label (see below) is required for naming the subgrid.</para>
</listitem>
<listitem>
<para>INCLUDE and/or EXCLUDE instruction(s) (see below) These are optional.</para>

<para>(X cell, Y cell):</para>

<para>Cell numbers should appear for all cells in the subgrid. The count (i.e. the x-cell count and the y-cell count) of the cells depends on the grid defined by the gridding matrix being used by <command>Smkreport</command>. A range can be given with the following syntax:</para>

<para>(X cell, Y cell) TO (X cell, Y cell)</para>

<para>If only one cell is to be specified, the range must still appear, with both entries indicating the same cell.</para>
 
<para><command>Smkreport</command> is not very sensitive to the spacing of this instruction, and additional spaces or no spaces may be placed between the parentheses, the cell numbers, and the commas. Spaces around the "TO" are recommended.</para>

<para>The maximum width of these lines is 100 characters. Multiple entries of this type may appear in the packet, allowing for the grouping of spatially unconnected cells/regions or non-rectangular regions.</para>
</listitem>
<listitem>
<para>/END/</para>

<para>Must appear to end the packet.</para>
</listitem>
</itemizedlist>

</section>

<section>

<title>Group labels</title>

<para>Group labels, denoted above by &lt;Label&gt;, are used to name a group for identification when creating a report in the Create-report section. The text appearing in the placeholder &lt;Label&gt; can be any alphanumeric combination of characters up to 200 characters, including intervening blanks. The text string (less trailing blanks) that occurs after /DEFINE .../ and before a comment (indicated with ##), is treated as the group label. References to the group label in the Create-report section do not have to be consistent in the case of the text; SMOKE will ignore the case of the text, treating lower- and uppercase characters as if they were the same.</para>

</section>

<section>

<title>INCLUDE and EXCLUDE instructions</title>

<para>The INCLUDE and EXCLUDE instructions are used for defining the meaning of the entries in the packet. If the INCLUDE instruction appears, then <command>Smkreport</command> interprets the subsequent entries in the packet as identifying records to <emphasis>include</emphasis> in the output report(s). On the other hand, if the EXCLUDE instruction appears, then <command>Smkreport</command> interprets the subsequent entries in the packet as identifying records to <emphasis>exclude</emphasis> from the output report(s). The INCLUDE and EXCLUDE instructions may appear in both the /DEFINE GROUP REGION/ and /DEFINE SUBGRID/ packets. These instructions act as toggle switches, and <command>Smkreport</command> will give a warning if a county previously included is later excluded. All packet entries after an instruction will be interpreted according to the instruction, until another instruction is given, or until the packet ends. The INCLUDE instruction is the default, so if neither instruction is given, SMOKE will assume that the records in the packet are those to be only in the report.</para>

<para>The ordering of INCLUDE or EXCLUDE instructions in a group definition can change the meaning of the group definition. If INCLUDE is given first, <command>Smkreport</command> will initialize the group to exclude all grid cells and then proceed with interpreting the instructions. On the other hand, if EXCLUDE is given first, <command>Smkreport</command> will initialize the group to include all grid cells. Here is an example for a small 6-cell by 6-cell grid, which shows how the order of the INCLUDE and EXCLUDE statements changes the meaning of a group definition.</para>

<para>If the instructions are</para>

<programlisting>/DEFINE GROUP REGION/ Example group
    INCLUDE (2,2) TO (6,6)
    EXCLUDE (3,3) TO (5,5)
    INCLUDE (4,4) TO (4,4)
/END/</programlisting>

<para>then the following cells (shown in gray) will be selected:</para>

<informalfigure>
<mediaobject>
<imageobject role="pdf">
<imagedata width="1.5in" fileref="images/qa/group_1_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/qa/group_1_html.jpg" />
</imageobject>
</mediaobject>
</informalfigure>
 
<para>If the instructions were rearranged to have the EXCLUDE statement first, then the initialized status for all cells would be INCLUDE. The additional INCLUDE statements are therefore unneeded, and the definition of the group changes to the following:</para>

<informalfigure>
<mediaobject>
<imageobject role="pdf">
<imagedata width="1.5in" fileref="images/qa/group_2_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/qa/group_2_html.jpg" />
</imageobject>
</mediaobject>
</informalfigure>

</section>

<section>

<title>Future grouping options</title>

<para>As noted above, the <envar>REPCONFIG</envar> file currently can have only two possible groups in the Define-group section (regions and subgrids) In the future, other types of groups could be permitted if a need for them is identified:</para>

<itemizedlist>
<listitem>
<para>/DEFINE GROUP SCC/: Permits user-defined SCC groups</para>
</listitem>
<listitem>
<para>/DEFINE GROUP PLANT/ Permits user-defined groups by country/state/county code and plant ID</para>
</listitem>
<listitem>
<para>/DEFINE GROUP STACK/ Permits user-define groups by country/state/county code, plant ID, and stack ID</para>
</listitem>
<listitem>
<para>/DEFINE GROUP POINT/ / Permits user-define groups by country/state/county code, plant ID, stack ID, and point ID</para>
</listitem>
<listitem>
<para>/DEFINE GROUP SOURCE/: Permits user-defined source groups by SMOKE source ID</para>
</listitem>
<listitem>
<para>/DEFINE GROUP HOURS/: Permits user-defined hour groupings</para>
</listitem>
</itemizedlist>

</section>

</section>

<section id="sect_qa_repconfig_create_report">

<title>Create-report Section</title>

<para>The third section of the <envar>REPCONFIG</envar> file is called the Create-report section. It is responsible for providing instructions to <command>Smkreport</command> for generating the reports. The /CREATE REPORT/ packet is used in this section. This packet uses the following types of instructions (listed in alphabetical order):</para>

<itemizedlist>
<listitem>ARRANGE</listitem>
<listitem>ASCIIELEV</listitem>
<listitem>BY</listitem>
<listitem>CONTROL</listitem>
<listitem>GRIDDING</listitem>
<listitem>LAYFRAC</listitem>
<listitem>NORMALIZE</listitem>
<listitem>NUMBER</listitem>
<listitem>PROJECTION</listitem>
<listitem>SELECT</listitem>
<listitem>SPECIATION</listitem>
<listitem>TEMPORAL</listitem>
<listitem>TITLE</listitem>
<listitem>UNITS</listitem>
</itemizedlist>

<para>By using these instructions (some of which have a number of different options), many different types of outputs can be achieved by <command>Smkreport</command>. The ordering of the instructions in the packet is not important, <emphasis>with one exception</emphasis>: if multiple titles are used, they will be printed to the report in the order in which they appear in the packet. The remainder of this subsection provides descriptions of each of these instructions.</para>

<section>

<title>ARRANGE instruction</title>

<para>The ARRANGE instruction controls the arrangement of variables and files for a single report. This instruction sets how many variables are included in a report or a section of a report, and can set the number of sections that a report will have. It also permits a database format that includes an emissions data value for each record in the report.</para>

<para>If no ARRANGE instruction is provided for a report, <command>Smkreport</command> will attempt to write all of the variables requested in the report to the same file and section. If too many variables are requested in the report, this could cause <command>Smkreport</command> to abort with an error. <emphasis>In general, if you have more than 20 variables that will be written to a given report, you should consider using the ARRANGE instruction.</emphasis></para>

<para>The syntax of the ARRANGE instruction is:</para>

<para>ARRANGE &lt;option&gt;</para>

<para>with the following valid options:</para>

<itemizedlist>
<listitem>
<para>MULTIFILE [<emphasis>number of variables</emphasis>]: Writes the report into multiple output files. This is different from the <command>Smkreport</command> capability of creating multiple reports: the instruction applies to a single report and indicates that the report should be output as multiple files. The file names in this case are created automatically by <command>Smkreport</command> based on the file name set by the associated NEWFILE instruction (explained in <xref linkend="sect_qa_repconfig_newfile" />), by appending a "_1", "_2", "_3", and so forth to the file name that would otherwise be output by <command>Smkreport</command>. For example, if the output report setting <envar>REPORT1</envar> is defined as <filename>/outdir/test/report1.myfile.txt</filename>, but that report requires two files, then the actual files that would be written would be <filename>/outdir/test/report1.myfile.txt_1</filename> and <filename>/outdir/test/report1.myfile.txt_2</filename>.</para>

<para>The <emphasis>number of variables</emphasis> option controls the number of variables written to each file of the report. For example, if the report will include 100 variables and the number of variables is set to 15, then <command>Smkreport</command> will create a report using seven separate files, six that include 15 variables (taking care of the first 90 variables) and a seventh file that has the remaining 10 variables. <emphasis><command>Smkreport</command> allows a maximum of 30 variables per file using the MULTIFILE instruction.</emphasis></para>
</listitem>
<listitem>
<para>ONEFILE [<emphasis>number of variables</emphasis>]: Writes the report into a single output file with multiple sections. Like the MULTIFILE option, this is different from the <command>Smkreport</command> capability of creating multiple reports: the instruction applies to a single report, but permits multiple sections of the report to be written to the same file.</para>

<para>The <emphasis>number of variables</emphasis> option controls the number of variables written to each section of the report. The number of sections is set automatically by dividing the number of data variables selected for the report by the number of variables.</para>
</listitem>
<listitem>
<para>DATABASE: Writes the report one variable at a time, with only one data variable on each row of the report. The attributes of the row are repeated for all variables, and all entries are written for one variable before the next variable is written. For example, if a report BY SCC10 is requested for the variables NOX and SO2, the report will list all SCCs with the NOX emissions as a data variable, followed by all SCCs again with SO2 emissions. Without the DATABASE instruction, the NOX and SO2 values would be written to the same line of the report and the SCC codes would be written only once.</para>
</listitem>
</itemizedlist>

</section>

<section>

<title>ASCIIELEV instruction</title>

<para>The ASCIIELEV instruction causes <command>Smkreport</command> to use the elevated ASCII emissions file (<envar>ELEVTS_L</envar> or <envar>ELEVTS_S</envar>) written by <command>Smkmerge</command> as the sole source for emissions information in the report. This option can be used only for point sources (SMK_SOURCE is set to P). When this option is included in a <envar>REPCONFIG</envar> file, all other reports in the <envar>REPCONFIG</envar> file must also include the ASCIIELEV instruction, or <command>Smkreport</command> will produce an error.</para>

<para>Using this instruction, <command>Smkreport</command> will use the emissions in the <envar>ELEVTS_S</envar> or <envar>ELEVTS_L</envar> file as the sole source of emissions and inventory information. These files include information about the states, counties, plants, stacks, stack parameters, hour, cell number, and speciated emissions. Therefore, only certain instructions may be used with the ASCIIELEV instruction, or else a warning will be printed to the log file and the unusable instruction will be ignored. The following subset of /CREATE REPORT/ instructions can be used with the ASCIIELEV instruction:</para>

<itemizedlist>
<listitem>ARRANGE</listitem>
<listitem>BY &lt;COUNTRY | STATE | COUNTY | CELL | ELEVSTAT | HOUR | PLANT | SOURCE | STACK&gt;; other BY options will be ignored</listitem>
<listitem>NORMALIZE</listitem>
<listitem>NUMBER</listitem>
<listitem>SELECT</listitem>
<listitem>TITLE</listitem>
<listitem>UNITS</listitem>
</itemizedlist>

<para>The following instructions are implied by the ASCIIELEV instruction:</para>

<itemizedlist>
<listitem>CONTROL (implied only if the emissions in the elevated ASCII file are controlled)</listitem>
<listitem>GRIDDING</listitem>
<listitem>PROJECTION (implied only if the emissions in the elevated ASCII file are grown)</listitem>
<listitem>SPECIATION [MASS|MOLE] (which option is used depends on the <envar>MRG_GRDOUT_UNIT</envar> setting, described below)</listitem>
<listitem>TEMPORAL</listitem>
</itemizedlist>

</section>

<section>

<title>BY instruction</title>

<para>The BY instruction controls what columns in addition to data columns will be printed in the output report. Multiple BY commands may appear in the same /CREATE REPORT/ packet, but not all combinations make sense. The BY instructions tell the program the basis on which to sum the emissions or activity values. The syntax of the BY instruction is:</para>

<para>BY &lt;option&gt;</para>

<para>with the following valid options:</para>

<itemizedlist>
<listitem>
<para>CELL: Records are printed by cell. This option requires the GRIDDING instruction, so <command>Smkreport</command> automatically adds the GRIDDING instruction when the BY CELL instruction is used (even if it is not actually in the <envar>REPCONFIG</envar> file).</para>
</listitem>
<listitem>
<para>COUNTRY [NAME]: Records are printed by country total. This option invokes use of the <envar>COSTCY</envar> file. NAME can be appended to the option to additionally output the country name instead of only the country number.</para>
</listitem>
<listitem>
<para>COUNTY [NAME]: Records are printed by county total. This option invokes use of the <envar>COSTCY</envar> file. NAME can be appended to the option to additionally output the county name instead of only the county number.</para>
</listitem>
<listitem>
<para>DIUCODE: Records are printed by diurnal profile code. This option will work correctly only when monthly temporal profiles have not been applied by pollutant.</para>
</listitem>
<listitem>
<para>ELEVSTAT: Records include the status of sources as elevated (E), plume-in-grid (P), and low-level (L). All elevated statuses could appear in the same report, depending on the inventory and elevated source selection criteria. This instruction can be used for point sources only.</para>
</listitem>
<listitem>
<para>HOUR: Records are printed by hour total for each day. This option implies the TEMPORAL instruction, so <command>Smkreport</command> automatically adds that instruction even if it was not included in the input.</para>
</listitem>
<listitem>
<para>LAYER: For point sources, emissions are printed by vertical layer. This option implies the LAYFRAC option (discussed later) that requires input of the <envar>PLAY</envar> SMOKE intermediate file; it also implies the BY HOUR instruction (above). Emissions will be written by hour as well as by layer. In the report, records are written first for one layer, then the next, and so on. <comment>The Java Analysis and Reporting Tool (JART) software can be used to sort the records in a different order.</comment> <remark>Only records with nonzero emissions in a layer are written.</remark> Since the number of records this report can generate is very large, we recommend that a source group be used to subselect the inventory records.</para>
</listitem>
<listitem>
<para>MONCODE: Records are printed by monthly profile code. This option will work correctly only when monthly temporal profiles have not been applied by pollutant.</para>
</listitem>
<listitem>
<para>PLANT [NAME]: For point sources, emissions are printed by plant total. This option cannot be used in conjunction with the BY SOURCE option; if the <envar>REPCONFIG</envar> file contains both instructions, SMOKE will ignore the BY PLANT instruction.</para>

<para>When the NAME option is included, the plant name will be included in the report. Otherwise, only the plant number will be included.</para>
</listitem>
<listitem>
<para>ROADCLASS: Records are printed by road class total. This option can only be used for mobile sources.</para>
</listitem>
<listitem>
<para>SCC10 [NAME]: Records are printed by full 10-digit SCC totals.</para>

<para>When the "NAME" option on the BY SCC10 instruction is included, the column delimiter default is automatically changed from a semi-colon to a pipe symbol ("|"). This is because the SCC descriptions include semi-colons, commas, and colons, causing some spreadsheet programs (e.g. Microsoft Excel) to not read in the report cleanly. Also, the SCC name is enclosed in double quotes, which can help with the delimiter issue. If the /DELIMITER/ instruction (discussed in <xref linkend="sect_qa_repconfig_delimiter" />) is used, the user-specified delimiter is included in all subsequent reports, regardless of whether the BY SCC10 instruction with the NAME option is set in the <envar>REPCONFIG</envar> file.</para>
</listitem>
<listitem>
<para>SOURCE [STACKPARM] [NAME]: Records are printed by source totals. Source characteristics are printed as well:</para>

<itemizedlist>
<listitem>Point: country/state/county code, plant ID, stack ID, point ID, segment ID, and SCC</listitem>
<listitem>Area: country/state/county code and SCC</listitem>
<listitem>Mobile: country/state/county code, road type code, vehicle type code, link ID, and SCC</listitem>
</itemizedlist>
 
<para>For area and mobile source, the SCC descriptions will automatically be included in the report. This is the same as adding the "BY SCC10 NAME" instruction to the report instructions. There is no way to turn off this feature.</para>

<para>For point sources, STACKPARM can be appended to the option to also output the stack parameters (height, diameter, exit velocity, exit temperature). Also for point sources, NAME can be appended to the option to get the facility names in the output file.</para>
</listitem>
<listitem>
<para>SPCCODE &lt;POLLUTANT&gt;: Records are printed by speciation profile codes assigned to sources by the speciation cross-reference file. <emphasis>Only one pollutant can appear with this command throughout the entire <envar>REPCONFIG</envar> file.</emphasis> The pollutant should be one that is in the inventory file and that was processed as part of the chemical speciation file run. This BY option does not imply the SPECIATION instruction (see below), and it can be used without included speciated emissions in the report. For example, the BY SPCCODE instruction may be used to indicate which speciation profiles were assigned to total VOC emissions (without reporting speciated VOC emissions).</para>
</listitem>
<listitem>
<para>SRGCODE [FALLBACK]: Records are printed by surrogate codes assigned to sources by the gridding cross-reference file. If no option is used, both primary and fallback surrogate codes are included in the output report. If the FALLBACK option is used, only the fallback surrogate codes are included in the output report, and a zero is used for all records that did not use a fallback surrogate (i.e., their primary surrogate did not cause emissions to go to zero). This BY option does not imply the GRIDDING instruction (see below); therefore, it can be used without applying the gridding matrix in the report. A value of -9 is used for fallback surrogate IDs in the resulting report.</para>
</listitem>
<listitem>
<para>STATE [NAME]: Records are printed by state totals. This option invokes the use of the COSTCY file. NAME can be appended to the option to additionally output the state name instead of only the state number.</para>
</listitem>
<listitem>
<para>WEKCODE: Records are printed by weekly profile code. This option will work correctly only when monthly temporal profiles have not been applied by pollutant. Note that this option spelling is <emphasis>not</emphasis> WEEKCODE.</para>
</listitem>
</itemizedlist>

<para>The most detailed BY instruction will determine the resolution of the emissions and activity totals. For example, the COUNTRY, STATE, and COUNTY options can be used in the same report to affect the column headers, but the data output will not be different because the emissions totals will be at the finest resolution specified. In other words, if the instructs are to report BY COUNTY and BY STATE, the emission totals in that report will be by county, and the BY STATE instruction will merely add the state name to the columns printed. Another example is that the BY SCC10 instruction will override the resolution of BY ROADCLASS.</para>

<para>Future versions of the BY command may support the following options, if a need for them is identified by SMOKE users:</para>

<itemizedlist>
<listitem>
<para>SCC[#] [NAME]: Records are printed by collections of SCCs based on the number selected from 1 to 10. SCC-levels would match the 4 available levels for 8-digit and 10-digit SCCs. For example, SCC3 would sum emissions by SCC tier with the structure ###*******, where ### is the first three digits of the SCCs, and the asterisks indicate that the rest of the SCC number is ignored for purposes of grouping. NAME can be used to include the name of the SCC (or the appropriate SCC level) as one of the records in the output report.</para>
</listitem>
<listitem>
<para>STACK [NAME]: For point sources only, records are printed as facility and stack totals. NAME can be appended to the option to get the facility names in the output file.</para>
</listitem>
<listitem>
<para>POINT [NAME]: For point sources only, records are printed as facility, stack, and point totals. NAME can be appended to the option to get the facility names in the output file.</para>
</listitem>
<listitem>
<para>VTYPE: For mobile sources only, records are printed as vehicle-type totals.</para>
</listitem>
<listitem>
<para>SIC: For point sources only, records are printed as Standard Industrial Code (SIC) totals.</para>
</listitem>
<listitem>
<para>GROUP &lt;option&gt;: Records are printed based on the user-defined groups, with the following options:</para>

<itemizedlist>
<listitem>REGION: Rows in report are user-defined region groups.</listitem>
<listitem>SCC: Rows in report are user-defined SCC groups.</listitem>
<listitem>SOURCE: Rows in report are user-defined source groups, by SMOKE record number.</listitem>
<listitem>HOURS: Rows in report are user-defined hour groups.</listitem>
</itemizedlist>

</listitem>
</itemizedlist>

</section>

<section>

<title>CONTROL instruction</title>

<para>The CONTROL instruction applies the multiplicative control matrix to all pollutants and species requested in the report. This instruction does not limit the options available for resolution of the report, so reports that have the CONTROL instruction can also include any combination of BY instructions.  <command>Smkreport</command> is unable to apply the reactivity control matrix at this time.</para>

</section>

<section>

<title>GRIDDING instruction</title>

<para>The GRIDDING instruction controls whether or not the gridding matrix is used by <command>Smkreport</command>. When the instruction is present, the gridding matrix is used in generating the report; the matrix is applied to the emissions before the totals are made. The gridding matrix file name is determined by the environment variables set at run time. One use of the GRIDDING instruction would be the following: a report could be generated without GRIDDING to see emission totals before gridding, and another report could be generated with GRIDDING to see the totals after gridding. The totals from the two reports could be compared to see if any emissions were lost because of the gridding step.</para>

<para>The GRIDDING instruction is assumed when any of the following other instructions appear in the packet:</para>

<itemizedlist>
<listitem>SELECT SUBGRID</listitem>
<listitem>BY CELL</listitem>
<listitem>NORMALIZE CELLAREA</listitem>
</itemizedlist>

</section>

<section>

<title>LAYFRAC instruction</title>

<para>The LAYFRAC instruction controls whether or not the point source layer fractions file (<envar>PLAY</envar>) from the <command>Laypoint</command> program is used in determining elevated and low-level sources. If the <envar>PLAY</envar> file is not used for determining elevated sources, the <envar>PELV</envar> file from the <command>Elevpoint</command> program will be required.</para>

</section>

<section>

<title>NORMALIZE instruction</title>

<para>The NORMALIZE instruction controls whether or not the emission values will be normalized using some other data value. Two normalize options are currently supported; CELLAREA and POPULATION. Emissions normalization can provide additional insight to the inventory, more than can be obtained by simply summarizing emissions values.</para>

<para>The syntax of the NORMALIZE instruction is:</para>

<para>NORMALIZE &lt;option&gt;</para>

<para>with the following valid options:</para>

<itemizedlist>
<listitem>
<para>CELLAREA: Normalize emissions based on grid cell area. When the emissions are normalized by cell area, they are divided by the area of each cell (or just the cells selected, if a subgrid is used). Normalizing by grid cell area is useful for comparing emission reports from grids at different resolutions, including nested grids, to ensure that a consistent emissions density is maintained across the multiple grid resolutions.</para>

<para>For Lambert and UTM grids, the cell ares are computed using the formula:</para>

<para><emphasis>DX</emphasis> * <emphasis>DY</emphasis></para>

<para>where</para>

<itemizedlist>
<listitem><emphasis>DX</emphasis> is the cell x-direction size in meters</listitem>
<listitem><emphasis>DY</emphasis> is the cell y-direction size in meters</listitem>
</itemizedlist>

<para>For lat-lon grids, the area of the lat-lon cell are estimated using the formula:</para>

<para>(cos <emphasis>Y</emphasis>)*( <phrase role="symbol">&pi;</phrase> * <emphasis>DX</emphasis> * <emphasis>R</emphasis> / 180 )*( <phrase role="symbol">&pi;</phrase> * <emphasis>DY</emphasis> * <emphasis>R</emphasis> / 180 )</para>

<para>where</para>

<itemizedlist>
<listitem><emphasis>DX</emphasis> is the cell x-direction size in degrees longitude</listitem>
<listitem><emphasis>DY</emphasis> is the cell y-direction size in degrees latitude</listitem>
<listitem><emphasis>Y</emphasis> is the cell center in degrees latitude</listitem>
<listitem><emphasis>R</emphasis> is the radius of the earth in meters</listitem>
</itemizedlist>

<para>This instruction requires that the GRIDDING instruction also be used, because the gridding information is needed in order to normalize the emissions by grid area. If the GRIDDING instruction is left out of the report instructions, <command>Smkreport</command> will add it to the report and continue.</para>
</listitem>
<listitem>
<para>POPULATION: Normalize emission based on county population.  Emissions in the report are divided by county population, regardless of whether the BY COUNTY instruction has been used in the report instructions.</para>

<para>This option requires that the <envar>COSTCY</envar> input file to <command>Smkreport</command> include an additional field and a #POPULATION header (as is described in the <envar>COSTCY</envar> documentation in <xref linkend="ch_input_files" />).</para>
</listitem>
</itemizedlist>

<para>Future versions of the NORMALIZE instruction may support the following option, if a need for this option is identified by SMOKE users:</para>

<itemizedlist>
<listitem>
<para>NORMALIZE COUNTYAREA: Normalize emissions based on county area.</para>
</listitem>
</itemizedlist>

</section>

<section>

<title>NUMBER instruction</title>

<para>The NUMBER instruction controls the format used to display <emphasis>data values</emphasis> in the report. The argument for the number instruction applies to all data values that are written to the report, and the structure of the argument is simply the formats supported by Fortran. The data values in the reports are rounded to the nearest value allowed based on the format selected. A value of 5 is rounded up to the next decimal place, when such rounded is needed.</para>

<para>The syntax of the NUMBER instruction is simply:</para>

<para>NUMBER &lt;format&gt;</para>

<para>where &lt;format&gt; is the Fortran format specification. The common formats you might use are the following:</para>

<itemizedlist>
<listitem>
<para>Float format: F&lt;x&gt;.&lt;y&gt;: where &lt;x&gt; is the number of digits for the number, including the decimal place, and &lt;y&gt; is the number of digits shown after the decimal place.</para>
</listitem>
<listitem>
<para>Exponential format: E&lt;x&gt;.&lt;y&gt;: where &lt;x&gt; is the complete width of the value, including five characters for "E+00" and the decimal, and &lt;y&gt; is the number of significant figures.</para>
</listitem>
</itemizedlist>

<para>If the NUMBER instruction does not appear in the report instructions, the E8.3 format is used.</para>

</section>

<section>

<title>PROJECTION instruction</title>

<para>The PROJECTION instruction will apply the growth matrix to all pollutants and species requested in the report.  This instruction does not limit the options available for resolution of the report, so reports that have the PROJECTION instruction can also include any combination of BY instructions.</para>

</section>

<section>

<title>SELECT instruction</title>

<para>The SELECT instruction controls which records in the inventory are used in generating the report. It allows the user to extract particular records from the inventory, for inclusion in the report. This instruction also permits references to the groups defined in the Define-groups section of the <envar>REPCONFIG</envar> file. If no SELECT instruction is used, then the other report instructions will be applied to all records in the inventory. Only one SELECT statement of each type is permitted in per report; for example, only one SELECT REGION statement and one SELECT SUBGRID statement could be used for a single report. Of course, different SELECT REGION or SELECT SUBGRID instructions could be used for different reports in the same output file.</para>

<para>The syntax of the command is:</para>

<para>SELECT &lt;options&gt; &lt;label&gt;</para>

<para>where &lt;label&gt; is an optional field, depending on the &lt;option&gt; selected. The following options are available for the SELECT instruction:</para>

<itemizedlist>
<listitem>
<para>DATA &lt;label&gt;: Selects data values to include in the report. When no SELECT DATA instruction is used, all pollutants, activities, or species found in the input file(s) are reported. When species are being reported, the corresponding pollutants in the inventory or hourly emissions file are reported as well as the speciated emission values. The &lt;label&gt; must be a space-delimited list of pollutant, activity, or species names. Do not include the pollutant names in the list when species are listed, as these will be included by default.</para>

<para>To specify a species value when the species name is the same as the pollutant name, an "S" and a hyphen can be inserted before the species name. You can also use this method for specifying the sum of post-speciated emissions. For instance, to specify carbon monoxide after speciation, the SELECT instruction should be:</para>

<para>SELECT DATA S-CO</para>

<para>To specify the sum of VOC emissions after speciation, the SELECT instruction should be:</para>

<para>SELECT DATA S-VOC</para>

<para><emphasis>Note that <command>Smkreport</command> does not determine whether the summation makes sense, and does not correct for species molecular weights.</emphasis> You must ensure that your data requestions make sense.</para>

<para>Also note that the maximum number of characters that can be read on anly line in this file is 300. This can limit the number of pollutants that you can specifically request in a SELECT DATA statement.</para>
</listitem>
<listitem>
<para>ELEVATED [PING]: Selects all elevated point sources (recognized for point sources only). If no elevated sources are found (after applying all other selection criteria), the report will contain a warning to that effect. If the PING option appears, only plume-in-grid sources will be selected. When the ELEVATED instruction is used by any report, the <envar>PELV</envar> file (from <command>Elevpoint</command>) or <envar>PLAY</envar> file (from <command>Laypoint</command>) will be required to determine which sources are elevated. The latter will be used when the LAYFRAC instruction is also included in the report instructions. If the PING option is used, the <envar>PELV</envar> file will be required in all cases, although the LAYFRAC instruction can still be used to set the elevated source status based on the layer fractions.</para>
</listitem>
<listitem>
<para>NOELEVATED: Selects all low-level point sources (recognized for point sources only). If both the ELEVATED and NOELEVATED commands appear in the same report, a warning will be given, and the latter setting will be used to generate the report. If no low-level sources are found (after applying all other selection criteria), the report will contain a warning to this effect. The same rules apply for use of the <envar>PELV</envar> or <envar>PLAY</envar> files as described for the ELEVATED option.</para>
</listitem>
<listitem>
<para>REGION &lt;label&gt;: Selects a region using the country/state/county code or a region group. For this option, &lt;label&gt; must be either a country/state/county code in NSSCCC format, or a region group label from the Define-group section of the <envar>REPCONFIG</envar> file.</para>
</listitem>
<listitem>
<para>SUBGRID &lt;label&gt;: Selects a subgrid using the grid cell numbers or a subgrid group label. For this option, &lt;label&gt; must be either a range of grid cells, or a subgrid label from the Define-group Section of the file. When the &lt;label&gt; defines the cell range, you should use the same syntax that was specified above for the /DEFINE SUBGRID/ packet. However, the INCLUDE setting is assumed, and <command>Smkreport</command> will not understand the INCLUDE and EXCLUDE commands as part of the &lt;label&gt;.</para>

<para>For the REGION and SUBGRID options, the value of &lt;label&gt; must either match a group or subgrid label or match characteristics of the inventory or grid. Also, the &lt;label&gt; for the REGION and SUBGRID options must be 200 characters or fewer.</para>
</listitem>
</itemizedlist>

<para>Future versions of <command>Smkreport</command> may support the following additional options, if a need is identified:</para>

<itemizedlist>
<listitem>
<para>SCC &lt;label&gt;: Select a single SCC or SCC group for reporting.</para>
</listitem>
<listitem>
<para>PLANT &lt;label&gt;: Select a single point source plant, or a plant group for reporting.</para>
</listitem>
<listitem>
<para>STACK &lt;label&gt;: Select a single point source stack, or a stack group for reporting.</para>
</listitem>
<listitem>
<para>POINT &lt;label&gt;: Select a single point source point, or a point group for reporting.</para>
</listitem>
<listitem>
<para>HOURS &lt;label&gt;: Select a single hour or hour group for reporting.</para>
</listitem>
<listitem>
<para>SOURCE &lt;label&gt;: Select a single source or source group for reporting.</para>
</listitem>
</itemizedlist>

</section>

<section>

<title>SPECIATION instruction</title>

<para>The SPECIATION instruction controls whether the speciation matrix is used by the program. This option controls the columns of data that will be printed in the output file. When the SPECIATION instruction is in the report instructions, the columns in the output file will include speciated emissions values as well as inventory emissions from the SMOKE inventory or hourly emissions file (depending on whether or not the TEMPORAL instruction is used). When the SPECIATION instruction is not used, the columns in the output file will be inventory emissions and/or activities.</para>

<para>The syntax of the SPECIATION instruction is:</para>

<para>SPECIATION &lt;option&gt;</para>

<para>where the following options are supported</para>

<itemizedlist>
<listitem>
<para>MOLE: Uses the mole-based speciation matrix.</para>
</listitem>
<listitem>
<para>MASS: Uses the mass-based speciation matrix.</para>
</listitem>
</itemizedlist>

</section>

<section>

<title>TEMPORAL instruction</title>

<para>The TEMPORAL instruction controls whether or not emission values are used from the hourly emission files <envar>ATMP</envar>, <envar>MTMP</envar>, or <envar>PTMP</envar>. When this instruction is used, the default behavior of <command>Smkreport</command> is to sum up the emissions by day and report emissions as daily totals. To override this behavior, the BY HOUR instruction must be used.</para>

<para>When dates and times are given in the report, the hours are reported in the time zone from the <envar>ATMP</envar>, <envar>MTMP</envar>, or <envar>PTMP</envar> file. Hours are reported as <emphasis>standard</emphasis> time values for the time zone stored in the header of the hourly emissions file; hours are never reported as <emphasis>daylight</emphasis> time values.</para>

<para>The TEMPORAL instruction is assumed when either of the following options appear in the report instructions:</para>

<itemizedlist>
<listitem>SELECT HOURS</listitem>
<listitem>BY HOUR</listitem>
</itemizedlist>

<para>In the future, we may be able to enhance this instruction to permit the reported hour values to be labeled with a different time zone than is in the hourly emissions file.</para>

</section>

<section>

<title>TITLE instruction</title>

<para>The TITLE instruction allows one or more titles to be added to a report. The titles are printed into the report in the order in which they appear in the packet. Quotes are <emphasis>not</emphasis> needed in titles with blank spaces. The title will be ended at the last character on the line, or at a double pound sign (##), whichever appears first on the line. Double pound signs cannot be printed in the titles of reports. It is recommended that titles be 80 characters wide. The maximum title width is 300 characters. The syntax of the TITLE instruction is the following:</para>

<para>TITLE &lt;title text&gt;</para>

</section>

<section>

<title>UNITS instruction</title>

<para>The UNITS instruction allows you to control the units of the output data. The current version of <command>Smkreport</command> does not permit you to vary the units by data value; instead, the same units must be used for all data values, or the default units will be used. Future versions of <command>Smkreport</command> may permit control of the units by data variable.</para>

<para>All unit conversions that <emphasis>can</emphasis> be done, will be done. For example, if the inventory is stored in tons/hour, and the output is requested in fathoms/day, the hour-to-day conversion will be made, while the impossible tons-to-fathoms conversion will not be made. The syntax of the UNITS instruction is the following:</para>

<para>UNITS ALL &lt;units&gt;</para>

<para>Valid values for the &lt;units&gt; option numerator are the following:</para>

<itemizedlist>
<listitem>ton(s)</listitem>
<listitem>g, gm(s), gram(s)</listitem>
<listitem>kg(s)</listitem>
<listitem>mole(s), gm mole(s)</listitem>
</itemizedlist>

<para>Valid values for the &lt;units&gt; option denominator are the following:</para>

<itemizedlist>
<listitem>year(s), yr(s)</listitem>
<listitem>day</listitem>
<listitem>hour(s), hr(s)</listitem>
<listitem>min(s)</listitem>
<listitem>day(s)</listitem>
<listitem>s, sec(s)</listitem>
</itemizedlist>

<para>No quotes are needed around the unit labels, and they must be 30 characters or fewer. Some examples of the units instruction are the following:</para>

<programlisting>UNITS ALL gm moles/s
UNITS ALL tons/hr
UNITS ALL kg/year</programlisting>

</section>

</section>

<section id="sect_qa_repconfig_delimiter">

<title>The /DELIMITER/ packet</title>

<para>The /DELIMITER/ packet can be used to change the column delimiter used in the output reports from <command>Smkreport</command>. The default delimiter is a semicolon (";"). You can change the delimiter to any single-character value to suit your needs, although using a space as a delimiter may result in slightly misformatted reports. Some reasons to change the delimiter from the default are:</para>

<itemizedlist>
<listitem>
<para>You are reporting "BY SOURCE" and including the source name, and it has semicolons included in one or more of the names. This would prevent those records in the output report from being read into another program using semicolon as the delimeter.</para>
</listitem>
<listitem>
<para>Software you want to use to read the <command>Smkreport</command> output report does not support semi-colons for delimiters.</para>
</listitem>
<listitem>
<para>You prefer a different appearance in the reports; you can select another delimiter that does not conflict with other fields in your report.</para>
</listitem>
</itemizedlist>

<para>The syntax of this instruction is the following:</para>

<para>/DELIMITER/ ,</para>

<para>This example results in a comma (",") being used as the delimiter for columns of any results from /CREATE REPORT/ instructions that followed this instruction in the <envar>REPCONFIG</envar> file.</para>

</section>

<section id="sect_qa_repconfig_report_time">

<title>The /REPORT TIME/ packet</title>

<para>The /REPORT TIME/ packet can be used to change the hour value for which daily-total hourly emissions are output. The syntax of this instruction is the following:</para>

<para>/REPORT TIME/ &lt;HHMMSS&gt;</para>

<para>The setting uses HHMMSS format, in which HH is the hour and MMSS is 0000. The time specified is in the time zone of the input hourly data file. This setting is ignored when hourly data are not input to <command>Smkreport</command>. The default behavior of <command>Smkreport</command> is to report at the last hour of the day, hour 23 (hours are counted from 0 to 23). This setting must be consistent with the SMOKE intermediate files, which use hour numbers 0 through 23 because they are based on the I/O API. However, these hour numbers are different from those included in the report because of the "BY HOUR" instruction, which numbers the hours 1 through 24.</para>

</section>

<section id="sect_qa_repconfig_aveday">

<title>The /AVEDAY/ packet</title>

<para>The /AVEDAY/ packet can be used to toggle on or off the use of the average-day emissions from the SMOKE inventory file. The syntax of the command is the following:</para>

<para>/AVEDAY/ &lt;option&gt;</para>

<para>The &lt;option&gt; field can be set to Y or N. The default behavior of the program (if no /AVEDAY/ packet appears) is to <emphasis>not</emphasis> use the average-day emissions in the reports. This packet only affects the program <emphasis>only</emphasis> when the inventory emission are being reported. If the TEMPORAL instruction is given, the output report will contain whatever emission values were used to create the hourly emissions file.</para>

</section>

<section id="sect_qa_repconfig_newfile">

<title>The /NEWFILE/ packet</title>

<para>The /NEWFILE/ packet can be used before or between any /CREATE REPORT/ packets to cause <command>Smkreport</command> to write out the subsequent reports to a different report file. The syntax of the command is the following:</para>

<para>/NEWFILE/ &lt;Filename&gt;</para>

<para>The placeholder &lt;Filename&gt; is replaced by either:</para>

<orderedlist>
<listitem>
<para>A physical file name, including the path.</para>
</listitem>
<listitem>
<para>A logical file name.</para>
</listitem>
</orderedlist>

<para><command>Smkreport</command> will detect whether the file is a physical or logical file name by checking to see if the &lt;Filename&gt; value is defined with a nonblank value in the run-time environment. If it is, then <command>Smkreport</command> assumes the value is a logical file name, and opens a file using the value found from the environment.</para>

<para>If no information is given for &lt;Filename&gt;, the output files will be named by their automatic logical file names, <envar>REPORT[#]</envar>, where [#] is replaced by the number of the report file in order of its associated /NEWFILE/ packet.</para>

</section>

</section>

<section id="sect_qa_output">

<title>Reports Created by <command>Smkreport</command></title>

<para>As described in <xref linkend="sect_qa_smkreport" />, the <command>Smkreport</command> program creates user-defined reports and summaries for QA purposes based on the SMOKE intermediate files (e.g., SMOKE inventory files, hourly emissions, speciation matrix, gridding matrix). The reports that are created by <command>Smkreport</command> can easily be imported into a spreadsheet program (such as Microsoft&copy; Excel&copy;) or into a database because the ASCII output format is delimited. Note that report files larger than about 60,000 lines will not importable into Excel&copy; because of limitations of that software.</para>

<para>Because <command>Smkreport</command> is very flexible, there are a large number of reports that you can generate. The "File Format(s)" section below describes the guidelines that <command>Smkreport</command> uses in building the output reports, based on the instructions the user provides to <command>Smkreport</command>. This section is followed by a large number of example reports, to help you understand the possible format options.</para>

<section>

<title>File format(s)</title>

<section>

<title>Multiple reports in one file</title>

<para>Each file output by <command>Smkreport</command> can contain multiple reports. The user has control over how many reports are included in each file (please see the <envar>REPCONFIG</envar> file documentation above for more information on using the /CREATE REPORT/ and /NEWFILE/ packets). The reports in a file are separated by a row of pound signs (#). If having multiple reports in a single file causes problems for importing the data into other software, then you should create a <envar>REPCONFIG</envar> file that specifies a new file for each report.</para>

</section>

<section>

<title>Basic report structure</title>

<para>The reports in an output file use columns and rows to structure the information. The reports are structured to permit the user to import a report into spreadsheet or database software, or some other data-processing tool for further analysis. The columns in the reports are semicolon delimited (though the delimiter can be set by the user), have labels, and have units. Where possible, we have also tried to make sure that the text versions of the reports can be viewed easily. The width of the widest entry in a column is used to set the width for the column, thereby making fixed-file format transfer to other software possible.</para>

</section>

<section>

<title>Advanced report structures</title>

<para>Using the ARRANGE instruction in the <command>Smkreport</command> <envar>REPCONFIG</envar> input file, you can also create reports with more advanced structures: a single report that is composed of multiple physical files; a report that is single physical file but has multiple sections; or a report that uses a "database" format of one data value (e.g., emissions value) per line. Use of these formats is described in the <envar>REPCONFIG</envar> file documentation in <xref linkend="sect_qa_repconfig" />.</para>

</section>

<section>

<title>Structure template</title>

<para>The following is a general template for the <command>Smkreport</command> output files. It consists of a REPORTS section and a METADATA section. These two sections are discussed in detail below the template.</para>

<programlisting><![CDATA[<REPORT1>
     <User Title(s), one per line>
     <Automatic Titles, one per line>
     <Column headers>
     <Units, for columns that need them>
     <Line of minus signs>
     <Data values for all rows>
##########################################################################
<REPORT2, if any>
     <User Title(s), one per line>
     <Automatic Titles, one per line>
     <Column headers>
     <Units, for columns that need them>
     <Line of minus signs>
     <Data values for all rows>
##########################################################################
METADATA
     <Input files>
     <Echoed group definitions from REPCONFIG file>
     <Echoed report instructions from REPCONFIG file>
<End of file>]]></programlisting>

</section>

<section>

<title>Elements of the REPORTS section</title>

<section>

<title>User titles</title>

<para>The first section of each report is a title section. The first title entries in the report are any titles specified in the /CREATE REPORT/ packets in the <envar>REPCONFIG</envar> file, created by the user. They are listed in the same order as those provided in the input packets for the report. It is recommended that user titles be no more than 80 characters wide (to more easily fit on printed documents), although they can have up to 300 characters.</para>

</section>

<section>

<title>Automatic titles</title>

<para>Automatic titles are inserted by <command>Smkreport</command> to indicate the operations that were done by <command>Smkreport</command> to generate the requested report. This helps the report be self-describing. The automatic titles are formatted to be no larger than 80 characters wide, in order to permit easier viewing as text files. The following automatic titles are applied, where applicable:</para>

<itemizedlist>
<listitem>
<para>The source category processed</para>
</listitem>
<listitem>
<para>The year of the base inventory</para>
</listitem>
<listitem>
<para>The year of the grown inventory (only if a grown inventory file is input to <command>Smkreport</command>)</para>
</listitem>
<listitem>
<para>Whether growth factors were applied, and if so, for what year</para>
</listitem>
<listitem>
<para>Whether multiplicative control factors were applied, and if so, for what year</para>
</listitem>
<listitem>
<para>Whether a gridding matrix was applied, and if so, the grid name</para>
</listitem>
<listitem>
<para>Whether a speciation matrix was applied, and if so, whether it was mole-based or mass-based</para>
</listitem>
<listitem>
<para>Whether annual, average-day, or hourly data from SMOKE intermediate files are the basis of the emissions in the report</para>
</listitem>
<listitem>
<para>If hourly data were input, the time period processed with dates, hours, and time zones</para>
</listitem>
<listitem>
<para>Whether annual or average-day data were the basis for the report</para>
</listitem>
<listitem>
<para>Whether the emissions are divided by grid cell area (NORMALIZE CELLAREA instruction)</para>
</listitem>
<listitem>
<para>Whether the emissions are divided by population (NORMALIZE POPULATION instruction)</para>
</listitem>
<listitem>
<para>The name of the group used to select the data, if any (the group definition will be listed in the METADATA section)</para>
</listitem>
<listitem>
<para>The name of the subgrid used to select the data, if any (the subgrid definition will be listed in the METADATA section)</para>
</listitem>
</itemizedlist>

</section>

<section>

<title>Data columns written</title>

<para>The particular columns of data that are written to a report are determined by the BY instructions in the /CREATE REPORT/ packet. Typically, one column is created for each BY instruction, which corresponds to the name of the BY instruction. The exceptions to this rule are the following:</para>

<itemizedlist>
<listitem>
<para>The BY COUNTRY, BY STATE, and BY COUNTY instructions, which output the country, state, and county codes, and optionally the country, state, and county names, respectively (if NAME is included at the end of the instruction).</para>
</listitem>
<listitem>
<para>The BY SOURCE instruction, which outputs columns for all source characteristics (point sources: country/state/county, plant, char1, char2, char3, char4, char5; area sources: country/state/county, SCC; mobile sources: country/state/county, road class, vehicle type, SCC). For point sources, the BY SOURCE instruction can also output four additional columns for stack parameters, and another additional column for facility name.</para>
</listitem>
</itemizedlist>

<para>In addition to the columns specified by the BY instructions, the emissions and/or activity data are written out to the report. If no speciation option is used (i.e., the SPECIATION instruction is not given), then the other data columns are the emissions and activities from the SMOKE inventory file (e.g., NOX, VOC, PM10, VMT). If the speciation option <emphasis>is</emphasis> used, then the other data columns are the speciated emissions data (e.g., NO, NO2, ALD, PAR, ISOP). The SELECT DATA instruction determines which inventory data and speciated emissions data are written to the reports. When speciated data are output, the columns for the corresponding inventory pollutants are written as well (as explained more fully in the input file description of the SELECT DATA instruction, earlier).</para>

<para>The order of the columns of data values is taken from the order of the data in the SMOKE intermediate files. The orders of pollutants and activities are controlled by the <envar>INVTABLE</envar> file when <command>Smkinven</command> is run to create the SMOKE inventory files. Species are arranged by <command>Spcmat</command> based on the order of the pollutants, and then alphabetically for species coming for the same pollutant, and this order is used to create the speciation matrix.</para>

</section>

<section>

<title>Column delimiters</title>

<para>The default column delimiter in most cases is a semicolon (";"). However, if you select the "BY SCC10 NAME" instruction, the SCC description will be included in the report and the default delimiter will be a pipe symbol ("|"). This is because the SCC descriptions can include semicolons. In either case, you can use the /DELIMITER/ packet to manually set your choice of delimiter, if desired.</para>

</section>

<section>

<title>Column headers</title>

<para>Each column of data is labeled with a header name. Where applicable, the columns also are labeled with units (discussed below), as set by the UNITS instruction or by the default units for the data used by the program. For the emissions and activity data, the header names are simply the names of the pollutants or activity variables input to SMOKE. For columns generated by the BY instructions, the following possible column headers are used by SMOKE. These are listed in the order in which they would appear.</para>

<itemizedlist>
<listitem>Date (values of MM/DD/YYYY)</listitem>
<listitem>Hour (integer values from 1 through 24)</listitem>
<listitem>Layer number (integer values >0)</listitem>
<listitem>X cell (integer values >0)</listitem>
<listitem>Y cell (integer values >0)</listitem>
<listitem>Source ID (SMOKE record number, integer values >0)</listitem>
<listitem>Co/St/Cy (Country, state, and county code; values of NSSCCC, with SS and/or CCC replaced by zeros as necessary, depending on the BY option used)</listitem>
<listitem>Country (value is name; optional when country, state, and county code is output)</listitem>
<listitem>State (value is name; optional when country, state, and county code is output)</listitem>
<listitem>County (value is name; optional when country, state, and county code is output)</listitem>
<listitem>SCC (10-character values, with 2 leading zeros for 8-character SCCs)</listitem>
<listitem>Primary Srg (primary surrogate ID code; for area or mobile sources only)</listitem>
<listitem>Fallbk Srg (fallback surrogate ID code; for area or mobile sources only)</listitem>
<listitem>Monthly Prf (monthly temporal profile code)</listitem>
<listitem>Weekly Prf (weekly temporal profile code)</listitem>
<listitem>Diurnal Prf (diurnal temporal profile code)</listitem>
<listitem>Spec Prf (speciation profile code)</listitem>
<listitem>Plant ID (for point sources only) or Road (road class; for mobile sources only)</listitem>
<listitem>Char 1 (for IDA inventories, the point-source stack ID) or Veh Type (vehicle type; for mobile sources only)</listitem>
<listitem>Char 2 (for IDA inventories, the point-source point ID)</listitem>
<listitem>Char 3 (for IDA inventories, the point-source segment ID)</listitem>
<listitem>Char 4 (for point sources only; may or may not be defined)</listitem>
<listitem>Char 5 (for point sources only; may or may not be defined)</listitem>
<listitem>Stk Ht (stack height; for point sources only)</listitem>
<listitem>Stk Dm (stack diameter; for point sources only)</listitem>
<listitem>Stk Tmp (stack exit temperature; for point sources only)</listitem>
<listitem>Stk Vel (stack exit velocity; for point sources only)</listitem>
<listitem>Elevstat (E= elevated, P= Plume-in-grid, L= low-level; for point sources only)</listitem>
<listitem>Plt Name (facility name with quotes around it; for point sources only)</listitem>
<listitem>SCC Description (quotes around it)</listitem>
</itemizedlist>

</section>

<section>

<title>Header units</title>

<para>The units used in the header for each column depend on (1) the units in the input files, (2) the units set as output units in the report instructions, and (3) any normalization used. <command>Smkreport</command> starts with the units obtained from the input files and application of any matrices of interest. Then all unit conversions that can be made, are made. The conversions are done separately on the numerator and the denominator, but one or both of the conversions will not be done if <command>Smkreport</command> has not been configured for the conversions. If this is the case, a note will appear to this effect in the log file. Last, the units are converted to 1/m<subscript>2</subscript> if the NORMALIZE CELLAREA instruction has been given.</para>

<para>Below the header units, a line of minus signs will appear in the reports.</para>

</section>

<section>

<title>Data rows</title>

<para>The rows of data (i.e., emissions totals or activity totals) are listed sequentially, without spaces between the rows, in sorted order according to the BY instructions, and based on the order listed in the file (just explained above). Data-value-based sorting is not done by <command>Smkreport</command>, but rather left for a postprocessing step of other data manipulation software. Unlike the title rows, the length of the data rows constrained only by the maximum number of characters per ASCII line, which varies based on the platform you are using. The ARRANGE instruction can be used to improve the arrangement of data rows when the lines are too large or the program is not working properly because of the large number of data values requested in a report.</para>

<para>The data values in the rows are formatted based on the NUMBER instruction for the report.</para>

<para>The resolution of the data values (e.g., summed by SCC) depends on the BY instructions for the report. The inventory records included in the totals (i.e., which sources are included in the reported emissions) depend on the SELECT instructions for the report. More description of these instructions and how they affect the output is provided with the <envar>REPCONFIG</envar> file format information given earlier.</para>

</section>

</section>

<section>

<title>Elements of the METADATA section</title>

<para>Note: this section is not yet implemented in SMOKE. Once implemented, this section of the reports will begin by a line with the word METADATA on it.</para>

<section>

<title>Input files</title>

<para>In this part of the METADATA section, all of the input files used in running the program are provided, one on each line. The full path and file name will be provided.</para>

</section>

<section>

<title>Echoed group definitions</title>

<para>The group definitions from the <envar>REPCONFIG</envar> file used to generate the file will be listed in this section. The definitions will be merely copied directly from the input file to this section of the output report.</para>

</section>

<section>

<title>Echoed report instructions</title>

<para>The report instructions from the <envar>REPCONFIG</envar> file used for creating each report in the file will be listed in this section. The instructions will be merely copied directly from the input file.</para>

</section>

</section>

</section>

<section>

<title>Example reports</title>

<para>Given below are just a few examples of the many types of reports <command>Smkreport</command> can generate. Note that no actual emission data values are given in these examples (and sometimes the emission values are not even listed). Also, no example is given with two reports in a single file. When we created these examples, we pretended that the inventory used to generate the reports had only CO and NOx available. Also, we have not provided the entire reports, but rather a sampling of what each report looks like, without showing all states, SCCs, etc.</para>

<section>

<title>Example 1</title>

<programlisting>Country-total point-source inventory emissions, with country names
1996 Inventory
No gridding

Co/St/Cy, Country Name, CO       , NOX
        ,             , [tons/yr], [tons/yr]
--------------------------------------------
  000000, US          , 602390.4 , 302123.1
  100000, Canada      , 312233.3 , 197158.9
  200000, Mexico      , 809822.1 , 289321.3</programlisting>

</section>

<section>

<title>Example 2</title>

<programlisting>State-total point-source emissions, with state names
1996 Inventory
No gridding

Co/St/Cy, State Name    , CO        , NOX   
        ,               , [tons/yr] , [tons/yr]
------------------------------------------------
  010000, Alabama       ,    2390.4 ,    2123.1 
  037000, North Carolina,    5233.3 ,    2400.9 
  045000, South Carolina,    3822.1 ,    1321.3</programlisting>

</section>

<section>

<title>Example 3</title>

<programlisting>County-total area-source emissions, with state and county names
1996 Inventory
No gridding

Co/St/Cy, State Name    , County Name , CO        , NOX       
        ,               ,             , [tons/yr] , [tons/yr] 
--------------------------------------------------------------
  037001, North Carolina, Alamance Co , 0.2344E+03, 0.1235E+03
  037003, North Carolina, Alexander Co, 0.1354E+03, 0.9909E+02
  037005, North Carolina, Alleghany Co, 0.9807E+02, 0.7897E+02
  037007, North Carolina, Anson Co    , 0.8734E+03, 0.9807E+02
  037009, North Carolina, Ashe Co     , 0.1140E+03, 0.9871E+02</programlisting>

</section>

<section>

<title>Example 4</title>

<programlisting>Hourly area-source emissions by county for first 3 counties in NC
1996 Inventory
No gridding
July 1, 1996 at 0 GMT to July 7, 1996 at 23 GMT

Day       , Hour, Co/St/Cy, CO        , NOX      
          ,     ,         , [tons/hr] , [tons/hr]
-------------------------------------------------
07/01/1996,    0,   037001,     0.1234,   0.5678 
07/01/1996,    0,   037003,     0.1247,   0.5725 
07/01/1996,    0,   037005,     0.1293,   0.5548 
07/01/1996,    1,   037001,     etc. 
07/01/1996,    1,   037003,      
07/01/1996,    1,   037005,      
07/01/1996,    2,   037001,      
07/01/1996,    2,   037003,      
07/01/1996,    2,   037005,</programlisting>

</section>

<section>

<title>Example 5</title>

<para>In this example, the data are sorted by the first three columns (the BY settings) from left to right. The x-cell cycles the slowest, followed by the y-cell, and then by the county code.</para>

<programlisting>Grid-cell inventory area-source emissions by county, daily average
1996 Inventory
Grid name NC36_03X03

X cell, Y cell, Co/St/Cy, CO      , NOX
      ,       ,         , [kg/day], [kg/day]
--------------------------------------------
     1,      1,   037001, 0.123556, 0.0789112
     1,      1,   037003, etc.
     1,      2,   037001, 
     1,      2,   037003, 
     2,      1,   037001,</programlisting>

</section>

<section>

<title>Example 6</title>

<programlisting>SCC-total mobile-source emissions by day from hourly data
1996 Inventory
No gridding
July 1, 1996 at 0 GMT to July 7, 1996 at 23 GMT

Date      , SCC       , CO        , NOX
          ,           , [tons/day], [tons/day]
----------------------------------------------
07/01/1996, 2201001110,    123.321,    456.654
07/01/1996, 2201001130,    etc.
07/01/1996, 2201001150, 
07/01/1996, 2201001170, 
07/01/1996, 2201001190, 
07/01/1996, 2201001210, 
07/01/1996, 2201001230,</programlisting>

</section>

<section>

<title>Example 7</title>

<programlisting>SCC-total mobile-source daily-total emissions by state (no state names)
North Carolina and South Carolina
1996 Inventory
No gridding
July 1, 1996 at 0 GMT to July 7, 1996 at 23 GMT

Date      , Co/St/Cy, SCC       , CO        , NOX
          ,         ,           , [tons/day], [tons/day]
--------------------------------------------------------
07/01/1996,    37000, 2201001110,    123.321,    456.654
07/01/1996,    37000, 2201001130,    etc.
07/01/1996,    37000, 2201001150, 
07/01/1996,    37000, 2201001170, 
07/01/1996,    37000, 2201001190, 
07/01/1996,    37000, 2201001210, 
07/01/1996,    37000, 2201001230, 
07/01/1996,    45000, 2201001110, 
07/01/1996,    45000, 2201001130, 
07/01/1996,    45000, 2201001150, 
07/01/1996,    45000, 2201001170, 
07/01/1996,    45000, 2201001190, 
07/01/1996,    45000, 2201001210, 
07/01/1996,    45000, 2201001230,</programlisting> 

</section>

<section>

<title>Example 8</title>

<programlisting>Elevated hourly emissions by grid cell and point source
Only 2 point sources in inventory (wouldn't that be nice?)
1996 Inventory
Grid name NC36_03X03
July 1, 1996 at 0 GMT to July 7, 1996 at 23 GMT

Date      , Hour, X cell, Y cell, Source ID, CO        , NOX
          ,         ,           ,          , [tons/day], [tons/day]
-------------------------------------------------------------------
07/01/1996,    0,      1,      1,         1,    123.321,    456.654
07/01/1996,    0,      1,      1,         2,     12.345,     56.789
07/01/1996,    0,      1,      2,         1,    123.321,    456.654
07/01/1996,    0,      1,      2,         2,     12.345,     56.789
07/01/1996,    0,      1,      3,         1,    etc.
07/01/1996,    0,      1,      3,         2,
07/01/1996,    0,      2,      1,         1,
07/01/1996,    0,      2,      1,         2,
07/01/1996,    0,      2,      2,         1,
07/01/1996,    0,      2,      2,         2,
07/01/1996,    0,      2,      3,         1,
07/01/1996,    0,      2,      3,         2,
07/01/1996,    0,      3,      1,         1,
07/01/1996,    0,      3,      1,         2,
07/01/1996,    0,      3,      2,         1,
07/01/1996,    0,      3,      2,         2,
07/01/1996,    0,      3,      3,         1,
07/01/1996,    0,      3,      3,         2,
07/01/1996,    1,      1,      1,         1,
07/01/1996,    1,      1,      1,         2,
07/01/1996,    1,      1,      2,         1,
07/01/1996,    1,      1,      2,         2,
07/01/1996,    1,      1,      3,         1,
07/01/1996,    1,      1,      3,         2,</programlisting>

</section>

<section>

<title>Example 9</title>

<programlisting>Breweries and Wineries SCC-total area-source emissions for a subgrid
Grid name: NC36_24X24
Subgrid cells selected:
	(1,1) TO (4,4)
	(6,6) TO (9,9)

X cell, Y cell, SCC       , CO        , NOX
      ,       ,           , [tons/day], [tons/day]
--------------------------------------------------
     1,      1, 2302070001, 0.1234E-03, 0.4567E-04
     1,      1, 2302070005, etc.
     1,      2, 2302070001, 
     1,      2, 2302070005, 
     1,      3, 2302070001, 
     1,      3, 2302070005, 
     1,      4, 2302070001, 
     1,      4, 2302070005, 
     2,      1, 2302070001, 
     2,      1, 2302070005,</programlisting>

</section>

<section>

<title>Example 10</title>

<programlisting>Grid-cell-normalized area-source daily-total speciated emissions for NC
Grid name: NC36_24X24
Cell-area-normalized emissions using cell size 36000 m X 36000 m
July 1, 1996 at 0 GMT to July 7, 1996 at 23 GMT

Date      , Co/St/Cy, State         , CO            , NO      , NO2
          ,         ,               , [g/day*m^2], [g/day*m^2], [g/day*m^2]
---------------------------------------------------------------------------
07/01/1996,    37000, North Carolina,    112.3456,     23.3456,      1.1234
07/02/1996,    37000, North Carolina,    112.3456,     23.3456,      1.1234
07/03/1996,    37000, North Carolina,    112.3456,     23.3456,      1.1234
07/04/1996,    37000, North Carolina,    112.3456,     23.3456,      1.1234
07/05/1996,    37000, North Carolina,    112.3456,     23.3456,      1.1234
07/06/1996,    37000, North Carolina,    112.3456,     23.3456,      1.1234
07/07/1996,    37000, North Carolina,    112.3456,     23.3456,      1.1234</programlisting>

</section>

</section>

</section>

<section id="sect_qa_methods">

<title>Quality Assurance Methods</title>

<para>To determine whether your run worked correctly, you must quality assure your emissions processing. To one degree or another, you must design your quality assurance techniques to be specific to each emissions modeling effort, since no two efforts are exactly the same. This section describes some general methods that can be followed to assist users with quality assuring their emissions processing.</para>

<para>As stated in the introduction to this chapter, quality assurance consists of at least the following four components. These are discussed in <xref linkend="sect_qa_methods_setup" />, <xref linkend="sect_qa_methods_logs" />, <xref linkend="sect_qa_methods_core_reports" />, and <xref linkend="sect_qa_methods_smkreport" />.</para>

<itemizedlist>
<listitem>
<para>Setting up SMOKE using available documentation (this manual) on file formats and script setup.</para>
</listitem>
<listitem>
<para>Reviewing log files for errors and warnings, then resolving any problems.</para>
</listitem>
<listitem>
<para>Reviewing reports generated by SMOKE core programs (e.g., reports from the <command>Cntlmat</command> program indicating which controls were applied and the changes made to the inventory emissions).</para>
</listitem>
<listitem>
<para>Reviewing and customizing reports generated by the <command>Smkreport</command> program, and comparing these to one another and to totals from the emission inventory.</para>
</listitem>
</itemizedlist>

<para>With all reporting and analyses, it is important to keep the following principles in mind:</para>

<itemizedlist>
<listitem>
<para>Focus only on those pollutants and inventories that are key components of air quality problems in your modeling case. For example, it is often not worthwhile analyzing CO emissions, since their contribution to ozone air quality problems is minor. It is often worthwhile to first analyze the raw inventories to see which source categories are contributing the majority of key pollutants, to help target your efforts.</para>
</listitem>
<listitem>
<para>When performing analysis on a key inventory and pollutant, focus on those SCCs that contribute the majority of the emissions. For example, if 10% of the SCCs contribute 90% of the emissions, focus on quality assuring those 10% of SCCs.</para>
</listitem>
<listitem>
<para>Keep lists of potential issues, their status, and their resolution. Such lists will be critical to documenting the emissions modeling efforts when you are finished.</para>
</listitem>
<listitem>
<para>As problems are found, new inventories may be created and analyses rerun. Make sure to use new scenario names in the SMOKE Assigns files when running a new version of the inventory. The <envar>INVEN</envar>, <envar>INVOP</envar>, and <envar>INVID</envar> environment variables can be configured to use the same input directories and new output directories.</para>
</listitem>
<listitem>
<para>Consider using version-control software (such as the UNIX CVS or SCCS programs) to keep track of changes in your inventories and SMOKE ancillary files.</para>
</listitem>
<listitem>
<para>If possible, archive the SMOKE configuration, including all inputs and output files, once a set of "final" model-ready emissions is created and used in an air quality model. Inevitably, more changes will be made to the SMOKE setup, but you will most likely want or need to go back to the raw inputs used for a specific case, once it has been run through an AQM.</para>
</listitem>
</itemizedlist>

<section id="sect_qa_methods_setup">

<title>Setting up SMOKE</title>

<para>The information in <xref linkend="ch_input_files" />, which provides detailed documentation on SMOKE input file formats, can be used to help ensure the quality of your modeling efforts. Although SMOKE programs check the input file formats when they are read and used, you should not rely on this capability entirely. There is no substitute for carefully comparing your input files with the file formats in this manual. The files should be checked in the following ways:</para>

<itemizedlist>
<listitem>
<para>Make sure all required fields specified in the manual are present.</para>
</listitem>
<listitem>
<para>Make sure all fields are in the correct position in the file.</para>
</listitem>
<listitem>
<para>Make sure the type of the field (integer, real, character) is consistent between the file and the manual. Usually, it is acceptable to provide an integer value for a real field, if the data warrant this.</para>
</listitem>
<listitem>
<para>Make sure the file has been converted from DOS/Windows to UNIX format. This is often an issue when users edit their files on a Windows computer and move the file to a UNIX (including Linux) workstation for further processing. Files that have not been transferred properly will have "^M" entries at the end of each line and possibly a "^Z" entry at the end of the file. All of these erroneous fields must be removed. Some options for making this conversion automatically include the <command>dos2unix</command> and <command>to_unix</command> UNIX command-line programs.</para>
</listitem>
<listitem>
<para>Make sure tabs are not used in the file. SMOKE does not support tabs as delimiters in the input files, and the readers will not be able to read the data correctly if tabs are present.</para>
</listitem>
</itemizedlist>

<para><xref linkend="ch_scripts" /> provides documentation on the SMOKE default scripts. We recommend that new users start with these default scripts to enhance the quality of their experience using SMOKE - and thus the ultimate quality of their emissions modeling results. The script documentation should be reviewed carefully before making changes to the settings in the scripts. In addition, <xref linkend="ch_utilities" />, <xref linkend="ch_programs" />, and <xref linkend="sect_qa_smkreport" /> provide documentation on the UNIX environment variables that the scripts use to control the SMOKE programs. These settings can make a large difference in the emissions modeling results. Users should review each setting in the scripts, understand its purpose, and make an informed decision about the value to use for each setting prior to using the SMOKE run scripts on new inventory data. The end of <xref linkend="ch_scripts" /> provides some additional information about how to reconfigure your run scripts; these instructions should be followed carefully to ensure high quality in your emissions modeling.</para>

<para>A useful way to ensure that the settings have all been checked and set correctly is to create a table that includes all SMOKE settings for each source category. This table can then be filled in prior to running SMOKE for a new case, while reviewing the SMOKE documentation in detail for the correct settings. As the scripts are created for a new case, this table can be the reference for setting up the script properly. Prior to running the new script, its settings should be compared to the reference table as a final check that all the correct settings have been used.</para>

</section>

<section id="sect_qa_methods_logs">

<title>Reviewing log files</title>

<para>The SMOKE log files are the first source of information about whether your SMOKE run has completed properly. The simplest thing to check in the log file is that the program ran to completion. If it did, the last line of the log file will be "Normal Completion of program..." followed by the program name. This line is simply a first step to understanding whether your program actually completed successfully because this "successful completion" statement will be printed even if your program ran with warnings. If errors occurred in your program run, this line will not be printed.</para>

<para>To fully evaluate whether your program run was indeed successful, you must review the entire log file and also perform additional QA as described in <xref linkend="sect_qa_methods_core_reports" /> and <xref linkend="sect_qa_methods_smkreport" />. In this section, we describe how to further review the log files. <xref linkend="fig_qa_examine_logs" /> is a flow diagram that gives step-by-step instructions on how to evaluate the errors and warnings in the log files. <comment><xref linkend="ch_errors" /> documents most of these errors and warnings and provides some guidance on how to decide whether warnings are important and how to resolve errors.</comment></para>

<para>In the diagram, "SMOKE support" refers to several resources that you can use for support on SMOKE. The primary support mechanism is the Community Modeling and Analysis System (CMAS) Center <ulink url="http://www.cmascenter.org/html/help.html">Help Desk</ulink>. This web site can be used to look up questions and answers as well as submit new questions about SMOKE usage and behavior. Another resource available to all emissions modelers is the <ulink url="http://webmail0.isis.unc.edu:82/lists/index.php?reason=results&amp;list=emregional">emregional listserv</ulink>. This listserv is hosted by the University of North Carolina at Chapel Hill's Carolina Environmental Program (CEP) and is open to all questions, concerns, and issues related to emissions modeling.</para>

<figure id="fig_qa_examine_logs">
<title>Flow diagram for examining log files</title>

<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/qa/examine_logs_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/qa/examine_logs_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para>One technique you can use to quickly create a list of the major types of errors or warnings that occurred, without listing all of the many specific instances, is to use the UNIX <command>grep</command> command. This approach will find the types of errors and warnings, but when multiple instances of an error or warning are present (e.g., for multiple sources) only one instance of the error or warning will be listed. The UNIX command to perform this function is:</para>

<para><userinput><command>grep</command> ERROR <replaceable>&lt;logfile&gt;</replaceable> | <command>cut -c1-50</command> | <command>sort -u</command></userinput></para>

<para>The "ERROR" in this command can be replaced by "WARNING", and the number "50" can be increased or reduced depending on whether you need more or fewer of the warnings in order to obtain the information you want. The "50" controls how many columns of text are included. The <command>sort -u</command> performs a unique (-u) sort that will eliminate duplicate records created by the <command>cut</command> part of the command. So, since more lines will be similar when the <command>cut</command> command includes fewer columns, the unique sort will produce fewer unique entries as the <command>cut</command> limit is decreased.  The number 50 is usually a good starting point, since it captures the majority of the critical part of the warning, without capturing less significant details such as a line number from an input file on which the error or warning occurred.</para>

<para>In addition to reviewing the log files for errors and warnings, we recommend that you compare the environment variable settings listed in the log files with those you intended to use. Previously, we recommended that you create a table that includes all of the correct SMOKE scripts settings to be used in the modeling effort. The settings shown in the log files should be compared back to that master table to ensure that everything worked properly. This can help you prevent the SMOKE programs from obtaining and using incorrect settings due to typographical errors in the scripts.</para>

<para>Finally, the log files include all of the names of the input and output files. These should be reviewed to confirm that the correct input files and output files were actually used by the program. It is possible that an error in the Assigns file or script could cause the wrong input files to be used, or the output files to be written to the wrong locations.</para>

</section>

<section id="sect_qa_methods_core_reports">

<title>Reviewing reports created by SMOKE core programs</title>

<para>In addition to log files, some SMOKE programs also create reports. These reports can help provide quality assurance concerning the steps taken by the program. The programs and their associated reports and uses are as follows:</para>

<para><command>Smkinven</command>: Creates the <envar>REPINVEN</envar> file, which documents the inventory data read, which data where kept, and the inventory totals for each data value. It also includes the area-to-point conversion information.</para>

<para><command>Laypoint</command>: Creates the <envar>REPRTLAY</envar> file, which documents any point sources for which the <command>Laypoint</command> program computed a plume rise into a layer greater than the layer number set by the <envar>REP_LAYER_MAX</envar> setting.</para>

<para><command>Spcmat</command>: Creates the <envar>ASSUP</envar>, <envar>MSSUP</envar>, and <envar>PSSUP</envar> files, which include the speciation profile codes assigned to each source by pollutant. These files can be used with the ASCII component of the SMOKE intermediate inventory file (<envar>AREA</envar>, <envar>MOBL</envar>, and <envar>PNTS</envar>) to quickly determine the speciation profile assigned to a specific source. These files are also input files to the <command>Smkreport</command> program, for creating more involved summaries of emissions and/or sources including the speciation profiles.</para>

<para><command>Grdmat</command>: Creates the <envar>AGSUP</envar> and <envar>MGSUP</envar> files, which include the spatial surrogate codes assigned to each source. They also indicate whether that assignment was a fallback or original assignment. This file can be used with the ASCII component of the SMOKE intermediate inventory file (<envar>AREA</envar> and <envar>MOBL</envar>) to quickly determine the spatial surrogate assigned to a specific source. These files can also be used by the <command>Smkreport</command> program, for creating more involved summaries of emissions and/or sources including the spatial surrogate codes.</para>

<para><command>Temporal</command>: Creates the <envar>ATSUP</envar>, <envar>MTSUP</envar>, and <envar>PTSUP</envar> files, which include the monthly, weekly, and diurnal profile codes assigned to each source for each pollutant. These files can be used with the ASCII component of the SMOKE intermediate inventory file (<envar>AREA</envar>, <envar>MOBL</envar>, and <envar>PNTS</envar>) to quickly determine the temporal profiles assigned to a specific source. When no pollutant-specific temporal profile assignments have been made, these files can also be used by the <command>Smkreport</command> program, for creating more involved summaries of emissions and/or sources including the temporal profile codes.</para>

<para><command>Cntlmat</command>: Writes several report files (documented with the <command>Cntlmat</command> program in <xref linkend="ch_programs" />) that summarize the growth and control factors. Separate reports are written for each type of projection (growth, multiplicative control, reactivity control) with emissions before and after each control. Another report is written that summarizes all projections made to each source.</para>

<para><command>Smkmerge</command>: Writes a report of state and/or county totals that are created at the same time as the model-ready files. These totals are guaranteed to match the actual state/county totals in the model-ready gridded, hourly outputs (unless there is a problem introduced into <command>Smkmerge</command>). These reports are useful even though they duplicate the <command>Smkreport</command> reports in some ways, because they allow you to ensure that the <command>Smkmerge</command> totals and <command>Smkreport</command> totals are the same - indicating that <command>Smkreport</command> was run with the correct files. Because <command>Smkreport</command> is run separately from <command>Smkmerge</command>, this is not necessarily the case, so you should confirm it with the <command>Smkmerge</command> report.</para>

</section>

<section id="sect_qa_methods_smkreport">

<title>Reviewing and customizing reports created by <command>Smkreport</command></title>

<para>This section provides some ideas on things to check after SMOKE has been run to a successful completion (and after the other QA steps described above have been completed). The review steps listed here will help ensure that SMOKE is working properly. However, these recommendations will not enable you to identify any missing sources (the source exists but was not included in the inventory) or wrong emissions sources (the source is in the inventory, but the emissions are completely incorrect), so it is up to you to understand your emission inventory and make sure that it is representative of the emissions for the regions and years of interest.</para>

<section id="sect_qa_methods_smkreport_area">

<title>Area, nonroad mobile, and precomputed emissions for on-road mobile sources</title>

<para>The following checks should be performed to ensure that the area-source and nonroad mobile-source processing was done properly:</para>

<orderedlist>
<listitem>
<para>Compare state and/or county totals among the following processing steps:</para>

<orderedlist>
<listitem>
<para>Inventory import</para>
</listitem>
<listitem>
<para>Spatial allocation</para>
</listitem>
<listitem>
<para>Temporal allocation for key days (e.g., weekday, Saturday, and Sunday)</para>
</listitem>
<listitem>
<para>Chemical speciation (e.g., add up NO/NO<subscript>2</subscript> and VOC species using the SELECT DATA instruction in <command>Smkreport</command> with the S- prefix)</para>
</listitem>
<listitem>
<para>Final merge</para>
</listitem>
<listitem>
<para>Make comparisons for multiple grid resolutions, if applicable.</para>
</listitem>
</orderedlist>

<para>The differences and similarities revealed at each stage should be these:</para>

<orderedlist>
<listitem>
<para>Import totals (after <command>Smkinven</command> processing) should be the same as inventory totals outside of SMOKE (if available).</para>
</listitem>
<listitem>
<para>Spatial allocation totals should be the same as the import totals for all states/counties except those on a grid boundary. Comparing totals after spatial allocation among multiple grids should reveal that the emissions totals are the same in all grids for states/counties that are completely within the grids.</para>
</listitem>
<listitem>
<para>Temporal allocation should be different for weekdays, Saturday, and Sunday, and different from the average-weekday or average annual value represented by the import totals. The differences should be in the correct direction: generally, area sources are higher on weekends because of lawn/garden emissions. If you are using an average-day inventory (not an annual inventory), confirm that monthly adjustments have not been made. Check that any holiday days have been processed as directed based on the <envar>HOLIDAYS</envar> files (e.g., that weekday holidays have been processed as Sundays).</para>
</listitem>
<listitem>
<para>Chemical speciation should match total mass before and after (again, the <command>Smkreport</command> SELECT DATA option with the S- prefix is helpful here).</para>
</listitem>
<listitem>
<para>Final merged files should match between the <command>Smkmerge</command> and <command>Smkreport</command> reports.</para>
</listitem>
</orderedlist>

</listitem>
<listitem>
<para>Create report of temporal allocation factors used, by SCC.  Review profiles assigned to SCCs representing the top 50%-80% of key area/nonroad pollutants for your inventory.</para>
</listitem>
<listitem>
<para>Create report of spatial surrogates used, by SCC. Review spatial surrogates assigned to SCCs representing the top 50%-80% of key area/nonroad pollutants for your inventory.</para>
</listitem>
<listitem>
<para>Create report of speciation profiles used, by SCC.  Review speciation profiles assigned to SCCs representing the top 50%-80% of key area/nonroad pollutants for your inventory.</para>
</listitem>
<listitem>
<para>Create reports by state/SCC for key states in your domain (the SELECT REGION statement in <command>Smkreport</command> can be used to isolate certain states for this report). Review these reports to ensure that the totals are consistent with expectations. Compare and contrast emissions by SCC among states.  Include per-capita reports as well as total emissions reports, and review these to determine if per-capita emissions differences make sense from state to state; this approach can often identify outliers in inventories (caused by improper units, double counting, or out-of-date inventory creation approach).</para>
</listitem>
<listitem>
<para>Create spatial plots (e.g., using PAVE) of average-day emissions for each day (these daily-total emissions can be created by running <command>Smkmerge</command> with <envar>MRG_TEMPORAL</envar> set to N). Daily-total plots can also be created from the model-ready plots using the I/O API utility <command>m3tproc</command>. Do for all grids (if applicable) and compare.</para>
</listitem>
<listitem>
<para>Create temporal profile plots (e.g., using PAVE) of hourly, gridded data over the entire episode. Look for consistent patterns on consistent days (e.g., all non-holiday weekdays in a single month should have the same value). Do for all grids (if applicable) and compare. Check for holidays and ensure these were processed as Sundays.</para>
</listitem>
</orderedlist>

</section>

<section id="sect_qa_methods_smkreport_point">

<title>Point sources</title>

<para>The following checks should be performed to ensure that the point-sources processing was done properly:</para>

<orderedlist>
<listitem>
<para>Compare state and/or county totals at the following processing steps for all grids:</para>

<orderedlist>
<listitem>
<para>Inventory import</para>
</listitem>
<listitem>
<para>Spatial allocation</para>
</listitem>
<listitem>
<para>Temporal allocation for weekday, Saturday, and Sunday</para>
</listitem>
<listitem>
<para>Chemical speciation (e.g., add up NO/NO<subscript>2</subscript> and VOC species using the SELECT DATA instruction in <command>Smkreport</command> with the S- prefix)</para>
</listitem>
<listitem>
<para>Layer fractions</para>
</listitem>
<listitem>
<para>Final merge</para>
</listitem>
</orderedlist>

<para>The differences and similarities revealed at each stage should be these:</para>

<orderedlist>
<listitem>
<para>Import totals (after <command>Smkinven</command> processing) should be the same as inventory totals outside of SMOKE (if available)</para>
</listitem>
<listitem>
<para>Spatial allocation should be the same as the import totals for all states/counties except those on a grid boundary. Comparing totals after spatial allocation among multiple grids should reveal that the emissions totals are the same in all grids for states/counties that are completely within the grids.</para>
</listitem>
<listitem>
<para>Temporal allocation may or may not be different for weekdays, Saturday, and Sunday, and different from the average-weekday or average annual value represented by the import totals. The differences should be in the correct direction: generally, many of the electric generating facilities (major emissions sources) are the same for all days of the week because the power plants never shut down and their emissions do not depend much on the day of the week. Emissions for major manufacturing plants will often be closed completely on weekends and have no emissions. If using an average-day inventory (not an annual inventory), confirm that monthly adjustments have not been made. Check that any holiday days have been processed as directed based on the <envar>HOLIDAYS</envar> files (e.g., that weekday holidays have been processed as Sundays).</para>

<para>If using day-specific or hour-specific inventory data, then it will be harder to compare the inventory totals before input to SMOKE to the emissions totals after temporal processing. This is because part of a state/county total when using hour-day- or hour-specific data include these data and part do not, but the inventory totals are often available only for the annual and/or average-day emissions values. This limitation can be rectified by calculating the emissions totals for the day- and hour-specific data outside of SMOKE, and analyzing these sources by SCC instead of only by state/county to separate the analysis of the annual and/or average-day emissions from the analysis of the day- and/or hour-specific emissions.</para>
</listitem>
<listitem>
<para>Chemical speciation should match total mass before and after (again, the <command>Smkreport</command> SELECT DATA option with the S- prefix is helpful here).</para>
</listitem>
<listitem>
<para>Emissions totals should match before and after layer fractions for all grids. Note that the layer fractions will be different across grids for sources that are in multiple grids because the meteorology data are different.</para>
</listitem>
<listitem>
<para>Final merged files should match between the <command>Smkmerge</command> and <command>Smkreport</command> reports.</para>
</listitem>
</orderedlist>

</listitem>
<listitem>
<para>Create report of temporal allocation factors used, by SCC.  Review profiles assigned to SCCs representing the top 50%-80% of key point-source pollutants for your inventory.</para>
</listitem>
<listitem>
<para>Create report of speciation profiles used, by SCC.  Review speciation profiles assigned to SCCs representing the top 50%-80% of key point-source pollutants for your inventory.</para>
</listitem>
<listitem>
<para>Create reports by state/plant for key states. These should include the grid cell in which the plant is located, which should be reviewed for correctness. A GIS analysis approach could be helpful for this step, to match the grid cells in the report with an independent assessment of the state/county. Major sources should be reviewed for correct emissions and correct locations.</para>
</listitem>
<listitem>
<para>Create reports with layer fractions for all major power plants in key states. Include grid cell in which the plant is located. Perform a reality-check on the plume rise; large power plants should have high plume rise, but the plumes should still be well distributed throughout the model layers.</para>
</listitem>
<listitem>
<para>Create the spatial and temporal profile plots discussed in items 6 and 7 above for area/nonroad processing, except for the spatial plots you need to first condense the I/O API model-ready files to 2-D instead of 3-D files. The I/O API utility <command>vertot</command> can be used to sum layers from 3-D files to 2-D files.</para>
</listitem>
</orderedlist>

</section>

<section id="sect_qa_methods_smkreport_mobile">

<title>On-road mobile sources using MOBILE6</title>

<para>The following checks should be performed to ensure that the on-road mobile-source processing was done properly:</para>

<orderedlist>
<listitem>
<para>Compare state and/or county totals at the following processing steps for all grids (if applicable):</para>

<orderedlist>
<listitem>
<para>Inventory import (VMT only)</para>
</listitem>
<listitem>
<para>Spatial allocation (VMT only)</para>
</listitem>
<listitem>
<para>Compare emissions among all days by states. Compare sample weekday emissions daily-totals with average-day VMT to see if sources with high VMT have high emissions. Calculate ratios between VMT and emissions and look for outliers.</para>
</listitem>
<listitem>
<para>Compare temporalized daily-totals with speciation/temporalized daily-totals of mass emissions</para>
</listitem>
<listitem>
<para>Final merge</para>
</listitem>
</orderedlist>

<para>The differences and similarities revealed at each stage should be these:</para>

<orderedlist>
<listitem>
<para>Import totals (after <command>Smkinven</command> processing) should be the same as inventory totals outside of SMOKE (if available)</para>
</listitem>
<listitem>
<para>Spatial allocation should be the same as the import totals for all states/counties except those on a grid boundary. Comparing totals after spatial allocation among multiple grids should reveal that the emissions totals are the same in all grids for states/counties that are completely within the grids.</para>
</listitem>
<listitem>
<para>Temporal allocation should be different for weekdays, Saturday, and Sunday (note: no average-day values are available for on-road mobile-source processing using MOBILE6). The differences should be in the correct direction: generally, mobile sources are lower on weekends. Check any holidays to ensure that Sunday emissions were used.</para>
</listitem>
<listitem>
<para>Chemical speciation should match total mass before and after (the SELECT DATA statement in <command>Smkreport</command> with the S- prefix can be helpful here).</para>
</listitem>
<listitem>
<para>Final merged files emissions totals from <command>Smkmerge</command> should match the temporal/speciated emissions reports from <command>Smkreport</command>.</para>
</listitem>
</orderedlist>

</listitem>
<listitem>
<para>Create report of temporal allocation factors used, by SCC; review assignments.</para>
</listitem>
<listitem>
<para>Create report of speciation profiles used, by SCC; review assignments.</para>
</listitem>
<listitem>
<para>Create reports by state/SCC for key states. Review these for major sources (e.g., gasoline fueled automobiles on interstates, heavy duty diesel vehicles) and to compare contributions among states to see if these make sense.</para>
</listitem>
<listitem>
<para>Create the spatial and temporal profile plots discussed in items 6 and 7 above for area/nonroad processing (<xref linkend="sect_qa_methods_smkreport_area" />).</para>
</listitem>
</orderedlist>

</section>

</section>

</section>

</chapter>
