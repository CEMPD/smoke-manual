<?xml version="1.0" encoding="UTF-8"?>

<chapter id="ch_programs">

<title>SMOKE Core Programs</title>

<section>

<title>Overview</title>

<para><xref linkend="fig_programs_core_programs" /> shows the SMOKE core programs and how they relate to each other. We define the core programs as those needed for the actual emissions processing; we exclude QA and utility programs such as <command>Smkreport</command> (these programs are discussed in <xref linkend="ch_quality_assurance" /> and <xref linkend="ch_utilities" />). The lines between the boxes represent one or more files passing between the programs, and show the dependencies among the programs. Note that we have omitted some redundant file dependencies to make the diagram easier to understand (for example, <command>Premobl</command> depends on the output from <command>Grdmat</command>; however, since <command>Premobl</command> also depends on the output from <command>Mbsetup</command> which in turn depends on <command>Grdmat</command>, the relationship between <command>Grdmat</command> and <command>Premobl</command> is implied). Unless otherwise noted, the SMOKE core programs are applied for the anthropogenic source categories: area-, mobile-, and point-source processing (biogenic processing follows a separate path from the other source categories). When a program that applies to multiple source categories is used, it can be run for only one source category at a time, with the exception of <command>Smkmerge</command> and <command>Mrggrid</command>.</para>

<figure id="fig_programs_core_programs">
<title>SMOKE core programs</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/core_programs_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/core_programs_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para>The <link linkend="sect_programs_smkinven"><command>Smkinven</command></link> program, at left in <xref linkend="fig_programs_core_programs" />, is responsible for importing the stationary area/non-point, nonroad, on-road mobile, and point source inventory emissions data. For mobile sources, <command>Smkinven</command> can also import activity data in the form of VMT and vehicle speed for use in generating emission factors. For point sources, <command>Smkinven</command> can also import day- and hour-specific data. The output from <command>Smkinven</command> is used as input to nearly every other core SMOKE program.</para>

<para>Also at left, the <link linkend="sect_programs_rawbio"><command>Rawbio</command></link> program imports the county or gridded land use data and computes normalized (time-independent) biogenic emissions.</para>

<para>As an alternative to BEIS2 processing using <command>Rawbio</command>, SMOKE is capable of using the BEIS3 model. In this type of processing, <link linkend="sect_programs_normbeis3"><command>Normbeis3</command></link> creates gridded, normalized biogenic emissions from land use and biogenic emissions factors.</para>

<para><link linkend="sect_programs_grdmat"><command>Grdmat</command></link> creates the gridding matrix for the anthropogenic source categories. Also, for mobile sources the <command>Grdmat</command> program creates an ungridding matrix used by <command>Mbsetup</command>, <command>Premobl</command>, and <command>Emisfac</command> when emission factors are being generated.</para>

<para><link linkend="sect_programs_mbsetup"><command>Mbsetup</command></link> groups mobile sources by road type, speed, and county in preparation for running <command>Premobl</command> and <command>Emisfac</command>.</para>

<para>If meteorology data are input for mobile-source processing, <link linkend="sect_programs_premobl"><command>Premobl</command></link> processes these data, creating hourly temperature and relative humidity profiles by county that are used by <command>Emisfac</command> to compute mobile-source emission factors.</para>

<para><link linkend="sect_programs_emisfac"><command>Emisfac</command></link> computes emission factors for a variety of emission processes; these factors are needed when VMT data are used as input for mobile sources. <command>Mbsetup</command>, <command>Premobl</command>, and <command>Emisfac</command> are skipped if only emissions data are imported for mobile sources.</para>

<para>The <link linkend="sect_programs_temporal"><command>Temporal</command></link> program is used to create an hourly emissions file for the anthropogenic source categories. It can read in day-specific and hour-specific data, and merge this with estimated daily and hourly data created from the annual emissions data using temporal profiles. For mobile sources, <command>Temporal</command> can compute hourly emissions using the daily VMT, temporal factors (monthly, day-of-week, and hourly), and the emission factors from <command>Emisfac</command>. If VMT are not used, then the emissions from <command>Smkinven</command> are combined with the temporal factors, and the emission factors are not used at all.</para>

<para><link linkend="sect_programs_elevpoint"><command>Elevpoint</command></link> preprocesses the selected PinG and major point sources. <command>Elevpoint</command> is not used when no PinG or major point sources need to be defined. In this case, SMOKE can create elevated emissions for all point sources, so there is no need to specifically indicate the major point sources.</para>

<para><link linkend="sect_programs_laypoint"><command>Laypoint</command></link> computes the plume rise for all point sources based on the meteorology data.</para>

<para><link linkend="sect_programs_spcmat"><command>Spcmat</command></link> creates the speciation matrices (both mass and molar) for the anthropogenic source categories. It uses the user-selected chemical mechanism.</para>

<para><link linkend="sect_programs_cntlmat"><command>Cntlmat</command></link> creates the growth matrices, multiplicative control matrices, and reactivity control matrices for the anthropogenic source categories. This program is not used for base-year emissions without controls.</para>

<para><link linkend="sect_programs_grwinven"><command>Grwinven</command></link> is used to grow the emissions to past or future years using the growth matrix created by <command>Cntlmat</command> and the imported inventory data from <command>Smkinven</command>. It writes both SMOKE inventory format (I/O API NetCDF) and IDA format. The output from <command>Grwinven</command> is used in place of the original output from <command>Smkinven</command> when processing past or future years.</para>

<para><link linkend="sect_programs_tmpbio"><command>Tmpbio</command></link> applies meteorology adjustments to the gridded, normalized biogenic emissions from <command>Rawbio</command>. It also applies the speciation factors needed for the user-selected chemical mechanism to create gridded, hourly, model-species biogenic emission files for use in <command>Smkmerge</command> or <command>Mrggrid</command>. The <command>Rawbio</command> and <command>Tmpbio</command> programs taken together are the equivalent of SMOKE-BEIS2.</para>

<para><link linkend="sect_programs_tmpbeis3"><command>Tmpbeis3</command></link> applies meteorology adjustments to the normalized emissions created by <command>Normbeis3</command>.  <command>Tmpbeis3</command> also applies the speciation profiles needed for the user-selected chemical mechanism to create gridded, hourly, model-species biogenic emissions data for use in <command>Smkmerge</command> and <command>Mrggrid</command>. The <command>Normbeis3</command> and <command>Tmpbeis3</command> programs taken together are the equivalent of SMOKE-BEIS3.</para>

<para><link linkend="sect_programs_smkmerge"><command>Smkmerge</command></link> is used to combine all emissions and matrices to create the gridded, hourly, model-species emissions needed for an AQM. It can merge for one source category at a time or all source categories at once, and it can read in the model-ready biogenic emissions to merge with the anthropogenic source categories. It can merge the matrices with the inventory data output from <command>Smkinven</command> or the hourly emissions from <command>Temporal</command>, and it can optionally merge the speciation, gridding, or control matrices, or any combination. It also writes state and county emissions totals.</para>

<para><link linkend="sect_programs_mrggrid"><command>Mrggrid</command></link> is used to combine gridded emission data files, which can be speciated or non-speciated, and hourly or time-independent. It can combine a 3-D point source file with any number of 2-D files from other source categories. This program is optional and provides a convenient way to merge model-ready output files outside of <command>Smkmerge</command>.</para>

<para>In the remaining sections of this chapter, we provide detailed program descriptions, in alphabetic order.</para>

</section>

<section id="sect_programs_cntlmat">

<title><command>Cntlmat</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> area, mobile, point</para>

<para>The <command>Cntlmat</command> program uses control packets to create a growth matrix, and/or a multiplicative control matrix, and/or a reactivity control matrix. <command>Cntlmat</command> allows seven different control packet types: /MACT/, /CONTROL/, /EMS_CONTROL/, /CTG/, /ALLOWABLE/, /REACTIVITY/, and /PROJECTION/. The format of each packet type is given in <xref linkend="sect_input_gcntl" />.</para>

<itemizedlist>
<listitem>
<para>Growth matrix - This contains past- or future-year growth factors for all sources. <remark>If desired, <command>Cntlmat</command> can grow multiple inventory years to a single modeling year. The /PROJECTION/ packet contains the year for which the growth factors apply and contains both a "to year" and a "from year". Using a series of these packets, inventory records from different years can be grown to a single year. <command>Cntlmat</command> supports multiple-year growth for area, mobile, and point sources.</remark></para>
</listitem>
<listitem>
<para>Multiplicative control matrix - This matrix contains the combination of various types ofcontrols typically used in emissions processing: CTG, MACT, RACT, control efficiency, rule effectiveness, rule penetration, allowable emissions, and caps. The logic used when applying this matrix is described below this bulleted list. </para>
</listitem>
<listitem>
<para>Reactivity matrix - This matrix contains the information needed for applying reactivity controls.</para>
</listitem>
</itemizedlist>

<section>

<title>Application Logic for the Multiplicative Control Matrix</title>

<para>The multiplicative matrix is built from entries in four packets: /MACT/, /CONTROL/ or /EMS_CONTROL/, /CTG/, and /ALLOWABLE/. The packets are applied in the following order:</para>

<itemizedlist>
<listitem>
<para>/MACT/</para>
</listitem>
<listitem>
<para>/CONTROL/ or /EMS_CONTROL/ (cannot use both at same time)</para>
</listitem>
<listitem>
<para>/CTG/</para>
</listitem>
<listitem>
<para>/ALLOWABLE/</para>
</listitem>
</itemizedlist>

<para>With the exception of the /CONTROL/ packet, all controls are always applied in addition to one another.</para>

<section>

<title>/MACT/ packet</title>

<para>The /MACT/ packet is designed to support the primary MACT controls needed for toxics processing. It is applied first, and uses the following logic. When a source is found that matches a /MACT/ packet entry (source matching is addressed in <xref linkend="sect_programs_cntlmat_source_match" />), <command>Cntlmat</command> first calculates a inventory efficiency value (Eff<subscript>inv</subscript>) for that source based on the control efficiency (C<subscript>eff</subscript>), rule effectiveness (R<subscript>eff</subscript>), and rule penetration (R<subscript>pen</subscript>) provided in the inventory:</para>

<para>Eff<subscript>inv</subscript> = C<subscript>eff</subscript> [inventory] x R<subscript>eff</subscript> [inventory] x R<subscript>pen</subscript> [inventory]</para>

<para>Next, a control factor is calculated for existing sources (Fac<subscript>exist</subscript>) using the control efficiency of existing sources (Eff<subscript>exist</subscript>) and fraction of new sources (Frac<subscript>new</subscript>) provided in the /MACT/ packet entry. If Eff<subscript>exist</subscript> &gt; Eff<subscript>inv</subscript>, then Fac<subscript>exist</subscript> is calculated as:</para>

<para>Fac<subscript>exist</subscript> = (1 - Frac<subscript>new</subscript>) x ((1 - Eff<subscript>exist</subscript>) / (1 - Eff<subscript>inv</subscript>))</para>

<para>Otherwise,</para>

<para>Fac<subscript>exist</subscript> = (1 - Frac<subscript>new</subscript>)</para>

<para><command>Cntlmat</command> then calculates a control factor for new sources (Fac<subscript>new</subscript>) using the control efficiency of new sources (Eff<subscript>new</subscript>) provided in the /MACT/ packet. If Eff<subscript>new</subscript> &gt; Eff<subscript>inv</subscript>, then</para>

<para>Fac<subscript>new</subscript> = Frac<subscript>new</subscript> x ((1 - Eff<subscript>new</subscript>) / (1 - Eff<subscript>inv</subscript>))</para>

<para>Otherwise,</para>

<para>Fac<subscript>new</subscript> = Frac<subscript>new</subscript></para>

<para>Finally, the new and existing source factors are summed to compute the final /MACT/ packet control factor (Fac<subscript>MACT</subscript>).</para>

<para>Fac<subscript>MACT</subscript> = Fac<subscript>exist</subscript> + Fac<subscript>new</subscript></para>

<para>The /MACT/ packet is designed to be used only for sources with MACT codes, currently nonpoint and point toxic sources.</para>

</section>

<section>

<title>/CONTROL/ packet</title>

<para>After processing the /MACT/ packet, the /CONTROL/ packet is applied using the following logic. Each entry in the /CONTROL/ packet can be identified as "replacement" or "additive". If set to "replace", the /CONTROL/ entry will be used to replace the controls from the /MACT/ packet; otherwise, the control will be applied in addition to the controls from the /MACT/ packet. When an "additive" entry is matched to a source, the /CONTROL/ packet factor (Fac<subscript>CONTROL</subscript>) is calculated only from the control efficiency, rule effectiveness, and rule penetration values provided in the /CONTROL/ packet entry as follows:</para>

<para>Fac<subscript>CONTROL</subscript> = (1 - C<subscript>eff</subscript> [packet] x R<subscript>eff</subscript> [packet] x R<subscript>pen</subscript> [packet])</para>

<para>A cumulative control factor is then calculated by multiplying Fac<subscript>MACT</subscript> x Fac<subscript>CONTROL</subscript>.</para>

<para>For "replacement" entries, <command>Cntlmat</command> first "backs out" the existing controls provided in the inventory from the control values provided in the /CONTROL/ packet entry as follows:</para>

<para>D = (1 - C<subscript>eff</subscript> [inventory] x R<subscript>eff</subscript> [inventory] x R<subscript>pen</subscript> [inventory])</para>

<para>If D = 0.0, then the backout value, B, is equal to 0; otherwise, B = 1/D. Using this backout value, the /CONTROL/ factor is calculated as</para>

<para>Fac<subscript>CONTROL</subscript> = B x (1 - C<subscript>eff</subscript> [packet] x R<subscript>eff</subscript> [packet] x R<subscript>pen</subscript> [packet])</para>

<para>Unlike "additive" entries, the Fac<subscript>CONTROL</subscript> value for "replacement" entries replaces the factor calculated from the /MACT/ packet (if any). The /CONTROL/ packet can be applied to stationary area/nonpoint, nonroad, on-road mobile, and point sources. On-road mobile source inventories do not include control efficiency, rule effectiveness, or rule penetration fields. However, the /CONTROL/ packet can still be used to apply adjustment factors to mobile sources. In this case, B in the above formula will be 1 when computing factor Fac<subscript>CONTROL</subscript> that is applied to the emissions.</para>

</section>

<section>

<title>/EMS_CONTROL/ packet</title>

<para>The /EMS_CONTROL/ packet is processed in a very similar way as "replacement" entries in the /CONTROL/ packet, with three differences:</para>

<orderedlist>
<listitem>
<para>The base-year inventory control efficiency, rule effectiveness, and rule penetration values are not provided with the base-year inventory emission input files in EMS-95 format. Instead, these base-year values are provided as part of the control packet values (see the /EMS_CONTROL/ packet format). The base-year controls are "backed out" before the future-year controls from the /EMS_CONTROL/ packets are applied.</para>
</listitem>
<listitem>
<para>The /EMS_CONTROL/ packet contains a "control adjustment factor" field, which overrides all other values in the packet. This override feature allows the user to precompute the control factor needed for each record instead of using the formula listed above for application of the controls. When a control adjustment factor is provided, the control efficiency, rule effectiveness, and rule penetration from both the base case and the future year are completely ignored.</para>
</listitem>
<listitem>
<para>The factor computed from the /EMC_CONTROL/ packet will be applied in addition to any factors computed from the /MACT/ packet.</para>
</listitem>
</orderedlist>

</section>

<section>

<title>/CTG/ packet</title>

<para>The /CTG/ packet is processed next, as follows. The emission value (after application of /MACT/, /CONTROL/, and/or /EMS CONTROL/) is compared to the cutoff value specified as part of the /CTG/ packet record. If the emission value exceeds the cutoff value, then the control technology factor is applied to the emissions. If the resulting emissions value still exceeds the cutoff value, then either the MACT <emphasis>or</emphasis> the RACT factor is used. The MACT factor is used if it is defined (i.e., greater than zero); if it is not defined (less than or equal to zero), then the RACT factor is used. If neither the MACT nor RACT are defined, but the emissions are still greater than the cutoff, then the emissions are set to the cutoff value.</para>

</section>

<section>

<title>/ALLOWABLE/ packet</title>

<para>Finally, the /ALLOWABLE/ packet is processed. The entries in this packet override the /MACT/, /CONTROL/, /EMS CONTROL/, and /CTG/ packets. The way this packet is applied depends on whether or not the Cap and Replace values in the packet are defined (greater than zero).</para>

<itemizedlist>
<listitem>
<para>If the Cap value is defined, <command>Cntlmat</command> compares the inventory emissions value to the Cap value, and sets a control factor, using the following procedure: If both the Cap and Replace values are defined, this control factor is the Replace value divided by the original emissions value. If only the Cap value is defined, the factor is the Cap value divided by the original emissions value.</para>
</listitem>
<listitem>
<para>If the Cap value is not defined, then the factor is the Replace value divided by the original emissions value.</para>
</listitem>
<listitem>
<para>If neither the Cap nor Replace values are defined, the packet entry is invalid and is ignored.</para>
</listitem>
</itemizedlist>

</section>

</section>

<section id="sect_programs_cntlmat_source_match">

<title>Source Matching Hierarchy</title>

<para>To match each sources with the appropriate control packet entry, <command>Cntlmat</command> uses a hierarchy of source characteristics, trying to match each source to the most specific control packet entry. Note that not all combinations are applicable to all control packets (for example, there is no MACT code associated with the /PROJECTION/ packet). "Left <emphasis>x</emphasis> of SCC" refers to an 8- or 10-digit SCC with all digits except the first <emphasis>x</emphasis> set to 0. "Left 2 of SIC code" refers to a 4-digit SIC code with the third and fourth digits set to 0.</para>

<para>For point sources, the following hierarchy is used, in order of most specific to least specific.</para>

<orderedlist>
<listitem>
<para>Country/State/County code, plant ID, point ID, stack ID, segment ID, 8-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, plant ID, point ID, stack ID, segment ID, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, plant ID, point ID, stack ID, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, plant ID, point ID, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, plant ID, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, plant ID, point ID, stack ID, segment ID, 8-digit SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, plant ID, point ID, stack ID, segment ID</para>
</listitem>
<listitem>
<para>Country/State/County code, plant ID, point ID, stack ID</para>
</listitem>
<listitem>
<para>Country/State/County code, plant ID, point ID</para>
</listitem>
<listitem>
<para>Country/State/County code, plant ID</para>
</listitem>
<listitem>
<para>Country/State/County code, MACT code, 8-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, MACT code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, MACT code, 8-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, MACT code, pollutant</para>
</listitem>
<listitem>
<para>MACT, 8-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>MACT, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, MACT code, 8-digit SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, MACT code</para>
</listitem>
<listitem>
<para>Country/State code, MACT code, 8-digit SCC code</para>
</listitem>
<listitem>
<para>Country/State code, MACT code</para>
</listitem>
<listitem>
<para>MACT code, 8-digit SCC code</para>
</listitem>
<listitem>
<para>MACT code</para>
</listitem>
<listitem>
<para>Country/State/County code, 4-digit SIC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, left 2 of SIC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, 4-digit SIC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, left 2 of SIC code, pollutant</para>
</listitem>
<listitem>
<para>4-digit SIC code, pollutant</para>
</listitem>
<listitem>
<para>Left 2 of SIC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, 4-digit SIC code</para>
</listitem>
<listitem>
<para>Country/State/County code, left 2 of SIC code</para>
</listitem>
<listitem>
<para>Country/State code, 4-digit SIC code</para>
</listitem>
<listitem>
<para>Country/State code, left 2 of SIC code</para>
</listitem>
<listitem>
<para>4-digit SIC code</para>
</listitem>
<listitem>
<para>Left 2 of SIC code</para>
</listitem>
<listitem>
<para>Country/State/County code, 8-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, left 6 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, left 3 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, left 1 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, 8-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, left 6 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, left 3 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, left 1 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>8-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Left 6 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Left 3 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Left 1 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, 8-digit SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, left 6 of SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, left 3 of SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, left 1 of SCC code</para>
</listitem>
<listitem>
<para>Country/State code, 8-digit SCC code</para>
</listitem>
<listitem>
<para>Country/State code, left 6 of SCC code</para>
</listitem>
<listitem>
<para>Country/State code, left 3 of SCC code</para>
</listitem>
<listitem>
<para>Country/State code, left 1 of SCC code</para>
</listitem>
<listitem>
<para>8-digit SCC code</para>
</listitem>
<listitem>
<para>Left 6 of SCC code</para>
</listitem>
<listitem>
<para>Left 3 of SCC code</para>
</listitem>
<listitem>
<para>Left 1 of SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code</para>
</listitem>
<listitem>
<para>Country/State code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code</para>
</listitem>
<listitem>
<para>Pollutant</para>
</listitem>
</orderedlist>

<para>For nonpoint/stationary area sources, the following hierarchy is used. Nonpoint SCCs can have either 8 or 10 digits, which is why there are two separate SCC levels mentioned for each of the SCC-based assignments.</para>

<orderedlist>
<listitem>
<para>Country/State/County code, MACT code, 8- or 10-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, MACT code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, MACT code, 8- or 10-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, MACT code, pollutant</para>
</listitem>
<listitem>
<para>MACT code, 8- or 10-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>MACT code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, MACT code, 8- or 10-digit SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, MACT code</para>
</listitem>
<listitem>
<para>Country/State code, MACT code, 8- or 10-digit SCC code</para>
</listitem>
<listitem>
<para>Country/State code, MACT code</para>
</listitem>
<listitem>
<para>MACT code, 8- or 10-digit SCC code</para>
</listitem>
<listitem>
<para>MACT code</para>
</listitem>
<listitem>
<para>Country/State/County code, 4-digit SIC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, left 2 of SIC code, pollutant </para>
</listitem>
<listitem>
<para>Country/State code, 4-digit SIC code, pollutant </para>
</listitem>
<listitem>
<para>Country/State code, left 2 of SIC code, pollutant</para>
</listitem>
<listitem>
<para>4-digit SIC code, pollutant</para>
</listitem>
<listitem>
<para>Left 2 of SIC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, 4-digit SIC code</para>
</listitem>
<listitem>
<para>Country/State/County code, left 2 of SIC code</para>
</listitem>
<listitem>
<para>Country/State code, 4-digit SIC code</para>
</listitem>
<listitem>
<para>Country/State code, left 2 of SIC code</para>
</listitem>
<listitem>
<para>4-digit SIC code</para>
</listitem>
<listitem>
<para>Left 2 of SIC code</para>
</listitem>
<listitem>
<para>Country/State/County code, 8- or 10-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, left 6 or left 7 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, left 3 or left 4 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, left 1 or left 2 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, 8- or 10-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, left 6 or left 7 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, left 3 or left 4 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, left 1 or left 2 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>8- or 10-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Left 6 or left 7 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Left 3 or left 4 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Left 1 or left 2 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, 8- or 10-digit SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, left 6 or left 7 of SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, left 3 or left 4 of SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, left 1 or left 2 of SCC code</para>
</listitem>
<listitem>
<para>Country/State code, 8- or 10-digit SCC code</para>
</listitem>
<listitem>
<para>Country/State code, left 6 or left 7 of SCC code</para>
</listitem>
<listitem>
<para>Country/State code, left 3 or left 4 of SCC code</para>
</listitem>
<listitem>
<para>Country/State code, left 1 or left 2 of SCC code</para>
</listitem>
<listitem>
<para>8- or 10-digit SCC code</para>
</listitem>
<listitem>
<para>Left 6 or left 7 of SCC code</para>
</listitem>
<listitem>
<para>Left 3 or left 4 of SCC code</para>
</listitem>
<listitem>
<para>Left 1 or left 2 of SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code</para>
</listitem>
<listitem>
<para>Country/State code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code</para>
</listitem>
<listitem>
<para>Pollutant</para>
</listitem>
</orderedlist>

<para>On-road mobile and nonroad sources are matched to the control packet entries using the following hierarchy:</para>

<orderedlist>
<listitem>
<para>Country/State/County code, 10-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, left 7 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, left 4 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, left 2 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, 10-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, left 7 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, left 4 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, left 2 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>10-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Left 7 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Left 4 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Left 2 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, 10-digit SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, left 7 of SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, left 4 of SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, left 2 of SCC code</para>
</listitem>
<listitem>
<para>Country/State code, 10-digit SCC code</para>
</listitem>
<listitem>
<para>Country/State code, left 7 of SCC code</para>
</listitem>
<listitem>
<para>Country/State code, left 4 of SCC code</para>
</listitem>
<listitem>
<para>Country/State code, left 2 of SCC code</para>
</listitem>
<listitem>
<para>10-digit SCC code</para>
</listitem>
<listitem>
<para>Left 7 of SCC code</para>
</listitem>
<listitem>
<para>Left 4 of SCC code</para>
</listitem>
<listitem>
<para>Left 2 of SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code</para>
</listitem>
<listitem>
<para>Country/State code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code</para>
</listitem>
<listitem>
<para>Pollutant</para>
</listitem>
</orderedlist>

</section>

</section>

<section>

<title>Processing Order</title>

<para><command>Smkinven</command> must be executed before <command>Cntlmat</command>.</para>

<para><command>Cntlmat</command> must be executed before <command>Smkmerge</command>. <command>Cntlmat</command> also needs to be run prior to the <command>Grwinven</command> program, which requires at least one growth or control matrix to be run.</para>

<para><command>Cntlmat</command> is an optional program that needs to be run only when controlled emissions are needed for the AQM.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_cntlmat">
<title><command>Cntlmat</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/cntlmat_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/cntlmat_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_cntlmat" /> shows the input and output files for the <command>Cntlmat</command> program. The input files are the inventory file output from <command>Smkinven</command> (either <envar>AREA</envar>, <envar>MOBL</envar>, or <envar>PNTS</envar>), the control packets file (<envar>GCNTL</envar>), and the speciation profiles file (<envar>GSPRO</envar>) if there are reactivity controls. If the control packets file contains a /PROJECTION/ packet, the program outputs a projection matrix file (<envar>APMAT</envar>, <envar>MPMAT</envar>, or <envar>PPMAT</envar>) and a projection report (<envar>APROJREP</envar>, <envar>MPROJREP</envar>, or <envar>PPROJREP</envar>). If the control packets file contains a /REACTIVITY/ packet, the program outputs mole and mass-based reactivity matrix files (either <envar>ARMAT_L</envar> and <envar>ARMAT_S</envar>, <envar>MRMAT_L</envar> and <envar>MRMAT_S</envar>, or <envar>PRMAT_L</envar> and <envar>PRMAT_S</envar>), a reactivity matrix supplement file (<envar>ARSUP</envar>, <envar>MRSUP</envar>, or <envar>PRSUP</envar>), and a report of reactivity controls (<envar>AREACREP</envar>, <envar>MREACREP</envar>, or <envar>PREACREP</envar>). If the control packets file contains /MACT/, /CONTROL/, /EMS_CONTROL/, /ALLOWABLE/, and/or /CTG/ packets, the program outputs a multiplicative control matrix file (<envar>ACMAT</envar>, <envar>MCMAT</envar>, or <envar>PCMAT</envar>), a report of multiplicative controls (<envar>ACREP</envar>, <envar>MCREP</envar>, or <envar>PCREP</envar>), and a report of all controls applied to the inventory (<envar>ACSUMREP</envar>, <envar>MCSUMREP</envar>, or <envar>PCSUMREP</envar>).</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name*</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[AREA|MOBL|PNTS]</envar></entry>
<entry>SMOKE map</entry>
<entry>Intermediate inventory file produced by <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>GCNTL</envar></entry>
<entry>ASCII</entry>
<entry>Control packets file</entry>
</row>
<row>
<entry><envar>GSPRO</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Speciation profiles file; only needed for reactivity controls</entry>
</row>
</tbody>
</tgroup>
</informaltable>

<para>* As in <xref linkend="fig_programs_cntlmat" />, the notation <envar>[AREA|MOBL|PNTS]</envar> is used to indicate that only one of the three files is used for a given run.</para>

<para>The physical file name of the input file <envar>GCNTL</envar> file is typically overridden by the environment that is running <command>Cntlmat</command>. For example, when running SMOKE from scripts using the Assigns file, the projection factor inputs are available as the <envar>[A|M|P]PROJ</envar> files. So, for instance, the script must set <envar>GCNTL</envar> as <envar>APROJ</envar> (for area-source processing) after the Assigns file has been invoked by the script, but before the <command>Cntlmat</command> program is actually run.</para>

</section>

<section id="sect_programs_cntlmat_envar">

<title>Input Environment Variables</title>

<itemizedlist>
<listitem>
<para><envar>PROJECTION_YR_SPEC:</envar> [default: Y]</para>
<para>Sets whether or not entries in the projection packet are in year-specific format.</para>
    <itemizedlist>
    <listitem>
    <para>Y: Year-specific format in use</para>
    </listitem>
    <listitem>
    <para>N: Year-specific format not in use</para>
    </listitem>
    </itemizedlist>
</listitem>

<listitem>
<para><envar>REACTIVITY_POL</envar>: [default: VOC]</para>
<para>Sets the pollutant name to use in computing the reactivity matrix.</para>
</listitem>

<listitem>
<para><envar>REPORT_DEFAULTS</envar>: [default: Y]</para>
<para>Defines whether or not the program reports when a source uses the default cross-reference.</para>
    <itemizedlist>
    <listitem>
    <para>Y: List sources in the log file when they use default cross-reference</para>
    </listitem>
    <listitem>
    <para>N: Do not list sources that use the default cross-reference</para>
    </listitem>
    </itemizedlist>
</listitem>

<listitem>
<para><envar>SMK_AVEDAY_YN</envar>: [default: N]</para>
<para>Indicates whether or not to read average day emissions instead of annual emissions from the inventory file.</para>
    <itemizedlist>
    <listitem>
    <para>Y: Read average day emissions</para>
    </listitem>
    <listitem>
    <para>N: Do not read average day emissions, use annual emissions instead</para>
    </listitem>
    </itemizedlist>
</listitem>

<listitem>
<para><envar>SMK_SOURCE</envar>: [default: blank]</para>
<para>Defines the type of sources to be processed. Valid values are</para>
    <itemizedlist>
    <listitem>
    <para>A: Area processing</para>
    </listitem>
    <listitem>
    <para>B: Biogenic processing</para>
    </listitem>
    <listitem>
    <para>M: Mobile processing</para>
    </listitem>
    <listitem>
    <para>P: Point processing</para>
    </listitem>
    </itemizedlist>
</listitem>

<listitem>
<para><envar>SMK_TMPDIR</envar>: [default: "."]</para>
<para>Sets the path for writing the temporary files needed when processing the /CONTROL/ packet (from the <envar>GCNTL</envar> file).</para>
</listitem>

<listitem>
<para><envar>SPEC_OUTPUT</envar>: [default: ALL]</para>
<para>Defines the types of speciation outputs to create.</para>
    <itemizedlist>
    <listitem>
    <para>MASS: Output speciation matrix based on mass</para>
    </listitem>
    <listitem>
    <para>MOLE: Output speciation matrix based on moles</para>
    </listitem>
    <listitem>
    <para>ALL: Output both mass and mole speciation matrices</para>
    </listitem>
    </itemizedlist>
</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name*</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[A|M|P]PMAT</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Growth matrix</entry>
</row>
<row>
<entry><envar>[A|M|P]PROJREP</envar></entry>
<entry>ASCII</entry>
<entry>Report of growth factors applied to the inventory</entry>
</row>
<row>
<entry><envar>[A|M|P]RMAT_L</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Mole-based reactivity matrix</entry>
</row>
<row>
<entry><envar>[A|M|P]RMAT_S</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Mass-based reactivity matrix</entry>
</row>
<row>
<entry><envar>[A|M|P]RSUP</envar></entry>
<entry>ASCII</entry>
<entry>Reactivity matrix supplemental file</entry>
</row>
<row>
<entry><envar>[A|M|P]REACREP</envar></entry>
<entry>ASCII</entry>
<entry>Report of reactivity controls applied to the inventory</entry>
</row>
<row>
<entry><envar>[A|M|P]CMAT</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Multiplicative control matrix</entry>
</row>
<row>
<entry><envar>[A|M|P]CSUMREP</envar></entry>
<entry>ASCII</entry>
<entry>Report of all controls applied to the inventory, with all controls listed under each source</entry>
</row>
<row>
<entry><envar>[A|M|P]CREP</envar></entry>
<entry>ASCII</entry>
<entry>Report of multiplicative controls applied to the inventory</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Cntlmat</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

<para>* As in <xref linkend="fig_programs_cntlmat" />, the notation [A|M|P] is used to indicate that only one of the three files is output for a given run.</para>

</section>

</section>

<section>

<title>Earlier Versions</title>

<para>The SMOKE prototype used separate programs for each type of source. These programs were CTLAMAT for area sources and CTLPMAT for point sources. A version of the control/projection program was not previously available for mobile sources.</para>

<para><command>Cntlmat</command> for SMOKE v1.2 did not have an operational reporting capability. The /MACT/ packet and updated /CONTROL/ and /PROJECTION/ packets were added in SMOKE v2.0.</para>

</section>

</section>

<section id="sect_programs_elevpoint">

<title><command>Elevpoint</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> point</para>

<para>The <command>Elevpoint</command> program is used to select elevated point sources and to prepare certain input files for special elevated source or PinG processing. <command>Elevpoint</command> selects the major point source (MPS) and major elevated point source emissions (MEPSE) records using a variety of criteria, such as stack parameters, emissions, and analytical plume rise calculations. (Note that MEPSE is another name for a PinG source.)</para>

<para><command>Elevpoint</command> distinguishes PinG sources from non-PinG elevated sources based on emission thresholds, highest day-specific emissions rank compared to other sources, analytical plume rise, and/or stack parameters such as height. <command>Elevpoint</command> flags sources as either elevated or PinG based on instructions given in an input configuration file, the <envar>PELVCONFIG</envar> file. <command>Elevpoint</command> also permits grouping of stacks at the same facility if the stack parameters are similar, within tolerances you specify with the <envar>PELVCONFIG</envar> file; the result is call a "stack group". For more information on selecting and grouping elevated and PinG sources, refer to <xref linkend="sect_input_pelvconfig" />.</para>

<para><command>Elevpoint</command> can also be used to calculate plume rise using the "cutoff" method. This is the method traditionally used to prepare input files to the air quality models UAM-IV, UAM-V, REMSAD, and CAM<subscript>X</subscript>, which require a separate model-ready input file containing emissions for elevated point sources. Below, we refer to this path as the "UAM style" of emissions processing.</para>

<para>For the cutoff method, the <command>Elevpoint</command> program uses the stack parameters of the point sources and estimates the plume rise for each source using a Briggs analytical solution (but not actual gridded meteorology data); the details of this process are given later in this subsection. <command>Elevpoint</command> then records all of the sources that have an estimated plume rise greater than a specified cutoff as defined in the <envar>PELVCONFIG</envar> file using the "RISE" instruction. Using the <envar>PELVCONFIG</envar> file, this cutoff method can be combined with selection of elevated sources based on stack parameters and/or emissions values.</para>

<para>When emissions values are part of these selection criteria, <command>Elevpoint</command> computes the maximum daily emissions using one or more <envar>PTMP</envar> files. <command>Elevpoint</command> computes the maximum daily value of any pollutant used as a selection criterion across all of the days that you input. You have the option of providing either a list of paths and file names of one or more <envar>PTMP</envar> files, or a single <envar>PTMP</envar> file. The day or days that <command>Elevpoint</command> uses to compute each source's maximum depends on the time zone in which the source resides, based on the county and the <envar>COSTCY</envar> file setting for the time zone (the time zone is stored in the <envar>PNTS</envar> file output from <command>Smkinven</command>).</para>

<para><command>Elevpoint</command> also creates a report file that contains all SMOKE sources that have been selected as elevated, their source characteristics (including stack parameters), emissions values used as selection criteria, stack-group numbers, status as either elevated or PinG, and which selection criteria were used to assign the status to the source. The report does not include any low-level sources. This report is in semicolon-delimited format for easier reading into a spreadsheet for sorting, review, and making charts.</para>

<para>The <command>Elevpoint</command> program is not needed if the environment variables <envar>SMK_PING_METHOD</envar> and <envar>SMK_ELEV_METHOD</envar> are both set to 0.</para>

<section>

<title>Plume rise calculation</title>

<para>The Briggs solution is documented in the following:</para>

<orderedlist>
<listitem>
<para>Briggs, Gary A., 1971: Some Recent Analyses of Plume Rise Observation, pp. 1029-1032 in <emphasis>Proceedings of the Second International Clean Air Congress</emphasis>, edited by H. M. Englun and W. T. Beery. Academic Press, New York.</para>
</listitem>
<listitem>
<para>Briggs, Gary A., 1972: Discussion on Chimney Plumes in Neutral and Stable Surroundings, <emphasis>Atmos. Environ.</emphasis> 6, 507-510.</para>
</listitem>
</orderedlist>

<para>The following formula is used in <command>Elevpoint</command>:</para>

<para>F = 0.25 x G x V<subscript>S</subscript> x D<subscript>S</subscript><superscript>2</superscript> x (T<subscript>S</subscript> - T)/T<subscript>S</subscript></para>

<para>For F less than 55,</para> 

<para>Plume rise = H<subscript>S</subscript> + 21.31311057 x F<superscript>0.75</superscript>/U</para>

<para>Otherwise,</para>

<para>Plume rise = H<subscript>S</subscript> + 38.87776061 x F<superscript>0.6</superscript>/U</para>

<para>where</para>

<itemizedlist>
<listitem>
F = Bouyancy flux (m<superscript>4</superscript>/s<superscript>3</superscript>)
</listitem>
<listitem>
G = Mean gravitational acceleration (9.80665 m/s<superscript>2</superscript>)
</listitem>
<listitem>
V<subscript>S</subscript> = Stack gas exit velocity (m/s)
</listitem>
<listitem>
D<subscript>S</subscript> = Inside stack diameter (m)
</listitem>
<listitem>
T<subscript>S</subscript> = Stack gas temperature (K)
</listitem>
<listitem>
T = Default ambient air temperature (293 K)
</listitem>
<listitem>
U = Default wind speed (2 m/s)
</listitem>
<listitem>
H<subscript>S</subscript> = Physical stack height (m)
</listitem>
</itemizedlist>

<para>This represents an improved algorithm over the original so that the discontinuity at F = 55 no longer exists. Now, the second term in the plume rise formula approaches 595 as F approaches 55 from either side.</para>

</section>

<section>

<title>Summary</title>

<para>In summary, <command>Elevpoint</command> permits the following combinations of source selection and processing:</para>

<itemizedlist>
<listitem>
<para>Identify MEPSE/PinG sources for outputting to special PinG files only (all other point sources will be treated as potentially elevated by <command>Laypoint</command>).</para>
</listitem>
<listitem>
<para>Identify elevated sources (MPSs) with the <envar>PELVCONFIG</envar> file, which might include using the cutoff method alone or in combination with other criteria.</para>
</listitem>
<listitem>
<para>Identify elevated sources (MPSs) and MEPSE/PinG sources with the <envar>PELVCONFIG</envar> file with cutoff method (<command>Laypoint</command> not used) and identify MEPSE/PinG sources with the <envar>PSPLIT</envar> file for outputting to special PinG files.</para>
</listitem>
</itemizedlist>

</section>

</section>

<section>

<title>Processing Order</title>

<para><command>Smkinven</command> must be run for point sources before <command>Elevpoint</command>. If the <envar>PELVCONFIG</envar> file uses emissions as a source-grouping or source-selection criterion, then <command>Temporal</command> must be run before <command>Elevpoint</command>.</para>

<para><command>Elevpoint</command> must be run before <command>Laypoint</command>.</para>

<para><command>Elevpoint</command> must be run before <command>Smkmerge</command> if elevated sources are to be used.</para>

<para><command>Elevpoint</command> is an optional program that is not needed if all of the following criteria are met:</para>

<orderedlist>
<listitem>
<para>A UAM-style model (e.g., UAM, REMSAD, CAM<subscript>X</subscript>) is not being used.</para>
</listitem>
<listitem>
<para>No MEPSE/PinG source processing is required.</para>
</listitem>
<listitem>
<para>You are willing to run <command>Laypoint</command> for all point sources and treat all as "potentially elevated". In this case, sources that rise above layer 1 will be "elevated" for reporting purposes in <command>Smkreport</command>, but these sources may sometimes be within layer 1 if the plume rise algorithm in <command>Laypoint</command> computes it that way.</para>
</listitem>
</orderedlist>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_elevpoint">
<title><command>Elevpoint</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/elevpoint_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/elevpoint_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_elevpoint" /> shows the input and output files for the <command>Elevpoint</command> program. The input files include the point-source inventory file output from <command>Smkinven</command> (<envar>PNTS</envar>), an elevated source configuration file (<envar>PELVCONFIG</envar>), the grid description file (<envar>GRIDDESC</envar>), and a list of hourly inventory files output by <command>Temporal</command> if the elevated source configuration file selects by emissions value or rank (<envar>PTMPLIST</envar>). The program outputs an elevated point source identification file (<envar>PELV</envar>), a plume-in-grid and/or elevated sources stack parameters file (<envar>STACK_GROUPS</envar>), and an elevated and PinG source report (<envar>REPPELV</envar>).</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>PNTS</envar></entry>
<entry>SMOKE map</entry>
<entry>Intermediate inventory file produced by <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>PELVCONFIG</envar></entry>
<entry>ASCII</entry>
<entry>Elevated source configuration file</entry>
</row>
<row>
<entry><envar>GRIDDESC</envar></entry>
<entry>ASCII</entry>
<entry>Description of the modeling grid</entry>
</row>
<row>
<entry><envar>PTMPLIST</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>List of hourly inventory files produced by <command>Temporal</command>; needed only when <envar>PELVCONFIG</envar> specifies emissions as one of the selection or grouping criteria</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section id="sect_programs_elevpoint_envar">

<title>Input Environment Variables</title>

<itemizedlist>
<listitem>
<para><envar>SMK_ELEV_METHOD</envar>: [default: 0]</para>

<para>Defines the method to use in SMOKE for determining and processing elevated point sources. The setting chosen depends on the model output format needed from SMOKE. All PinG sources determined based on <envar>SMK_PING_METHOD</envar> will automatically be considered elevated sources (as defined specifically for the model for which you are creating emissions).</para>

<itemizedlist>
<listitem>
<para>0: Treat all sources as potentially elevated, and let the <command>Laypoint</command> program determine which sources are elevated and which are not. This approach is appropriate only for SMOKE output for the CMAQ and MAQSIP models.</para>
</listitem>
<listitem>
<para>1: Use the "Elevated" section of the <envar>PELVCONFIG</envar> configuration file to select specific sources. This approach can be used for any of the model output formats - CMAQ, MAQSIP, and UAM-style.</para>
</listitem>
</itemizedlist>

<para>For UAM-style emissions processing, this environment variable must be set to 1 and the <envar>PELVCONFIG</envar> file will be used to select specific sources. This method of processing is needed for UAM, REMSAD, and CAM<subscript>X</subscript> because they require use of the cutoff method discussed earlier. In rare cases of a very small inventory, it might be acceptable to specify 0 for this setting in UAM-style emissions processing, provided that you are sure that treating all sources as elevated sources in UAM-style models is acceptable. We do not recommend such an approach for typical SMOKE applications for UAM-style models.</para>
</listitem>
<listitem>
<para><envar>SMK_PING_METHOD</envar>: [default: 0]</para>

<para>Defines the method to use in determining PinG point sources.</para>

<itemizedlist>
<listitem>
<para>0: No PinG sources</para>
</listitem>
<listitem>
<para>1: Use PinG section of <envar>PELVCONFIG</envar> configuration file</para>
</listitem>
</itemizedlist>

<para>For all models that SMOKE supports except MAQSIP, use of PinG sources is optional. MAQSIP does not include a released PinG implementation. Some models may have limitations on the number of PinG sources supported, and you must make sure that these limitations are met; SMOKE does not automatically compare with these limitations, if any.</para>

<para>For CMAQ, SMOKE will output a <envar>STACK_GROUPS</envar> file from the <command>Elevpoint</command> program and a <envar>PINGTS_[S|L]</envar> file from the <command>Smkmerge</command> program to support PinG. For UAM-style processing, SMOKE will flag PinG sources in the ASCII elevated file created by <command>Smkmerge</command>, and should be used with the <envar>SMK_ASCIIELEV_YN</envar> option set to Y to create this ASCII elevated file.</para>
</listitem>
<listitem>
<para><envar>SMK_SOURCE</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" /></para>
</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>PELV</envar></entry>
<entry>ASCII</entry>
<entry>Elevated point source identification file</entry>
</row>
<row>
<entry><envar>STACK_GROUPS</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>PinG and/or elevated sources stack parameters file</entry>
</row>
<row>
<entry><envar>REPPELV</envar></entry>
<entry>ASCII</entry>
<entry>Reports the sources selected as elevated and PinG, plus other information about the sources, including why they were selected</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Elevpoint</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

<section>

<title>Earlier Versions</title>

<para>This program is an updated version of the <command>Elevpoint</command> program in the SMOKE prototype. The new version creates the <envar>STACK_GROUPS</envar> file for use with plume-in-grid models.</para>

<para>SMOKE versions after 1.3 also include new capabilities for selecting PinG and elevated sources using the <envar>PELVCONFIG</envar> file. Version 1.3 and earlier used the <envar>PSPLIT</envar> and <envar>PGROUP</envar> files, which are no longer supported by <command>Elevpoint</command>. The <envar>PSPLIT</envar> and <envar>PGROUP</envar> files were created manually or using the SMOKE Tool in the Models-3 Framework, but SMOKE versions after 1.3 no longer rely on the SMOKE Tool or users to prepare these files.</para>

<para>The <envar>REPPELV</envar> file did not exist in versions 1.3 and earlier.</para>

</section>

</section>

<section id="sect_programs_emisfac">

<title><command>Emisfac</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> mobile</para>

<para>The <command>Emisfac</command> program drives EPA's Office of Transportation and Air Quality MOBILE model (version 6.2) to generate emission factors representing several different emission processes. The program drives MOBILE6 by supplying 24-hour temperature profiles and county-specific MOBILE6 input files. Using multiple calls to MOBILE6, <command>Emisfac</command> uses the specified temperatures and inputs to create emission factors for all sources. Having <command>Emisfac</command> execute MOBILE6 allows very complex combinations of emission factors to be generated in a relatively short period of time.</para>

<section>

<title>MOBILE modifications</title>

<para>In adapting MOBILE6 for use in SMOKE, MOBILE6 has been changed somewhat in order to output emission factors at the level of aggregation required by SMOKE, generate multiple sets of emission factors in the same run, and create a better interface with <command>Emisfac</command>. The mappings of SMOKE road classes to MOBILE6 facilities and of SMOKE vehicle types to MOBILE6 facilities are given in <xref linkend="tbl_concepts_mobile6_roads" /> and <xref linkend="tbl_concepts_mobile6_vehicles" />.</para>

</section>

<section>

<title>Accounting for freeway ramps in speeds and emission factors</title>

<para>The annual VMT and average speed values for rural and urban interstates and urban freeways typically account for travel on freeway ramps. Since MOBILE6 calculates freeway and freeway ramp emission factors separately, SMOKE must create a composite emission factor that is used for rural and urban interstates and urban freeways. The approach SMOKE uses is intended to duplicate the way MOBILE6 is used outside of SMOKE to compute the NEI inventories.</para>

<para>Since the speeds provided in the on-road mobile inventory are an average of speeds on freeways and ramps, SMOKE first calculates the nonramp freeway speed using the following formula:</para>

<para>S<subscript>f</subscript> = (1 - V<subscript>r</subscript>)/[(1/S<subscript>i</subscript>) - (V<subscript>r</subscript>/S<subscript>r</subscript>)]</para>

<para>where</para>

<itemizedlist>
<listitem>
S<subscript>f</subscript> = freeway (nonramp) speed
</listitem>
<listitem>
V<subscript>r</subscript> = ramp VMT fraction
</listitem>
<listitem>
S<subscript>i</subscript> = inventory freeway speed (includes ramps)
</listitem>
<listitem>
S<subscript>r</subscript> = ramp speed
</listitem>
</itemizedlist>

<para>Based on the MOBILE6 documentation, SMOKE assumes a ramp VMT fraction (V<subscript>r</subscript>) of 0.08 and a constant ramp speed (S<subscript>r</subscript>) of 34.6 mph. The calculated nonramp freeway speed (S<subscript>f</subscript>) is passed to MOBILE6 and used to calculate the freeway emission factors. MOBILE6 uses a fixed ramp speed of 34.6 mph to calculate the freeway ramp emission factors. The environment variables <envar>ADJUST_INV_SPEED</envar> and <envar>ADJUST_HR_SPEED</envar> are used to control whether or not the inventory and/or hourly speeds are adjusted for freeway ramps.</para>

<para>SMOKE creates a composite emission factor from the freeway and ramp emission factors as follows:</para>

<para>C<subscript>ef</subscript> = V<subscript>r</subscript> R<subscript>ef</subscript> + (1 - V<subscript>r</subscript>) F<subscript>ef</subscript></para>

<para>where</para>

<itemizedlist>
<listitem>
C<subscript>ef</subscript> = composite emission factor
</listitem>
<listitem>
V<subscript>r</subscript> = ramp VMT fraction
</listitem>
<listitem>
R<subscript>ef</subscript> = ramp emission factor
</listitem>
<listitem>
F<subscript>ef</subscript> = freeway emission factor
</listitem>
</itemizedlist>

<para>Again, SMOKE assumes a ramp VMT fraction (V<subscript>r</subscript>) of 0.08.</para>

</section>

</section>

<section>

<title>Processing Order</title>

<para><command>Smkinven</command>, <command>Grdmat</command>, <command>Mbsetup</command>, and <command>Premobl</command> must be run before <command>Emisfac</command>.</para>

<para><command>Emisfac</command> must be run before <command>Temporal</command> and <command>Smkmerge</command> for mobile sources.</para>

<para><command>Emisfac</command> is an optional program that is needed only if activity data are used in the SMOKE mobile-source inventory file.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_emisfac">
<title><command>Emisfac</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/emisfac_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/emisfac_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_emisfac" /> shows the input and output files for the <command>Emisfac</command> program. The input files include a group file listing counties using <emphasis>xx</emphasis>-average temperatures (<envar>DAILYGROUP</envar>, <envar>WEEKLYGROUP</envar>, <envar>MONTHLYGROUP</envar>, or <envar>EPISODEGROUP</envar>), a temperature file output from <command>Premobl</command> (<envar>HOURLYT</envar>), an inventory data table (<envar>INVTABLE</envar>), a file listing the MOBILE6 scenario files (<envar>M6LIST</envar>), a mobile emission processes file (<envar>MEPROC</envar>), the mobile-source inventory file output from <command>Smkinven</command> (<envar>MOBL</envar>), the speed profiles file (only if <envar>USE_SPEED_PROFILES</envar> is set to Y), a speed summary file output by <command>Mbsetup</command> (<envar>SPDSUM</envar>), and sets of temperature files subsequent to the <envar>HOURLYT</envar> file. The program outputs some MOBILE6 intermediate files and sets of emissions factor files.</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>DAILYGROUP</envar> (optional)*</entry>
<entry>ASCII</entry>
<entry>List of counties using day-average temperatures, produced by <command>Mbsetup</command></entry>
</row>
<row>
<entry><envar>WEEKLYGROUP</envar> (optional)*</entry>
<entry>ASCII</entry>
<entry>List of counties using week-average temperatures, produced by <command>Mbsetup</command></entry>
</row>
<row>
<entry><envar>MONTHLYGROUP</envar> (optional)*</entry>
<entry>ASCII</entry>
<entry>List of counties using month-average temperatures, produced by <command>Mbsetup</command></entry>
</row>
<row>
<entry><envar>EPISODEGROUP</envar> (optional)*</entry>
<entry>ASCII</entry>
<entry>List of counties using episode-average temperatures, produced by <command>Mbsetup</command></entry>
</row>
<row>
<entry><envar>HOURLYT</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Initial hourly temperature file produced by <command>Premobl</command>; assumed to match <envar>GROUP_TYPE</envar> environment variable</entry>
</row>
<row>
<entry><envar>INVTABLE</envar></entry>
<entry>ASCII</entry>
<entry>Inventory data table containing activity and pollutant names</entry>
</row>
<row>
<entry><envar>M6LIST</envar></entry>
<entry>ASCII</entry>
<entry>List of MOBILE6 scenario files with full names and paths</entry>
</row>
<row>
<entry><envar>MEPROC</envar></entry>
<entry>ASCII</entry>
<entry>Mobile-source emission processes file</entry>
</row>
<row>
<entry><envar>MOBL</envar></entry>
<entry>SMOKE map</entry>
<entry>Intermediate inventory file produced by <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>SPDPRO</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Speed profiles file, required when <envar>USE_SPEED_PROFILES</envar> = Y</entry>
</row>
<row>
<entry><envar>SPDSUM</envar></entry>
<entry>ASCII</entry>
<entry>Vehicle speed summary file, produced by <command>Mbsetup</command></entry>
</row>
<row>
<entry><filename>{<envar>GROUP_TYPE</envar>}.{date}.ncf</filename></entry>
<entry>I/O API netCDF</entry>
<entry>Sets of temperature files subsequent to the <envar>HOURLYT</envar> file</entry>
</row>
</tbody>
</tgroup>
</informaltable>

<para>* At least one <envar>[xx]GROUP</envar> is required.</para>

</section>

<section>

<title>Input Environmant Variables</title>

<itemizedlist>
<listitem>
<para><envar>ADJUST_HR_SPEED</envar>: [default: N]</para>

<para>Indicates whether the hourly speeds should be adjusted to account for freeway ramps.</para>

<itemizedlist>
<listitem>
<para>Y: Adjust hourly speeds to account for freeway ramps</para>
</listitem>
<listitem>
<para>N: Do not modify hourly speeds</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>ADJUST_INV_SPEED</envar>: [default: Y]</para>

<para>Indicates whether average freeway speeds from the inventory should be adjusted to account for freeway ramps.</para>

<itemizedlist>
<listitem>
<para>Y: Adjust inventory speeds to account for freeway ramps</para>
</listitem>
<listitem>
<para>N: Do not modify inventory speeds</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>EF_YEAR</envar>: [default: 1988]</para>

<para>Sets the year for which to create emission factors.</para>
</listitem>
<listitem>
<para><envar>GROUP_TYPE</envar>: [default: daily]</para>

<para>Sets which temporal averaging group to process by indicating which of the group files (<envar>DAILYGROUP</envar>, <envar>WEEKLYGROUP</envar>, etc.) to open. Valid values are daily, weekly, monthly, and episode.</para>
</listitem>
<listitem>
<para><envar>MB_HC_TYPE</envar>: [default: TOG]</para>

<para>Sets the type of hydrocarbon pollutant to generate from MOBILE6. Valid values are THC, NMHC, VOC, TOG, and NMOG.</para>
</listitem>
<listitem>
<para><envar>REPLACE_TEMPERATURES</envar>: [default: Y]</para>

<para>Defines whether to replace the temperatures in the MOBILE6 scenario files with those calculated in <command>Premobl</command>.</para>

<itemizedlist>
<listitem>
<para>Y: Replace temperatures</para>
</listitem>
<listitem>
<para>N: Use original temperatures from MOBILE6 scenario files</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>SMK_EMISPATH</envar>: [default: <filename class="directory">.</filename>]</para>

<para>Directory for the output emission factor files.</para>
</listitem>
<listitem>
<para><envar>SMK_M6PATH</envar>: [default: <filename class="directory">.</filename>]</para>

<para>Directory for the external MOBILE6 input files and intermediate files.</para>
</listitem>
<listitem>
<para><envar>SMK_METPATH</envar>: [default: <filename class="directory">.</filename>]</para>

<para>Directory for the hourly temperature files.</para>
</listitem>
<listitem>
<para><envar>SMK_SOURCE</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" /></para>
</listitem>
<listitem>
<para><envar>SMK_SPDPATH</envar>: [default: <filename class="directory">.</filename>]</para>

<para>Directory for the speed files needed by MOBILE6.</para>
</listitem>
<listitem>
<para><envar>USE_SPEED_PROFILES</envar>: [default: N]</para>

<para>Indicates whether speed profiles (hourly speeds) should be used instead of inventory speeds.</para>

<itemizedlist>>
<listitem>
<para>Y: Use speed profiles instead of inventory speeds (requires <envar>SPDPRO</envar> file)</para>
</listitem>
<listitem>
<para>N: Use inventory speeds</para>
</listitem>
</itemizedlist>

</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry>various</entry>
<entry>ASCII</entry>
<entry>Intermediate files used when running MOBILE6, located in the <envar>SMK_M6PATH</envar> directory</entry>
</row>
<row>
<entry><filename>emisfacs.<envar>${GROUP_TYPE}</envar>.{date}.ncf</filename></entry>
<entry>I/O API netCDF</entry>
<entry>Sets of files containing emission factors corresponding to the hourly temperature files, located in the <envar>SMK_EMISPATH</envar> directory</entry>
</row>
<row>
<entry>LOGFILE</entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Emisfac</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

<section>

<title>Earlier Versions</title>

<para>Prior versions of SMOKE did not have mobile-source emissions stored in a <envar>MOBL</envar> file, so <command>Emisfac</command> had to calculate required emission factors for all mobile-source records. Because <command>Smkinven</command> now stores mobile-source emissions in the intermediate inventory file, <command>Emisfac</command> no longer needs to compute emission factors for those records.</para>

<para>In previous versions of SMOKE, the MOBILE5b model was used to generate emission factors.</para>

<para>Version 2.0 added the capability to use hourly speed profiles instead of inventory speeds, and adjustments to speed and emission factors to account for travel on freeway ramps.</para>

</section>

</section>

<section id="sect_programs_grdmat">

<title><command>Grdmat</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> area, mobile, point</para>

<para>The <command>Grdmat</command> program produces the matrix that contains the factors for spatially allocating the emission sources to the modeling domain.</para>

<para>Point sources are assigned to grid cells using the geographic coordinates that are stored in each point-source record. For area and mobile sources, a cross-reference file matches the gridding surrogates to the source-level emissions. When the gridding cross-reference files are applied, the most-specific matches always override the less-specific ones.</para>

<para>For the current version of SMOKE, a gridding surrogates file must be created for the specific grid of interest. This can be accomplished in a variety of ways:</para>

<itemizedlist>
<listitem>
<para>ArcInfo (or other GIS) processing by an expert in creating gridding surrogates.</para>
</listitem>
<listitem>
<para>Using the MIMS Spatial Allocation Tool.</para>
</listitem>
<listitem>
<para>Extracting surrogate data from a larger gridding surrogates file. <remark>A number of efforts are underway to create surrogates at 4-km resolution for the entire U.S.</remark> To use these data, you must adopt for your modeling the grid projection used to create the gridding surrogates.</para>
</listitem>
</itemizedlist>

<para>For area sources, the gridding cross-reference file provides the following possible combinations, ordered from most specific to least specific:</para>

<orderedlist>
<listitem>
<para>Country/state/county code and 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state/county code and 7-digit SCC</para>
</listitem>
<listitem>
<para>Country/state code and 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state code and 7-digit SCC</para>
</listitem>
<listitem>
<para>10-digit SCC</para>
</listitem>
<listitem>
<para>7-digit SCC</para>
</listitem>
<listitem>
<para>Country/state/county code</para>
</listitem>
<listitem>
<para>Country/state code</para>
</listitem>
<listitem>
<para>Ultimate default (country/state/county code = 0, SCC = 0)</para>
</listitem>
</orderedlist>

<para>For mobile sources, the available combinations and their order are:</para>

<orderedlist>
<listitem>
<para>Country/state/county code, and 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state code and 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state/county code</para>
</listitem>
<listitem>
<para>Country/state code</para>
</listitem>
<listitem>
<para>10-digit SCC</para>
</listitem>
<listitem>
<para>Ultimate default (country/state/county code = 0, SCC = 0)</para>
</listitem>
</orderedlist>

<para>For mobile sources only, <command>Grdmat</command> outputs both a gridding matrix and a second file called an "ungridding" matrix. This ungridding matrix is used by <command>Mbsetup</command> and <command>Temporal</command> to determine which sources are within the grid, and by <command>Premobl</command> to compute county-based temperatures from the gridded temperature data inputs. The ungridding matrix is calculated as the ratio of VMT in a given grid cell to the total amount of VMT in the county. For link-based sources, the ratio is the amount of VMT in the grid cell to the total VMT for that link. This results in nonlink sources within a county using the same weighting factors across grid cells, while link sources have different factors. <remark>Note that at this time, <command>Premobl</command> cannot use link-based temperature data.</remark></para>

</section>

<section>

<title>Processing Order</title>

<para><command>Smkinven</command> must be run before <command>Grdmat</command>.</para>

<para>For mobile sources only, <command>Grdmat</command> must be run before <command>Mbsetup</command>, <command>Premobl</command>, <command>Emisfac</command>, and <command>Temporal</command>.</para>

<para><command>Grdmat</command> must be run before gridded emissions may be produced using <command>Smkmerge</command>.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_grdmat">
<title><command>Grdmat</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/grdmat_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/grdmat_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_grdmat" /> shows the input and output files for the <command>Grdmat</command> program. The input files include the inventory file output from <command>Smkinven</command> (<envar>AREA</envar>, <envar>MOBL</envar>, or <envar>PNTS</envar>), the spatial cross-reference file (<envar>AGREF</envar> or <envar>MGREF</envar>), the spatial surrogates file (<envar>AGPRO</envar> or <envar>MGPRO</envar>), and the grid description file (<envar>GRIDDESC</envar>). For mobile sources, the mobile codes file (<envar>MCODES</envar>) is also needed, <remark>and the link definitions file (<envar>MGLNK</envar>) can be optionally provided to specify link coordinates</remark>. The program outputs a gridding matrix (<envar>AGMAT</envar>, <envar>MGMAT</envar>, or <envar>PGMAT</envar>) used by other SMOKE programs, and a supplemental output file (<envar>AGSUP</envar> or <envar>MGSUP</envar>) that includes all of the spatial surrogate codes assigned to each source. For mobile sources, <command>Grdmat</command> also outputs the <envar>MUMAT</envar> ungridding matrix file.</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[AREA|MOBL|PNTS]</envar></entry>
<entry>SMOKE map</entry>
<entry>Intermediate inventory file produced by <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>[A|M]GREF</envar></entry>
<entry>ASCII</entry>
<entry>Gridding surrogate cross-reference file</entry>
</row>
<row>
<entry><envar>[A|M]GPRO</envar></entry>
<entry>ASCII</entry>
<entry>Gridding surrogate coefficients</entry>
</row>
<row>
<entry><envar>GRIDDESC</envar></entry>
<entry>ASCII</entry>
<entry>Description of the modeling grid</entry>
</row>
<row>
<entry><envar>MCODES</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Mobile codes for converting inventory road classes and vehicle type names to SMOKE's road types and vehicle type numbers</entry>
</row>
<row>
<entry><envar>MGLNK</envar> (optional)</entry>
<entry>ASCII</entry>
<entry><remark>Link definitions file; required if <envar>GRDMAT_LINKDEFS</envar> = Y; this file is planned for future development and is not implemented in the current version of SMOKE</remark></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section>

<title>Input Environment Variables</title>

<itemizedlist>
<listitem>
<para><envar>GRDMAT_ADJUST</envar>: [default: N]</para>

<para><remark>Defines whether or not the program uses the grid adjustments file. This option is not implemented in the current version of SMOKE.</remark></para>

<itemizedlist>
<listitem>
<para>Y: Use grid adjustments file</para>
</listitem>
<listitem>
<para>N: Do not use grid adjustments file</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>GRDMAT_LINKDEFS</envar>: [default: N]</para>

<para><remark>Defines whether or not the program uses a link definitions file for mobile sources. This option is not implemented in the current version of SMOKE.</remark></para>

<itemizedlist>
<listitem>
<para>Y: Use link definitions file; requires <envar>MGLNK</envar> input file</para>
</listitem>
<listitem>
<para>N: Do not use link definitions file</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>REPORT_DEFAULTS</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" /></para>
</listitem>
<listitem>
<para><envar>SMK_DEFAULT_SRGID</envar>: [default: 50 (Models-3 population surrogate code) or 1 (if 50 is unavailable in surrogates data)]</para>

<para>Defines the surrogate code number to use as a fallback surrogate when the surrogate number set by the cross-reference file would zero out the emissions for that source.</para>
</listitem>
<listitem>
<para><envar>SMK_SOURCE</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" /></para>
</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[A|M|P]GMAT</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Gridding matrix containing the factors needed to spatially allocate the input emissions to the grid cells in the modeling domain.</entry>
</row>
<row>
<entry><envar>[A|M]GSUP</envar></entry>
<entry>ASCII</entry>
<entry>Gridding supplemental file containing spatial surrogate codes for each source</entry>
</row>
<row>
<entry><envar>MUMAT</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Ungridding matrix file; for mobile sources only</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Grdmat</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

<section>

<title>Earlier Versions</title>

<para>The SMOKE prototype used separate programs for each type of emission source: GRDAMAT for area sources, GRDMMAT for mobile sources, and GRDPMAT for point sources.</para>

<para>Calculation of the mobile "ungridding" matrix was significantly revised for SMOKE v2.0.</para>

</section>

</section>

<section id="sect_programs_grwinven">

<title><command>Grwinven</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing catagories:</emphasis> area, mobile, point</para>

<para>The <command>Grwinven</command> program grows and controls inventory emissions and activity data into the past/future by merging a SMOKE inventory file (<envar>AREA</envar>, <envar>MOBL</envar>, or <envar>PNTS</envar>) with its respective growth and control matrices. This optional program need not be used if these projections have been made outside of SMOKE. <command>Grwinven</command> outputs new SMOKE I/O API inventory files, but not the corresponding inventory ASCII files (because the program changes the data only in the I/O API inventory files, so there is no need to output the same ASCII files). The program can also output in IDA format, or be used as a converter from SMOKE to IDA format. <command>Grwinven</command> does not merge the SMOKE inventory with reactivity matrices; this functionality is handled by <command>Smkmerge</command>.</para>

<para>The <command>Grwinven</command> program writes out temporary emissions files when creating an IDA-formatted inventory. You can set the directory to which these temporary files go by setting the <envar>SMK_TMPPATH</envar> environment variable. These files can be quite large; at least 100 MB should be available on the disk to which this environment variable is set.</para>

</section>

<section>

<title>Processing Order</title>

<para><command>Smkinven</command> and <command>Cntlmat</command> must be run before <command>Grwinven</command>.</para>

<para>After running <command>Grwinven</command>, the output can be used similarly to the output from <command>Smkinven</command>. If <command>Spcmat</command> or <command>Grdmat</command> have already been run for a given inventory, these programs do not need to be rerun after running <command>Grwinven</command> because the number and order of the sources in the grown emissions files are the same as in the base case.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_grwinven">
<title><command>Grwinven</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/grwinven_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/grwinven_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_grwinven" /> shows the input and output files for the <command>Grwinven</command> program. The input files include the inventory file output from <command>Smkinven</command> (<envar>AREA</envar>, <envar>MOBL</envar>, or <envar>PNTS</envar>), the country, state and county file (<envar>COSTCY</envar>), and all of the control or growth matrices output from <command>Cntlmat</command> (<envar>ACMATxx</envar>, <envar>MCMATxx</envar>, or <envar>PCMATxx</envar>). The program outputs new inventory files (<envar>AREA_O</envar>, <envar>MOBL_O</envar>, or <envar>PNTS_O</envar>) that have been either controlled or grown into the past or future. Optionally, you can choose to output ASCII inventory files (<envar>ARINV_O</envar>, <envar>MBINV_O</envar>, or <envar>PTINV_O</envar>). Note that the suffix _O is used to distinguish the <command>Grwinven</command> output files from the input files.</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[AREA|MOBL|PNTS]</envar></entry>
<entry>SMOKE map</entry>
<entry>Intermediate inventory file produced by <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>COSTCY</envar></entry>
<entry>ASCII</entry>
<entry>Country, state, and county file</entry>
</row>
<row>
<entry><envar>[A|M|P]CMAT_01</envar>, <envar>[A|M|P]CMAT_02</envar>, ...</entry>
<entry>I/O API netCDF</entry>
<entry>Control or growth matrices output from <command>Cntlmat</command>; total number of files is determined by <envar>SMK_NUM_CTLMAT</envar> setting</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section>

<title>Input Environment Variables</title>

<itemizedlist>
<listitem>
<para><envar>SMK_GRWIDAOUT_YN</envar>: [default: N]</para>

<itemizedlist>
<listitem>
<para>Y: Output inventory in IDA format</para>
</listitem>
<listitem>
<para>N: Do not output IDA format</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>SMK_GRWSMKOUT_YN</envar>: [default: Y]</para>

<itemizedlist>
<listitem>
<para>Y: Output inventory in SMOKE I/O API format</para>
</listitem>
<listitem>
<para>N: Do not output SMOKE I/O API format</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>SMK_NUM_CTLMAT</envar>: [default: 1]</para>

<para>Number of control and/or projection matrices to import and apply to the inventory.</para>
</listitem>
<listitem>
<para><envar>SMK_TMPPATH</envar>: [default: <filename class="directory">.</filename>]</para>

<para>Defines the path to use for temporary files that are written out when supplying the IDA-formatted inventory. This setting is used only when <envar>SMK_GRWIDAOUT_YN</envar> is set to Y.</para>
</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[AREA_O| MOBL_O| PNTS_O]</envar></entry>
<entry>SMOKE map</entry>
<entry>Annual and average-day inventory emissions and source characteristics</entry>
</row>
<row>
<entry><envar>[ARINV_O| MBINV_O| PTINV_O]</envar></entry>
<entry>ASCII</entry>
<entry>Annual and average-day inventory emissions and source characteristics</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Grwinven</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

<section>

<title>Earlier Versions</title>

<para><command>Grwinven</command> was updated for SMOKE v2.0 to output SICs for non-point toxic inventories.</para>

</section>

</section>

<section id="sect_programs_laypoint">

<title><command>Laypoint</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> point</para>

<para>The <command>Laypoint</command> program uses the SMOKE point-source inventory file with gridded and hourly meteorology data to compute hourly plume rise for all point sources. The plume rise is expressed in terms of layer fractions for each source.</para>

<para><command>Laypoint</command> is run only for the MAQSIP and CMAQ styles of processing, in which all of the plume rise calculations are done prior to input to the AQM. In <command>Laypoint</command>, meteorological data are used to calculate the plume rise for all point sources. Then, the plume is distributed into the vertical layers that the plume intersects based on the pressure in each layer. Only these fractions are stored (not the emissions in each layer), until the SMOKE merge step (<command>Smkmerge</command>). Therefore, the plume rise calculations do not need to be repeated for each control strategy or grid (unlike the situation in which the plume rise calculations are done inside the AQM, such as in UAM-IV and UAM-V). The <command>Laypoint</command> program calculates the plume rise for all days of each meteorological scenario.</para>

</section>

<section>

<title>Processing Order</title>

<para>For elevated point sources, <command>Smkinven</command> and <command>Elevpoint</command> must be run before <command>Laypoint</command> if using PinG and/or specific major point sources.</para>

<para><command>Laypoint</command> must be run before elevated sources can be processed using <command>Smkmerge</command>.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_laypoint">
<title><command>Laypoint</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/laypoint_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/laypoint_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_laypoint" /> shows the input and output files for the <command>Laypoint</command> program. The input files include the grid description file (<envar>GRIDDESC</envar>), meteorology files created by the meteorology preprocessor (<envar>GRID_CRO_3D</envar>, <envar>MET_CRO_2D</envar>, <envar>MET_CRO_3D</envar>, and <envar>MET_DOT_3D</envar>), the inventory file output from <command>Smkinven</command> (<envar>PNTS</envar>), the elevated point source identification file output from <command>Elevpoint</command> (<envar>PELV</envar>) if this file will be used to set elevated sources, and optionally the hourly inventory file from <command>Smkinven</command> (<envar>PHOUR</envar>) if hourly plume data are to be used. The program outputs hourly plume rise layer fractions for all sources (<envar>PLAY</envar>) or optionally only for explicit sources (<envar>PLAY_EX</envar>).</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>GRIDDESC</envar></entry>
<entry>ASCII</entry>
<entry>Description of the modeling grid</entry>
</row>
<row>
<entry><envar>GRID_CRO_3D</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Meteorology file produced by the meteorology preprocessor </entry>
</row>
<row>
<entry><envar>MET_CRO_2D</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Meteorology file produced by the meteorology preprocessor </entry>
</row>
<row>
<entry><envar>MET_CRO_3D</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Meteorology file produced by the meteorology preprocessor </entry>
</row>
<row>
<entry><envar>MET_DOT_3D</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Meteorology file produced by the meteorology preprocessor </entry>
</row>
<row>
<entry><envar>PNTS</envar></entry>
<entry>SMOKE map</entry>
<entry>Intermediate inventory file produced by <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>PELV</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Elevated point source identification file produced by <command>Elevpoint</command></entry>
</row>
<row>
<entry><envar>PHOUR</envar> (optional)</entry>
<entry>I/O API netCDF</entry>
<entry>Hourly point-source inventory file produced by <command>Smkinven</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section id="sect_programs_laypoint_envar">

<title>Input Environment Variables</title>

<itemizedlist>
<listitem>
<para><envar>EXPLICIT_PLUMES_YN</envar>: [default: N]</para>

<para>Indicates whether only explicit plume rise sources should be calculated.</para>

<itemizedlist>
<listitem>
<para>Y: Process only explicit plume rise sources; automatically sets <envar>HOUR_PLUMEDATA_YN</envar> to Y</para>
</listitem>
<listitem>
<para>N: Process all sources</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>HOUR_PLUMEDATA_YN</envar>: [default: N]</para>

<para>Indicates whether hourly plume rise data should be used.</para>

<itemizedlist>
<listitem>
<para>Y: Use hourly data; requires <envar>PHOUR</envar> file</para>
</listitem>
<listitem>
<para>N: Do not use hourly data</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>REP_LAYER_MAX</envar>: [default: -1]</para>

<para>Layer number for reporting high plume rise; reporting is turned off if set to less than 1.</para>
</listitem>
<listitem>
<para><envar>SMK_EMLAYS</envar>: [default: -1]</para>

<para>Number of emissions layers; must be at least 4 otherwise program will not run.</para>
</listitem>
<listitem>
<para><envar>SMK_SOURCE</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" />.</para>
</listitem>
<listitem>
<para><envar>SMK_SPECELEV_YN</envar>: [default: N]</para>

<para>Defines whether the <command>Elevpoint</command> output file <envar>PELV</envar> will be used to set elevated sources.</para>

<itemizedlist>
<listitem>
<para>Y: Use the <envar>PELV</envar> file to set elevated sources during run</para>
</listitem>
<listitem>
<para>N: Let <command>Laypoint</command> plume rise calculation determine whether or not sources are elevated</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>VELOC_RECALC</envar>: [default: N]</para>

<para>Determines whether velocity should be recalculated based on hourly flow rates and stack diameter.</para>

<itemizedlist>
<listitem>
<para>Y: Recalculate velocity for hourly data</para>
</listitem>
<listitem>
<para>N: Use velocity values from hourly inventory file</para>
</listitem>
</itemizedlist>

</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>PLAY</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Hourly plume rise layer fractions by source</entry>
</row>
<row>
<entry><envar>PLAY_EX</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Hourly plume rise layer fractions for explicit sources</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Laypoint</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

<section>

<title>Earlier Versions</title>

<para>The current version of the <command>Laypoint</command> program replaces the Laypoint program found in the SMOKE prototype. This new version adds support for plume-in-grid models by removing those sources from the point-source emissions in the <envar>PLAY</envar> file.</para>

</section>

</section>

<section id="sect_programs_mbsetup">

<title><command>Mbsetup</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> mobile</para>

<para>The <command>Mbsetup</command> program prepares intermediate files needed to run <command>Premobl</command> and <command>Emisfac</command>. It uses a county cross-reference file to assign a reference county to each county in the mobile-source inventory. The program also reads a county-settings file to determine options for temperature averaging and handling of local roads. <command>Mbsetup</command> groups sources by speed and reference county, then outputs a summary file used by <command>Premobl</command> and <command>Emisfac</command>.</para>

</section>

<section>

<title>Processing Order</title>

<para><command>Smkinven</command> and <command>Grdmat</command> must be run before <command>Mbsetup</command>.</para>

<para><command>Mbsetup</command> must be run before <command>Premobl</command>.</para>

<para><command>Mbsetup</command> is needed only if activity data are used in the SMOKE mobile inventory file.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_mbsetup">
<title><command>Mbsetup</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/mbsetup_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/mbsetup_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_mbsetup" /> shows the input and output files for the <command>Mbsetup</command> program. The input files include the inventory file output from <command>Smkinven</command> (<envar>MOBL</envar>), the ungridding matrix file from <command>Grdmat</command> (<envar>MUMAT</envar>), the county cross-reference file (<envar>MCREF</envar>), the county settings file (<envar>MVREF</envar>), and the speed cross-reference file (only if <envar>USE_SPEED_PROFILES</envar> is set to Y). The program outputs an ASCII listing of counties using either day-average temperatures (<envar>DAILYGROUP</envar>), week-average temperatures (<envar>WEEKLYGROUP</envar>), month-average temperatures (<envar>MONTHLYGROUP</envar>), or episode-average temperatures (<envar>EPISODEGROUP</envar>). It also outputs a summary of speeds and road types (<envar>SPDSUM</envar>).</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>MOBL</envar></entry>
<entry>SMOKE map</entry>
<entry>Intermediate inventory file produced by <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>MUMAT</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Ungridding matrix from <command>Grdmat</command></entry>
</row>
<row>
<entry><envar>MCREF</envar></entry>
<entry>ASCII</entry>
<entry>County cross-reference file</entry>
</row>
<row>
<entry><envar>MVREF</envar></entry>
<entry>ASCII</entry>
<entry>County settings file</entry>
</row>
<row>
<entry><envar>SPDREF</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Speed profiles cross-reference file</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section>

<title>Input Environment Variables</title>

<itemizedlist>
<listitem>
<para><envar>SMK_SOURCE</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" />.</para>
</listitem>
<listitem>
<para><envar>USE_SPEED_PROFILES</envar>: [default: N]</para>

<para>Indicates whether hourly speed profiles should be used instead of speed data from the inventory.</para>

<itemizedlist>
<listitem>
<para>Y: Use hourly speed data; requires <envar>SPDREF</envar> cross-reference file</para>
</listitem>
<listitem>
<para>N: Use speed data from the mobile inventory</para>
</listitem>
</itemizedlist>

</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>SPDSUM</envar></entry>
<entry>ASCII</entry>
<entry>Summary of speeds and road types associated with each source</entry>
</row>
<row>
<entry><envar>DAILYGROUP</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Listing of counties using day-average temperatures</entry>
</row>
<row>
<entry><envar>WEEKLYGROUP</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Listing of counties using week-average temperatures</entry>
</row>
<row>
<entry><envar>MONTHLYGROUP</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Listing of counties using month-average temperatures</entry>
</row>
<row>
<entry><envar>EPISODEGROUP</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Listing of counties using episode-average temperatures</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Mbsetup</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

<section>

<title>Earlier Versions</title>

<para><command>Mbsetup</command> was first released with SMOKE v1.5. SMOKE v2.0 included the ability to use hourly speed profiles.</para>

</section>

</section>

<section id="sect_programs_mrggrid">

<title><command>Mrggrid</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> all</para>

<para>The purpose of the <command>Mrggrid</command> program is to combine gridded emission data files, which can be speciated or nonspeciated, and hourly or time-independent. It can combine any number of 3-D emissions files with any number of 2-D emissions files. In fact, this program will work with any I/O API netCDF gridded files and need not be used only for emissions files. The program merges whatever data variables are in the input files. These files can each have different sets of data variables; <command>Mrggrid</command> will sum values only for each variable that is common to two or more files.</para>

<para><command>Mrggrid</command> checks several features of the input files to ensure that the data in these files are appropriate to be merged together. <command>Mrggrid</command> compares the units of the variables with the same name and it creates an error message when the units are not identical. It is not sufficient to have units that are the same in meaning but different in syntax. For example, although tons/hour and tons/hr represent the same units, <command>Mrggrid</command> will not recognize this because of the different syntax. The user must resolve unit discrepancies before running the program. In addition, <command>Mrggrid</command> compares the horizontal grid settings across all 2-D and 3-D files, and these settings must be identical in all respects (e.g., number of cells, grid cell size, grid projection). Finally, <command>Mrggrid</command> checks the layer structures across multiple 3-D files. The 3-D files can have a different number of layers, as long as any layer common to two or more files has the same thickness in each of the files. <command>Mrggrid</command> also checks the I/O API type of vertical structures and top height, and these must be identical across all 3-D files.</para>

</section>

<section>

<title>Processing Order</title>

<para><command>Mrggrid</command> can be used with any gridded output files from <command>Smkmerge</command>. It can also be used with other I/O API netCDF gridded files produced outside of SMOKE.</para>

<para>Output files from <command>Mrggrid</command> are usually model-ready input files that will be used in running an AQM.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_mrggrid">
<title><command>Mrggrid</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/mrggrid_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/mrggrid_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_mrggrid" /> shows the input and output files for the <command>Mrggrid</command> program. The input file is simply a list of the logical file names for the files to be merged (<envar>FILELIST</envar>). The program outputs a gridded, optionally layered, optionally hourly emissions file (<envar>OUTFILE</envar>).</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>FILELIST</envar></entry>
<entry>ASCII</entry>
<entry>List of <emphasis>logical</emphasis> file name for 2-D and 3-D gridded I/O API netCDF files; this file cannot contain the full paths and file names. Users should make sure that the logical file names that appear in <envar>FILELIST</envar> are defined prior to running <command>Mrggrid</command>.</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section>

<title>Input Environment Variables</title>

<para>None</para>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>OUTFILE</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Gridded, optionally layered, optionally hourly emission file</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Mrggrid</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

<section>

<title>Earlier Versions</title>

<para><command>Mrggrid</command> was first released with SMOKE v1.3.</para>

</section>

</section>

<section id="sect_programs_normbeis3">

<title><command>Normbeis3</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> biogenic</para>

<para><command>Normbeis3</command> reads gridded land use data and emissions factors and produces gridded normalized biogenic emissions. <command>Normbeis3</command> is the first program in the SMOKE-BEIS3 model; <command>Rawbio</command> is the corresponding program for SMOKE-BEIS2. The gridded land use includes 230 different land use types. Emissions factors are provided for each land use type. The output gridded domain is the same as the input domain for the land use data. Emission fluxes are normalized to 30 &deg;C, and isoprene and methyl-butenol fluxes are also normalized to a photosynthetic active radiation (PAR) of 1000 &micro;mol/m<subscript>2</subscript>s. <command>Normbeis3</command> also computes normalized emissions for winter months, using a winter factor read in from the emissions factor table. <command>Normbeis3</command> outputs winter and summer normalized emissions for four species/compounds (ISOP, MONO, OVOC, NO) as well as winter and summer leaf area indices (LAI). The output units for all species/compounds are in grams of carbon per hour.</para>

</section>

<section>

<title>Processing Order</title>

<para><command>Normbeis3</command> is the first program for processing biogenic emissions using the SMOKE-BEIS3 prototype.</para>

<para><command>Normbeis3</command> must be executed before <command>Tmpbeis3</command>.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_normbeis3">
<title><command>Normbeis3</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/normbeis3_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/normbeis3_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_normbeis3" /> shows the input and output files for the <command>Normbeis3</command> program. The input files include the emission factors file (<envar>B3FAC</envar>), the gridded land use file for the first 120 land use types (<envar>BELD3_A</envar>), the gridded land use types for the next 110 types (<envar>BELD3_B</envar>), and the land use totals data file (<envar>BELD3_TOT</envar>). The program outputs a gridded, normalized biogenic emissions file (<envar>B3GRD</envar>).</para>

<section>

<title>Input Files</title>

<para>Gridded land use data can be created using GIS software, such as ArcInfo. Another tool that can be used to generate gridded land use data is the SMOKE Tool in Models-3 (see Models-3 documentation). The typical database used to generate the <envar>BELD3_A</envar>, <envar>BELD3_B</envar>, and <envar>BELD3_TOT</envar> files is the BELD3. Future versions of SMOKE may include a method for creating land use files for use with <command>Normbeis3</command>.</para>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>B3FAC</envar></entry>
<entry>ASCII</entry>
<entry>Emission factors file</entry>
</row>
<row>
<entry><envar>BELD3_A</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Gridded land use (first 120 land use types)</entry>
</row>
<row>
<entry><envar>BELD3_B</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Gridded land use (last 110 land use types)</entry>
</row>
<row>
<entry><envar>BELD3_TOT</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Land use totals data</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section>

<title>Input Environment Variables</title>

<para>None</para>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>B3GRD</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Gridded, normalized biogenic emission for ISOP, MONO, OVOC, and NO (in grams of carbon per hour) and LAI; contains both summer and winter normalized emissions</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Normbeis3</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

<section>

<title>Earlier Versions</title>

<para>SMOKE v1.4 marked the initial release of the <command>Normbeis3</command> program, which together with the <command>Tmpbeis3</command> program make up the SMOKE-BEIS3 modeling system.</para>

</section>

</section>

<section id="sect_programs_premobl">

<title><command>Premobl</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> mobile</para>

<para>The <command>Premobl</command> program inputs gridded, time-dependent temperature data and an ungridding matrix produced by the <command>Grdmat</command> program. <command>Premobl</command> creates 24-hour temperature profiles for each county group based on settings obtained from <command>Mbsetup</command>.</para>

<section>

<title>Definition of a "day"</title>

<para><command>Premobl</command> seeks to obtain 24 hours' worth of temperature data for a source for each day, which is necessary for generating emission factors. However, the definition of a "day" differs for sources in different time zones. By default, <command>Premobl</command> uses each source's time zone to determine a day for that time zone. To instead use the same day-start-time for all sources, the <envar>UNIFORM_TIME</envar> environment variable can be used.</para>

<para>If the inventory covers multiple time zones, all sources will not have the same coverage of days. <command>Premobl</command> will use temperature data from previous or subsequent days to fill in missing data. If appropriate data are not available, the program will quit with an error and you must provide additional temperature data to cover the time period of interest. Currently, <command>Premobl</command> does not considers Daylight Saving time in its determination of "day".</para>

</section>

</section>

<section>

<title>Processing Order</title>

<para><command>Smkinven</command>, <command>Grdmat</command>, and <command>Mbsetup</command> must be run before <command>Premobl</command>.</para>

<para><command>Premobl</command> program must be run before <command>Emisfac</command>.</para>

<para><command>Premobl</command> is needed only if activity data are used in the SMOKE mobile-source inventory file.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_premobl">
<title><command>Premobl</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/premobl_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/premobl_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_premobl" /> shows the input and output files for the <command>Premobl</command> program. The input files include the inventory file output from <command>Smkinven</command> (<envar>MOBL</envar>), the ungridding matrix file (<envar>MUMAT</envar>), the file listing the meteorology files (<envar>METLIST</envar>), the speed summary file (<envar>SPDSUM</envar>) from the <command>Mbsetup</command> program, and a file listing the counties using either day-average temperatures (<envar>DAILYGROUP</envar>), week-average temperatures (<envar>WEEKLYGROUP</envar>), month-average temperatures (<envar>MONTHLYGROUP</envar>), or episode-average temperatures (<envar>EPISODEGROUP</envar>). The program outputs sets of files containing 24-hour temperature profiles.</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>MOBL</envar></entry>
<entry>SMOKE map</entry>
<entry>Intermediate inventory file produced by <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>MUMAT</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Ungridding matrix from <command>Grdmat</command></entry>
</row>
<row>
<entry><envar>METLIST</envar></entry>
<entry>ASCII</entry>
<entry>Listing of <envar>MET_CRO_2D</envar> or <envar>MET_CRO_3D</envar> meteorology files, with full names and paths</entry>
</row>
<row>
<entry><envar>SPDSUM</envar></entry>
<entry>ASCII</entry>
<entry>Vehicle speed summary file produced by <command>Mbsetup</command></entry>
</row>
<row>
<entry><envar>DAILYGROUP</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>List of counties using day-average temperatures, from <command>Mbsetup</command></entry>
</row>
<row>
<entry><envar>WEEKLYGROUP</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>List of counties using week-average temperatures, from <command>Mbsetup</command></entry>
</row>
<row>
<entry><envar>MONTHLYGROUP</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>List of counties using month-average temperatures, from <command>Mbsetup</command></entry>
</row>
<row>
<entry><envar>EPISODEGROUP</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>List of counties using episode-average temperatures, from <command>Mbsetup</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section id="sect_programs_premobl_envar">

<title>Input Environment Variables</title>

<itemizedlist>
<listitem>
<para><envar>EPI_RUNLEN</envar>: [default: 0]</para>

<para>Sets the overall episode duration (HHMMSS).</para>
</listitem>
<listitem>
<para><envar>EPI_STDATE</envar>: [default: 0]</para>

<para>Sets the overall episode start date; Julian format (YYYYDDD).</para>
</listitem>
<listitem>
<para><envar>EPI_STTIME</envar>: [default: 0]</para>

<para>Sets the overall episode start time (HHMMSS). Midnight may be entered as 0 instead of 000000.</para>
</listitem>
<listitem>
<para><envar>OUTZONE</envar>: [default: 0]</para>

<para>Indicates offset from Greenwich Mean Time (GMT) for episode start date and time. <envar>OUTZONE</envar> should be set to the standard time for the time zone of interest; SMOKE will adjust to Daylight Saving time for episodes that are during periods and in regions where Daylight Saving time applies.</para>

<para><xref linkend="tbl_programs_outzone" /> provides allowed values for <envar>OUTZONE</envar>. The CMAQ and MAQSIP models expect <envar>OUTZONE</envar> to be 0, while other models such as UAM-IV, UAM-V, REMSAD, and CAM<subscript>X</subscript> often use time zone 5. All models expect that the emissions and the meteorology data provided to the model will have a consistent time zone. SMOKE expects that the meteorology data will be in GMT.</para>

<table id="tbl_programs_outzone">
<title>Values for <envar>OUTZONE</envar> and associated time zone</title>

<tgroup cols="4">
<thead>
<row>
<entry><envar>OUTZONE</envar></entry>
<entry>GMT Offset</entry>
<entry>Time Zone</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry>0</entry>
<entry>+0:00</entry>
<entry>GMT</entry>
<entry>Greenwich Mean Time</entry>
</row>
<row>
<entry>4</entry>
<entry>-4:00</entry>
<entry>AST</entry>
<entry>Atlantic Standard Time</entry>
</row>
<row>
<entry>5</entry>
<entry>-5:00</entry>
<entry>EST</entry>
<entry>Eastern Standard Time</entry>
</row>
<row>
<entry>6</entry>
<entry>-6:00</entry>
<entry>CST</entry>
<entry>Central Standard Time</entry>
</row>
<row>
<entry>7</entry>
<entry>-7:00</entry>
<entry>MST</entry>
<entry>Mountain Standard Time</entry>
</row>
<row>
<entry>8</entry>
<entry>-8:00</entry>
<entry>PST</entry>
<entry>Pacific Standard Time</entry>
</row>
<row>
<entry>9</entry>
<entry>-9:00</entry>
<entry>YST</entry>
<entry>Yukon Standard Time</entry>
</row>
<row>
<entry>10</entry>
<entry>-10:00</entry>
<entry>HST</entry>
<entry>Hawaiian Standard Time</entry>
</row>
<row>
<entry>10</entry>
<entry>-10:00</entry>
<entry>CAT</entry>
<entry>Central Alaska Time</entry>
</row>
<row>
<entry>11</entry>
<entry>-11:00</entry>
<entry>NT</entry>
<entry>Nome Time</entry>
</row>
</tbody>
</tgroup>
</table>

<para>Note that SMOKE expects <envar>OUTZONE</envar> to be set as a positive number for time zones in the Western Hemisphere, although standard notation would list these as negative values. For example, Eastern Standard Time is -5:00 hours from GMT, but <envar>OUTZONE</envar> for EST in SMOKE is 5.</para>
</listitem>
<listitem>
<para><envar>SMK_MAXTEMP</envar>: [default: 120.0 (from MOBILE6)]</para>

<para>Defines the maximum allowable hourly temperature (&deg;F).</para>
</listitem>
<listitem>
<para><envar>SMK_METPATH</envar>: [default: <filename class="directory">.</filename>]</para>

<para>Directory for the hourly temperature files.</para>
</listitem>
<listitem>
<para><envar>SMK_MINTEMP</envar>: [default: 0.0 (from MOBILE6)]</para>

<para>Defines the minimum allowable hourly temperature (&deg;F).</para>
</listitem>
<listitem>
<para><envar>SMK_SOURCE</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" />.</para>
</listitem>
<listitem>
<para><envar>TVARNAME</envar>: [default: TEMPG]</para>

<para>Name of the temperature variable to read from the meteorology input data.</para>
</listitem>
<listitem>
<para><envar>UNIFORM_STIME</envar>: [default: N]</para>

<para>Logical value to specify whether all sources start a day on the same hour or use time zones to determine the start of a day.</para>

<itemizedlist>
<listitem>
<para>Y: Start all sources on same hour</para>
</listitem>
<listitem>
<para>N: Use time zones to determine start of day</para>
</listitem>
</itemizedlist>

</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><filename><envar>${GROUP_TYPE}</envar>.{date}.ncf</filename></entry>
<entry>I/O API netCDF</entry>
<entry>Sets of files containing 24-hour temperature profiles</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Premobl</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

<section>

<title>Earlier Versions</title>

<para>The SMOKE prototype had a similar program called Prediur. In previous versions of SMOKE, <command>Premobl</command> determined minimum and maximum temperature combinations by source and day.</para>

</section>

</section>

<section id="sect_programs_rawbio">

<title><command>Rawbio</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> biogenic</para>

<para><command>Rawbio</command> reads the county-level biomass/land use or gridded land use, the emissions factors (winter or summer table), and (optionally) gridding surrogate factors, and produces gridded normalized biogenic emissions. <command>Rawbio</command> is the first program in the SMOKE-BEIS2 model, while <command>Normbeis3</command> is the corresponding program in SMOKE-BEIS3. When the land use data is available only at the county level, the surrogate factors are used to produce gridded land use data. You can assign a surrogate code to be used for each of the following land coverage categories, using environment variables:</para>

<itemizedlist>
<listitem>
<para>pine forest</para>
</listitem>
<listitem>
<para>deciduous forest</para>
</listitem>
<listitem>
<para>(other) coniferous forest</para>
</listitem>
<listitem>
<para>all (other) forest</para>
</listitem>
<listitem>
<para>agriculture</para>
</listitem>
<listitem>
<para>grasslands</para>
</listitem>
<listitem>
<para>wetlands</para>
</listitem>
<listitem>
<para>other land uses</para>
</listitem>
<listitem>
<para>LAI</para>
</listitem>
</itemizedlist>

<para>The default surrogate code for all of these land coverage categories is 60, which is the EPA Models-3 area surrogate code. If surrogate data exist for these specific land coverage categories, better results may be achieved by careful choice of surrogate mapping.</para>

<para>Gridded land use can be created using GIS software (such as ArcInfo) by someone with expertise in generating gridding surrogates. The <command>Beld3to2</command> utility can create gridded land use from BELD3 data (see <xref linkend="sect_utilities_beld3to2" />). <remark>Another tool that can be used to generate gridded land use data is the SMOKE Tool in Models-3 (see the Models-3 documentation).</remark></para>

</section>

<section>

<title>Processing Order</title>

<para><command>Rawbio</command> is the first program for processing biogenic emissions.</para>

<para><command>Rawbio</command> must be run before <command>Tmpbio</command>.</para>

<para>The <command>Beld3to2</command> utility program can be executed to produce gridded land use for input into <command>Rawbio</command>.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_rawbio">
<title><command>Rawbio</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/rawbio_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/rawbio_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_rawbio" /> shows the input and output files for the <command>Rawbio</command> program. The input files include the emission factors file for summer or winter (<envar>BFAC</envar>), the grid description file (<envar>GRIDDESC</envar>), the gridded land use data (<envar>BGUSE</envar>) or the county land use data (<envar>BCUSE</envar>), and the surrogates (<envar>BGPRO</envar>) if county land use data are to be processed. The program outputs a gridded, normalized biogenic emissions file for either summer or winter (<envar>BGRD</envar> or <envar>BGRDW</envar>).</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>BFAC</envar></entry>
<entry>ASCII</entry>
<entry>Summer or winter emission factors file</entry>
</row>
<row>
<entry><envar>GRIDDESC</envar></entry>
<entry>ASCII</entry>
<entry>Description of the modeling grid</entry>
</row>
<row>
<entry><envar>BGUSE</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Gridded land use data</entry>
</row>
<row>
<entry><envar>BCUSE</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>County land use data</entry>
</row>
<row>
<entry><envar>BGPRO</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Gridding surrogates data</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section>

<title>Input Environment Variables</title>

<itemizedlist>
<listitem>
<para><envar>AGRI_SURG</envar>: [default: 60]</para>

<para>Surrogate code to use for agriculture allocation.</para>
</listitem>
<listitem>
<para><envar>ALLFOR_SURG</envar>: [default: 60]</para>

<para>Surrogate code to use for all (other) forest allocation.</para>
</listitem>
<listitem>
<para><envar>CONF_SURG</envar>: [default: 60]</para>

<para>Surrogate code to use for (other) coniferous forest allocation.</para>
</listitem>
<listitem>
<para><envar>DECD_SURG</envar>: [default: 60]</para>

<para>Surrogate code to use for deciduous forest allocation.</para>
</listitem>
<listitem>
<para><envar>GLUSE_YN</envar>: [default: N]</para>

<para>Indicates whether to use gridded land use data.</para>

<itemizedlist>
<listitem>
<para>Y: Use gridded land use data</para>
</listitem>
<listitem>
<para>N: Use county-total land use data and gridding surrogates</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>GRASS_SURG</envar>: [default: 60]</para>

<para>Surrogate code to use for grasslands allocation.</para>
</listitem>
<listitem>
<para><envar>LAI_SURG</envar>: [default: 60]</para>

<para>Surrogate code to use for LAI allocation.</para>
</listitem>
<listitem>
<para><envar>OTHER_SURG</envar>: [default: 60]</para>

<para>Surrogate code to use for other land uses allocation.</para>
</listitem>
<listitem>
<para><envar>PINE_SURG</envar>: [default: 60]</para>

<para>Surrogate code to use for pine forest allocation.</para>
</listitem>
<listitem>
<para><envar>WETL_SURG</envar>: [default: 60]</para>

<para>Surrogate code to use for wetlands allocation.</para>
</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>BGRD</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Gridded, normalized biogenic emissions from summer emission factors</entry>
</row>
<row>
<entry><envar>BGRDW</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Gridded, normalized biogenic emissions from winter emission factors</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Rawbio</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

<section>

<title>Earlier Versions</title>

<para>The SMOKE prototype version of <command>Rawbio</command> included an additional input file (<envar>BFIP</envar>) that contained a list of counties to use from the <envar>BCUSE</envar> file. Newer versions automatically create this list internally using the FIPS codes contained in the surrogates file <envar>BGPRO</envar>. A <envar>BGUSE</envar> input file can now be created using the utility program <command>Beld3to2</command> (see <xref linkend="sect_utilities_beld3to2" />).</para>

</section>

</section>

<section id="sect_programs_smkinven">

<title><command>Smkinven</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> area, mobile, point</para>

<para><command>Smkinven</command> reads in the raw input data, sorts the records, and creates the SMOKE inventory files that are required by most of the SMOKE programs. The program is run separately for area-, mobile-, and point-source processing. <command>Smkinven</command> reads annual, average-day, day-specific, and hour-specific inventory files. The annual and average-day inventory data are combined into a single inventory. The output also indicates whether the data started out as annual or average-day data; such "temporal origin" information is needed by the <command>Temporal</command> program to determine whether to apply monthly adjustments. <command>Smkinven</command> can also import gridded one-layer annual or average-day emissions in I/O API netCDF format.</para>

<para><command>Smkinven</command> writes several SMOKE inventory files for each source category: an ASCII file containing all character-string fields from the inventory, individual I/O API netCDF files containing emissions data for each output pollutant, and an ASCII map file listing the names and locations of each file. The character string fields cannot be stored in the I/O API netCDF file because of limitations of the I/O API library. When day-specific and hour-specific data are available (this applies only for point sources), <command>Smkinven</command> can also read these data, and produce separate I/O API netCDF files for each data type (day-specific or hour-specific).</para>

<para><command>Smkinven</command> supports the following input file formats and source categories:</para>

<itemizedlist>
<listitem>
<para>IDA for area, mobile, point</para>
</listitem>
<listitem>
<para>IDA mobile extended (modified to support VMT and pollutants)</para>
</listitem>
<listitem>
<para>SMOKE one-record-per-line (ORL) format for nonpoint, nonroad mobile, on-road mobile, and point sources</para>
</listitem>
<listitem>
<para>EMS-95 area, mobile nonlink (column-specific and list-directed), point</para>
</listitem>
<listitem>
<para>Special mobile link format</para>
</listitem>
<listitem>
<para>EMS-95 hour-specific point (can also be used to match with IDA inventories)</para>
</listitem>
<listitem>
<para>EMS-95 day-specific (modified hour-specific format) point (can also be used to match with IDA inventories)</para>
</listitem>
<listitem>
<para>ASCII Continuous Emissions Monitoring (CEM) format (hour-specific point-source emissions); must be used with IDA inventory files for annual or seasonal inventory data.</para>
</listitem>
<listitem>
<para>List format (for combining multiple files of the same or compatible formats) for area, mobile, and point</para>
</listitem>
<listitem>
<para>Gridded one-layer annual or average-day netCDF I/O API emissions data (must be treated as an area source)</para>
</listitem>
</itemizedlist>

<para>It is not possible to import only day- or hour-specific data from EMS-95 input files. If only such data are to be used, mock annual files must be created; see <xref linkend="sect_input_ptday" /> and <xref linkend="sect_input_pthour" /> for more information on the required formats.</para>

<para>The list format is simply a list of file names with paths with a special format identifier that allows all files in the list to be processed together. To use a list format, all input files must have the same or compatible formats.</para>

<para><remark>When using CEM data, the default CEM files provided with SMOKE are for the whole U.S. and a whole year. Because this file takes a long time to read in, you are encouraged to preprocess these data to pare them down to the dates and/or sources in the domain. However, SMOKE can do this if you do not. The dates can be extracted with the DATERANGE header in the <envar>PTHOUR</envar> file (see <envar>PTHOUR</envar> file documentation).</remark> The sources in the grid will be selected based on matching to the inventory (if the inventory is for only states within the modeling grid) and/or by the <command>Grdmat</command> program, which will remove sources outside the grid from the model-ready results.</para>

<para>If new sources are added to the input files or sources are removed, <command>Smkinven</command> must be rerun for that type of source. However, <command>Smkinven</command> does not need to be rerun when processing additional control scenarios, growth projections, speciation profiles, or modeling grids.</para>

<para>By default, <command>Smkinven</command> will fill in missing average-day data with annual data when possible. To fill in missing annual data with average-day data, use the <envar>FILL_ANNUAL</envar> setting.</para>

<comment>list default stack parameters and give details about how the filling in is done - this is described in chapter 2 sect_concepts_check_stack_params</comment>

</section>

<section>

<title>Processing Order</title>

<para><command>Smkinven</command> must be run for a given processing type (i.e., area, mobile, point) before any other SMOKE programs for that processing type can be run.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_smkinven_area">
<title><command>Smkinven</command> input and output files for area sources</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/smkinven_area_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/smkinven_area_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_smkinven_area" /> shows the input and output files for <command>Smkinven</command> for area sources. The input files include either the raw inventory file (<envar>ARINV</envar>) or a gridded annual or average-day input file (<envar>AG</envar>), the inventory data table (<envar>INVTABLE</envar>), the country, state, and county codes file (<envar>COSTCY</envar>), the optional area-to-point cross-reference file (<envar>ARTOPNT</envar>), and the optional NONHAP exclude file (<envar>NHAPEXCLUDE</envar>). The program outputs an annual and average-day inventory emissions file (<envar>AREA</envar>), a file listing the inventory SCCs (<envar>ASCC</envar>), and an optional report containing various information about the processed inventory (<envar>REPINVEN</envar>) for NTI-formatted inventory or for area-to-point sources.</para>

<figure id="fig_programs_smkinven_mobile">
<title><command>Smkinven</command> input and output files for mobile sources</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/smkinven_mobile_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/smkinven_mobile_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_smkinven_mobile" /> shows the input and output files for <command>Smkinven</command> for mobile sources. The input files include the mobile codes file (<envar>MCODES</envar>), the raw inventory file (<envar>MBINV</envar>), the country, state and county codes file (<envar>COSTCY</envar>), the inventory data table (<envar>INVTABLE</envar>), the optional NONHAP exclude file (<envar>NHAPEXCLUDE</envar>), and an optional <envar>VMTMIX</envar> file. The program outputs an annual and average-day inventory emissions file (<envar>MOBL</envar>), a file listing the inventory SCCs (<envar>MSCC</envar>), and an optional report containing various information about the processed inventory (<envar>REPINVEN</envar>) for NTI-formatted inputs only.</para>

<figure id="fig_programs_smkinven_point">
<title><command>Smkinven</command> input and output files for point sources</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/smkinven_point_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/smkinven_point_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_smkinven_point" /> shows the input and output files for <command>Smkinven</command> for point sources. The input files include either the raw inventory file (<envar>PTINV</envar>) <remark>or a gridded annual or average-day inventory file (<envar>PNTS</envar>), previously created by <command>Smkinven</command>, in place of the raw inventory file</remark>; the inventory data table (<envar>INVTABLE</envar>); the country, state and county codes file (<envar>COSTCY</envar>); the replacement stack parameters file (<envar>PSTK</envar>); the optional day-specific raw inventory file (<envar>PTDAY</envar>); the optional hour-specific raw inventory file (<envar>PTHOUR</envar>); and for CEM-formatted data, the ORIS facility description file (<envar>ORISDESC</envar>) and the SCC description file (<envar>SCCDESC</envar>). The program outputs an annual and average-day inventory emissions file (<envar>PNTS</envar>); a file listing the inventory SCCs (<envar>PSCC</envar>); an optional day-specific inventory file (<envar>PDAY</envar>); an optional hour-specific inventory file (<envar>PHOUR</envar>); for EMS-95 formatted inputs, an optional temporal profile file (<envar>PTREF_ALT</envar>); and for CEM-formatted inputs, an optional report containing various information about the processed inventory (<envar>REPINVEN</envar>).</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="4">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Source Type</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[AR|MB|PT]INV</envar></entry>
<entry>ASCII</entry>
<entry>A, M, P</entry>
<entry>Annual and average-day emissions and source characteristics raw inventory data</entry>
</row>
<row>
<entry><envar>COSTCY</envar></entry>
<entry>ASCII</entry>
<entry>A, M, P</entry>
<entry>Country, state, and county codes file, with time zones</entry>
</row>
<row>
<entry><envar>INVTABLE</envar></entry>
<entry>ASCII</entry>
<entry>A, M, P</entry>
<entry>Inventory data table listing pollutant and activity names</entry>
</row>
<row>
<entry><envar>NHAPEXCLUDE</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>A, M, P</entry>
<entry>List of counties and SCCs to exclude from toxics integration</entry>
</row>
<row>
<entry><envar>AG</envar> (optional)</entry>
<entry>I/O API netCDF</entry>
<entry>A</entry>
<entry>Gridded annual or average-day data; this file can be created by <command>Smkmerge</command> and must be time-independent</entry>
</row>
<row>
<entry><envar>ARTOPNT</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>A</entry>
<entry>Area-to-point cross-reference file for assigning X and Y locations to area sources</entry>
</row>
<row>
<entry><envar>MCODES</envar></entry>
<entry>ASCII</entry>
<entry>M</entry>
<entry>Mobile codes for converting road class to road type and vehicle type name to vehicle type number</entry>
</row>
<row>
<entry><envar>VMTMIX</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>M</entry>
<entry>Assigns fractions of VMT to individual vehicle types; used when importing EMS-95 mobile data</entry>
</row>
<row>
<entry><envar>ORISDESC</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>P</entry>
<entry>ORIS facility descriptions, needed for getting ORIS facility names for reporting purposes when CEM hour-specific data are read</entry>
</row>
<row>
<entry><envar>PTDAY</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>P</entry>
<entry>Day-specific raw inventory data</entry>
</row>
<row>
<entry><envar>PTHOUR</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>P</entry>
<entry>Hour-specific raw inventory data</entry>
</row>
<row>
<entry><envar>PSTK</envar></entry>
<entry>ASCII</entry>
<entry>P</entry>
<entry>Replacement stack parameters file</entry>
</row>
<row>
<entry><envar>SCCDESC</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>P</entry>
<entry>SCC descriptions, needed for reading CEM hour-specific data only, to select electric generator facilities in the inventory</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section id="sect_programs_smkinven_envar">

<title>Input Environment Variables</title>

<itemizedlist>
<listitem>
<para><envar>DAY_SPECIFIC_YN</envar>: [default: N]</para>

<para>Defines whether to import day-specific inventory data.</para>

<itemizedlist>
<listitem>
<para>Y: Import day-specific data</para>
</listitem>
<listitem>
<para>N: Do not import day-specific data</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>FILL_ANNUAL</envar>: [default N]</para>

<para>Allows annual data to be filled in with average-day data.</para>

<itemizedlist>
<listitem>
<para>Y: Use "Y" when annual emission numbers are blank for some records of the inventory but not all records. The emissions values will be filled in using the average-day emissions field, by multiplying the average-day number by the number of days in the inventory year (365 or 366). This option is useful when some sources have only annual data and some sources have only average-day data. Although the annual number will be filled in using the average-day one, the average-day emissions will be output from SMOKE as a whole. Note that <envar>SMK_AVEDAY_YN</envar> should be set to N in other SMOKE programs when this option has been selected.</para>
</listitem>
<listitem>
<para>N: Do not fill in annual data based on average-day emissions values.</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>HOUR_SPECIFIC_YN</envar>: [default: N]</para>

<para>Defines whether to import hour-specific inventory data.</para>

<itemizedlist>
<listitem>
<para>Y: Import hour-specific data</para>
</listitem>
<listitem>
<para>N: Do not import hour-specific data</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>HOURLY_TO_DAILY</envar>: [default: N]</para>

<para>Defines whether to treat the hour-specific inputs as day-specific data.</para>

<itemizedlist>
<listitem>
<para>Y: Use daily-total column only from hour-specific input file, and process as day-specific data. <emphasis>This setting does not work for input of hour-specific data using CEM format.</emphasis></para>
</listitem>
<listitem>
<para>N: Treat hourly file as hourly data</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>HOURLY_TO_PROFILE</envar>: [default: N]</para>

<para>Defines whether to treat the hour-specific inputs as hour-specific temporal profiles.</para>

<itemizedlist>
<listitem>
<para>Y: Treat hourly data as temporal profile, and divide each hourly value by value in the daily total column of the file. The values are not renormalized. The resulting hour-specific output file will be recognized by the <command>Temporal</command> program as containing hourly profiles. <emphasis>This setting does not work for input of hour-specific data using CEM format.</emphasis></para>
</listitem>
<listitem>
<para>N: Treat hourly file as hourly data</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>IMPORT_AVEINV_YN</envar>: [default: Y]</para>

<para>Defines whether to import the annual and average-day inventory data. This is set to N to import day-specific or hour-specific data after <command>Smkinven</command> has previously been run for the annual and average-day data.</para>

<itemizedlist>
<listitem>
<para>Y: Import annual and average-day inventory data from <envar>PTINV</envar> file</para>
</listitem>
<listitem>
<para>N: Use SMOKE inventory files from a previous run of <command>Smkinven</command> to get the SMOKE source characteristics to match with the day-specific and hour-specific sources</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>IMPORT_GRDIOAPI_YN</envar>: [default: N]</para>

<para>Defines whether the program will import a gridded I/O API netCDF inventory file. This setting can be used only with area-source processing, and it overrides all other program settings for importing data (e.g., day- and hour-specific data import will be shut off).</para>

<itemizedlist>
<listitem>
<para>Y: Import gridded I/O API data</para>
</listitem>
<listitem>
<para>N: Do not import gridded I/O API data</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>IMPORT_VMTMIX_YN</envar>: [default: N]</para>

<para>Indicates whether VMT mix data should be imported.</para>

<itemizedlist>
<listitem>
<para>Y: Import <envar>VMTMIX</envar> file; required if using EMS-95 mobile format</para>
</listitem>
<listitem>
<para>N: Do not import VMT mix data</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>RAW_DUP_CHECK</envar>: [default: N]</para>

<para>Defines whether the program checks for duplicate records in the input file.</para>

<itemizedlist>
<listitem>
<para>Y: Check for duplicates, and produce a fatal error if found</para>
</listitem>
<listitem>
<para>N: Do not check for duplicates, and add emissions from duplicate records</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>SMK_ARTOPNT_YN</envar>: [default: N]</para>

<itemizedlist>
<listitem>
<para>Y: Assign X and Y coordinates to specified sources based on the <envar>ARTOPNT</envar> cross-reference file</para>
</listitem>
<listitem>
<para>N: Do not perform area-to-point processing</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>SMK_BASEYR_OVERRIDE</envar>: [default: 0]</para>

<para>Used to override the base year determined by the inventory.</para>
</listitem>
<listitem>
<para><envar>SMK_DEFAULT_TZONE</envar>: [default: 5]</para>

<para>Defines the default time zone to use for sources that do not match entries in the <envar>COSTCY</envar> file.</para>
</listitem>
<listitem>
<para><envar>SMK_EMS95_FIXFMT</envar>: [default: N]</para>

<para>Indicates whether mobile EMS-95 inventory is fixed format (column-specific) or free format (delimited list).</para>

<itemizedlist>
<listitem>
<para>Y: Mobile EMS-95 inventory is fixed format</para>
</listitem>
<listitem>
<para>N: Mobile EMS-95 inventory is free format</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>SMK_MAXERROR</envar>: [default: 100]</para>

<para>Defines the maximum number of ERROR statements to be displayed by SMOKE.</para>
</listitem>
<listitem>
<para><envar>SMK_MAXWARNING</envar>: [default: 100]</para>

<para>Defines the maximum number of WARNING statements to be displayed by SMOKE.</para>
</listitem>
<listitem>
<para><envar>SMK_NHAPEXCLUDE_YN</envar>: [default: N]</para>

<itemizedlist>
<listitem>
<para>Y: Read <envar>NHAPEXCLUDE</envar> cross-reference file and do not integrate the specified sources</para>
</listitem>
<listitem>
<para>N: Integrate all sources if a toxics inventory has been read</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>SMK_SOURCE</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" /></para>
</listitem>
<listitem>
<para><envar>SMK_TMPDIR</envar>: [default: <filename class="directory">.</filename>]</para>

<para>Sets the path for writing temporary files needed when importing the inventory.</para>
</listitem>
<listitem>
<para><envar>SMKINVEN_FORMULA</envar>: [default: blank]</para>

<para>Allows you to specify a formula for computing one pollutant value from the values of other pollutants. For example, if the formula is set to "PMC=PM10-PM25", then <command>Smkinven</command> will compute a new variable, PMC, as the difference between PM<subscript>10</subscript> and PM<subscript>2.5</subscript>. The pollutant units are taken from the first variable in the formula. The variables used as input in the formula will still be output to the SMOKE inventory file. If the formula is not set, no additional variables will be written to the SMOKE inventory file.</para>
</listitem>
<listitem>
<para><envar>VELOC_RECALC</envar>: [default: N]</para>

<para>Defines whether stack velocity is recalculated in order to make the velocity consistent with the reported flow and diameter.</para>

<itemizedlist>
<listitem>
<para>Y: Recalculate stack velocity</para>
</listitem>
<listitem>
<para>N: Output the input stack velocity </para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>WEST_HSPHERE</envar>: [default: Y]</para>

<para>Defines how spatial coordinates are interpreted.</para>

<itemizedlist>
<listitem>
<para>Y: Convert longitudinal coordinates for the Western Hemisphere (positive values are converted to negative values)</para>
</listitem>
<listitem>
<para>N: Do not convert longitude values (positive values are not changed)</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>WKDAY_NORMALIZE</envar>: [default: Y for EMS-95 input format, N for all other formats]</para>

<para>Clarifies the nature of the "average-day" data read in by <command>Smkinven</command> and will impact the <command>Temporal</command> program processing of EMS-95 formatted data of type "AD" and average-day data for all other formats.</para>

<itemizedlist>
<listitem>
<para>Y: Average-day emissions input to <command>Smkinven</command> are based on weekday emissions only. In <command>Temporal</command>, these emissions will be adjusted with weekly profiles normalized with weekdays only (Monday through Friday)</para>
</listitem>
<listitem>
<para>N: Average-day emissions input to <command>Smkinven</command> are based on <emphasis>all days of the week</emphasis>. In <command>Temporal</command>, these emissions will be adjusted with weekly profiles normalized with all days of the week.</para>
</listitem>
</itemizedlist>

</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[AREA|MOBL|PNTS]</envar></entry>
<entry>SMOKE map</entry>
<entry>Annual and average-day inventory emissions and source characteristics</entry>
</row>
<row>
<entry><envar>[ASCC|MSCC|PSCC]</envar></entry>
<entry>ASCII</entry>
<entry>List of SCCs appearing in the raw inventory file</entry>
</row>
<row>
<entry><envar>PDAY</envar> (optional)</entry>
<entry>I/O API netCDF</entry>
<entry>Day-specific inventory emissions assigned to sources in annual/average-day files</entry>
</row>
<row>
<entry><envar>PHOUR</envar> (optional)</entry>
<entry>I/O API netCDF</entry>
<entry>Hour-specific inventory emissions assigned to sources in annual/average day files</entry>
</row>
<row>
<entry><envar>PTREF_ALT</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Temporal profile identification codes per source; available when EMS-95-formatted point-source data are input</entry>
</row>
<row>
<entry><envar>REPINVEN</envar> (optional)</entry>
<entry>ASCII</entry>
<entry><para>Inventory report file; contents depend on the inventory being processed, but can include:</para>

<para>CEM section:</para>

<itemizedlist>
<listitem>ORIS IDs from the CEM matched to the inventory</listitem>
<listitem>ORIS IDs from the CEM not matched to the inventory</listitem>
<listitem>Power-generating inventory sources not matched to the CEM</listitem>
</itemizedlist>

<para>Toxics section:</para>

<itemizedlist>
<listitem>Total emissions and number of inventory records by CAS number</listitem>
<listitem>Total emissions before and after aggregation by CAS number</listitem>
</itemizedlist>

<para>Area-to-point section:</para>

<itemizedlist>
<listitem>>SCCs in the <envar>ARTOPNT</envar> file but not in the inventory</listitem>
<listitem>Total emissions before and after area-to-point processing by pollutant, state, and SCC</listitem>
</itemizedlist>
</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Smkinven</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

<section>

<title>Earlier Versions</title>

<para>The SMOKE prototype used separate programs for each type of source and input file format. These programs included RAWAREA, RAWMOBIL, and RAWPOINT for EPS-formatted files, and EMSAREA and EMSPOINT for EMS-95-formatted files.</para>

<para>The SMOKE prototype stored VMT in the <envar>MOBL</envar> output file; SMOKE 1.0 stored either VMT or emission estimates, if available.</para>

<para>Previous versions of SMOKE did not support hour-specific, day-specific, or gridded data import.</para>

<para>Processing of toxic pollutants was added in versions 1.5 and 2.0, and required extensive changes to <command>Smkinven</command>, including a different intermediate inventory format. Previous versions of SMOKE used an intermediate inventory format consisting of one ASCII file and one I/O API file. Support for EPS 2.0 formatted inventories was dropped in SMOKE v1.5.</para>

</section>

</section>

<section id="sect_programs_smkmerge">

<title><command>Smkmerge</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> area, biogenic, mobile, point</para>

<para>The <command>Smkmerge</command> program combines the matrices produced by the other SMOKE programs to produce the emissions files for input to the AQM. The <command>Smkmerge</command> program may be run on any combination of source types and may incorporate temporal, speciation, projection, and spatial processing.</para>

<para>If <command>Smkmerge</command> is run to produce the input files to the AQM, all the other SMOKE programs must already have been run. However, you can also run <command>Smkmerge</command> to produce specialized reports. In that instance, only the required subset of SMOKE programs must have been run prior to <command>Smkmerge</command>.</para>

<para><command>Smkmerge</command> can be used to create 2-D or 3-D gridded, hourly, speciated files. It also outputs the hourly emissions file for PinG sources needed by CMAQ and MAQSIP. Finally, it outputs an ASCII elevated point sources file, suitable for postprocessing with the PTSRCE program of EPS2.0/EPS2.5. If PinG sources have been selected and an ASCII elevated sources file is output, then SMOKE will set the stack diameters to negative values for the PinG sources.</para>

<section>

<title>By-day processing</title>

<para><command>Smkmerge</command> can use a by-day processing approach, to read in one-day hourly files for each day of the week. When the <envar>MRG_BYDAY</envar> environment variable is set to A, M, P, or any combination of those letters, <command>Smkmerge</command> reads a different logical file name for each day of the week for the hourly emission input files for the indicated sources.</para>

<para>For example, if the <envar>MRG_SOURCE</envar> environment variable is set to AMBP, <command>Smkmerge</command> will expect the following hourly input files: <envar>ATMP</envar>, <envar>BGTS_[S|L]</envar>, <envar>MTMP</envar>, and <envar>PTMP</envar>, for area, biogenic, mobile, and point source types respectively. If, in addition, <envar>MRG_BYDAY</envar> is set to “A”, then the hourly input files expected by <command>Smkmerge</command> for area sources would be the <envar>ATMP_{day}</envar> files. The files for the other source types would remain the same.</para>

<para>The <envar>MRG_BYDAY</envar> option is useful for implementing a Monday-weekday-Saturday-Sunday (MWSS) approach to save processing time for long episodes. This approach is applicable when weekly temporal profiles used by an inventory do not have variation between the five weekdays. In the MWSS approach, Monday is processed separately, because time zone differences across a large domain cause some Sunday emissions for some time zones to be in the Monday file. Additional environment variables other than the defaults in the Assigns file need to be set when this option is applied. <command>Smkmerge</command> will prompt for a different file for each day of the week, but the logical file names for Tuesday through Friday can be defined as the same file when implementing the MWSS approach.</para>

</section>

</section>

<section>

<title>Processing Order</title>

<para>All other SMOKE core programs except the optional program <command>Mrggrid</command> prepare input for the <command>Smkmerge</command> program. <command>Smkmerge</command> is the last nonoptional SMOKE program to be run.</para>

<para>Individual output files from <command>Smkmerge</command> can be merged using <command>Mrggrid</command> if desired.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_smkmerge_area">
<title><command>Smkmerge</command> input and output files for area sources</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/smkmerge_area_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/smkmerge_area_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_smkmerge_area" /> shows the input and output files for the <command>Smkmerge</command> program for area sources. The inputs include the inventory file output form <command>Smkinven</command> (<envar>AREA</envar>), the gridding matrix from <command>Grdmat</command> (<envar>AGMAT</envar>), the optional speciation matrix from <command>Spcmat</command> (<envar>ASMAT_L</envar> or <envar>ASMAT_S</envar>), the optional multiplicative control matrix from <command>Cntlmat</command> (<envar>ACMAT</envar>), the optional reactivity matrix from <command>Cntlmat</command> (<envar>ARMAT</envar>), the optional hourly emissions from <command>Temporal</command> (<envar>ATMP</envar>) or hourly emissions for each day of the week (<envar>ATMP_{day}</envar>), the inventory data table (<envar>INVTABLE</envar>), the country, state, and county codes file (<envar>COSTCY</envar>), and the grid description file (<envar>GRIDDESC</envar>). The program outputs a data file that is determined by the inputs and can be a model-ready emissions file (<envar>AG[T][S]_L</envar> or <envar>AG[T][S]_S</envar>) and a report file (<envar>REPAG[T][S]_L</envar> or <envar>REPAG[T][S]_S</envar>).</para>

<figure id="fig_programs_smkmerge_biogenic">
<title><command>Smkmerge</command> input and output files for biogenic sources</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/smkmerge_biogenic_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/smkmerge_biogenic_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_smkmerge_biogenic" /> shows the input and output files for the <command>Smkmerge</command> program for biogenic sources. The inputs include the model-ready emissions file (<envar>BGTS_L</envar> or <envar>BGTS_S</envar>), the optional surrogates file (<envar>BGPRO</envar>), the country, state, and county file (<envar>COSTCY</envar>), and the grid description file (<envar>GRIDDESC</envar>). The program outputs a data file that is determined by the inputs and can be a model-ready emissions file (<envar>BGTS_L_O</envar> or <envar>BGTS_S_O</envar>) and a report file (<envar>REPBGTS_L</envar> or <envar>REPBGTS_S</envar>). Note that _O is appended to the output file name to distinguish it from the input file.</para>

<figure id="fig_programs_smkmerge_mobile">
<title><command>Smkmerge</command> input and output files for mobile sources</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/smkmerge_mobile_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/smkmerge_mobile_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_smkmerge_mobile" /> shows the input and output files for the <command>Smkmerge</command> program for mobile sources. The inputs include the inventory file output from <command>Smkinven</command> (<envar>MOBL</envar>), the gridding matrix from <command>Grdmat</command> (<envar>MGMAT</envar>), the optional speciation matrix from <command>Spcmat</command> (<envar>MSMAT_L</envar> or <envar>MSMAT_S</envar>), the optional multiplicative control matrix from <command>Cntlmat</command> (<envar>MCMAT</envar>), the optional reactivity matrix from <command>Cntlmat</command> (<envar>MRMAT</envar>), the optional hourly emissions from <command>Temporal</command> (<envar>MTMP</envar>) or hourly emissions for each day of the week (<envar>MTMP_{day}</envar>), the inventory data table (<envar>INVTABLE</envar>), the country, state and county codes file (<envar>COSTCY</envar>), and the grid description file (<envar>GRIDDESC</envar>). The program outputs a data file that is determined by the inputs and can be a model-ready emissions file (<envar>MG[T][S]_L</envar> or <envar>MG[T][S]_S</envar>) and a report file (<envar>REPMG[T][S]_L</envar> or <envar>REPMG[T][S]_S</envar>).</para>

<figure id="fig_programs_smkmerge_point">
<title><command>Smkmerge</command> input and output files for point sources</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/smkmerge_point_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/smkmerge_point_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_smkmerge_point" /> shows the input and output files for the <command>Smkmerge</command> program for point sources. The inputs include the inventory file output from <command>Smkinven</command> (<envar>PNTS</envar>), the gridding matrix from <command>Grdmat</command> (<envar>PGMAT</envar>), the optional speciation matrix from <command>Spcmat</command> (<envar>PSMAT_L</envar> or <envar>PSMAT_S</envar>), the optional point sources layer file from <command>Laypoint</command> (<envar>PLAY</envar> or <envar>PLAY_EX</envar>), the optional multiplicative control matrix from <command>Cntlmat</command> (<envar>PCMAT</envar>), the optional reactivity matrix from <command>Cntlmat</command> (<envar>PRMAT</envar>), the optional hourly emissions from <command>Temporal</command> (<envar>PTMP</envar>) or hourly emissions for each day of the week (<envar>PTMP_{day}</envar>), the optional elevated sources file (<envar>PELV</envar>), the optional elevated stack groups file (<envar>STACK_GROUPS</envar>), the inventory data table (<envar>INVTABLE</envar>), the country, state, and county codes file (<envar>COSTCY</envar>), and the grid description file (<envar>GRIDDESC</envar>). The program outputs data files determined by the inputs and can be include a model-ready emissions file (<envar>PG[T][S][3D]_L</envar> or <envar>PG[T][S][3D]_S</envar>), a PinG file (<envar>PING[T][S][_S][_L]</envar>, an elevated sources file (<envar>ELEV[T]S[_S|_L]</envar>), and a report file (<envar>REPPG[T][S]_L</envar> or <envar>REPPG[T][S]_S</envar>).</para>

<figure id="fig_programs_smkmerge_all">
<title><command>Smkmerge</command> input and output files for all source categories</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/smkmerge_all_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/smkmerge_all_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_smkmerge_all" /> shows the input and output files for the <command>Smkmerge</command> program for all sources. The input and output files are a combination of those found in the previous four figures.</para>

<section>

<title>Input Files</title>

<para>The input files needed depend upon the input environment variables that are set for this program. For example, if only area sources are being merged, then only area-source-related inputs are required. Similarly, if <command>Smkmerge</command> is being executed to produce speciated, gridded, temporally allocated area and point sources, then all area- and point-related inputs for area and point sources, speciation matrices, gridding matrices, and temporal matrices are required.</para>

<informaltable>
<tgroup cols="4">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Source Type</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>AREA</envar></entry>
<entry>SMOKE map</entry>
<entry>A</entry>
<entry>Intermediate area-source inventory created by <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>MOBL</envar></entry>
<entry>SMOKE map</entry>
<entry>M</entry>
<entry>Intermediate mobile-source inventory created by <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>PNTS</envar></entry>
<entry>SMOKE map</entry>
<entry>P</entry>
<entry>Intermediate point-source inventory created by <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>BGTS_[S|L]</envar></entry>
<entry>I/O API netCDF</entry>
<entry>B</entry>
<entry>Biogenic model-ready emissions, to be input only when merging with other source categories, or when computing biogenic state and county totals, produced by <command>Tmpbio</command> or <command>Tmpbeis3</command></entry>
</row>
<row>
<entry><envar>[A|M|P]GMAT</envar></entry>
<entry>I/O API netCDF</entry>
<entry>A, M, P</entry>
<entry>Gridding matrix from <command>Grdmat</command></entry>
</row>
<row>
<entry><envar>[A|M|P]SMAT_[S|L]</envar> (optional)</entry>
<entry>I/O API netCDF</entry>
<entry>A, M, P</entry>
<entry>Mass- or mole-based speciation matrix from <command>Spcmat</command> (used when <envar>MRG_SPCMAT_YN</envar> = Y)</entry>
</row>
<row>
<entry><envar>BGPRO</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>B</entry>
<entry>Gridding surrogates for computing biogenic state and county totals from gridded biogenic inputs</entry>
</row>
<row>
<entry><envar>PLAY</envar> (optional)</entry>
<entry>I/O API netCDF</entry>
<entry>P</entry>
<entry>Hourly plume rise layer fractions, output by <command>Laypoint</command> (used when <envar>MRG_LAYERS_YN</envar> = Y and <envar>EXPLICIT_PLUMES_YN</envar> = N)</entry>
</row>
<row>
<entry><envar>PLAY_EX</envar> (optional)</entry>
<entry>I/O API netCDF</entry>
<entry>P</entry>
<entry>Hourly plume rise layer fractions for explicit sources, output by <command>Laypoint</command> (used when <envar>MRG_LAYERS_YN</envar> = Y and <envar>EXPLICIT_PLUMES_YN</envar> = Y)</entry>
</row>
<row>
<entry><envar>[A|M|P]CMAT</envar> (optional)</entry>
<entry>I/O API netCDF</entry>
<entry>A, M, P</entry>
<entry>Multiplicative control matrix, output by <command>Cntlmat</command> (used when <envar>MRG_CTLMAT_MULT</envar> is set)</entry>
</row>
<row>
<entry><envar>[A|M|P]RMAT</envar> (optional)</entry>
<entry>I/O API netCDF</entry>
<entry>A, M, P</entry>
<entry>Mass- or mole-based reactivity matrix, output by <command>Cntlmat</command> (used when <envar>MRG_CTLMAT_REAC</envar> is set)</entry>
</row>
<row>
<entry><envar>[A|M|P]TMP</envar> (optional)</entry>
<entry>I/O API netCDF</entry>
<entry>A, M, P</entry>
<entry>Hourly emissions from <command>Temporal</command> (used when <envar>MRG_TEMPORAL_YN</envar> = Y and <envar>MRG_BYDAY</envar> is not set)</entry>
</row>
<row>
<entry><envar>[A|M|P]TMP_{day}</envar> (optional)</entry>
<entry>I/O API netCDF</entry>
<entry>A, M, P</entry>
<entry>Hourly emissions from <command>Temporal</command> by day, where</entry>
</row>
{day} = MON, TUE, WED, THU, FRI, SAT, SUN (used when <envar>MRG_TEMPORAL_YN</envar> = Y and <envar>MRG_BYDAY</envar> is set)
<row>
<entry><envar>PELV</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>P</entry>
<entry>Elevated point sources identification file, output by <command>Elevpoint</command></entry>
</row>
<row>
<entry><envar>STACK_GROUPS</envar> (optional)</entry>
<entry>I/O API netCDF</entry>
<entry>P</entry>
<entry>Elevated sources stack parameters file, output by <command>Elevpoint</command></entry>
</row>
<row>
<entry><envar>INVTABLE</envar></entry>
<entry>ASCII</entry>
<entry>A, B, M, P</entry>
<entry>Inventory data table containing activity and pollutant names</entry>
</row>
<row>
<entry><envar>COSTCY</envar></entry>
<entry>ASCII</entry>
<entry>A, B, M, P</entry>
<entry>Country, state, and county file with time zones</entry>
</row>
<row>
<entry><envar>GRIDDESC</envar></entry>
<entry>ASCII</entry>
<entry>A, B, M, P</entry>
<entry>Description of the modeling grid</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section>

<title>Input Environment Variables</title>

<para>NOTE: At least one of the <envar>MRG_GRDOUT_YN</envar>, <envar>MRG_REPSTA_YN</envar>, or <envar>MRG_REPCNY_YN</envar> environment variables must be set to Y.</para>

<itemizedlist>
<listitem>
<para><envar>AREA_SURROGATE_NUM</envar>: [default: 60]</para>

<para>Surrogate code of the area surrogate in the <envar>BGPRO</envar> file, to use for totals of biogenic emissions by state and county.</para>
</listitem>
<listitem>
<para><envar>EXPLICIT_PLUMES_YN</envar>: [default: N]</para>

<para>Indicates whether only explicit plume rise sources should be merged.</para>

<itemizedlist>
<listitem>
<para>Y: Merge only explicit plume rise sources; uses <envar>PLAY_EX</envar> file</para>
</listitem>
<listitem>
<para>N: Merge all plume rise sources; uses <envar>PLAY</envar> file</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>MRG_BYDAY</envar>: [default: blank]</para>

<para>String code that specifies which source categories (if any) are to use a by-day approach for the hourly input files (see “Description” section above for more information on this approach). Valid settings include A, M, P, or any combination. For example, set this environment variable to “AMP” to have <command>Smkmerge</command> read the area-, mobile-, and point-source hourly emissions files individually for each day.</para>
</listitem>
<listitem>
<para><envar>MRG_CTLMAT_MULT</envar>: [default: blank]</para>

<para>String code that specifies which source categories (if any) are to be processed using a multiplicative control matrix. Valid settings include A, M, P, or any combination. For example, set this environment variable to “M” to have <command>Smkmerge</command> read the mobile-source multiplicative control matrix.</para>
</listitem>
<listitem>
<para><envar>MRG_CTLMAT_REAC</envar>: [default: blank]</para>

<para>String code that specifies which source categories (if any) are to be processed using a reactivity control matrix. Valid settings include A, M, P, or any combination. For example, set this environment variable to “MP” to have <command>Smkmerge</command> read the mobile- and point-source reactivity control matrices.</para>
</listitem>
<listitem>
<para><envar>MRG_GRDOUT_UNIT</envar>: [default: input file units]</para>

<para>String code that permits the user to change the units of the gridded output file. For example, “kg/hr” would convert the output emissions to kilograms per hour, before outputting the emissions data file. Not all conversions are known to SMOKE. Valid numerators are: “tons”, “kg”, “moles”, and “g”; note that molar emissions cannot be output without the mole-based speciation matrices. Valid denominators are “yr”, “dy”, “hr”, and “s”. Note that if annual output is requested but not available in the input file, leap year adjustments are not made.</para>

<para>Units required by CMAQ are moles/s and units needed for MAQSIP and most other air quality models are moles/hr.</para>
</listitem>
<listitem>
<para><envar>MRG_GRDOUT_YN</envar>: [default: N]</para>

<para>Defines whether the program produces a gridded output file.</para>

<itemizedlist>
<listitem>
<para>Y: Produce the file</para>
</listitem>
<listitem>
<para>N: Do not produce the file</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>MRG_LAYERS_YN</envar>: [default: N]</para>

<para>Defines whether the program uses the layer fractions file.</para>

<itemizedlist>
<listitem>
<para>Y: Use the layer fractions file</para>
</listitem>
<listitem>
<para>N: Do not use the layer fractions file</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>MRG_MARKETPEN_YN</envar>: [default: Y]</para>

<para>Defines whether the program uses market penetration from reactivity matrices.</para>

<itemizedlist>
<listitem>
<para>Y: Use market penetration</para>
</listitem>
<listitem>
<para>N: Do not use market penetration</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>MRG_METCHK_YN</envar>: [default: Y]</para>

<para>Defines whether the program checks consistency of headers in the meteorology file.</para>

<itemizedlist>
<listitem>
<para>Y: Check contents of meteorology file headers</para>
</listitem>
<listitem>
<para>N: Do not check headers</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>MRG_REPCNY_YN</envar>: [default: N]</para>

<para>Defines whether the program produces a report of emission totals by county.</para>

<itemizedlist>
<listitem>
<para>Y: Produce county-total emissions report</para>
</listitem>
<listitem>
<para>N: Do not produce the report</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>MRG_REPCTL_YN</envar>: [default: Y]</para>

<para>Defines whether the program separately reports controlled emissions.</para>

<itemizedlist>
<listitem>
<para>Y: Report controlled emissions separately</para>
</listitem>
<listitem>
<para>N: Do not report controlled emissions separately</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>MRG_REPINV_YN</envar>: [default: Y]</para>

<para>Defines whether the program creates a report using inventory emissions. <remark>This option is not available in the current version of SMOKE.</remark></para>

<itemizedlist>
<listitem>
<para>Y: Report inventory emissions</para>
</listitem>
<listitem>
<para>N: Do not report inventory emissions</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>MRG_REPSPC_YN</envar>: [default: Y]</para>

<para>Defines whether the program creates a report using speciated emissions. <remark>This option is not available in the current version of SMOKE.</remark></para>

<itemizedlist>
<listitem>
<para>Y: Report speciated emissions</para>
</listitem>
<listitem>
<para>N: Do not report speciated emissions</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>MRG_REPSTA_YN</envar>: [default: N]
Defines whether the program produces a report of emission totals by state.</para>

<itemizedlist>
<listitem>
<para>Y: Produce state-total emissions report</para>
</listitem>
<listitem>
<para>N: Do not produce the report</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>MRG_SOURCE</envar>: [default: blank (processing halts)]</para>

<para>Series of character codes representing the type(s) of sources to be merged.</para>

<itemizedlist>
<listitem>
<para>A: Area sources</para>
</listitem>
<listitem>
<para>B: Biogenic sources</para>
</listitem>
<listitem>
<para>M: Mobile sources</para>
</listitem>
<listitem>
<para>P: Point sources</para>
</listitem>
<listitem>
<para>AP: Area and point sources</para>
</listitem>
<listitem>
<para>AM: Area and mobile sources</para>
</listitem>
<listitem>
<para>etc.</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>MRG_SPCMAT_YN</envar>: [default: N]</para>

<para>Defines whether the program produces speciated output.</para>

<itemizedlist>
<listitem>
<para>Y: Read the speciation matrix produced by the <command>Spcmat</command> program</para>
</listitem>
<listitem>
<para>N: Do not read the speciation matrix</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>MRG_TEMPORAL_YN</envar>: [default: N]</para>

<para>Defines whether the program produces temporally allocated output.</para>

<itemizedlist>
<listitem>
<para>Y: Read the temporal matrix produced by the <command>Temporal</command> program</para>
</listitem>
<listitem>
<para>N: Do not read the temporal matrix</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>MRG_TOTOUT_UNIT</envar>: [default: input file units, or per day if hourly input is used]</para>

<para>This variable is like the <envar>MRG_GRDOUT_UNIT</envar> variable, except that it controls the state and county totals reports separately from the gridded outputs. The only difference is the temporal resolution of <envar>MRG_TOTOUT_UNIT</envar>, which always outputs the emission values as daily totals, no matter what units are used.</para>
</listitem>
<listitem>
<para><envar>SMK_ASCIIELEV_YN</envar>: [default: N]</para>

<para>Defines whether the program produces an ASCII elevated point sources file, suitable for postprocessing with the PTSRCE program in EPS2.0/EPS2.5.</para>

<itemizedlist>
<listitem>
<para>Y: Create the ASCII elevated point sources file</para>
</listitem>
<listitem>
<para>N: Do not create the ASCII elevated point sources file</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>SMK_AVEDAY_YN</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" /></para>

<para>NOTE: This setting affects the <command>Smkmerge</command> results only when hourly emissions are not merged. To use hourly average-day emissions in <command>Smkmerge</command>, this variable must be set to Y for the <command>Temporal</command> program, so that average-day emissions will be used in creating the hourly emissions.</para>
</listitem>
<listitem>
<para><envar>SMK_EMLAYS</envar>: See description in <xref linkend="sect_programs_laypoint_envar" /></para>

<para>Used to set the default value for <envar>UAM_LAYERS</envar> when the <command>Smkmerge</command> output is to be used in UAM-V elevated-point-source output processing.</para>
</listitem>
<listitem>
<para><envar>SMK_PING_METHOD</envar>: See description in <xref linkend="sect_programs_elevpoint_envar" /></para>

<para>Creates CMAQ or MAQSIP PinG file or flags PinG sources in UAM-style elevated ASCII file (when the <envar>SMK_ASCIIELEV_YN</envar> environment variable is set to Y).</para>
</listitem>
<listitem>
<para><envar>SMK_REPORT_TIME</envar>: [default: 230000]</para>

<para>Time for writing daily reports from program (HHMMSS).</para>
</listitem>
<listitem>
<para><envar>SPC_INPUT</envar>: [script setting, no default]</para>

<para>Used by the SMOKE scripts to switch between mass-based and mole-based speciation. At this time, the <command>Smkmerge</command> program does not read in this setting directly; instead, the SMOKE scripts use it to control whether <command>Smkmerge</command> will be provided with mass-based or mole-based speciation matrices and biogenic model-ready inputs.</para>
</listitem>
</itemizedlist>

<para>The rest of the variables in this list are relevant only when the <envar>SMK_ASCIIELEV_YN</envar> environment variable is set to Y. The UAM-style elevated-point-source file referenced in the following descriptions is produced by <command>Smkmerge</command> and used as input to the UAM preprocessor PTSRCE.</para>

<itemizedlist>
<listitem>
<para><envar>UAM_LAYERS</envar>: [default: set by value of <envar>SMK_EMLAYS</envar>]</para>

<para>Number of layers to output to the elevated-point-source file.</para>
</listitem>
<listitem>
<para><envar>UAM_NOTE</envar>: [default: “UAM elev pt emis from Smkmerge”]</para>

<para>Message to appear as a note in the elevated-point-source file.</para>
</listitem>
<listitem>
<para><envar>UAM_NPARAM</envar>: [default: 20]</para>

<para>Number of parameters for control packet to appear in the elevated-point-source file.</para>
</listitem>
<listitem>
<para><envar>UAM_PRINT_LOCATIONS</envar>: [default: 0]</para>

<para>Flag printed in the elevated-point-source file to control whether PTSRCE will print the locations table. 0=No; 1=Yes.</para>
</listitem>
<listitem>
<para><envar>UAM_PRINT_METHODS</envar>: [default: 0]</para>

<para>Flag printed in the elevated-point-source file to control whether PTSRCE will print the methods table. 0=No; 1=Yes.</para>
</listitem>
<listitem>
<para><envar>UAM_PRINT_OUTGRD</envar>: [default: 0]</para>

<para>Flag printed in the elevated-point-source file to control whether PTSRCE will print the output grid. 0=No; 1=Yes.</para>
</listitem>
<listitem>
<para><envar>UAM_PRINT_UNITS</envar>: [default: 0]</para>

<para>Flag printed in the elevated-point-source file to control whether PTSRCE will print the units table. 0=No; 1=Yes.</para>
</listitem>
<listitem>
<para><envar>UAM_PRINT_VALUES</envar>: [default: 0]</para>

<para>Flag printed in the elevated-point-source file to control whether PTSRCE will print the values table. 0=No; 1=Yes.</para>
</listitem>
<listitem>
<para><envar>UAM_PRINT_VERTMETH</envar>: [default: 0]</para>

<para>Flag printed in the elevated-point-source file to control whether PTSRCE will print the vertical methods table. 0=No; 1=Yes.</para>
</listitem>
<listitem>
<para><envar>UAM_PTSRCE_OUTUNIT</envar>: [default: 20]</para>

<para>PTSRCE output file unit number in the elevated-point-source file.</para>
</listitem>
<listitem>
<para><envar>UAM_VERTICAL_METHOD</envar>: [default: STACKHGT]</para>

<para>Vertical method in the elevated-point-source file. Appropriate values are STACKHGT and PLUMERISE.</para>
</listitem>
<listitem>
<para><envar>UAM4_DIFFBREAK_UNIT</envar>: [default: 0]</para>

<para>DIFFBREAK file unit number in the elevated-point-source file.</para>
</listitem>
<listitem>
<para><envar>UAM4_HTLOWR</envar>: [default: 20]</para>

<para>Minimum height (in meters) of cells between the surface and the “diffbreak” in the elevated-point-source file.</para>
</listitem>
<listitem>
<para><envar>UAM4_HTSFC</envar>: [default: 0]</para>

<para>Height of the surface layer (in meters) in the elevated-point-source file.</para>
</listitem>
<listitem>
<para><envar>UAM4_HTUPPR</envar>: [default: 100]</para>

<para>Minimum height (in meters) of cells between the “diffbreak” and the top of the model in the elevated-point-source file.</para>
</listitem>
<listitem>
<para><envar>UAM4_LAYABOVE</envar>: [default: <envar>UAM_LAYERS</envar> - <envar>UAM4_LAYBELOW</envar>]</para>

<para>Number of layers above the “diffbreak” in the elevated-point-source file.</para>
</listitem>
<listitem>
<para><envar>UAM4_LAYBELOW</envar>: [default: 3]</para>

<para>Number of layers below the “diffbreak” in the elevated-point-source file.</para>
</listitem>
<listitem>
<para><envar>UAM4_METSCALARS_UNIT</envar>: [default: 15]</para>

<para>METSCALARS file unit number in the elevated-point-source file. Used only for <envar>UAM_VERTICAL_METHOD</envar> set to “PLUMERISE”.</para>
</listitem>
<listitem>
<para><envar>UAM4_REGIONTOP_UNIT</envar>: [default: 0]</para>

<para>REGIONTOP file unit number in the elevated-point-source file.</para>
</listitem>
<listitem>
<para><envar>UAM4_TEMPERATUR_UNIT</envar>: [default: 14]</para>

<para>TEMPERATUR file unit number in the elevated-point-source file. Used only for <envar>UAM_VERTICAL_METHOD</envar> set to “PLUMERISE”.</para>
</listitem>
<listitem>
<para><envar>UAM4_WIND_UNIT</envar>: [default: 16]</para>

<para>WIND file unit number in the elevated-point-source file. Used only for <envar>UAM_VERTICAL_METHOD</envar> set to “PLUMERISE”.</para>
</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<para>The output files produced by <command>Smkmerge</command> are determined by the values of the input environment variables.</para>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[A|B|M|P]G[T][S][3D][_S|_L][_O]</envar></entry>
<entry>I/O API netCDF</entry>
<entry><para>Merged emission file, produced when <envar>MRG_GRDOUT_YN</envar> is set to Y; actual file name is determined by the environment variables used to configure <command>Smkmerge</command>, as follows:</para>

<itemizedlist>
<listitem>
<para>[area|biogenic|mobile|point] (<envar>MRG_SOURCE</envar>)</para>
</listitem>
<listitem>
<para>T = temporally allocated (<envar>MRG_TEMPORAL_YN</envar>)</para>
</listitem>
<listitem>
<para>S = speciated (<envar>MRG_SPCMAT_YN</envar>)</para>
</listitem>
<listitem>
<para>3D = layered (<envar>MRG_LAYERS_YN</envar>)</para>
</listitem>
<listitem>
<para>_S = mass-based speciation (<envar>SPC_INPUT</envar>)</para>
</listitem>
<listitem>
<para>_L = mole-based speciation (<envar>SPC_INPUT</envar>)</para>
</listitem>
<listitem>
<para>_O = used when only merging biogenic sources (<envar>MRG_SOURCE</envar> = B)</para>
</listitem>
</itemizedlist>

</entry>
</row>
<row>
<entry><envar>PING[T][S][_S|_L]</envar></entry>
<entry>I/O API netCDF</entry>
<entry>CMAQ or MAQSIP PinG file, produced if <envar>SMK_PING_METHOD</envar> is set to 1</entry>
</row>
<row>
<entry><envar>ELEV[T]S[_S|_L]</envar></entry>
<entry>ASCII</entry>
<entry>Elevated-point-sources file, produced if <envar>SMK_ASCIIELEV_YN</envar> is set to Y; if PinG sources have also been selected, then the stack diameters listed in this file will be set to the negative value of their actual value</entry>
</row>
<row>
<entry><envar>REP[A|B|M|P]G[T][S][_S|_L]</envar></entry>
<entry>ASCII</entry>
<entry>Emission totals report file, produced if either <envar>MRG_REPSTA_YN</envar> or <envar>MRG_REPCNY_YN</envar> is set to Y</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Smkmerge</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

<section>

<title>Earlier Versions</title>

<para>The SMOKE prototype used a series of merge programs: CSELEV for elevated point sources, SDGMERGE for low-level sources, CSGLMERGE for layered output, SMK2EMIS for UAM-ready lower-level emissions, SMK2PTS for UAM-ready elevated point sources, SMK2SAQM for SAQM-ready emissions, and CSGLDAYMERGE. The new <command>Smkmerge</command> program replaces all these special-purpose programs.</para>

</section>

</section>

<section id="sect_programs_spcmat">

<title><command>Spcmat</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> area, mobile, point</para>

<para>An emission inventory is built and reported for a variety of compounds or chemical classes such as CO, NO<subscript>x</subscript>, VOC, PM<subscript>10</subscript>, and SO<subscript>2</subscript>. However, AQM photochemical mechanisms (e.g., CB-IV, RADM2) contain a simplified set of equations that use representative “model species” to represent atmospheric chemistry. Therefore, source-specific factors are needed to convert the emissions from the chemical classes in the emission inventory to the species in the intended photochemical mechanism. The <command>Spcmat</command> program produces matrices that contain the factors for performing this conversion.</para>

<para><command>Spcmat</command> outputs both mass-based and mole-based factors for all sources. Previous systems have assumed that the average molecular weight of the model species was sufficient to represent the molecular weight of a species emitted by a specific source. In fact, the actual molecular weight of a model species is different for different types of emission processes. To represent the mass values more accurately, the mass and mole factors are computed and stored separately.</para>

<para>The speciation cross-reference file input to <command>Spcmat</command> specifies the speciation profile to be used for transforming the inventory pollutants to the model species for each source or type of source. <command>Spcmat</command> permits profiles to be assigned based on the country, state, and county code, the SCC, and other source characteristics. In the hierarchical system used to apply the profiles, the most specific assignments are applied first, followed by the next most specific, and so on. This system ensures that the most-specific matches override the less-specific ones.</para>

<para>For stationary area/nonpoint sources, the available combinations and their order are the following, starting with the most specific. “Left <emphasis>x</emphasis> of SCC” refers to an 8- or 10-digit SCC with all digits except the first <emphasis>x</emphasis> set to 0. “Left 2 of SIC code” refers to a 4-digit SIC code with the third and fourth digits set to 0.</para>

<orderedlist>
<listitem>
<para>Country/state/county code, MACT code, and 8- or 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state/county code and MACT code</para>
</listitem>
<listitem>
<para>Country/state code, MACT code, and 8- or 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state code and MACT code</para>
</listitem>
<listitem>
<para>MACT code and 8- or 10-digit SCC</para>
</listitem>
<listitem>
<para>MACT code</para>
</listitem>
<listitem>
<para>Country/state/county code and 4-digit SIC code</para>
</listitem>
<listitem>
<para>Country/state/county code and left 2 of SIC code</para>
</listitem>
<listitem>
<para>Country/state code and 4-digit SIC code</para>
</listitem>
<listitem>
<para>Country/state code and left 2 of SIC code</para>
</listitem>
<listitem>
<para>4-digit SIC code</para>
</listitem>
<listitem>
<para>Left 2 of SIC code</para>
</listitem>
<listitem>
<para>Country/state/county code and 8- or 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state/county code and left 6 or left 7 of SCC</para>
</listitem>
<listitem>
<para>Country/state code and 8- or 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state code and left 6 or left 7 of SCC</para>
</listitem>
<listitem>
<para>8- or 10-digit SCC</para>
</listitem>
<listitem>
<para>Left 6 or left 7 of SCC</para>
</listitem>
<listitem>
<para>Country/state/county code</para>
</listitem>
<listitem>
<para>Country/state code</para>
</listitem>
<listitem>
<para>Ultimate default (country/state/county code = 0, SCC = 0)</para>
</listitem>
</orderedlist>

<para>For nonroad sources, the available combinations and their order are:</para>

<orderedlist>
<listitem>
<para>Country/state/county code and 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state/county code and left 7 of SCC</para>
</listitem>
<listitem>
<para>Country/state code and 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state code and left 7 of SCC</para>
</listitem>
<listitem>
<para>10-digit SCC</para>
</listitem>
<listitem>
<para>Left 7 of SCC</para>
</listitem>
<listitem>
<para>Country/state/county code</para>
</listitem>
<listitem>
<para>Country/state code</para>
</listitem>
<listitem>
<para>Ultimate default (country/state/county code = 0, SCC = 0)</para>
</listitem>
</orderedlist>

<para>For mobile sources, the available combinations and their order are:</para>

<orderedlist>
<listitem>
<para>Country/state/county code, road class, vehicle type, and process</para>
</listitem>
<listitem>
<para>Country/state/county code, road class, and vehicle type</para>
</listitem>
<listitem>
<para>Country/state/county code, road class, and process</para>
</listitem>
<listitem>
<para>Country/state/county code and road class</para>
</listitem>
<listitem>
<para>Country/state/county code, vehicle type, and process</para>
</listitem>
<listitem>
<para>Country/state/county code and vehicle type</para>
</listitem>
<listitem>
<para>Country/state code, road class, vehicle type, and process</para>
</listitem>
<listitem>
<para>Country/state code, road class, and vehicle type</para>
</listitem>
<listitem>
<para>Country/state code and road class</para>
</listitem>
<listitem>
<para>Country/state code, vehicle type, and process</para>
</listitem>
<listitem>
<para>Country/state code and vehicle type</para>
</listitem>
<listitem>
<para>Road class, vehicle type, and process</para>
</listitem>
<listitem>
<para>Road class and vehicle type</para>
</listitem>
<listitem>
<para>Road class</para>
</listitem>
<listitem>
<para>Vehicle type and process</para>
</listitem>
<listitem>
<para>Vehicle type</para>
</listitem>
<listitem>
<para>Country/state/county code and process</para>
</listitem>
<listitem>
<para>Country/state/county code</para>
</listitem>
<listitem>
<para>Country/state code and process</para>
</listitem>
<listitem>
<para>Country/state/county code</para>
</listitem>
<listitem>
<para>Process-specific ultimate default (country/state/county code = 0, SCC = 0)</para>
</listitem>
<listitem>
<para>Ultimate default (no process, country/state/county code = 0, SCC = 0)</para>
</listitem>
</orderedlist>

<para>For point sources, the available combinations depend on the source definition. A header in the speciation cross-reference file format allows you to indicate the source definition. (The header is required for IDA inventories). For IDA-formatted inventories, a source is defined as the unique combination of country/state/county code, plant ID, point ID, stack ID, segment, and SCC. For point sources, the available combinations and their order are:</para>

<orderedlist>
<listitem>
<para>Country/state/county code, plant ID, point ID, stack ID, segment ID, and SCC</para>
</listitem>
<listitem>
<para>Country/state/county code, plant ID, point ID, stack ID, and segment ID</para>
</listitem>
<listitem>
<para>Country/state/county code, plant ID, point ID, and stack ID</para>
</listitem>
<listitem>
<para>Country/state/county code, plant ID, and point ID</para>
</listitem>
<listitem>
<para>Country/state/county code and plant ID</para>
</listitem>
<listitem>
<para>Country/state/county code, MACT code, and SCC</para>
</listitem>
<listitem>
<para>Country/state/county code and MACT code</para>
</listitem>
<listitem>
<para>Country/state code, MACT code, and SCC</para>
</listitem>
<listitem>
<para>Country/state code and MACT code</para>
</listitem>
<listitem>
<para>MACT code and SCC</para>
</listitem>
<listitem>
<para>MACT code</para>
</listitem>
<listitem>
<para>Country/state/county code and 4-digit SIC code</para>
</listitem>
<listitem>
<para>Country/state/county code and left 2 of SIC code</para>
</listitem>
<listitem>
<para>Country/state code and 4-digit SIC code</para>
</listitem>
<listitem>
<para>Country/state code and left 2 of SIC code</para>
</listitem>
<listitem>
<para>4-digit SIC code</para>
</listitem>
<listitem>
<para>Left 2 of SIC code</para>
</listitem>
<listitem>
<para>Country/state/county code and SCC</para>
</listitem>
<listitem>
<para>Country/state/county code and left 6 of SCC </para>
</listitem>
<listitem>
<para>Country/state/county code and left 3 of SCC </para>
</listitem>
<listitem>
<para>Country/state/county code and left 1 of SCC</para>
</listitem>
<listitem>
<para>Country/state code and SCC</para>
</listitem>
<listitem>
<para>Country/state code and left 6 of SCC </para>
</listitem>
<listitem>
<para>Country/state code and left 3 of SCC </para>
</listitem>
<listitem>
<para>Country/state code and left 1 of SCC</para>
</listitem>
<listitem>
<para>SCC</para>
</listitem>
<listitem>
<para>Left 6 of SCC</para>
</listitem>
<listitem>
<para>Left 3 of SCC</para>
</listitem>
<listitem>
<para>Left 1 of SCC</para>
</listitem>
<listitem>
<para>Country/state/county code</para>
</listitem>
<listitem>
<para>Country/state code</para>
</listitem>
<listitem>
<para>Ultimate default (country/state/county code = 0, SCC = 0)</para>
</listitem>
</orderedlist>

</section>

<section>

<title>Processing Order</title>

<para><command>Smkinven</command> must be run before <command>Spcmat</command>.</para>

<para><command>Spcmat</command> must be executed before speciated emissions can be produced by <command>Smkmerge</command>.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_spcmat">
<title><command>Spcmat</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/spcmat_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/spcmat_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_spcmat" /> shows the input and output files for the <command>Spcmat</command> program. The input files include the inventory file output from <command>Smkinven</command> (<envar>AREA</envar>, <envar>MOBL</envar>, or <envar>PNTS</envar>), the speciation profiles file (<envar>GSPRO</envar>), the speciation cross-reference file (<envar>GSREF</envar>), the inventory data table (<envar>INVTABLE</envar>), the pollutant conversion file (<envar>GSCNV</envar>) if <envar>POLLUTANT_CONVERSION</envar> = Y, and for mobile sources only, the mobile codes file (<envar>MCODES</envar>) and the mobile emission processes file (<envar>MEPROC</envar>). The program outputs a mole-based speciation matrix file (<envar>ASMAT_L</envar>, <envar>MSMAT_L</envar>, or <envar>PSMAT_L</envar>) and a mass-based speciation matrix file (<envar>ASMAT_S</envar>, <envar>MSMAT_S</envar>, or <envar>PSMAT_S</envar>).</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[AREA|MOBL|PNTS]</envar></entry>
<entry>SMOKE map</entry>
<entry>Intermediate inventory file produced by <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>GSPRO</envar></entry>
<entry>ASCII</entry>
<entry>Speciation profiles</entry>
</row>
<row>
<entry><envar>GSREF</envar></entry>
<entry>ASCII</entry>
<entry>Speciation cross-reference file</entry>
</row>
<row>
<entry><envar>INVTABLE</envar></entry>
<entry>ASCII</entry>
<entry>Inventory data table listing activity and pollutant names</entry>
</row>
<row>
<entry><envar>GSCNV</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Pollutant conversion file, used only if <envar>POLLUTANT_CONVERSION</envar> = Y</entry>
</row>
<row>
<entry><envar>MCODES</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Mobile codes file for converting road class numbers and vehicle type numbers to SMOKE internal standard</entry>
</row>
<row>
<entry><envar>MEPROC</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Mobile emission processes file</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section>

<title>Input Environment Variables</title>

<itemizedlist>
<listitem>
<para><envar>POLLUTANT_CONVERSION</envar>: [default: N]</para>

<para>Defines whether the program uses the pollutant-to-pollutant conversion file.</para>

<itemizedlist>
<listitem>
<para>Y: Use conversion file</para>
</listitem>
<listitem>
<para>N: Do not use conversion file</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>REPORT_DEFAULTS</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" /></para>
</listitem>
<listitem>
<para><envar>SMK_SOURCE</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" /></para>
</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[A|M|P]SMAT_L</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Mole-based speciation matrix</entry>
</row>
<row>
<entry><envar>[A|M|P]SMAT_S</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Mass-based speciation matrix</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Spcmat</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

<section>

<title>Earlier Versions</title>

<para>The SMOKE prototype used separate programs for each type of emission source: SPCAMAT for area sources, SPCMMAT for mobile sources, and SPCPMAT for point sources. Also, the SMOKE prototype output only mole-based speciation matrices.</para>

<para>Version 2.0 added the ability to assign speciation profiles by MACT and SIC codes. Also, species of differing types (i.e., gaseous and particulate) can be created from the same pollutant.</para>

</section>

</section>

<section id="sect_programs_temporal">

<title><command>Temporal</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> area, mobile, point</para>

<para>The <command>Temporal</command> program produces a file with hourly inventory pollutant emissions. Unlike the SMOKE matrices produced by <command>Cntlmat</command>, <command>Grdmat</command>, and <command>Spcmat</command>, the output file from <command>Temporal</command> contains the actual emissions data. For all source categories, it uses temporal profiles, temporal cross-references, and the time zone of each source to create the hourly emissions output file. It can also read in day-specific and hour-specific inventory data in SMOKE format, and it uses the most detailed data it can when multiple types of data are available for the same source. For example, if a source had annual, day-specific, and hour-specific data, <command>Temporal</command> would use the hour-specific emissions. The program can also apply source-specific hourly profiles from the hour-specific data file, and it can override all temporal profiles and use temporally uniform profiles for all sources. For mobile sources, <command>Temporal</command> also reads the emission factors created by <command>Emisfac</command>.</para>

<para><command>Temporal</command> treats the temporal profiles as <emphasis>local</emphasis> profiles. In other words, the profile applied to the source is adjusted based on the difference between the time zone of the source (determined by the <envar>COSTCY</envar> file) and the output time zone (determined by the <envar>OUTZONE</envar> environment variable). SMOKE automatically considers Daylight Saving time when converting from a region’s standard time zone to the output time zone, and SMOKE can exclude regions that never use Daylight Saving time based on the <envar>COSTCY</envar> file. Note that <command>Temporal</command> has been tested for time zones in the Western Hemisphere, but we have not tested it for time zones in the Eastern Hemisphere.</para>

<para>Within the <command>Temporal</command> program, the processing occurs as follows:</para>

<itemizedlist>
<listitem>
<para>Temporal profiles are assigned for all sources.</para>
</listitem>
<listitem>
<para>Monthly and day-of-week temporal profiles are applied.</para>
</listitem>
<listitem>
<para>Day-specific emissions or activities are read in and used to overwrite daily emissions for the appropriate sources</para>
</listitem>
<listitem>
<para>Hourly temporal profiles are applied.</para>
</listitem>
<listitem>
<para>Hour-specific emissions or activities are read in and used to overwrite hourly emissions for the appropriate sources.</para>
</listitem>
<listitem>
<para>Emission factors are applied to the hourly activity data (if any)</para>
</listitem>
</itemizedlist>

<para>Hourly temporal profiles can be applied for weekdays and weekend days by default in the system. By breaking up the processing into different periods, you can apply different temporal profiles for different days of the week. A future version of SMOKE will permit different hourly profiles for every day of the week in a single run of the <command>Temporal</command> program.</para>

<para>A special holidays file should be provided so that holidays can receive special treatment. This file specifies which daily profiles should be applied to holidays.</para>

<para>A many-step hierarchy is used in applying the temporal cross-referencing. SMOKE preferentially matches each source to the most specific line in the cross-reference file. When there are missing entries in the cross-reference file, <command>Temporal</command> first looks for cross-reference entries for other species at the same level in the search hierarchy before descending to the next level in the hierarchy. For example, if a source has a temporal cross-reference entry for CO but not for NO<subscript>x</subscript>, <command>Temporal</command> uses the source-specific CO temporal cross reference entry for allocating NO<subscript>x</subscript> from that source in preference to using a default NO<subscript>x</subscript> temporal profile.</para>

<para>For area sources, the available combinations are the following, starting with the most specific. "7-digit SCC" means a 10-digit SCC with the last three digits set to zero.</para>

<orderedlist>
<listitem>
<para>Country/state/county code, 10-digit SCC, and pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, 7-digit SCC, and pollutant </para>
</listitem>
<listitem>
<para>Country/state code, 10-digit SCC, and pollutant</para>
</listitem>
<listitem>
<para>Country/state code, 7-digit SCC, and pollutant</para>
</listitem>
<listitem>
<para>10-digit SCC and pollutant</para>
</listitem>
<listitem>
<para>7-digit SCC and pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code and 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state/county code and 7-digit SCC</para>
</listitem>
<listitem>
<para>Country/state code and 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state code and 7-digit SCC</para>
</listitem>
<listitem>
<para>10-digit SCC</para>
</listitem>
<listitem>
<para>7-digit SCC</para>
</listitem>
<listitem>
<para>Country/state/county code</para>
</listitem>
<listitem>
<para>Country/state code</para>
</listitem>
<listitem>
<para>Ultimate default (no pollutant, country/state/county code = 0, SCC = 0)</para>
</listitem>
</orderedlist>

<para>For mobile sources, the available combinations are given below. To specify an entry that is to match by vehicle type, the road class part of the SCC must be filled with zeros. If any warnings or errors are written during the read of the mobile temporal cross-reference file, the messages will use the mobile internal SCCs.</para>

<orderedlist>
<listitem>
<para>Country/state/county code, road class, link ID, vehicle type, and process/pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, road class, link ID, and process/pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, road class, link ID, and vehicle type</para>
</listitem>
<listitem>
<para>Country/state/county code, road class, and link ID</para>
</listitem>
<listitem>
<para>Country/state/county code, road class, vehicle type, and process/pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, road class, and process/pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, vehicle type, and process/pollutant</para>
</listitem>
<listitem>
<para>Country/state code, road class, vehicle type, and process/pollutant</para>
</listitem>
<listitem>
<para>Country/state code, road class, and process/pollutant</para>
</listitem>
<listitem>
<para>Country/state code, vehicle type, and process/pollutant</para>
</listitem>
<listitem>
<para>Road class, vehicle type, and process/pollutant</para>
</listitem>
<listitem>
<para>Road class and process/pollutant</para>
</listitem>
<listitem>
<para>Vehicle type and process/pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, road class, vehicle type</para>
</listitem>
<listitem>
<para>Country/state/county code, road class</para>
</listitem>
<listitem>
<para>Country/state/county code, vehicle type</para>
</listitem>
<listitem>
<para>Country/state code, road class, vehicle type</para>
</listitem>
<listitem>
<para>Country/state code, road class</para>
</listitem>
<listitem>
<para>Country/state code, vehicle type</para>
</listitem>
<listitem>
<para>Road class, vehicle type</para>
</listitem>
<listitem>
<para>Road class</para>
</listitem>
<listitem>
<para>Vehicle type</para>
</listitem>
<listitem>
<para>Country/state/county code</para>
</listitem>
<listitem>
<para>Country/state code</para>
</listitem>
<listitem>
<para>Ultimate default (all values = 0)</para>
</listitem>
</orderedlist>

<para>For point sources, the available combinations depend on the source definition. A header is used in the file to indicate the source definition. (The header is required for IDA inventories). For IDA-formatted inventories, a source is defined as the unique combination of country/state/county code, plant ID, point ID, stack ID, segment, and SCC. This documentation applies to IDA-formatted inventories only. "5-digit SCC" means a 10-digit SCC with the last 5 digits set to zero. If only 8-digit SCCs are available, these can be used and SMOKE will assume leading zeros. In this case, the "5-digit SCC" becomes a "3-digit SCC."</para>

<para>The hierarchy of cross-referencing is the following.</para>

<orderedlist>
<listitem>
<para>Country/state/county code, 10-digit SCC, plant ID, point ID, stack ID, segment, and pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, 10-digit SCC, plant ID, point ID, stack ID, and pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, 10-digit SCC, plant ID, point ID, and pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, 10-digit SCC, plant ID, and pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, 10-digit SCC, plant ID, point ID, stack ID, and segment</para>
</listitem>
<listitem>
<para>Country/state/county code, 10-digit SCC, plant ID, point ID, and stack ID</para>
</listitem>
<listitem>
<para>Country/state/county code, 10-digit SCC, plant ID, and point ID</para>
</listitem>
<listitem>
<para>Country/state/county code, 10-digit SCC, and plant ID</para>
</listitem>
<listitem>
<para>Country/state/county code, 10-digit SCC, and pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, 5-digit SCC, and pollutant</para>
</listitem>
<listitem>
<para>Country/state code, 10-digit SCC, and pollutant</para>
</listitem>
<listitem>
<para>Country/state code, 5-digit SCC, and pollutant</para>
</listitem>
<listitem>
<para>10-digit SCC and pollutant</para>
</listitem>
<listitem>
<para>5-digit SCC and pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code and 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state/county code and 5-digit SCC</para>
</listitem>
<listitem>
<para>Country/state code and 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state code and 5-digit SCC</para>
</listitem>
<listitem>
<para>10-digit SCC</para>
</listitem>
<listitem>
<para>5-digit SCC</para>
</listitem>
<listitem>
<para>Country/state/county code</para>
</listitem>
<listitem>
<para>Country/state code</para>
</listitem>
<listitem>
<para>Ultimate default (all values = 0)</para>
</listitem>
</orderedlist>

</section>

<section>

<title>Processing Order</title>

<para><command>Smkinven</command> must be run before <command>Temporal</command>. For mobile sources, <command>Grdmat</command>, <command>Mbsetup</command>, <command>Premobl</command>, and <command>Emisfac</command> must also be run before the <command>Temporal</command> program when activity data are being used.</para>

<para><command>Temporal</command> must be run before gridded, hour-specific emissions can be produced using the <command>Smkmerge</command> program.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_temporal_area">
<title><command>Temporal</command> input and output files for area sources</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/temporal_area_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/temporal_area_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_temporal_area" /> shows the input and output files for the <command>Temporal</command> program for area sources. The input files include the inventory file output from <command>Smkinven</command> (<envar>AREA</envar>), the optional day-specific inventory file (<envar>ADAY</envar>) and the optional hour-specific inventory file (<envar>AHOUR</envar>), the temporal profiles file (<envar>ATPRO</envar>), the temporal cross-reference file (<envar>ATREF</envar>), the country, state, and county codes file (<envar>COSTCY</envar>), the holidays file (<envar>HOLIDAYS</envar>), and, if activity data are used, the inventory data table (<envar>INVTABLE</envar>). The program outputs an hourly emissions file (<envar>ATMP</envar>).</para>

<figure id="fig_programs_temporal_mobile">
<title><command>Temporal</command> input and output files for mobile sources</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/temporal_mobile_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/temporal_mobile_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_temporal_mobile" /> shows the input and output files for the <command>Temporal</command> program for mobile sources. The input files include the inventory file output from <command>Smkinven</command> (<envar>MOBL</envar>), the optional day-specific inventory file (<envar>MDAY</envar>) and the optional hour-specific inventory file (<envar>MHOUR</envar>), the temporal profiles file (<envar>MTPRO</envar>), the temporal cross-reference file (<envar>MTREF</envar>), the mobile emission process file (<envar>MEPROC</envar>), the mobile codes file (<envar>MCODES</envar>), the list of emission factors files output from <command>Emisfac</command> (<envar>MEFLIST</envar>), the country, state, and county codes file (<envar>COSTCY</envar>), the holidays file (<envar>HOLIDAYS</envar>), and, if activity data are used, the inventory data table (<envar>INVTABLE</envar>) and the ungridding matrix file (<envar>MUMAT</envar>). The program outputs an hourly emissions file (<envar>MTMP</envar>).</para>

<figure id="fig_programs_temporal_point">
<title><command>Temporal</command> input and output files for point sources</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/temporal_point_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/temporal_point_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_temporal_point" /> shows the input and output files for the <command>Temporal</command> program for point sources. The input files include the inventory file output from <command>Smkinven</command> (<envar>PNTS</envar>), the optional day-specific inventory file (<envar>PDAY</envar>) and the optional hour-specific inventory file (<envar>PHOUR</envar>), the temporal profiles file (<envar>PTPRO</envar>), the temporal cross-reference file (<envar>PTREF</envar>), the country, state, and county codes file (<envar>COSTCY</envar>), the holidays file (<envar>HOLIDAYS</envar>), and, if activity data are used, the inventory data table (<envar>INVTABLE</envar>). The program outputs an hourly emissions file (<envar>PTMP</envar>).</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[AREA|MOBL|PNTS]</envar></entry>
<entry>SMOKE map</entry>
<entry>Intermediate inventory file produced by <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>[A|M|P]DAY</envar> (optional)</entry>
<entry>I/O API netCDF</entry>
<entry>Day-specific intermediate inventory file created by <command>Smkinven</command> (required if <envar>DAY_SPECIFIC_YN</envar> is set to Y)</entry>
</row>
<row>
<entry><envar>[A|M|P]HOUR</envar> (optional)</entry>
<entry>I/O API netCDF</entry>
<entry>Hour-specific intermediate inventory file created by <command>Smkinven</command> (required if <envar>HOUR_SPECIFIC_YN</envar> is set to Y)</entry>
</row>
<row>
<entry><envar>[A|M|P]TPRO</envar></entry>
<entry>ASCII</entry>
<entry>Temporal profiles</entry>
</row>
<row>
<entry><envar>[A|M|P]TREF</envar></entry>
<entry>ASCII</entry>
<entry>Temporal cross-reference file</entry>
</row>
<row>
<entry><envar>MEPROC</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Mobile emission processes file</entry>
</row>
<row>
<entry><envar>MCODES</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Mobile codes file for converting road class numbers and vehicle type numbers to SMOKE internal standard</entry>
</row>
<row>
<entry><envar>MEFLIST</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>List of emission factors files produced by <command>Emisfac</command></entry>
</row>
<row>
<entry><envar>COSTCY</envar></entry>
<entry>ASCII</entry>
<entry>Country/state/county codes file, used to determine counties that do not use Daylight Saving time.</entry>
</row>
<row>
<entry><envar>HOLIDAYS</envar></entry>
<entry>ASCII</entry>
<entry>Holidays file by Gregorian date, for applying holiday temporal profiles. </entry>
</row>
<row>
<entry><envar>INVTABLE</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Inventory data table listing pollutant and activity names; required only if activity data are used</entry>
</row>
<row>
<entry><envar>MUMAT</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Ungridding matrix file produced by <command>Grdmat</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section>

<title>Input Environment Variables</title>

<itemizedlist>
<listitem>
<para><envar>DAY_SPECIFIC_YN</envar>: See description in <xref linkend="sect_programs_smkinven_envar" /></para>
</listitem>
<listitem>
<para><envar>HOUR_SPECIFIC_YN</envar>: See description in <xref linkend="sect_programs_smkinven_envar" /></para>
</listitem>
<listitem>
<para><envar>OUTZONE</envar>: See description in <xref linkend="sect_programs_premobl_envar" /></para>
</listitem>
<listitem>
<para><envar>RENORM_TPROF</envar>: [default: Y]</para>

<para>Defines whether <command>Temporal</command> normalizes the temporal profiles or uses them as they exist in the data file. If the profiles are specified as decimal values and sum to 1, then specify N. Otherwise, specify Y and the program will sum the values associated with each profile and then divide each value by the sum, thereby creating a normalized profile.</para>

<itemizedlist>
<listitem>
<para>Y: Normalize the temporal profiles</para>
</listitem>
<listitem>
<para>N: Use the temporal profile values as they exist in the data file</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>REPORT_DEFAULTS</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" /></para>
</listitem>
<listitem>
<para><envar>SMK_AVEDAY_YN</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" /></para>
</listitem>
<listitem>
<para><envar>SMK_EF_MODEL</envar>: [default: MOBILE6]</para>

<para>Name of the emission factor model to use. NOTE: At this time only the default value can be used.</para>
</listitem>
<listitem>
<para><envar>SMK_MAXERROR</envar>: See description in <xref linkend="sect_programs_smkinven_envar" /></para>
</listitem>
<listitem>
<para><envar>SMK_MAXWARNING</envar>: See description in <xref linkend="sect_programs_smkinven_envar" /></para>
</listitem>
<listitem>
<para><envar>SMK_SOURCE</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" /></para>
</listitem>
<listitem>
<para><envar>UNIFORM_TPROF_YN</envar>: [default: N]</para>

<para>Defines whether to use uniform temporal profiles for all sources.</para>

<itemizedlist>
<listitem>
<para>Y: Use uniform temporal profiles</para>
</listitem>
<listitem>
<para>N: Use temporal profiles file and temporal cross-reference file</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>ZONE4WM</envar>: [default: Y]</para>

<para>Defines whether <command>Temporal</command> applies weekly and monthly temporal profiles using time zones. If SMOKE does not apply the profiles using the sources’ time zones, then all sources change from one day to the next or one month to the next at the same hour. This is what other emission processing systems have typically done, and it is a minor distinction in most cases.</para>

<itemizedlist>
<listitem>
<para>Y: Use time zones</para>
</listitem>
<listitem>
<para>N: Do not use time zones</para>
</listitem>
</itemizedlist>

</listitem>
</itemizedlist>

</section>

<section>

<title>Other Input</title>

<para>When running <command>Temporal</command> interactively, the following inputs will be requested. The default values for these are set by the <envar>G_STDATE</envar>, <envar>G_STTIME</envar>, and <envar>G_RUNLEN</envar> environment variables.</para>

<itemizedlist>
<listitem>
<para>Start date: Starting date of simulation in Julian (DDDYYYY) or Gregorian (MMDDYYYY) formats</para>
</listitem>
<listitem>
<para>Start Time: Starting time of simulation in HHMMSS</para>
</listitem>
<listitem>
<para>Duration: Simulation duration in hours</para>
</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[A|M|P]TMP</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Hourly emissions by source; if using elevated point sources as part of point-source processing, this file contains only the layer-1 emissions</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Temporal</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

<section>

<title>Earlier Versions</title>

<para>The SMOKE prototype used separate programs for each type of emission source: TMPAREA for area sources, TMPMOBIL for mobile sources, and TMPPOINT for point sources. The TMPAREA, TMPMOBIL, and TMPPOINT programs used <envar>ESDATE</envar>, <envar>STIME</envar>, and <envar>DURATION</envar> environment variables to set the default date, time, and duration; SMOKE now uses the <envar>G_STDATE</envar>, <envar>G_STTIME</envar>, and <envar>G_RUNLEN</envar> environment variables used by other programs in the Models-3 environment.</para>

<para>Also, the SMOKE prototype permitted pollutant-specific temporal profiles for point and mobile sources, but not for area sources. Starting with SMOKE v1.0, area, mobile, and point sources can all use pollutant-specific temporal profiles.</para>

<para>SMOKE v1.0 and later handle pollutants other than CO, NO<subscript>x</subscript>, and VOC or ROG.</para>

</section>

</section>

<section id="sect_programs_tmpbeis3">

<title><command>Tmpbeis3</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> biogenic</para>

<para><command>Tmpbeis3</command> uses version 3.09 of the BEIS3 model. <command>Tmpbeis3</command> reads the gridded, normalized emissions file <envar>B3GRD</envar> and meteorological data from <envar>MET_FILE1</envar> and optionally <envar>MET_FILE2</envar> (these files may be either <envar>MET_CRO_2D</envar> or <envar>MET_CRO_3D</envar>). Note that <command>Tmpbeis3</command> uses temperature and surface pressure data that must be in <envar>MET_FILE1</envar>, and radiation/cloud data that may be in <envar>MET_FILE1</envar> or <envar>MET_FILE2</envar>. Within <command>Tmpbeis3</command>, speciation profiles are used to speciate biogenic pollutants for appropriate chemical mechanisms. The speciation profiles used in SMOKE-BEIS3 are different than those used in SMOKE-BEIS2 modeling, and speciation profiles for the CB-IV, RADM2, and SAPRC99 mechanisms are available for BEIS3 modeling. The normalized emissions and meteorological data are used to produce gridded, speciated, hourly biogenic emissions. Additionally, an optional seasonal switch file, <envar>BIOSEASON</envar>, can be used to determine when and where to use summer or winter normalized emissions data on a daily basis.</para>

</section>

<section>

<title>Processing Order</title>

<para>The <command>Normbeis3</command> program must be executed before <command>Tmpbeis3</command>.</para>

<para>If you are using the seasonal switch option, the seasonal switch file (<envar>BIOSEASON</envar>) must be created using the utility program <command>Metscan</command> before running <command>Tmpbeis3</command>.</para>

<para><command>Tmpbeis3</command> must be executed before biogenic emissions can be used in <command>Smkmerge</command>.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_tmpbeis3">
<title><command>Tmpbeis3</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/tmpbeis3_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/tmpbeis3_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_tmpbeis3" /> shows the input and output files for the <command>Tmpbeis3</command> program. The input files include the gridded, normalized biogenic emissions from <command>Normbeis3</command> (<envar>B3GRD</envar>), a meteorology file containing the latitude and longitude for each grid cell (<envar>GRID_CRO_2D</envar>), the speciation profiles file (<envar>GSPRO</envar>), and the meteorology file containing the temperature, surface pressure and radiation/cloud data (<envar>MET_FILE1</envar>). If <envar>BIOMET_SAME</envar> = N, then a second meteorology file containing the radiation/cloud data is needed (<envar>MET_FILE2</envar>), and if <envar>BIOSW_YN</envar> = Y then an optional gridded, seasonal switch file output from <command>Metscan</command> is required (<envar>BIOSEASON</envar>). The program outputs gridded, speciated, hourly biogenic emissions files in moles/hour (<envar>B3GTS_L</envar>) and tons/hour (<envar>B3GTS_S</envar>).</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>B3GRD</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Gridded, normalized biogenic emissions, output from <command>Normbeis3</command></entry>
</row>
<row>
<entry><envar>GRID_CRO_2D</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Meteorology file containing latitude and longitude coordinates for each grid cell</entry>
</row>
<row>
<entry><envar>GSPRO</envar></entry>
<entry>ASCII</entry>
<entry>Speciation profiles file (<emphasis role="bold">do not use the same profiles used in SMOKE-BEIS2; use profile named ‘BV309’</emphasis>)</entry>
</row>
<row>
<entry><envar>MET_FILE1</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Meteorology file containing temperature and surface pressure data and possibly radiation/cloud data as well (see <envar>BIOMET_SAME</envar> environment variable)</entry>
</row>
<row>
<entry><envar>MET_FILE2</envar> (optional)</entry>
<entry>I/O API netCDF</entry>
<entry>Meteorology file containing radiation/cloud data if not in <envar>MET_FILE1</envar></entry>
</row>
<row>
<entry><envar>BIOSEASON</envar> (optional)</entry>
<entry>I/O API netCDF</entry>
<entry>Gridded seasonal switch file containing daily data, with “0” meaning use winter normalized emissions and “1” meaning use the summer normalized emissions, produced by <command>Metscan</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section>

<title>Input Environment Variables</title>

<itemizedlist>
<listitem>
<para><envar>BG_CLOUD_TYPE</envar>: [default: 1]</para>

<para>Specifies which meteorological data to use.</para>

<itemizedlist>
<listitem>
<para>1: Use RGND or RSD (solar radiation reaching the ground) from MM5 to calculate PAR. <remark>No other options are supported at this time.</remark></para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>BIOG_SPRO</envar>: [default: BV309]</para>

<para>Specifies the speciation profile for biogenic emissions from GSPRO.</para>
</listitem>
<listitem>
<para><envar>BIOMET_SAME</envar>: [default: N]</para>

<para>Defines whether the radiation/cloud data are in the same file as the temperature data (<envar>MET_FILE1</envar>) or in a different file (<envar>MET_FILE2</envar>).</para>
</listitem>
<listitem>
<para><envar>BIOSW_YN</envar>: [default: Y]</para>

<para>Indicates whether to use a gridded seasonal switch file.</para>

<itemizedlist>
<listitem>
<para>Y: Use gridded seasonal switch file <envar>BIOSEASON</envar></para>
</listitem>
<listitem>
<para>N: Use environment variable <envar>SUMMER_YN</envar> to determine season</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>OUTZONE</envar>: See description in <xref linkend="sect_programs_premobl_envar" /></para>
</listitem>
<listitem>
<para><envar>PRES_VAR</envar>: [default: PRSFC]</para>

<para>Specifies the variable name for surface pressure data to extract from <envar>MET_FILE1</envar>.</para>
</listitem>
<listitem>
<para><envar>RAD_VAR</envar>: [default: RGRND]</para>

<para>Specifies the variable name for radiation/cloud data to extract from either <envar>MET_FILE1</envar> or optional <envar>MET_FILE2</envar>.</para>
</listitem>
<listitem>
<para><envar>SUMMER_YN</envar>: [default: Y]</para>

<para>Indicates whether summer or winter normalized emissions should be used; only used when <envar>BIOSW_YN</envar> is N.</para>

<itemizedlist>
<listitem>
<para>Y: Use summer normalized emissions</para>
</listitem>
<listitem>
<para>N: Use winter normalized emissions</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>TMPR_VAR</envar>: [default: TA]</para>

<para>Specifies the variable name for temperature to extract from <envar>MET_FILE1</envar>.</para>
</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>B3GTS_L</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Gridded, speciated, hourly biogenic emissions, in moles/hour</entry>
</row>
<row>
<entry><envar>B3GTS_S</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Gridded, speciated, hourly biogenic emissions, in tons/hour</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Tmpbeis3</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

<section>

<title>Earlier Versions</title>

<para><command>Tmpbeis3</command> was first released with SMOKE v1.4.</para>

</section>

</section>

<section id="sect_programs_tmpbio">

<title><command>Tmpbio</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> biogenic</para>

<para><command>Tmpbio</command> is the second program in the SMOKE-BEIS2 model. <command>Tmpbio</command> reads the gridded, normalized emissions file <envar>BGRD</envar> and/or <envar>BGRDW</envar> produced by <command>Rawbio</command>, as well as meteorological data from <envar>MET_FILE1</envar> and/or <envar>MET_FILE2</envar> (<envar>MET_CRO_2D</envar> or <envar>MET_CRO_3D</envar>). Speciation profiles are used to speciate biogenic pollutants into appropriate chemical mechanisms; the CB-IV and RADM2 mechanisms are supported. The normalized emissions and meteorological data are used to produce gridded, speciated, hourly biogenic emissions. Additionally, an optional seasonal switch file, <envar>BIOSEASON</envar>, can be used to determine when and where to use summer or winter normalized emissions data on a daily basis. Both the <envar>BGRD</envar> and <envar>BGRDW</envar> files are needed if the seasonal switch file is used.</para>

</section>

<section>

<title>Processing Order</title>

<para>The <command>Rawbio</command> program must be run before <command>Tmpbio</command>.</para>

<para>If using the seasonal switch option, <command>Rawbio</command> must be run twice (once using the summer emissions factors file and once using the winter emissions factors file). Also, the seasonal switch file must be created using <command>Metscan</command> before running <command>Tmpbio</command>.</para>

<para><command>Tmpbio</command> must be run before biogenic emissions can be used in <command>Smkmerge</command>.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_tmpbio">
<title><command>Tmpbio</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/tmpbio_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/tmpbio_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_tmpbio" /> shows the input and output files for the <command>Tmpbio</command> program. The input files include the gridded, normalized biogenic emissions from <command>Rawbio</command> (<envar>BGRD</envar> or <envar>BGRDW</envar>), the speciation profiles file (<envar>GSPRO</envar>), a grid description file (<envar>GRIDDESC</envar>), a meteorology file containing the temperature, surface pressure, and possibly radiation/cloud data (<envar>MET_FILE1</envar>), a second meteorology file (<envar>MET_FILE2</envar>) containing the radiation/cloud data if <envar>BIOMET_SAME</envar> = N, an optional meteorology file containing the latitude and longitude for each grid cell (<envar>GRID_CRO_2D</envar>), and, if <envar>BIOSW_YN</envar> = Y, an optional gridded seasonal switch file output from <command>Metscan</command> (<envar>BIOSEASON</envar>). The program outputs gridded, speciated, hourly biogenic emissions files in moles/hour (<envar>BGTS_L</envar>) and tons/hour (<envar>BGTS_S</envar>).</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>BGRD</envar>, <envar>BGRDW</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Gridded, normalized summer or winter biogenic emissions, output from <command>Rawbio</command></entry>
</row>
<row>
<entry><envar>GSPRO</envar></entry>
<entry>ASCII</entry>
<entry>Speciation profiles file</entry>
</row>
<row>
<entry><envar>GRIDDESC</envar></entry>
<entry>ASCII</entry>
<entry>Description of the modeling grid</entry>
</row>
<row>
<entry><envar>MET_FILE1</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Meteorology file containing temperature and surface pressure data and possibly radiation/cloud data as well (see <envar>BIOMET_SAME</envar> environment variable)</entry>
</row>
<row>
<entry><envar>MET_FILE2</envar> (optional)</entry>
<entry>I/O API netCDF</entry>
<entry>Meteorology file containing radiation/cloud data if not in <envar>MET_FILE1</envar></entry>
</row>
<row>
<entry><envar>GRID_CRO_2D</envar> (optional)</entry>
<entry>I/O API netCDF</entry>
<entry>Meteorology file containing latitude and longitude coordinates for each grid cell</entry>
</row>
<row>
<entry><envar>BIOSEASON</envar> (optional)</entry>
<entry>I/O API netCDF</entry>
<entry>Gridded seasonal switch file containing daily data, with “0” meaning use winter normalized emissions and “1” meaning use summer normalized emissions, produced by <command>Metscan</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section>

<title>Input Environment Variables</title>

<itemizedlist>
<listitem>
<para><envar>BG_CLOUD_TYPE</envar>: [default: 1]</para>

<para>Specifies which meteorological data to use.</para>

<itemizedlist>
<listitem>
<para>1: Use RGND or RSD (solar radiation reaching the ground) from MM5 to calculate PAR</para>
</listitem>
<listitem>
<para>2: Use MM5 Kuo cloud fractions and surface pressure data to calculate PAR (untested)</para>
</listitem>
<listitem>
<para>3: Use MM5 Kain-Fritsch cloud fractions and surface pressure data to calculate PAR (untested)</para>
</listitem>
<listitem>
<para>4: Use MM5 cloud fractions with no deep convection parameterization and surface pressure data to calculate PAR (untested)</para>
</listitem>
<listitem>
<para>5: Assume clear skies when calculating PAR; need <envar>GRID_CRO_2D</envar> file (latitude-longitude coordinates) for solar zenith angle calculation</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>BIOG_SPRO</envar>: [default: 0000]</para>

<para>Specifies the speciation profile for biogenic emissions from <envar>GSPRO</envar>.</para>
</listitem>
<listitem>
<para><envar>BIOMET_SAME</envar>: [default: N]</para>

<para>Indicates whether the radiation/cloud data are in the same file as the temperature data (<envar>MET_FILE1</envar>) or a different file (<envar>MET_FILE2</envar>).</para>
</listitem>
<listitem>
<para><envar>BIOSW_YN</envar>: [default: TRUE]</para>

<para>Indicates whether to input a gridded seasonal switch file.</para>
</listitem>
<listitem>
<para><envar>OUTZONE</envar>: See description in <xref linkend="sect_programs_premobl_envar" /></para>
</listitem>
<listitem>
<para><envar>PRES_VAR</envar>: [default: PRSFC]</para>

<para>Specifies the variable name for surface pressure data to extract from <envar>MET_FILE1</envar>.</para>
</listitem>
<listitem>
<para><envar>RAD_VAR</envar>: [default: RGRND]</para>

<para>Specifies the variable name for radiation/cloud data to extract from either <envar>MET_FILE1</envar> or optional <envar>MET_FILE2</envar>.</para>
</listitem>
<listitem>
<para><envar>TMPR_VAR</envar>: [default: TA]</para>

<para>Specifies the variable name for temperature data to extract from <envar>MET_FILE1</envar>.</para>
</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>BGTS_L</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Gridded, speciated, hourly biogenic emissions, in moles/hour</entry>
</row>
<row>
<entry><envar>BGTS_S</envar></entry>
<entry>I/O API netCDF</entry>
<entry>Gridded, speciated, hourly biogenic emissions, in tons/hour</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Tmpbio</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

<section>

<title>Earlier Versions</title>

<para>The SMOKE prototype version of <command>Tmpbio</command> supported only UAM-BEIS2 processing for the CB-IV mechanism. The prototype <command>Tmpbio</command> also allowed National Weather Service observational data to be used in estimating emissions; this option is no longer available due to lack of interest. Regarding the <envar>BG_CLOUD_TYPE</envar> environment variable, options 2, 3, and 4 above that use cloud fraction data have not been fully tested, so we strongly recommend setting <envar>BG_CLOUD_TYPE</envar> to 1. The <envar>OUTZONE</envar> environment variable was not in the prototype version of <command>Tmpbio</command>; the output time zone was the same time zone as the meteorological data. SMOKE v1.2 and earlier versions did not allow the input of a gridded seasonal switch file.</para>

</section>

</section>

</chapter>
