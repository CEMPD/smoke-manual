<?xml version="1.0" encoding="UTF-8"?>

<chapter id="ch_programs">

<title>SMOKE Core Programs</title>

<section>

<title>Overview</title>

<para><xref linkend="fig_programs_core_programs" /> shows the SMOKE core programs and how they relate to each other. We define the core programs as those needed for the actual emissions processing; we exclude QA and utility programs such as <command>Smkreport</command> (these programs are discussed in <xref linkend="ch_quality_assurance" /> and <xref linkend="ch_utilities" />). The lines between the boxes represent one or more files passing between the programs, and show the dependencies among the programs. Note that we have omitted some redundant file dependencies to make the diagram easier to understand. Unless otherwise noted, the SMOKE core programs are applied for the anthropogenic source categories: area-, mobile-, and point-source processing (biogenic processing follows a separate path from the other source categories). When a program that applies to multiple source categories is used, it can be run for only one source category at a time, with the exception of <command>Smkmerge</command> and <command>Mrggrid</command>.</para>

<figure id="fig_programs_core_programs">
<title>SMOKE core programs</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/core_programs_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/core_programs_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para>The <link linkend="sect_programs_smkinven"><command>Smkinven</command></link> program, at left in <xref linkend="fig_programs_core_programs" />, is responsible for importing the stationary area/non-point, nonroad, on-road mobile, and point source inventory emissions data. For mobile sources, <command>Smkinven</command> can also import activity data in the form of VMT and vehicle speed for use in generating emission factors. For point sources, <command>Smkinven</command> can also import day- and hour-specific data. The output from <command>Smkinven</command> is used as input to nearly every other core SMOKE program.</para>

<para>Also at left, the <link linkend="sect_programs_normbeis3"><command>Normbeis3</command></link> program imports the gridded land use data and biogenic emissions factors ,and creates gridded, normalized (time-independent) biogenic emissions.</para>

<para><link linkend="sect_programs_grdmat"><command>Grdmat</command></link> creates the gridding matrix for the anthropogenic source categories.</para>

<para>The <link linkend="sect_programs_temporal"><command>Temporal</command></link> program is used to create an hourly emissions file for the anthropogenic source categories. It can read in day-specific and hour-specific data, and merge this with estimated daily and hourly data created from the annual emissions data using temporal profiles.</para>

<para><link linkend="sect_programs_elevpoint"><command>Elevpoint</command></link> preprocesses the selected PinG and major point sources. <command>Elevpoint</command> is not used when no PinG or major point sources need to be defined. In this case, SMOKE can create elevated emissions for all point sources, so there is no need to specifically indicate the major point sources.</para>

<para><link linkend="sect_programs_laypoint"><command>Laypoint</command></link> computes the plume rise for all point sources based on the meteorology data.</para>

<para><link linkend="sect_programs_spcmat"><command>Spcmat</command></link> creates the speciation matrices (both mass and molar) for the anthropogenic source categories. It uses the user-selected chemical mechanism.</para>

<para><link linkend="sect_programs_cntlmat"><command>Cntlmat</command></link> creates the growth matrices, multiplicative control matrices, and reactivity control matrices for the anthropogenic source categories. This program is not used for base-year emissions without controls.</para>

<para><link linkend="sect_programs_grwinven"><command>Grwinven</command></link> is used to grow the emissions to past or future years using the growth matrix created by <command>Cntlmat</command> and the imported inventory data from <command>Smkinven</command>. It writes both SMOKE inventory format (I/O API NetCDF) and ORL format. The output from <command>Grwinven</command> is used in place of the original output from <command>Smkinven</command> when processing past or future years.</para>

<para><link linkend="sect_programs_tmpbeis3"><command>Tmpbeis3</command></link> applies meteorology adjustments to the normalized emissions created by <command>Normbeis3</command>.  <command>Tmpbeis3</command> also applies the speciation profiles needed for the user-selected chemical mechanism to create gridded, hourly, model-species biogenic emissions data for use in <command>Smkmerge</command> and <command>Mrggrid</command>. The <command>Normbeis3</command> and <command>Tmpbeis3</command> programs taken together are the equivalent of SMOKE-BEIS3.</para>

<para><link linkend="sect_programs_smkmerge"><command>Smkmerge</command></link> is used to combine all emissions and matrices to create the gridded, hourly, model-species emissions needed for an AQM. It can merge for one source category at a time or all source categories at once, and it can read in the model-ready biogenic emissions to merge with the anthropogenic source categories. It can merge the matrices with the inventory data output from <command>Smkinven</command> or the hourly emissions from <command>Temporal</command>, and it can optionally merge the speciation, gridding, or control matrices, or any combination. It also writes state and county emissions totals.</para>

<para><link linkend="sect_programs_movesmrg"><command>Movesmrg</command></link> is only used for mobile sources to compute hourly emissions using the hourly VMT from <command>Temporal</command>, the MOVES emission rates lookup tables (i.e., RPD, RPH, RPV and RPP), the gridded/averaged temperatures meteorology data and more. If VMT are not used, then the emissions from <command>Smkinven</command> are combined with the temporal factors, and the emission factors are not used at all.</para>

<para>In the remaining sections of this chapter, we provide detailed program descriptions, in alphabetic order.</para>


<para><link linkend="sect_programs_mrgelev"><command>Mrgelev</command></link> is used to combine ASCII elevated files created by <command>Smkmerge</command>. These files contain point-source data needed by AQMs including CAMx and UAM models.</para>

<para><link linkend="sect_programs_mrggrid"><command>Mrggrid</command></link> is used to combine gridded emission data files, which can be speciated or non-speciated, and hourly or time-independent. It can combine a 3-D point source file with any number of 2-D files from other source categories. This program is optional and provides a convenient way to merge model-ready output files outside of <command>Smkmerge</command>.</para>

<para><link linkend="sect_programs_mrgpt"><command>Mrgpt</command></link> is used to combine multiple point sources inline-mode hourly speciated emission data and ASCII elevated files created by <command>Smkmerge</command>. This program is optional and allows the users to process multiple point sources separately in inline mode through <command>Smkmerge</command> prior to merging them for CMAQ model.</para>

</section>

<section id="sect_programs_cntlmat">

<title><command>Cntlmat</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> area, mobile, point</para>

<para>The <command>Cntlmat</command> program uses control packets to create a growth matrix, and/or a multiplicative control matrix, and/or a reactivity control matrix. <command>Cntlmat</command> allows seven different control packet types: /MACT/, /CONTROL/, /EMS_CONTROL/, /CTG/, /ALLOWABLE/, /REACTIVITY/, and /PROJECTION/. The format of each packet type is given in <xref linkend="sect_input_gcntl" />.</para>

<itemizedlist>
<listitem>
<para>Growth matrix - This contains past- or future-year growth factors for all sources. <comment>If desired, <command>Cntlmat</command> can grow multiple inventory years to a single modeling year. The /PROJECTION/ packet contains the year for which the growth factors apply and contains both a <quote>to year</quote> and a <quote>from year</quote>. Using a series of these packets, inventory records from different years can be grown to a single year. <command>Cntlmat</command> supports multiple-year growth for area, mobile, and point sources.</comment></para>
</listitem>
<listitem>
<para>Multiplicative control matrix - This matrix contains the combination of various types ofcontrols typically used in emissions processing: CTG, MACT, RACT, control efficiency, rule effectiveness, rule penetration, allowable emissions, and caps. The logic used when applying this matrix is described below this bulleted list. </para>
</listitem>
<listitem>
<para>Reactivity matrix - This matrix contains the information needed for applying reactivity controls.</para>
</listitem>
</itemizedlist>

<section>

<title>Application Logic for the Multiplicative Control Matrix</title>

<para>The multiplicative matrix is built from entries in four packets: /MACT/, /CONTROL/ or /EMS_CONTROL/, /CTG/, and /ALLOWABLE/. The packets are applied in the following order:</para>

<itemizedlist>
<listitem>
<para>/MACT/</para>
</listitem>
<listitem>
<para>/CONTROL/ or /EMS_CONTROL/ (cannot use both at same time)</para>
</listitem>
<listitem>
<para>/CTG/</para>
</listitem>
<listitem>
<para>/ALLOWABLE/</para>
</listitem>
</itemizedlist>

<para>With the exception of the /CONTROL/ packet, all controls are always applied in addition to one another.</para>

<section>

<title>/MACT/ packet</title>

<para>The /MACT/ packet is designed to support the primary MACT controls needed for toxics processing. It is applied first, and uses the following logic. When a source is found that matches a /MACT/ packet entry (source matching is addressed in <xref linkend="sect_programs_cntlmat_source_match" />), <command>Cntlmat</command> first calculates a inventory efficiency value (Eff<subscript>inv</subscript>) for that source based on the control efficiency (C<subscript>eff</subscript>), rule effectiveness (R<subscript>eff</subscript>), and rule penetration (R<subscript>pen</subscript>) provided in the inventory:</para>

<para>Eff<subscript>inv</subscript> = C<subscript>eff</subscript> [inventory] x R<subscript>eff</subscript> [inventory] x R<subscript>pen</subscript> [inventory]</para>

<para>Next, a control factor is calculated for existing sources (Fac<subscript>exist</subscript>) using the control efficiency of existing sources (Eff<subscript>exist</subscript>) and fraction of new sources (Frac<subscript>new</subscript>) provided in the /MACT/ packet entry. If Eff<subscript>exist</subscript> &gt; Eff<subscript>inv</subscript>, then Fac<subscript>exist</subscript> is calculated as:</para>

<para>Fac<subscript>exist</subscript> = (1 - Frac<subscript>new</subscript>) x ((1 - Eff<subscript>exist</subscript>) / (1 - Eff<subscript>inv</subscript>))</para>

<para>Otherwise,</para>

<para>Fac<subscript>exist</subscript> = (1 - Frac<subscript>new</subscript>)</para>

<para><command>Cntlmat</command> then calculates a control factor for new sources (Fac<subscript>new</subscript>) using the control efficiency of new sources (Eff<subscript>new</subscript>) provided in the /MACT/ packet. If Eff<subscript>new</subscript> &gt; Eff<subscript>inv</subscript>, then</para>

<para>Fac<subscript>new</subscript> = Frac<subscript>new</subscript> x ((1 - Eff<subscript>new</subscript>) / (1 - Eff<subscript>inv</subscript>))</para>

<para>Otherwise,</para>

<para>Fac<subscript>new</subscript> = Frac<subscript>new</subscript></para>

<para>Finally, the new and existing source factors are summed to compute the final /MACT/ packet control factor (Fac<subscript>MACT</subscript>).</para>

<para>Fac<subscript>MACT</subscript> = Fac<subscript>exist</subscript> + Fac<subscript>new</subscript></para>

<para>The /MACT/ packet is designed to be used only for sources with MACT codes, currently nonpoint and point toxic sources.</para>

</section>

<section>

<title>/CONTROL/ packet</title>

<para>After processing the /MACT/ packet, the /CONTROL/ packet is applied using the following logic. Each entry in the /CONTROL/ packet can be identified as <quote>replacement</quote> or <quote>additive</quote>. If set to <quote>replace</quote>, the /CONTROL/ entry will be used to replace the controls from the /MACT/ packet or the base-year inventory controls; otherwise, the control will be applied in addition to the controls from the /MACT/ packet or the base-year inventory controls.  When the controls are replaced, the default behaviour of <command>Cntlmat</command> is to back out the existing controls and apply the replacement controls.  Usually, users want to do this only when the replacement controls are more stringent (i.e., a greater reduction) than the /MACT/ packet or base-year controls - so this is the default behaviour of <command>Cntlmat</command>.  This default behaviour can be changed by setting the value of <envar>COMPARE_REPLACE_CONTROL</envar> to "N" in your run script. In this case, the replacement controls will be applied regardless of the existing controls from the base invetory or the /MACT/ packet, which could result in increased emissions. </para>

<para>When an <quote>additive</quote> entry is matched to a source, the /CONTROL/ packet factor (Fac<subscript>CONTROL</subscript>) the control packet information is applied in addition to the exitsing controls, which further reduce the remaining emissions.</para>

<para>For <quote>additive</quote> control packet entries, the control factors are calculated from the control efficiency, rule effectiveness, and rule penetration values provided in the /CONTROL/ packet entry as follows:</para>

<para>Fac<subscript>CONTROL</subscript> = (1 - C<subscript>eff</subscript> [packet] x R<subscript>eff</subscript> [packet] x R<subscript>pen</subscript> [packet])</para>

<para>A cumulative control factor Fac<subscript>result</subscript> is then calculated by multiplying Fac<subscript>Existing</subscript> x Fac<subscript>CONTROL</subscript>.</para>

<para>In the case of <quote>additive</quote> controls only, The overall reduction factor is then used to calculate an overall new control efficiency to be put in any resulting inventory files as: C<subscript>eff</subscript> [result] = 1 - Fac<subscript>result </subscript>.  The final Rule Penetration and Rule Effectiveness values are then set to 100%.</para>

<para>For <quote>replacement</quote> entries, <command>Cntlmat</command> first <quote>backs out</quote> the existing controls provided in the inventory from the control values provided in the /CONTROL/ packet entry as follows:</para>

<para>D = (1 - C<subscript>eff</subscript> [inventory] x R<subscript>eff</subscript> [inventory] x R<subscript>pen</subscript> [inventory])</para>

<para>If D = 0.0, then the backout value, B, is equal to 0; otherwise, B = 1/D. Using this backout value, the /CONTROL/ factor is calculated as</para>

<para>Fac<subscript>CONTROL</subscript> = B x (1 - C<subscript>eff</subscript> [packet] x R<subscript>eff</subscript> [packet] x R<subscript>pen</subscript> [packet])</para>

<para>Unlike <quote>additive</quote> entries, the Fac<subscript>CONTROL</subscript> value for <quote>replacement</quote> entries replaces the factor calculated from the /MACT/ packet or  base year inventory (if any). The /CONTROL/ packet can be applied to stationary area/nonpoint, nonroad, on-road mobile, and point sources. On-road mobile source inventories do not include control efficiency, rule effectiveness, or rule penetration fields. However, the /CONTROL/ packet can still be used to apply adjustment factors to mobile sources. In this case, B in the above formula will be 1 when computing factor Fac<subscript>CONTROL</subscript> that is applied to the emissions.</para>

</section>

<section>

<title>/CTG/ packet</title>

<para>The /CTG/ packet is processed next, as follows. The emission value (after application of /MACT/, /CONTROL/, and/or /EMS CONTROL/) is compared to the cutoff value specified as part of the /CTG/ packet record. If the emission value exceeds the cutoff value, then the control technology factor is applied to the emissions. If the resulting emissions value still exceeds the cutoff value, then either the MACT <emphasis>or</emphasis> the RACT factor is used. The MACT factor is used if it is defined (i.e., greater than zero); if it is not defined (less than or equal to zero), then the RACT factor is used. If neither the MACT nor RACT are defined, but the emissions are still greater than the cutoff, then the emissions are set to the cutoff value.</para>

</section>

<section>

<title>/ALLOWABLE/ packet</title>

<para>Finally, the /ALLOWABLE/ packet is processed. The entries in this packet override the /MACT/, /CONTROL/, /EMS CONTROL/, and /CTG/ packets. The way this packet is applied depends on whether or not the Cap and Replace values in the packet are defined (greater than zero).</para>

<itemizedlist>
<listitem>
<para>If the Cap value is defined, <command>Cntlmat</command> compares the inventory emissions value to the Cap value, and sets a control factor, using the following procedure: If both the Cap and Replace values are defined, this control factor is the Replace value divided by the original emissions value. If only the Cap value is defined, the factor is the Cap value divided by the original emissions value.</para>
</listitem>
<listitem>
<para>If the Cap value is not defined, then the factor is the Replace value divided by the original emissions value.</para>
</listitem>
<listitem>
<para>If neither the Cap nor Replace values are defined, the packet entry is invalid and is ignored.</para>
</listitem>
</itemizedlist>

</section>

</section>

<section id="sect_programs_cntlmat_source_match">

<title>Source Matching Hierarchy</title>

<para>To match each sources with the appropriate control packet entry, <command>Cntlmat</command> uses a hierarchy of source characteristics, trying to match each source to the most specific control packet entry. Note that not all combinations are applicable to all control packets (for example, there is no MACT code associated with the /PROJECTION/ packet). <quote>Left <emphasis>x</emphasis> of SCC</quote> refers to an 8- or 10-digit SCC with all digits except the first <emphasis>x</emphasis> set to 0. <quote>Left 2 of SIC code</quote> refers to a 4-digit SIC code with the third and fourth digits set to 0. The maximum field width in SMOKE and its input files for SCC is 20 characters as of SMOKE v4.0. The 8 or 10 digit SCC are still supported, but if the SCC is greater than 10 digits the SCC hierarchial approach will not be supported. The SIC may also be up to 20 characters in length, but if the SIC is larger than 4 characters then the hierarchial approach will not be used.</para>

<para>For point sources, the following hierarchy is used, in order of most specific to least specific. (NOTE: only for SCC less than or equal to 10 characters and SIC less than or equal to 4 characters) </para>

<orderedlist spacing="compact">
<listitem>
<para>Country/State/County code, plant ID, point ID, stack ID, segment ID, 8-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, plant ID, point ID, stack ID, segment ID, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, plant ID, point ID, stack ID, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, plant ID, point ID, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, plant ID, 8-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, plant ID, MACT code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, plant ID, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, plant ID, point ID, stack ID, segment ID, 8-digit SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, plant ID, point ID, stack ID, segment ID</para>
</listitem>
<listitem>
<para>Country/State/County code, plant ID, point ID, stack ID</para>
</listitem>
<listitem>
<para>Country/State/County code, plant ID, point ID</para>
</listitem>
<listitem>
<para>Country/State/County code, plant ID, 8-digit SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, plant ID, MACT code</para>
</listitem>
<listitem>
<para>Country/State/County code, plant ID</para>
</listitem>
<listitem>
<para>Country/State/County code, MACT code, 8-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, MACT code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, MACT code, 8-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, MACT code, pollutant</para>
</listitem>
<listitem>
<para>MACT, 8-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>MACT, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, MACT code, 8-digit SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, MACT code</para>
</listitem>
<listitem>
<para>Country/State code, MACT code, 8-digit SCC code</para>
</listitem>
<listitem>
<para>Country/State code, MACT code</para>
</listitem>
<listitem>
<para>MACT code, 8-digit SCC code</para>
</listitem>
<listitem>
<para>MACT code</para>
</listitem>
<listitem>
<para>Country/State/County code, 4-digit SIC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, left 2 of SIC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, 4-digit SIC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, left 2 of SIC code, pollutant</para>
</listitem>
<listitem>
<para>4-digit SIC code, pollutant</para>
</listitem>
<listitem>
<para>Left 2 of SIC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, 4-digit SIC code</para>
</listitem>
<listitem>
<para>Country/State/County code, left 2 of SIC code</para>
</listitem>
<listitem>
<para>Country/State code, 4-digit SIC code</para>
</listitem>
<listitem>
<para>Country/State code, left 2 of SIC code</para>
</listitem>
<listitem>
<para>4-digit SIC code</para>
</listitem>
<listitem>
<para>Left 2 of SIC code</para>
</listitem>
<listitem>
<para>Country/State/County code, 8-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, left 6 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, left 3 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, left 1 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, 8-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, left 6 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, left 3 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, left 1 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>8-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Left 6 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Left 3 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Left 1 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, 8-digit SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, left 6 of SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, left 3 of SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, left 1 of SCC code</para>
</listitem>
<listitem>
<para>Country/State code, 8-digit SCC code</para>
</listitem>
<listitem>
<para>Country/State code, left 6 of SCC code</para>
</listitem>
<listitem>
<para>Country/State code, left 3 of SCC code</para>
</listitem>
<listitem>
<para>Country/State code, left 1 of SCC code</para>
</listitem>
<listitem>
<para>8-digit SCC code</para>
</listitem>
<listitem>
<para>Left 6 of SCC code</para>
</listitem>
<listitem>
<para>Left 3 of SCC code</para>
</listitem>
<listitem>
<para>Left 1 of SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code</para>
</listitem>
<listitem>
<para>Country/State code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code</para>
</listitem>
<listitem>
<para>Pollutant</para>
</listitem>
</orderedlist>

<para>For nonpoint/stationary area sources, the following hierarchy is used. The maximum field width in SMOKE and its input files for SCC is 20 characters as of SMOKE v4.0. The 8 or 10 digit SCC are still supported, but if the SCC is greater than 10 digits the SCC hierarchial approach will not be supported. The SIC may also be up to 20 characters in length, but if the SIC is larger than 4 characters then the hierarchial approach will not be used.  Nonpoint SCCs can have either 8 or 10 digits, which is why there are two separate SCC levels mentioned for each of the SCC-based assignments.(NOTE: hierarchial approach is only for SCC less than or equal to 10 characters and SIC less than or equal to 4 characters)</para>

<orderedlist spacing="compact">
<listitem>
<para>Country/State/County code, MACT code, 8- or 10-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, MACT code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, MACT code, 8- or 10-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, MACT code, pollutant</para>
</listitem>
<listitem>
<para>MACT code, 8- or 10-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>MACT code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, MACT code, 8- or 10-digit SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, MACT code</para>
</listitem>
<listitem>
<para>Country/State code, MACT code, 8- or 10-digit SCC code</para>
</listitem>
<listitem>
<para>Country/State code, MACT code</para>
</listitem>
<listitem>
<para>MACT code, 8- or 10-digit SCC code</para>
</listitem>
<listitem>
<para>MACT code</para>
</listitem>
<listitem>
<para>Country/State/County code, 4-digit SIC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, left 2 of SIC code, pollutant </para>
</listitem>
<listitem>
<para>Country/State code, 4-digit SIC code, pollutant </para>
</listitem>
<listitem>
<para>Country/State code, left 2 of SIC code, pollutant</para>
</listitem>
<listitem>
<para>4-digit SIC code, pollutant</para>
</listitem>
<listitem>
<para>Left 2 of SIC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, 4-digit SIC code</para>
</listitem>
<listitem>
<para>Country/State/County code, left 2 of SIC code</para>
</listitem>
<listitem>
<para>Country/State code, 4-digit SIC code</para>
</listitem>
<listitem>
<para>Country/State code, left 2 of SIC code</para>
</listitem>
<listitem>
<para>4-digit SIC code</para>
</listitem>
<listitem>
<para>Left 2 of SIC code</para>
</listitem>
<listitem>
<para>Country/State/County code, 8- or 10-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, left 6 or left 7 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, left 3 or left 4 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, left 1 or left 2 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, 8- or 10-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, left 6 or left 7 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, left 3 or left 4 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, left 1 or left 2 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>8- or 10-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Left 6 or left 7 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Left 3 or left 4 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Left 1 or left 2 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, 8- or 10-digit SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, left 6 or left 7 of SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, left 3 or left 4 of SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, left 1 or left 2 of SCC code</para>
</listitem>
<listitem>
<para>Country/State code, 8- or 10-digit SCC code</para>
</listitem>
<listitem>
<para>Country/State code, left 6 or left 7 of SCC code</para>
</listitem>
<listitem>
<para>Country/State code, left 3 or left 4 of SCC code</para>
</listitem>
<listitem>
<para>Country/State code, left 1 or left 2 of SCC code</para>
</listitem>
<listitem>
<para>8- or 10-digit SCC code</para>
</listitem>
<listitem>
<para>Left 6 or left 7 of SCC code</para>
</listitem>
<listitem>
<para>Left 3 or left 4 of SCC code</para>
</listitem>
<listitem>
<para>Left 1 or left 2 of SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code</para>
</listitem>
<listitem>
<para>Country/State code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code</para>
</listitem>
<listitem>
<para>Pollutant</para>
</listitem>
</orderedlist>

<para>On-road mobile and nonroad sources are matched to the control packet entries using the following hierarchy if the SCC length is less than 10 characters. As of SMOKE v4.0 the SCC character length may be up to 20 characters in length:(NOTE: this hierarchial approach is only for SCC less than or equal to 10 characters and SIC less than or equal to 4 characters)</para>

<orderedlist spacing="compact">
<listitem>
<para>Country/State/County code, 10-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, left 7 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, left 4 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, left 2 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, 10-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, left 7 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, left 4 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code, left 2 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>10-digit SCC code, pollutant</para>
</listitem>
<listitem>
<para>Left 7 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Left 4 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Left 2 of SCC code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code, 10-digit SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, left 7 of SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, left 4 of SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, left 2 of SCC code</para>
</listitem>
<listitem>
<para>Country/State code, 10-digit SCC code</para>
</listitem>
<listitem>
<para>Country/State code, left 7 of SCC code</para>
</listitem>
<listitem>
<para>Country/State code, left 4 of SCC code</para>
</listitem>
<listitem>
<para>Country/State code, left 2 of SCC code</para>
</listitem>
<listitem>
<para>10-digit SCC code</para>
</listitem>
<listitem>
<para>Left 7 of SCC code</para>
</listitem>
<listitem>
<para>Left 4 of SCC code</para>
</listitem>
<listitem>
<para>Left 2 of SCC code</para>
</listitem>
<listitem>
<para>Country/State/County code, pollutant</para>
</listitem>
<listitem>
<para>Country/State/County code</para>
</listitem>
<listitem>
<para>Country/State code, pollutant</para>
</listitem>
<listitem>
<para>Country/State code</para>
</listitem>
<listitem>
<para>Pollutant</para>
</listitem>
</orderedlist>

</section>

</section>

<section>

<title>Processing Order</title>

<para><command>Smkinven</command> must be executed before <command>Cntlmat</command>.</para>

<para><command>Cntlmat</command> must be executed before <command>Smkmerge</command>. <command>Cntlmat</command> also needs to be run prior to the <command>Grwinven</command> program, which requires at least one growth or control matrix to be run.</para>

<para><command>Cntlmat</command> is an optional program that needs to be run only when controlled emissions are needed for the AQM.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_cntlmat">
<title><command>Cntlmat</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/cntlmat_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/cntlmat_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_cntlmat" /> shows the input and output files for the <command>Cntlmat</command> program. The input files are the inventory file output from <command>Smkinven</command> (either <envar>AREA</envar>, <envar>MOBL</envar>, or <envar>PNTS</envar>), the control packets file (<envar>GCNTL</envar>), and the speciation profiles file (<envar>GSPRO</envar>) if there are reactivity controls (using the /REACTIVITY/ packet).</para>

<para>If the <envar>GCNTL</envar> file contains /MACT/, /CONTROL/ or /EMS_CONTROL/, /CTG/, and/or /ALLOWABLE/ packets, <command>Cntlmat</command> outputs a multiplicative control matrix file (<envar>ACMAT</envar>, <envar>MCMAT</envar>, or <envar>PCMAT</envar>), a report of multiplicative controls (<envar>ACREP</envar>, <envar>MCREP</envar>, or <envar>PCREP</envar>), and a report of all multiplicative controls applied to the inventory (<envar>ACSUMREP</envar>, <envar>MCSUMREP</envar>, or <envar>PCSUMREP</envar>). <command>Cntlmat</command> also outputs a warning file (<envar>ACTLWARN</envar>, <envar>MCTLWARN</envar>, or <envar>PCTLWARN</envar>) regardless of which packets are used.</para>

<para>If the <envar>GCNTL</envar> file contains a /PROJECTION/ packet, <command>Cntlmat</command> outputs a growth matrix file (<envar>APMAT</envar>, <envar>MPMAT</envar>, or <envar>PPMAT</envar>) and a growth report (<envar>APROJREP</envar>, <envar>MPROJREP</envar>, or <envar>PPROJREP</envar>).</para>

<para>If the <envar>GCNTL</envar> file contains a /REACTIVITY/ packet, <command>Cntlmat</command> outputs mole and mass-based reactivity matrix files (either <envar>ARMAT_L</envar> and <envar>ARMAT_S</envar>, <envar>MRMAT_L</envar> and <envar>MRMAT_S</envar>, or <envar>PRMAT_L</envar> and <envar>PRMAT_S</envar>), a reactivity matrix supplement file (<envar>ARSUP</envar>, <envar>MRSUP</envar>, or <envar>PRSUP</envar>), and a report of reactivity controls (<envar>AREACREP</envar>, <envar>MREACREP</envar>, or <envar>PREACREP</envar>). Finally, <command>Cntlmat</command> writes the <envar>LOGFILE</envar> detailing the program&rsquo;s execution.</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name*</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[AREA|MOBL|PNTS]</envar></entry>
<entry>SMOKE map</entry>
<entry>Intermediate inventory file produced by <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>GCNTL</envar></entry>
<entry>ASCII</entry>
<entry>Control packets file</entry>
</row>
<row>
<entry><envar>GSPRO</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Speciation profiles file; only needed for reactivity controls</entry>
</row>
</tbody>
</tgroup>
</informaltable>

<para>* As in <xref linkend="fig_programs_cntlmat" />, the notation <envar>[AREA|MOBL|PNTS]</envar> is used to indicate that only one of the three files is used for a given run.</para>

<para>The physical file name of the input file <envar>GCNTL</envar> file is typically overridden by the environment that is running <command>Cntlmat</command>. For example, when running SMOKE from scripts using the Assigns file, the projection factor inputs are available as the <envar>[A|M|P]PROJ</envar> files. So, for instance, the script must set <envar>GCNTL</envar> as <envar>APROJ</envar> (or area-source processing) after the Assigns file has been invoked by the script, but before the <command>Cntlmat</command> program is actually run.</para>

</section>

<section id="sect_programs_cntlmat_envar">

<title>Input Environment Variables</title>


<itemizedlist>
<listitem>
<para><envar>COMPARE_REPLACE_CONTROL:</envar> [default: Y]</para>
<para>Controls the way a replacement control is applied.</para>
    <itemizedlist>
    <listitem>
    <para>Y: When set to Y, Cntlmat compares the overall percent reductions (CEFF * RPEN * REFF) from a replacement control in the CONTROL packet against existing percent reductions (either from the base inventory or from a just-applied /MACT/ packet).  If the packet's reduction is more control (greater reduction) than the existing controls, then it is applied. Otherwise, it is not applied.</para>
    </listitem>
    <listitem>
    <para>N: When set to N, Cntlmat applies replacement controls even if the control is less control than an existing control, which may result in an increase in emissions</para>
    </listitem>
    </itemizedlist>
</listitem>

<listitem>
<para><envar>FULLSCC_ONLY:</envar> [default: N]</para>
<para>Disables any sub-SCC cross-reference assignments that would otherwise be included in the cross-reference hierarchy. For example, the left-7, left-4, and left-2 levels of nonpoint and mobile SCCs would never be used. This is useful when zeros are a natural part of the SCC that the user does not want to assume are present for cross-reference hierarchy purposes. This option affects all Cntlmat input packets that use SCC assignments as part of their hierarchy.</para>
</listitem>

<listitem>
<para><envar>PROJECTION_YR_SPEC:</envar> [default: Y]</para>
<para>Sets whether or not entries in the /PROJECTION/ packet are in year-specific format.</para>
    <itemizedlist>
    <listitem>
    <para>Y: Year-specific format in use</para>
    </listitem>
    <listitem>
    <para>N: Year-specific format not in use</para>
    </listitem>
    </itemizedlist>
</listitem>

<listitem>
<para><envar>REACTIVITY_POL</envar>: [default: VOC]</para>
<para>Sets the pollutant name to use in computing the reactivity matrix.</para>
</listitem>

<listitem>
<para><envar>REPORT_DEFAULTS</envar>: [default: Y]</para>
<para>Defines whether or not the program reports when a source uses the default cross-reference.</para>
    <itemizedlist>
    <listitem>
    <para>Y: List sources in the log file when they use default cross-reference</para>
    </listitem>
    <listitem>
    <para>N: Do not list sources that use the default cross-reference</para>
    </listitem>
    </itemizedlist>
</listitem>

<listitem>
<para><envar>SMK_AVEDAY_YN</envar>: [default: N]</para>
<para>Indicates whether or not to read average day emissions instead of annual emissions from the inventory file.</para>
    <itemizedlist>
    <listitem>
    <para>Y: Read average day emissions</para>
    </listitem>
    <listitem>
    <para>N: Do not read average day emissions, use annual emissions instead</para>
    </listitem>
    </itemizedlist>
</listitem>

<listitem>
<para><envar>SMK_SOURCE</envar>: [default: blank]</para>
<para>Defines the type of sources to be processed. Valid values are</para>
    <itemizedlist>
    <listitem>
    <para>A: Area processing</para>
    </listitem>
    <listitem>
    <para>B: Biogenic processing</para>
    </listitem>
    <listitem>
    <para>M: Mobile processing</para>
    </listitem>
    <listitem>
    <para>P: Point processing</para>
    </listitem>
    </itemizedlist>
</listitem>

<listitem>
<para><envar>SMK_TMPDIR</envar>: [default: <quote>.</quote>]</para>
<para>Sets the path for writing the temporary files needed when processing the /ALLOWABLE/, /CONTROL/, /CTG/, /EMS_CONTROL/, /MACT/, and/or /PROJECTION/ packets (from the <envar>GCNTL</envar> file).</para>
</listitem>

<listitem>
<para><envar>SPEC_OUTPUT</envar>: [default: ALL]</para>
<para>Defines the types of speciation outputs to create.</para>
    <itemizedlist>
    <listitem>
    <para>MASS: Output speciation matrix based on mass</para>
    </listitem>
    <listitem>
    <para>MOLE: Output speciation matrix based on moles</para>
    </listitem>
    <listitem>
    <para>ALL: Output both mass and mole speciation matrices</para>
    </listitem>
    </itemizedlist>
</listitem>

<listitem>
<para><envar>XREF_SICOVERSCC</envar>: [default: Y]</para>
<para>Determines how to deal with packet entries that have both an SCC and SIC</para>
    <itemizedlist>
    <listitem>
    <para>Y: Match sources by SIC before SCC</para>
    </listitem>
    <listitem>
    <para>N: Match sources by SCC before SIC</para>
    </listitem>
    </itemizedlist>
</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name*</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[A|M|P]CMAT</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Multiplicative control matrix</entry>
</row>
<row>
<entry><envar>[A|M|P]CREP</envar></entry>
<entry>ASCII</entry>
<entry>Report of multiplicative controls applied to the inventory</entry>
</row>
<row>
<entry><envar>[A|M|P]CREP2</envar></entry>
<entry>ASCII</entry>
<entry>Detailed before-and-after report of application of the /CONTROL/ packet only, which includes any comments appended to the end of the /CONTROL/ packet entries. These comments can describe the controls being applied with each packet row.  This report then includes the base and future overall percent reductions on a source-by-source basis, and includes the CONTROL packet line-specific comments.</entry>
</row>
<row>
<entry><envar>[A|M|P]CSUMREP</envar></entry>
<entry>ASCII</entry>
<entry>Report of all controls applied to the inventory, with all controls listed under each source</entry>
</row>
<row>
<entry><envar>[A|M|P]CTLWARN</envar></entry>
<entry>ASCII</entry>
<entry>List of warnings</entry>
</row>
<row>
<entry><envar>[A|M|P]PMAT</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Growth matrix</entry>
</row>
<row>
<entry><envar>[A|M|P]PROJREP</envar></entry>
<entry>ASCII</entry>
<entry>Report of growth factors applied to the inventory</entry>
</row>
<row>
<entry><envar>[A|M|P]REACREP</envar></entry>
<entry>ASCII</entry>
<entry>Report of reactivity controls applied to the inventory</entry>
</row>
<row>
<entry><envar>[A|M|P]RMAT_L</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Mole-based reactivity matrix</entry>
</row>
<row>
<entry><envar>[A|M|P]RMAT_S</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Mass-based reactivity matrix</entry>
</row>
<row>
<entry><envar>[A|M|P]RSUP</envar></entry>
<entry>ASCII</entry>
<entry>Reactivity matrix supplemental file</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Cntlmat</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

<para>* As in <xref linkend="fig_programs_cntlmat" />, the notation <envar>[A|M|P]</envar> is used to indicate that only one of the three files is output for a given run.</para>

</section>

</section>

<!--
<section>

<title>Earlier Versions</title>

<para>The SMOKE prototype used separate programs for each type of source. These programs were CTLAMAT for area sources and CTLPMAT for point sources. A version of the control/growth program was not previously available for mobile sources.</para>

<para><command>Cntlmat</command> for SMOKE v1.2 did not have an operational reporting capability. The /MACT/ packet and updated /CONTROL/ and /PROJECTION/ packets were added in SMOKE v2.0.</para>

<para><command>Cntlmat</command> for SMOKE v2.3 supports passing through updated control efficiencies, rule penetrations, and rule effectiveness values to the output intermediate files. These can be subsequently used by Grwinven to include in the output SMOKE inventories created by that program.</para>

<para><command>Cntlmat</command> for SMOKE v2.3 now includes the COMPARE_REPLACE_CONTROL setting for controlling how Replacement controls are implemented (see above)<para>

<para><command>Cntlmat</command> for SMOKE v2.3 has added <envar>[A|M|P]CREP2</envar> report to provide more detailed reporting on controls actually applied to the inventory records.</envar>

</section>
-->

</section>

<section id="sect_programs_elevpoint">

<title><command>Elevpoint</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> point</para>

<para>The <command>Elevpoint</command> program is used to select elevated point sources and to prepare certain input files for special elevated source or PinG processing. <command>Elevpoint</command> selects the major point source (MPS) and major elevated point source emissions (MEPSE) records using a variety of criteria, such as stack parameters, emissions, and analytical plume rise calculations. (Note that MEPSE is another name for a PinG source.)</para>

<para><command>Elevpoint</command> distinguishes PinG sources from non-PinG elevated sources based on emission thresholds, highest day-specific emissions rank compared to other sources, analytical plume rise, and/or stack parameters such as height. <command>Elevpoint</command> flags sources as either elevated or PinG based on instructions given in an input configuration file, the <envar>PELVCONFIG</envar> file. <command>Elevpoint</command> also permits grouping of stacks at the same facility if the stack parameters are similar, within tolerances you specify with the <envar>PELVCONFIG</envar> file; the result is call a <quote>stack group</quote>. For more information on selecting and grouping elevated and PinG sources, refer to <xref linkend="sect_input_pelvconfig" />.</para>

<para><command>Elevpoint</command> can also be used to calculate plume rise using the <quote>cutoff</quote> method. This is the method traditionally used to prepare input files to the air quality models UAM-IV, UAM-V and CAM<subscript>X</subscript>, which require a separate model-ready input file containing emissions for elevated point sources. Below, we refer to this path as the <quote>UAM style</quote> of emissions processing.</para>

<para>For the cutoff method, the <command>Elevpoint</command> program uses the stack parameters of the point sources and estimates the plume rise for each source using a Briggs analytical solution (but not actual gridded meteorology data); the details of this process are given in <xref linkend="sect_programs_elevpoint_briggs" />. <command>Elevpoint</command> then records all of the sources that have an estimated plume rise greater than a specified cutoff as defined in the <envar>PELVCONFIG</envar> file using the <quote>RISE</quote> instruction. Using the <envar>PELVCONFIG</envar> file, this cutoff method can be combined with selection of elevated sources based on stack parameters and/or emissions values.</para>

<para>When emissions values are part of these selection criteria, <command>Elevpoint</command> computes the maximum daily emissions using one or more <envar>PTMP</envar> files. <command>Elevpoint</command> computes the maximum daily value of any pollutant used as a selection criterion across all of the days that you input. You have the option of providing either a list of paths and file names of one or more <envar>PTMP</envar> files, or a single <envar>PTMP</envar> file. The day or days that <command>Elevpoint</command> uses to compute each source&rsquo;s maximum depends on the time zone in which the source resides, based on the county and the <envar>COSTCY</envar> file setting for the time zone (the time zone is stored in the <envar>PNTS</envar> file output from <command>Smkinven</command>). When using emissions values as a selection criterion, <command>Elevpoint</command> only considers sources that are within the grid domain.</para>

<para><command>Elevpoint</command> also creates a report file that contains all SMOKE sources that have been selected as elevated, their source characteristics (including stack parameters), emissions values used as selection criteria, stack-group numbers, status as either elevated or PinG, and which selection criteria were used to assign the status to the source. The report does not include any low-level sources. This report is in semicolon-delimited format for easier reading into a spreadsheet for sorting, review, and making charts.</para>

<para>The <command>Elevpoint</command> program is not needed if the environment variables <envar>SMK_PING_METHOD</envar> and <envar>SMK_ELEV_METHOD</envar> are both set to 0.</para>

<section id="sect_programs_elevpoint_briggs">

<title>Plume rise calculation</title>

<para>The Briggs solution is documented in the following:</para>

<orderedlist>
<listitem>
<para>Briggs, Gary A., 1971: Some Recent Analyses of Plume Rise Observation, pp. 1029-1032 in <emphasis>Proceedings of the Second International Clean Air Congress</emphasis>, edited by H. M. Englun and W. T. Beery. Academic Press, New York.</para>
</listitem>
<listitem>
<para>Briggs, Gary A., 1972: Discussion on Chimney Plumes in Neutral and Stable Surroundings, <emphasis>Atmos. Environ.</emphasis> 6, 507-510.</para>
</listitem>
</orderedlist>

<para>The following formula is used in <command>Elevpoint</command>:</para>

<para>F = 0.25 x G x V<subscript>S</subscript> x D<subscript>S</subscript><superscript>2</superscript> x (T<subscript>S</subscript> - T)/T<subscript>S</subscript></para>

<para>For F less than 55,</para> 

<para>Plume rise = H<subscript>S</subscript> + 21.31311057 x F<superscript>0.75</superscript>/U</para>

<para>Otherwise,</para>

<para>Plume rise = H<subscript>S</subscript> + 38.87776061 x F<superscript>0.6</superscript>/U</para>

<para>where</para>

<itemizedlist>
<listitem>
F = Bouyancy flux (m<superscript>4</superscript>/s<superscript>3</superscript>)
</listitem>
<listitem>
G = Mean gravitational acceleration (9.80665 m/s<superscript>2</superscript>)
</listitem>
<listitem>
V<subscript>S</subscript> = Stack gas exit velocity (m/s)
</listitem>
<listitem>
D<subscript>S</subscript> = Inside stack diameter (m)
</listitem>
<listitem>
T<subscript>S</subscript> = Stack gas temperature (K)
</listitem>
<listitem>
T = Default ambient air temperature (293 K)
</listitem>
<listitem>
U = Default wind speed (2 m/s)
</listitem>
<listitem>
H<subscript>S</subscript> = Physical stack height (m)
</listitem>
</itemizedlist>

<para>This represents an improved algorithm over the original so that the discontinuity at F = 55 no longer exists. Now, the second term in the plume rise formula approaches 595 as F approaches 55 from either side.</para>

</section>

<section>

<title>Summary</title>

<para>In summary, <command>Elevpoint</command> permits the following combinations of source selection and processing:</para>

<itemizedlist>
<listitem>
<para>Identify MEPSE/PinG sources for outputting to special PinG files only (all other point sources will be treated as potentially elevated by <command>Laypoint</command>).</para>
</listitem>
<listitem>
<para>Identify elevated sources (MPSs) with the <envar>PELVCONFIG</envar> file, which might include using the cutoff method alone or in combination with other criteria.</para>
</listitem>
<listitem>
<para>Identify elevated sources (MPSs) and MEPSE/PinG sources with the <envar>PELVCONFIG</envar> file with cutoff method (<command>Laypoint</command> not used) and identify MEPSE/PinG sources with the <envar>PSPLIT</envar> file for outputting to special PinG files.</para>
</listitem>
</itemizedlist>

</section>

</section>

<section>

<title>Processing Order</title>

<para><command>Smkinven</command> must be run for point sources before <command>Elevpoint</command>. If the <envar>PELVCONFIG</envar> file uses emissions as a source-grouping or source-selection criterion, then <command>Temporal</command> must be run before <command>Elevpoint</command>.</para>

<para><command>Elevpoint</command> must be run before <command>Laypoint</command>.</para>

<para><command>Elevpoint</command> must be run before <command>Smkmerge</command> if elevated sources are to be used.</para>

<para><command>Elevpoint</command> is an optional program that is not needed if all of the following criteria are met:</para>

<orderedlist>
<listitem>
<para>A UAM-style model (e.g., UAM, CAM<subscript>X</subscript>) is not being used.</para>
</listitem>
<listitem>
<para>No MEPSE/PinG source processing is required.</para>
</listitem>
<listitem>
<para>You are willing to run <command>Laypoint</command> for all point sources and treat all as <quote>potentially elevated</quote>. In this case, sources that rise above layer 1 will be <quote>elevated</quote> for reporting purposes in <command>Smkreport</command>, but these sources may sometimes be within layer 1 if the plume rise algorithm in <command>Laypoint</command> computes it that way.</para>
</listitem>
</orderedlist>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_elevpoint">
<title><command>Elevpoint</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/elevpoint_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/elevpoint_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_elevpoint" /> shows the input and output files for the <command>Elevpoint</command> program. The input files are the grid description file (<envar>GRIDDESC</envar>), an elevated source configuration file (<envar>PELVCONFIG</envar>), the point-source inventory file output from <command>Smkinven</command> (<envar>PNTS</envar>), and, if the <envar>PELVCONFIG</envar> file selects sources by emissions value or rank, either a list of hourly emissions files output by <command>Temporal</command> (<envar>PTMPLIST</envar>) or an individual hourly emissions file (<envar>PTMP</envar>).</para>

<para><command>Elevpoint</command> outputs a log file (<envar>LOGFILE</envar>), an elevated point source identification file (<envar>PELV</envar>), an elevated and PinG source report (<envar>REPPELV</envar>), and a stack parameters file (<envar>STACK_GROUPS</envar>) if the <envar>PELVCONFIG</envar> file is configured to select stack groups.</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>GRIDDESC</envar></entry>
<entry>ASCII</entry>
<entry>Description of the modeling grid</entry>
</row>
<row>
<entry><envar>PELVCONFIG</envar></entry>
<entry>ASCII</entry>
<entry>Elevated source configuration file</entry>
</row>
<row>
<entry><envar>PNTS</envar></entry>
<entry>SMOKE map</entry>
<entry>Intermediate inventory file produced by <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>PTMP</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Hourly emissions file produced by <command>Temporal</command>; needed only when <envar>PELVCONFIG</envar> specifies emissions as one of the selection or grouping criteria and not using the <envar>PTMPLIST</envar> file</entry>
</row>
<row>
<entry><envar>PTMPLIST</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>List of hourly emissions files produced by <command>Temporal</command>; needed only when <envar>PELVCONFIG</envar> specifies emissions as one of the selection or grouping criteria</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section id="sect_programs_elevpoint_envar">

<title>Input Environment Variables</title>

<itemizedlist>
<listitem>
<para><envar>ELEV_WRITE_FAKE_SRC</envar>: [default: Y]</para>

<para>Defines whether the program needs to add a fake source group or not when there is no an elevated source group to output.</para>

<itemizedlist>
<listitem>
<para>Y: Add a fake source group when there is no an elevated source group to output</para>
</listitem>
<listitem>
<para>N: Do not add a fake source group.</para>
</listitem>
</itemizedlist>
</listitem>


<listitem>
<para><envar>ELEV_WRITE_LATLON</envar>: [default: Y]</para>
<para>Defines whether write the latitude and longitude information of special elevated or PinG sources to the stack groups file <xref linkend="sect_intmed_stack_groups" /> for air quality models CMAQ, and UAM-style.</para>
<itemizedlist>
<listitem>
<para>Y: Write the latitude and longitude information of elevated or PinG sources to the the stack group file.</para>
</listitem>
<listitem>
<para>N: Do not write the latitude and longitude information of elevated or PinG sources to the the stack group file.</para>
</listitem>
</itemizedlist>
<para>The ELEV_WRITE_LATLON can not be N, when processing for PinG sources, since CMAQ does need the latitude and longitude to be included.</para>
</listitem>

<listitem>
<para><envar>G_RUNLEN</envar>: [default: 240000]</para>
<para>Simulation length (HHMMSS)</para>
</listitem>
<listitem>
<para><envar>G_STDATE</envar>: [default: 0]</para>
<para>Starting date of simulation (YYYYDDD)</para>
</listitem>
<listitem>
<para><envar>G_STTIME</envar>: [default: 0]</para>
<para>Starting time of simulation (HHMMSS)</para>
</listitem>
<listitem>
<para><envar>G_TSTEP</envar>: [default: 10000]</para>
<para>Time step (HHMMSS), only 10000 is allowed</para>
</listitem>
<listitem>
<para><envar>IOAPI_ISPH</envar>: [default: 19]</para>
<para>Determines which USGS spheroid to use for grid-based calculations</para>

<itemizedlist spacing="compact">
<listitem>0: Clarke 1866</listitem>
<listitem>1: Clarke 1880</listitem>
<listitem>2: Bessel</listitem>
<listitem>3: New International 1967</listitem>
<listitem>4: International 1909</listitem>
<listitem>5: WGS 72</listitem>
<listitem>6: Everest</listitem>
<listitem>7: WGS 66</listitem>
<listitem>8: GRS 1980</listitem>
<listitem>9: Airy</listitem>
<listitem>10: Modified Everest</listitem>
<listitem>11: Modified Airy</listitem>
<listitem>12: WGS 84</listitem>
<listitem>13: Southeast Asia</listitem>
<listitem>14: Australian National</listitem>
<listitem>15: Krassovsky</listitem>
<listitem>16: Hough</listitem>
<listitem>17: Mercury 1960</listitem>
<listitem>18: Modified Mercury 1968</listitem>
<listitem>19: Normal Sphere</listitem>
</itemizedlist>

<para>This environment variable can also be used to set custom spheroid representations. See the <ulink url="http://www.baronams.com/products/ioapi/SETSPHERE.html">I/O API documentation</ulink> for more information.</para>

</listitem>

<listitem>
<para><envar>SMK_ELEV_METHOD</envar>: [default: 0]</para>

<para>Defines the method to use in SMOKE for determining and processing elevated point sources. The setting chosen depends on the model output format needed from SMOKE. All PinG sources determined based on <envar>SMK_PING_METHOD</envar> will automatically be considered elevated sources (as defined specifically for the model for which you are creating emissions).</para>

<itemizedlist>
<listitem>
<para>0: Treat all sources as potentially elevated, and let the <command>Laypoint</command> program determine which sources are elevated and which are not. This approach is appropriate only for SMOKE output for the CMAQ model.</para>
</listitem>
<listitem>
<para>1: Use the <quote>Elevated</quote> section of the <envar>PELVCONFIG</envar> configuration file to select specific sources. This approach can be used for any of the model output formats - CMAQ and UAM-style.</para>
<para>For UAM-style emissions processing, this environment variable must be set to 1 and the <envar>PELVCONFIG</envar> file will be used to select specific sources. This method of processing is needed for UAM and CAM<subscript>X</subscript> because they require use of the cutoff method discussed earlier. In rare cases of a very small inventory, it might be acceptable to specify 0 for this setting in UAM-style emissions processing, provided that you are sure that treating all sources as elevated sources in UAM-style models is acceptable. We do not recommend such an approach for typical SMOKE applications for UAM-style models.</para>
</listitem>
<listitem>
<para>2: Use the <quote>Elevated</quote> section of the <envar>PELVCONFIG</envar> configuration file to select specific sources. This approach can be used for in-line plume rise in CMAQ. Must set <envar>SMK_PING_METHOD</envar> = 0.</para>
<para>For in-line plume rise processing in CMAQ, this environment variable must be set to 2 and the <envar>PELVCONFIG</envar> file will be used to select specific sources. To reduce the total number of plume rise calculations that would be done in the CMAQ in-line plume rise module, <command>Elevpoint</command> needs to group sources with nearly identical stack parameters. <command>Elevpoint</command> outputs stack group file that identifies elevated source locations and stack parameters for in-line plume rise calculation in CMAQ. See <xref linkend="sect_in-line_model_cmaq" /> for more detail.</para>
<para>When using <command>Smkmerge</command> for in-line plume rise processing, <envar>MRG_LAYERS_YN</envar> must set to N to create hourly speciated 2-D surface layer emissions file. If <envar>SMKMERGE_CUSTOM_OUTPUT</envar> is set to Y, the output file for the in-line emissions is called <envar>INLNST_L</envar>.</para>
<para>To process point fire emission (ptfire sector) without precomputed plume rise described in described in <xref linkend="sect_scripts_hour_day_invs" />.</para>
</listitem>

</itemizedlist>

</listitem>

<listitem>
<para><envar>SMK_PING_METHOD</envar>: [default: 0]</para>

<para>Defines the method to use in determining PinG point sources.</para>

<itemizedlist>
<listitem>
<para>0: No PinG sources</para>
</listitem>
<listitem>
<para>1: Use PinG section of <envar>PELVCONFIG</envar> configuration file</para>
</listitem>
</itemizedlist>

<para>For all models that SMOKE supports use of PinG sources is optional. Some models may have limitations on the number of PinG sources supported, and you must make sure that these limitations are met; SMOKE does not automatically compare with these limitations, if any.</para>

<para>For CMAQ, SMOKE will output a <envar>STACK_GROUPS</envar> file from the <command>Elevpoint</command> program and a <envar>PINGTS_[S|L]</envar> file from the <command>Smkmerge</command> program to support PinG. For UAM-style processing, SMOKE will flag PinG sources in the ASCII elevated file created by <command>Smkmerge</command>, and should be used with the <envar>SMK_ASCIIELEV_YN</envar> option set to Y to create this ASCII elevated file.</para>
</listitem>
<listitem>
<para><envar>SMK_SOURCE</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" /></para>
</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Elevpoint</command></entry>
</row>
<row>
<entry><envar>PELV</envar></entry>
<entry>ASCII</entry>
<entry>Elevated point source identification file</entry>
</row>
<row>
<entry><envar>REPPELV</envar></entry>
<entry>ASCII</entry>
<entry>Reports the sources selected as elevated and PinG, plus other information about the sources, including why they were selected</entry>
</row>
<row>
<entry><envar>STACK_GROUPS</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>PinG and/or elevated sources stack parameters file</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

<!--
<section>

<title>Earlier Versions</title>

<para>This program is an updated version of the <command>Elevpoint</command> program in the SMOKE prototype. The new version creates the <envar>STACK_GROUPS</envar> file for use with plume-in-grid models.</para>

<para>SMOKE versions after 1.3 also include new capabilities for selecting PinG and elevated sources using the <envar>PELVCONFIG</envar> file. Version 1.3 and earlier used the <envar>PSPLIT</envar> and <envar>PGROUP</envar> files, which are no longer supported by <command>Elevpoint</command>. The <envar>PSPLIT</envar> and <envar>PGROUP</envar> files were created manually or using the SMOKE Tool in the Models-3 Framework, but SMOKE versions after 1.3 no longer rely on the SMOKE Tool or users to prepare these files.</para>

<para>The <envar>REPPELV</envar> file did not exist in versions 1.3 and earlier.</para>

</section>
-->

</section>

<section id="sect_programs_grdmat">

<title><command>Grdmat</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> area, mobile, point</para>

<para>The <command>Grdmat</command> program produces the matrix that contains the factors for spatially allocating the emission sources to the modeling domain. </para>

<para>For pre-gridded inventory data, grdmat is used to convert the data from the input data grid (e.g. lat-lon for EDGAR/RCP/HTAP) to the output modeling grid when the user sets IMPORT_GRDNETCDF_YN to Y.  Spatial surrogates (AGPRO or MGPRO) are not needed for processing gridded inventory data with SMOKE.  The input modeling domain information is obtained from the GRIDMASK input file and the output grid is defined by the IOAPI_GRIDNAME_1 environment variable in the GRID_CRO_2D file.</para>

<para>For inventory data that is not already pre-gridded, point sources are assigned to grid cells using the geographic coordinates that are stored in each point-source record. For area and mobile sources, a cross-reference file matches the gridding surrogates to the source-level emissions. When the gridding cross-reference files are applied, the most-specific matches always override the less-specific ones.</para>

<para>For the current version of SMOKE, a gridding surrogates file must be created for the specific grid of interest. This can be accomplished in a variety of ways:</para>

<itemizedlist>
<listitem>
<para>ArcInfo (or other GIS) processing by an expert in creating gridding surrogates.</para>
</listitem>
<listitem>
<para>Using the MIMS Spatial Allocation Tool.</para>
</listitem>
<listitem>
<para>Extracting surrogate data from a larger gridding surrogates file. National 4-km surrogates are available from the EPA at <ulink url="http://www.epa.gov/ttn/chief/emch/spatial/newsurrogate.html" />. To use these data for your modeling, you must use the same grid projection as was used to create the gridding surrogates.</para>
</listitem>
</itemizedlist>

<para>For area sources, the gridding cross-reference file provides the following possible combinations, ordered from most specific to least specific:</para>

<orderedlist spacing="compact">
<listitem>
<para>Country/state/county code and 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state/county code and 7-digit SCC</para>
</listitem>
<listitem>
<para>Country/state code and 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state code and 7-digit SCC</para>
</listitem>
<listitem>
<para>10-digit SCC</para>
</listitem>
<listitem>
<para>7-digit SCC</para>
</listitem>
<listitem>
<para>Country/state/county code</para>
</listitem>
<listitem>
<para>Country/state code</para>
</listitem>
<listitem>
<para>Ultimate default (country/state/county code = 0, SCC = 0)</para>
</listitem>
</orderedlist>

<para>For mobile sources, the available combinations and their order are:</para>

<orderedlist spacing="compact">
<listitem>
<para>Country/state/county code, and 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state code and 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state/county code</para>
</listitem>
<listitem>
<para>Country/state code</para>
</listitem>
<listitem>
<para>10-digit SCC</para>
</listitem>
<listitem>
<para>Ultimate default (country/state/county code = 0, SCC = 0)</para>
</listitem>
</orderedlist>

</section>

<section>

<title>Processing Order</title>

<para><command>Smkinven</command> must be run before <command>Grdmat</command>.</para>

<para><command>Grdmat</command> must be run before gridded emissions may be produced using <command>Smkmerge</command>.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_grdmat">
<title><command>Grdmat</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/grdmat_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/grdmat_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_grdmat" /> shows the input and output files for the <command>Grdmat</command> program. The input files are the spatial surrogates file (<envar>AGPRO</envar> or <envar>MGPRO</envar>), the spatial cross-reference file (<envar>AGREF</envar> or <envar>MGREF</envar>), the inventory file output from <command>Smkinven</command> (<envar>AREA</envar>, <envar>MOBL</envar>, or <envar>PNTS</envar>), the surrogate description file (<envar>SRGDESC</envar>), and the grid description file (<envar>GRIDDESC</envar>).</para>

<para><command>Grdmat</command> outputs a gridding matrix file (<envar>AGMAT</envar>, <envar>MGMAT</envar>, or <envar>PGMAT</envar>) used by other SMOKE programs, and a supplemental gridding file (<envar>AGSUP</envar> or <envar>MGSUP</envar>) that includes all of the spatial surrogate codes assigned to each source. Like all SMOKE programs, <command>Grdmat</command> writes a program log (<envar>LOGFILE</envar>).</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="30*" />
<colspec colwidth="16*" />
<colspec colwidth="54*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>SRGDESC</envar></entry>
<entry>ASCII</entry>
<entry>Surrogate list, description and surrogate file name used in the modeling grid. Note: we recommand to use multiple files for individual surrogate code which are available from the <ulink url="http://www.epa.gov/ttn/chief/emch/spatial/newsurrogate.html">EPA&rsquo;s New Surrogates web site</ulink>.</entry>
</row>
<row>
<entry><envar>SRGPRO_PATH/surrogate-files</envar></entry>
<entry>ASCII</entry>
<entry>Gridding surrogate coefficients</entry>
</row>
<row>
<entry><envar>[A|M]GREF</envar></entry>
<entry>ASCII</entry>
<entry>Gridding surrogate cross-reference file</entry>
</row>
<row>
<entry><envar>[AREA|MOBL|PNTS]</envar></entry>
<entry>SMOKE map</entry>
<entry>Intermediate inventory file produced by <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>GRIDDESC</envar></entry>
<entry>ASCII</entry>
<entry>Description of the modeling grid</entry>
</row>
<row>
<entry><envar>GRIDMASK</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Geographic level code and Timezone for each grid cell</entry>
</row>
<row>
<entry><envar>GRID_CRO_2D</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Layer definitions for the CMAQ model domain</entry>
</row>

</tbody>
</tgroup>
</informaltable>

</section>

<section>

<title>Input Environment Variables</title>

<itemizedlist>

<listitem>
<para><envar>FULLSCC_ONLY</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" />. In this context, this option prevents left-7 SCC assignments using the gridding cross-reference file.</para>
</listitem>
<listitem>
	<para><envar>IOAPI_GRIDNAME_1</envar>: output modeling grid that global gridded inventory data is re-gridded to.</para>
</listitem>
<listitem>
	<para><envar>IOAPI_ISPH</envar>: See description in <xref linkend="sect_programs_elevpoint_envar" /></para>
</listitem>
<listitem>
	<para><envar>IMPORT_GRDNETCDF_YN</envar>: Y to read the native netCDF annual inventory files</para>
</listitem>
<listitem>
<para><envar>REPORT_DEFAULTS</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" /></para>
</listitem>
<listitem>
<para><envar>SRGPRO_PATH</envar>: Defines the location of the Area and Mobile spatial surrogate files. This should be a sub-directory in the <envar>$GE_DAT</envar> directory.</para>
</listitem>
<listitem>
<para><envar>SMK_DEFAULT_SRGID</envar>: [default: 100 (Models-3 population surrogate code)] Mandatory, user MUST choose a fallback code.</para>
</listitem>
<listitem>
<para><envar>SMK_USE_FALLBACK</envar>: [Y/N]  </para>
<para>Defines the surrogate code number to use as a fallback surrogate when the surrogate number set by the cross-reference file would zero out the emissions for that source.  This fallback surrogate is also used to define the county/state/country (FIPS) codes for use in <command>Grdmat</command>; therefore, a fallback surrogate code is mandatory even if the <envar>SMK_USE_FALLBACK</envar> is set to [N]. This code should exist in the <envar>SRGDESC</envar> file and be representative on all county/state/countries.  See description in <xref linkend="sect_input_srgdesc" />.</para>
</listitem>
<listitem>
<para><envar>SMK_SOURCE</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" /></para>
</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[A|M|P]GMAT</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Gridding matrix containing the factors needed to spatially allocate the input emissions to the grid cells in the modeling domain.</entry>
</row>
<row>
<entry><envar>[A|M]GSUP</envar></entry>
<entry>ASCII</entry>
<entry>Gridding supplemental file containing spatial surrogate codes for each source</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Grdmat</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

</section>

<section id="sect_programs_grwinven">

<title><command>Grwinven</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing catagories:</emphasis> area, mobile, point</para>

<para>The <command>Grwinven</command> program grows and controls inventory emissions and activity data into the past/future by merging a SMOKE inventory file (<envar>AREA</envar>, <envar>MOBL</envar>, or <envar>PNTS</envar>) with its respective growth and control matrices. This optional program need not be used if these projections have been made outside of SMOKE. <command>Grwinven</command> outputs new SMOKE I/O API inventory files, but not the corresponding inventory ASCII files (because the program changes the data only in the I/O API inventory files, so there is no need to output the same ASCII files). The program can also output data in ORL format, or be used as a converter from SMOKE to ORL format. <command>Grwinven</command> does not merge the SMOKE inventory with reactivity matrices; this functionality is handled by <command>Smkmerge</command>.</para>

<para>The <command>Grwinven</command> program writes out temporary emissions files when creating an ORL-formatted inventory. You can set the directory to which these temporary files go by setting the <envar>SMK_TMPDIR</envar> environment variable. These files can be quite large; at least 100 MB should be available on the disk to which this environment variable is set.</para>

</section>

<section>

<title>Processing Order</title>

<para><command>Smkinven</command> and <command>Cntlmat</command> must be run before <command>Grwinven</command>.</para>

<para>After running <command>Grwinven</command>, the output can be used similarly to the output from <command>Smkinven</command>. If <command>Spcmat</command> or <command>Grdmat</command> have already been run for a given inventory, these programs do not need to be rerun after running <command>Grwinven</command> because the number and order of the sources in the grown emissions files are the same as in the base case.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_grwinven">
<title><command>Grwinven</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/grwinven_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/grwinven_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_grwinven" /> shows the input and output files for the <command>Grwinven</command> program. The input files include at least one growth or control matrix output from <command>Cntlmat</command> (<envar>ACMAT01</envar>, <envar>MCMAT01</envar>, or <envar>PCMAT01</envar>). If you are applying more than one growth or control matrix (i.e. <envar>SMK_NUM_CNTLMAT</envar> is greater than one), <command>Cntlmat</command> will open additional matrices as needed (<envar>ACMAT[xx]</envar>, <envar>MCMAT[xx]</envar>, or <envar>PCMAT[xx]</envar>). <command>Cntlmat</command> also uses the inventory file output from <command>Smkinven</command> (<envar>AREA</envar>, <envar>MOBL</envar>, or <envar>PNTS</envar>) and the country, state and county file (<envar>COSTCY</envar>).</para>

<para><command>Grwinven</command> outputs new SMOKE intermediate inventory files (<envar>AREA_O</envar>, <envar>MOBL_O</envar>, or <envar>PNTS_O</envar>) that have been controlled and/or grown into the past or future. Note that the suffix _O is used to distinguish the <command>Grwinven</command> output files from the input files. You can also choose to output ASCII inventory files in ORL format (<envar>ARINV_O</envar>, <envar>MBINV_O</envar>, or <envar>PTINV_O</envar>). <command>Grwinven</command> also writes a log file (<envar>LOGFILE</envar>) and can create an ASCII inventory file for activity data (<envar>MBINV_AO</envar>).</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[A|M|P]CMAT_01</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Control or growth matrix output from <command>Cntlmat</command>; total number of files is determined by <envar>SMK_NUM_CTLMAT</envar> setting</entry>
</row>
<row>
<entry><envar>[A|M|P]CMAT_02</envar>, <envar>[A|M|P]CMAT_03</envar>, ...</entry>
<entry>I/O API NetCDF</entry>
<entry>Additional control or growth matrices; total number of files is determined by <envar>SMK_NUM_CTLMAT</envar> setting</entry>
</row>
<row>
<entry><envar>[AREA|MOBL|PNTS]</envar></entry>
<entry>SMOKE map</entry>
<entry>Intermediate inventory file produced by <command>Smkinven</command></entry>
</row>
<row>
<entry><link linkend="sect_input_costcy"><envar>COSTCY</envar></link></entry>
<entry>ASCII</entry>
<entry>Country, state, and county file</entry>
</row>
<row>
<entry><link linkend="sect_input_geocode"><envar>GEOCODE_LEVEL[1-4]</envar></link></entry>
<entry>ASCII</entry>
<entry>Geographical level codes and descriptions for gridded inventories, only when USE_EXP_GEO_CODES is set to Y, (COSTCY is ignored when <link linkend="sect_input_geocode"><envar>GEOCODE_LEVEL[1-4]</envar></link> files are used)</entry>
</row>

</tbody>
</tgroup>
</informaltable>

</section>

<section>

<title>Input Environment Variables</title>

<itemizedlist>
<listitem>
<para><envar>USE_EXP_GEO_CODES</envar>: [default: N]</para>
<para>If set to Y then use GEOCODE_LEVEL[1-4] files instead of the COSTCY file to define expanded geographical detail such as country-level(GEOCODE_LEVEL1), country/state-level (GEOCODE_LEVEL2), country/state/county-level (GEOCODE_LEVEL3) or country/state/county/tribal-level (GEOCODE_LEVEL4).</para>
</listitem>

<listitem>
<para><envar>ORL_NONROAD_OUT</envar>: [default: N]</para>
<itemizedlist>
<listitem>
<para>Y: Output NONROAD inventory in ORL format</para>
</listitem>
<listitem>
<para>N: Do not output NONROAD inventory in ORL format</para>
</listitem>
</itemizedlist>
</listitem>

<listitem>
<para><envar>SMK_GRWORLOUT_YN</envar>: [default: N]</para>

<para>Indicates if an ORL-formatted grown and/or controlled inventory should be output. Currently only ORL nonpoint ond point inventory formats are supported. <envar>SMK_GRWORLOUT_YN</envar> and <envar>SMK_GRWIDAOUT_YN</envar> cannot be both set to Y in the same run.  In SMOKE version 2.3, the Grwinven ORL output format was changed to use a more compact structure (eliminated spaces), uses commas, and includes semi-colons around all text fields. These changes make these files much smaller and easier to import to other software, but unfortunately harder to read in a text editor.</para>

<itemizedlist>
<listitem>
<para>Y: Output inventory in ORL format</para>
</listitem>
<listitem>
<para>N: Do not output inventory in ORL format</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>SMK_GRWSMKOUT_YN</envar>: [default: Y]</para>

<itemizedlist>
<listitem>
<para>Y: Output inventory in SMOKE I/O API format</para>
</listitem>
<listitem>
<para>N: Do not output inventory in SMOKE I/O API format</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>SMK_NUM_CTLMAT</envar>: [default: 1]</para>

<para>Number of control and/or growth matrices to import and apply to the inventory.</para>
</listitem>
<listitem>
<para><envar>SMK_TMPDIR</envar>: [default: <filename class="directory">.</filename>]</para>

<para>Defines the path to use for temporary files that are written out when supplying the inventory.</para>
</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="35*" />
<colspec colwidth="18*" />
<colspec colwidth="47*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[AREA_O|MOBL_O|PNTS_O]</envar></entry>
<entry>SMOKE map</entry>
<entry>Annual and average-day inventory emissions and source characteristics</entry>
</row>
<row>
<entry><envar>[ARINV_O|MBINV_O|PTINV_O]</envar></entry>
<entry>ASCII</entry>
<entry>Annual and average-day inventory emissions and source characteristics</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Grwinven</command></entry>
</row>
<row>
<entry><envar>MBINV_AO</envar></entry>
<entry>ASCII</entry>
<entry>Annual activity inventory and source characteristics</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

<!--
<section>

<title>Earlier Versions</title>

<para><command>Grwinven</command> was updated for SMOKE v2.0 to output SICs for non-point toxic inventories.</para>

<para><command>Grwinven</command> was updated for SMOKE v2.3 to include a more compact ORL output format that is easier to import to other software, but harder to read in a text editor.</para>

</section>
-->

</section>

<section id="sect_programs_laypoint">

<title><command>Laypoint</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> point</para>

<para>The <command>Laypoint</command> program uses the SMOKE point-source inventory file with gridded and hourly meteorology data to compute hourly plume rise for all point sources. The plume rise is expressed in terms of layer fractions for each source.</para>

<para><command>Laypoint</command> is run only for the CMAQ styles of processing, in which all of the plume rise calculations are done prior to input to the AQM. In <command>Laypoint</command>, meteorological data are used to calculate the plume rise for all point sources. Then, the plume is distributed into the vertical layers that the plume intersects based on the pressure in each layer. Only these fractions are stored (not the emissions in each layer), until the SMOKE merge step (<command>Smkmerge</command>). Therefore, the plume rise calculations do not need to be repeated for each control strategy or grid. The <command>Laypoint</command> program calculates the plume rise for all days of each meteorological scenario.</para>

<section id="sect_programs_laypoint_plume_rise_fires">

<title>Plume rise calculation for fires</title>

<para>Regardless whether the heat flux for wildfires is precomputed or internally computed, the Pouliot-Godowitch plume rise algorithm ( http://www.epa.gov/ttn/chief/conference/ei14/session12/pouliot.pdf ) converts the heat flux (Q) to a bouyancy flux (F) for use in the plume rise calculation (Equation 1). Hourly heat flux (Q) can be estimated based upon daily area burned, fuel loading, material burned and a constant default heat content (8000 BTU/lb). See more detail information in <xref linkend="sect_ptfire_emis_cmaq"/>.</para>

<para>To account for a smoldering fraction of the fire emissions, fire plumes are distributed into both the model layers below the plume bottom and into the model layers between the plume top and bottom. The smoldering fraction of the total fire emissions is distributed into the model layer below the plume bottom. The remaining part of emissions are distributed into the model layers between the plume bottom and top.</para>
<para>Equation 2 estimates the plume bouyant efficiency (BE) which is the portion of heat release from a fire that produces bouyancy, using the fire size in acres. The smoldering fraction (S<subscript>fraction</subscript>) of the fire plume is calculated from the BE (Equation 3). All the fire emissions are allocated to the model layers using a weighting based on the hourly sigma-pressure vertical coordinate. These equations are is used in <command>Laypoint</command> when the variable <envar>FIRE_PLUME_YN</envar> is set to Y. More information about processing fire emissions is in <xref linkend="sect_ptfire_emis_cmaq"/>.</para> 

<para> Fire-specific plume rise equations are following:</para> 

<orderedlist>
<listitem>
<para>F = 0.00000258 x Q</para>
</listitem>
<listitem>
<para>BE<subscript>size</subscript> = 0.0703 x ln( <emphasis>acres</emphasis> ) + 0.3</para>
</listitem>
<listitem>
<para>S<subscript>fraction</subscript> = 1 - BE<subscript>size</subscript></para>
</listitem>
</orderedlist>

<para>where</para>
<itemizedlist>
<listitem>
F = Bouyancy flux (m<superscript>4</superscript>/s<superscript>3</superscript>)
</listitem>
<listitem>
Q = Heat flux for fires (BTU/hr)
</listitem>
<listitem>
BE<subscript>size</subscript> = bouyanct efficiency
</listitem>
<listitem>
acres = fire size in acres
</listitem>
<listitem>
S<subscript>fraction</subscript> = smoldering fration
</listitem>
</itemizedlist>

</section>

</section>

<section>

<title>Processing Order</title>

<para>For elevated point sources, <command>Smkinven</command> and <command>Elevpoint</command> must be run before <command>Laypoint</command> if using PinG and/or specific major point sources.</para>

<para><command>Laypoint</command> must be run before elevated sources can be processed using <command>Smkmerge</command>.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_laypoint">
<title><command>Laypoint</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/laypoint_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/laypoint_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_laypoint" /> shows the input and output files for the <command>Laypoint</command> program. The input files include the grid description file (<envar>GRIDDESC</envar>) and meteorology files created by the meteorology preprocessor (<envar>GRID_CRO_3D</envar>, <envar>MET_CRO_2D</envar>, <envar>MET_CRO_3D</envar>, and <envar>MET_DOT_3D</envar>). If elevated sources have been selected, <command>Laypoint</command> uses the the elevated point source identification file output from <command>Elevpoint</command> (<envar>PELV</envar>). Hourly plume data can be read from the <envar>PHOUR</envar> hourly inventory file and annual inventory data is read from the <envar>PNTS</envar> file, both output from <command>Smkinven</command>. When processing fire sources, the <envar>PDAY</envar> file created by <command>Smkinven</command> and the <envar>PTMP</envar> file created by <command>Temporal</command> may be used.</para>

<para><command>Laypoint</command> outputs a log file (<envar>LOGFILE</envar>), hourly plume rise layer fractions for all sources (<envar>PLAY</envar>) or optionally only for explicit sources (<envar>PLAY_EX</envar>), and a report file <envar>REPRTLAY</envar> if reporting is turned on using the <envar>REP_LAYER_MAX</envar> setting.</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>GRIDDESC</envar></entry>
<entry>ASCII</entry>
<entry>Description of the modeling grid</entry>
</row>
<row>
<entry><envar>GRID_CRO_3D</envar> (optional)</entry>
<entry>I/O API NetCDF</entry>
<entry>Meteorology file produced by the meteorology preprocessor; only needed if using static layer information </entry>
</row>
<row>
<entry><envar>MET_CRO_2D</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Meteorology file produced by the meteorology preprocessor </entry>
</row>
<row>
<entry><envar>MET_CRO_3D</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Meteorology file produced by the meteorology preprocessor </entry>
</row>
<row>
<entry><envar>MET_DOT_3D</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Meteorology file produced by the meteorology preprocessor </entry>
</row>
<row>
<entry><envar>PDAY</envar> (optional)</entry>
<entry>I/O API NetCDF</entry>
<entry>Daily point-source inventory file produced by <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>PELV</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Elevated point source identification file produced by <command>Elevpoint</command></entry>
</row>
<row>
<entry><envar>PHOUR</envar> (optional)</entry>
<entry>I/O API NetCDF</entry>
<entry>Hourly point-source inventory file produced by <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>PNTS</envar></entry>
<entry>SMOKE map</entry>
<entry>Intermediate inventory file produced by <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>PTMP</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Hourly emissions file produced by <command>Temporal</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section id="sect_programs_laypoint_envar">

<title>Input Environment Variables</title>

<itemizedlist>
<listitem>
<para><envar>EXPLICIT_PLUMES_YN</envar>: [default: N]</para>

<para>Indicates whether only explicit plume rise sources should be calculated.</para>

<itemizedlist>
<listitem>
<para>Y: Process only explicit plume rise sources; automatically sets <envar>HOUR_PLUMEDATA_YN</envar> to Y</para>
</listitem>
<listitem>
<para>N: Process all sources</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>FIRE_AREA</envar>: [default: 0.0]</para>

<para>Sets daily area burned in acres/day; only used when <envar>FIRE_PLUME_YN</envar> is set to Y and <envar>HOURLY_FIRE_YN</envar> is set to N.</para>

</listitem>
<listitem>
<para><envar>FIRE_HFLUX</envar>: [default: 0.0]</para>

<para>Sets hourly heat flux value in BTU/hr; only used when <envar>FIRE_PLUME_YN</envar> is set to Y and <envar>HOURLY_FIRE_YN</envar> is set to N.</para>

</listitem>
<listitem>
<para><envar>FIRE_PLUME_YN</envar>: [default: N]</para>

<para>Indicates if fire-specific plume rise calculations should be used.</para>

<itemizedlist>
<listitem>
<para>Y: Use fire-specific plume rise calculations for all sources</para>
</listitem>
<listitem>
<para>N: Use traditional plume rise calculations based on stack parameters for all sources</para>
</listitem>
</itemizedlist>

</listitem>

<listitem>
<para><envar>HOUR_PLUMEDATA_YN</envar>: [default: N]</para>

<para>Indicates whether hourly plume rise data should be used.</para>

<itemizedlist>
<listitem>
<para>Y: Use hourly data; requires <envar>PHOUR</envar> file</para>
</listitem>
<listitem>
<para>N: Do not use hourly data</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>HOURLY_FIRE_YN</envar>: [default: N]</para>

<para>Indicates if hourly fire data should be used; only checked when <envar>FIRE_PLUME_YN</envar> is set to Y.</para>

<itemizedlist>
<listitem>
<para>Y: Read hourly heat flux from <envar>PTMP</envar> file and daily area burned from <envar>PDAY</envar> file</para>
</listitem>
<listitem>
<para>N: Get heat flux and area burned from environment variables <envar>FIRE_AREA</envar> and <envar>FIRE_HFLUX</envar></para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>IOAPI_ISPH</envar>: See description in <xref linkend="sect_programs_elevpoint_envar" /></para>
</listitem>

<listitem>
<para><envar>PLUME_GTEMP_NAME</envar>: [default: TEMP2]</para>
<para>Sets ground temperature variable name from meteorology file for plume rise calcuation.</para>
</listitem>

<listitem>
<para><envar>REP_LAYER_MAX</envar>: [default: -1]</para>

<para>Layer number for reporting high plume rise; reporting is turned off if set to less than 1.</para>
</listitem>
<listitem>
<para><envar>SMK_EMLAYS</envar>: [default: -1]</para>

<para>Number of emissions layers; must be at least 4 otherwise program will not run.</para>
</listitem>
<listitem>
<para><envar>SMK_SOURCE</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" />.</para>
</listitem>
<listitem>
<para><envar>SMK_SPECELEV_YN</envar>: [default: N]</para>

<para>Defines whether the <command>Elevpoint</command> output file <envar>PELV</envar> will be used to set elevated sources.</para>

<itemizedlist>
<listitem>
<para>Y: Use the <envar>PELV</envar> file to set elevated sources during run</para>
</listitem>
<listitem>
<para>N: Let <command>Laypoint</command> plume rise calculation determine whether or not sources are elevated</para>
</listitem>
</itemizedlist>

</listitem>

<listitem>
<para><envar>USE_EDMS_DATA_YN</envar>: [default: N]</para>

<para>Process EDMS aviation source elevation height as its plume rise and distributes the emissions into the layer where it belongs to.</para>

<itemizedlist>
<listitem>
<para>Y: Skip plume rise calculation and distribute EDMS aviation emissions into the layer where it belongs to using its elevation height.</para>
</listitem>
<listitem>
<para>N: Do not process EDMS aviation sources</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>VELOC_RECALC</envar>: [default: N]</para>

<para>Determines whether velocity should be recalculated based on hourly flow rates and stack diameter.</para>

<itemizedlist>
<listitem>
<para>Y: Recalculate velocity for hourly data</para>
</listitem>
<listitem>
<para>N: Use velocity values from hourly inventory file</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>VERTICAL_SPREAD</envar>: [default: 0]</para>

<para>Sets the vertical spread method for determining the bottom and top heights of each plume.</para>

<itemizedlist>
<listitem>
<para>0: Use the default Turner approach where plume thickness equals the amount of plume rise</para>
</listitem>
<listitem>
<para>1: Compute vertical spread using ambient temperature data</para>
</listitem>
</itemizedlist>

</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Laypoint</command></entry>
</row>
<row>
<entry><envar>PLAY</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Hourly plume rise layer fractions by source</entry>
</row>
<row>
<entry><envar>PLAY_EX</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Hourly plume rise layer fractions for explicit sources</entry>
</row>
<row>
<entry><envar>REPRTLAY</envar></entry>
<entry>ASCII</entry>
<entry>Report file for plumes exceeding specified layer</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

</section>

<section id="sect_programs_met4moves">

<title><command>Met4moves</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> mobile</para>

<para>The <command>Met4moves</command> is a meteorological processor that prepares temperature and relative humidity (RH) data for use by both MOVES and SMOKE. <command>Met4moves</command> produces specific meteorological metrices for the representative county(s) for MOVES and additional meteorological metrics for all inventory counties in the county group for SMOKE</para>

<section>

<title>Definition of a <quote>day</quote></title>

<para><command>Met4moves</command> seeks to obtain 24 hours&rsquo; worth of meteorology data for a source for each day, which is necessary for generating emission factors. However, the definition of a <quote>day</quote> differs for sources in different time zones. By default, <command>Met4moves</command> uses each source&rsquo;s time zone to determine a day for that time zone. To instead use the same day-start-time for all sources, the <envar>UNIFORM_STIME</envar> environment variable can be used.</para>

<para>If the inventory covers multiple time zones, all sources will not have the same coverage of days. <command>Met4moves</command> will use meteorology data from previous or subsequent days to fill in missing data. If appropriate data are not available, the program will quit with an error and you must provide additional meteorology data to cover the time period of interest. Currently, <command>Met4moves</command> does not considers Daylight Saving time in its determination of <quote>day</quote>.</para>

</section>
</section>


<section>

<title>Processing Order</title>
<para><command>Met4moves</command> must be run prior to <link linkend="section_moves_utilities">MOVES processing scripts</link>. The SMOKE Utility program, <link linkend="sect_utilities_metcombine"><command>Metcombine</command></link>, needs to be run prior to <command>Met4moves</command>. <command>Metcombine</command> allows the user to combine ambient temperature, pressure and mixing ratio variables from two different MCIP files (METCRO_2D and METCRO_3D) that are needed to compute Relative Humidity (RH) in <command>Met4moves</command>.</para>
</section>

<section>

<title>Files, Environment Variables and Run Syntax</title>

<figure id="fig_programs_met4moves">

<title><command>Met4moves</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/met4moves_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/met4moves_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_met4moves" /> shows the input and output files for the <command>Met4moves</command> program. The input files are the Grid Description File from MCIP(<envar>GRIDDESC</envar>), the Surrogate Description file (<envar>SRGDESC</envar>), the MCIP List of Meteorology File <link linkend="sect_input_metlist">(<envar>METLIST</envar>)</link>, and the representative county cross-reference file <link linkend="sect_input_mcxref">(<envar>MCXREF</envar>)</link>.</para>
<para><command>Met4moves</command> outputs datasets for SMOKE that contain the daily gridded min/max temperatures and averaged RH. <command>Met4moves</command> outputs for MOVES datasets that provide all (min/max) temperature combinations for a representative county, reflecting all min/max combinations for all inventory counties in that county group.  The associated RH values are also included in these datasets.  In addition, the datasets include the 24-h diurnal profiles needed for the RPP emission process, and contain user-specified temperature increments for use by MOVES.</para>

<section>
<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><link linkend="sect_input_costcy"><envar>COSTCY</envar></link></entry>
<entry>ASCII</entry>
<entry>Country, state, county codes file, with time zones</entry>
</row>
<row>
<entry><link linkend="sect_input_geocode"><envar>GEOCODE_LEVEL[1-4]</envar></link></entry>
<entry>ASCII</entry>
<entry>Geographical level codes and descriptions for gridded inventories, only when USE_EXP_GEO_CODES is set to Y, (COSTCY is ignored when <link linkend="sect_input_geocode"><envar>GEOCODE_LEVEL[1-4]</envar></link> files are used)</entry>
</row>
<row>
<entry><link linkend="sect_input_griddesc"><envar>GRIDDESC</envar></link></entry>
<entry>ASCII</entry>
<entry>Modeling Domain Grid Description File</entry>
</row>
<row>
<entry><link linkend="sect_input_mcxref"><envar>MCXREF</envar></link></entry>
<entry>ASCII</entry>
<entry>Representative county cross-reference file; NOTE: The list of counties in the MCXREF file used by <command>Met4moves</command> must match the list of inventory counties used by SMOKE</entry>
</row>
<row>
<entry><link linkend="sect_input_metlist"><envar>METLIST</envar></link></entry>
<entry>ASCII</entry>
<entry>A list of meteorology files containing temperature, mixing ratio, and surface pressure data created by <command>Metcombine</command></entry>
</row>
<row>
<entry><link linkend="sect_input_mfmref"><envar>MFMREF</envar></link></entry>
<entry>ASCII</entry>
<entry>Representative county fuel monthcross-reference file; NOTE: The list of counties in the MFMREF file used by <command>Met4moves</command> must match the list of inventory counties used by SMOKE</entry>
</row>
<row>
<entry><link linkend="sect_input_srgdesc"><envar>SRGDESC</envar></link></entry>
<entry>ASCII</entry>
<entry>Surrogate Description File</entry>
</row>
<row>
<entry><envar>Surrogate File(s)</envar></entry>
<entry>ASCII</entry>
<entry>Surrogate file(s) selected by <envar>SRG_LIST</envar></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section>

<title>Input Environment Variables</title>
<itemizedlist>
<listitem>
<para><envar>STDATE</envar>: [default: 0]</para>
<para>This environment variable sets the overall episode start date: Julian format (YYYYDDD) for <command>Movesmrg</command>.</para>
</listitem>
<listitem>
<para><envar>ENDDATE</envar>: [default: 0]</para>
<para>Sets the overall episode end date; Julian format (YYYYDDD).</para>
</listitem>
<listitem>
<para><envar>ENDTIME</envar>: [default: 230000]</para>
</listitem>
<listitem>
<para><envar>USE_EXP_GEO_CODES</envar>: [default: N]</para>
<para>If set to Y then use GEOCODE_LEVEL[1-4] files instead of the COSTCY file to define expanded geographical detail such as country-level(GEOCODE_LEVEL1), country/state-level (GEOCODE_LEVEL2), country/state/county-level (GEOCODE_LEVEL3) or country/state/county/tribal-level (GEOCODE_LEVEL4).</para>
</listitem>
<listitem>
<para><envar>PD_TEMP_INCREMENT</envar>: [default: 5]</para>
<para>Defines the temperature increment (in deg. F) for RPD lookup table to create combinations of min/max temperature bins</para>
</listitem>
<listitem>
<para><envar>PH_TEMP_INCREMENT</envar>: [default: 5]</para>
<para>Defines the temperature increment (in deg. F) for RPH lookup table to create combinations of min/max temperature bins</para>
</listitem>
<listitem>
<para><envar>PV_TEMP_INCREMENT</envar>: [default: 5]</para>
<para>Defines the temperature increment (in deg. F) for RPV lookup table to create combinations of min/max temperature bins</para>
</listitem>
<listitem>
<para><envar>PP_TEMP_INCREMENT</envar>: [default: 10]</para>
<para>Defines the temperature increment (in deg. F) for RPP lookup table to create combinations of min/max temperature bins</para>
</listitem>
<listitem>
<para><envar>MIN_NO_RH_BY_TEMPBIN</envar>: [default: 1]</para>
<para>Defines the minimum number of data point for computing averaged RH by tempearature bin</para>
</listitem>
<listitem>
<para><envar>SPECIFIC_HUMIDITY_YN</envar>: [default: N]</para>
<para>Defines whether compute specific humidity instead of relative humidity</para> 
</listitem>
<listitem>
<para><envar>SRG_LIST</envar>: [default: N]</para>
<para>Specifies the code(s) of the spatial surrogate(s) to be used in selecting the grid cells for the county (example: setenv SRG_LIST '100,230').</para>
</listitem>
<listitem>
<para><envar>SRGPRO_PATH</envar>: [default: N]</para>
<para>Defines the location of spatial surrogate files.</para>
</listitem>
<listitem>
<para><envar>TEMP_BUFFER_BIN</envar>: [default: 0.0]</para>
<para>Defines the temperature buffer value (°F). This value will allow <command>Met4moves</command> to expand the min/max temperature range for MOVES RPP processing. If <envar>TEMP_BUFFER_BIN</envar> is set to 10.0, the original max temperature which is 90.0°F will be treated as 100.0°F, and minimum temperaure (=30°F) will be treated as 20.0°F internally in <command>Met4moves</command>.</para>      
</listitem>
<listitem>
<para><envar>TVARNAME</envar>: [default: TEMP2]</para>
<para>Specifies the variable name for the temperature to extract from the <command>Met4moves</command> output file (<envar>MOVES_OUTFILE</envar>).</para>
</listitem>
</itemizedlist>

</section>

<section>
<title>Output Files</title>

<informaltable>
<tgroup cols="4">
<colspec colwidth="20*" />
<colspec colwidth="9*" />
<colspec colwidth="45*" />
<colspec colwidth="20*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><link linkend="sect_intmed_moves_output">MOVES_OUTFILE</link></entry>
<entry>ASCII </entry>
<entry>Contains the absolute minimum and maximum temperatures and average RH values and the 24 hour temperature profiles associated with each representative county (example filename: MOVES_12km_2009091-2009120.txt)</entry>
</row>
<row>
<entry><link linkend="sect_intmed_moves_rh_output">MOVES_RH_OUTFILE</link></entry>
<entry>ASCII </entry>
<entry>Contains the representative county-specific average RH, minimum and maximum temperature by temperature bin and fuel month.</entry> 
</row>
<row>
<entry><link linkend="sect_intmed_smoke_output">SMOKE_OUTFILE</link></entry>
<entry>ASCII</entry>
<entry>Contains gridded daily min/max temperatures in local timei for RPP mode run in <command>Movesmrg</command></entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Met4moves</command></entry>
</row>

</tbody>
</tgroup>
</informaltable>

</section>
</section>
</section>

<section id="sect_programs_movesmrg">

<title><command>Movesmrg</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> mobile</para>

 <para><command>Movesmrg</command> is a mobile-sources-only program, loosely based on the SMOKE program <command>Smkmerge</command>, that combines the intermediate files produced by the other SMOKE programs (i.e., <command>SmkInven</command>, <command>Grdmat</command>, <command>Spcmat</command>, <command>Temporal</command>). The <command>movesmrg</command> program is discussed in detail in <xref linkend="sect_programs_movesmrg" />. Similar to <link linkend="sect_programs_smkmerge"><command>Smkmerge</command></link>, the main goal of <link linkend="sect_programs_movesmrg"><command>Movesmrg</command></link> is to create (1) gridded, speciated, hourly air quality model-ready input files and (2) county-level SCC summaries. The primary difference between <command>Movesmrg</command> and <command>Smkmerge</command> is that <command>Movesmrg</command> uses the SMOKE Formatted MOVES emission rate lookup tables to compute emissions on the fly, by multiplying the emissions factors by hourly VMT (for RatePerDistance [RPD]), annual or monthly hotelling hours (for RatePerHour [RPH]) or by monthly or annual vehicle populations (for RatePerVehicle [RPV] or RatePerProfile [RPP]).</para>
 <para><command>Movesmrg</command> must be run four times to compute on-roadway and off-network (including vapor venting) emissions processes individually, since the emission rate calculation methods in SMOKE for these categories are quite different. Once all three emissions processes have been computed, the emission output files can be merged (optionally along with other 2D sectors separate from onroad) using <command>Mrggrid</command>, which combines any number of 2D or 3D hourly, gridded, and speciated emission data files. See the section <xref linkend="sect_programs_mrggrid" /> for more details on the above programs.</para>
  <itemizedlist>
  	<listitem><emphasis role="bold">RPD, RPH and RPV Emission Calculations</emphasis>
  		<para>For its RPD, RPH and RPV lookup table calculations, <command>Movesmrg</command> uses the gridded hourly temperatures in GMT, and then adjusts the hour of the RPD, RPH and RPV lookup tables from local time to GMT to get the emission rates for the representative county for the appropriate month.  The key lookup fields for the factors are hourly temperature and avarage speed for the RPD lookup table calculation, hourly temperature for the RPH lookup table calculation, and hourly temperature and hour of the day in local time for the RPV table calculation.</para>
  		</listitem>
  	<listitem><emphasis role="bold">RPP Emission Calculations</emphasis>
  		<para>For the RPP lookup table calculations, <command>Movesmrg</command> uses the RPP lookup table as an input file for the emission rates that depend not on the gridded hourly temperatures, but on the temperature profiles output by the <command>Met4moves</command> program.  The emissions estimates based on the RPP table are computed for the temporal averaging period specified for the temperature profiles, rather than using hourly gridded meteorology.</para>
  		</listitem>
  </itemizedlist>
</section>

<section>

<title>Processing Order</title>

<para><command>Movesmrg</command> must be run after <command>Met4moves</command> and MOVES and before <command>Mrggrid</command>.</para>

</section>

<section>
<title>Files and Environment Variables</title>

<figure id="fig_programs_movesmrg_mobile">
<title><command>Movesmrg</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/movesmrg_mobile_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/movesmrg_mobile_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_movesmrg_mobile" /> shows the input and output files for the <command>Movesmrg</command> program. The input files are the country, state, and county codes file (<envar>COSTCY</envar>), the grid description file (<envar>GRIDDESC</envar>), the inventory data table (<envar>INVTABLE</envar>), the representative county fuel month file (<envar>MFMREF</envar>), the list of emission process and associated pollutants file (<envar>MEPROC</envar>), the representative county cross-reference file (<envar>MCXREF</envar>), the list of emission factors files by representative county file (<envar>MRCLIST</envar>), the meteorology files (<envar>MET_CRO_2D</envar>), the gridding matrix from <command>Grdmat</command> (<envar>MGMAT</envar>), the inventory file output from <command>Smkinven</command> (<envar>MOBL</envar>), the speciation matrix from <command>Spcmat</command> (<envar>MSMAT_L</envar> or <envar>MSMAT_S</envar>), the <command>Met4moves</command> output file for SMOKE (<envar>METMOVES</envar> <link linkend="sect_intmed_smoke_output"><envar>=SMOKE_OUTFILE)</envar></link>, the MOVES-based lookup tables (RPD, RPV, and RPP), and the daily hour VMT files from <command>Temporal</command> (<envar>MTMP_(day)</envar>). Note that <envar>MET_CRO_2D</envar>, <envar>METMOVES</envar>, and <envar>MTMP_(day)</envar> are optional files that are included only in certain situations.</para>

<para><command>Movesmrg</command> outputs a model-ready emissions file <envar>MGTS_L</envar> or <envar>MGTS_S</envar>, a report file <envar>REPMGTS_S</envar>, and a log file <envar>LOGFILE</envar>.</para>

<para>When using source apportionment (see <xref linkend="sect_scripts_source_apportionment" />), <command>Movesmrg</command> will also read the source grouping file (<envar>SOURCE_GROUPS</envar>) and output the source group information <envar>SRCGROUPS_OUT</envar>, the emissions for each source group <envar>SGINLNTS_L</envar> or <envar>SGINLNTS_S</envar>, and a source group report file <envar>SRCGRP_REPORT</envar>.</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>COSTCY</envar></entry>
<entry>ASCII</entry>
<entry>Country, state and county codes file</entry>
</row>
<row>
<entry><link linkend="sect_input_geocode"><envar>GEOCODE_LEVEL[1-4]</envar></link></entry>
<entry>ASCII</entry>
<entry>Geographical level codes and descriptions for gridded inventories, only when USE_EXP_GEO_CODES is set to Y, (COSTCY is ignored when <link linkend="sect_input_geocode"><envar>GEOCODE_LEVEL[1-4]</envar></link> files are used)</entry>
</row>
<row>
<entry><link linkend="sect_input_cfpro"><envar>CFPRO</envar></link> (optional)</entry>
<entry>ASCII</entry>
<entry>Control factor file</entry>
</row>
<row>
<entry><envar>GRIDDESC</envar></entry>
<entry>ASCII</entry>
<entry>Grid description file</entry>
</row>
<row>
<entry><envar>INVTABLE</envar></entry>
<entry>ASCII</entry>
<entry>Inventory data table</entry>
</row>
<row>
<entry><envar>MFMREF</envar></entry>
<entry>ASCII</entry>
<entry>Representative county fuel month file</entry>
</row>
<row>
<entry><envar>MEPROC</envar></entry>
<entry>ASCII</entry>
<entry>List of emission process and associated pollutants file</entry>
</row>
<row>
<entry><envar>MCXREF</envar></entry>
<entry>ASCII</entry>
<entry>Representative county cross-reference file</entry>
</row>
<row>
<entry><envar>MRCLIST</envar></entry>
<entry>ASCII</entry>
<entry>List of emission factors files (i.e., RPD, RPV and RPP Lookup tables) by representative county file</entry>
</row>
<row>
<entry><envar>METLIST</envar></entry>
<entry>ASCII</entry>
<entry>List of MCIP meteorology files</entry>
</row>
<row>
<entry><envar>MGMAT</envar></entry>
<entry>ASCII</entry>
<entry>Gridding matrix from <command>Grdmat</command></entry>
</row>
<row>
<entry><envar>MOBL</envar></entry>
<entry>ASCII</entry>
<entry>Inventory file output from <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>MSMAT_[L|S]</envar></entry>
<entry>ASCII</entry>
<entry>Speciation matrix from <command>Spcmat</command></entry>
</row>
<row>
<entry><envar>METMOVES</envar> (<link linkend="sect_intmed_smoke_output"><envar>=SMOKE_OUTFILE)</envar></link> (optional)</entry>
<entry>ASCII</entry>
<entry>Meteorology file from <command>Met4moves</command></entry>
</row>
<row>
<entry><envar>MTMP_{day}</envar></entry>
<entry>ASCII</entry>
<entry>Daily hour VMT files from <command>Temporal</command></entry>
</row>
<row>
<entry><link linkend="sect_input_smkmerge_groups"><envar>SOURCE_GROUPS</envar></link> (optional)</entry>
<entry>ASCII</entry>
<entry>Source apportionment groups</entry>
</row>
<row>
<entry><link linkend="sect_input_spdpro"><envar>SPDPRO</envar></link> (optional)</entry>
<entry>ASCII</entry>
<entry>Weekday and weekend hourly speed profiles</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section>
<title>Input Environment Variables</title>

<itemizedlist>
<listitem>
<para><envar>USE_EXP_GEO_CODES</envar>: [default: N]</para>
<para>If set to Y then use GEOCODE_LEVEL[1-4] files instead of the COSTCY file to define expanded geographical detail such as country-level(GEOCODE_LEVEL1), country/state-level (GEOCODE_LEVEL2), country/state/county-level (GEOCODE_LEVEL3) or country/state/county/tribal-level (GEOCODE_LEVEL4).</para>
</listitem>
<listitem>
<para><envar>MEMORY_OPTIMIZE_YN: </envar>: [default: Y]</para>
<para> Allows <command>Movesmrg</command> to use less RAM memory. However, it will increase computational time of RPD_MODE and RPV_MODE runs. </para>
<itemizedlist>
<listitem><para>Y: Runs <command>Movesmrg</command> in memory optimization mode.</para></listitem>
<listitem><para>N: Runs <command>Movesmrg</command> faster mode using high capacity of RAM memory.</para></listitem>
</itemizedlist> 
</listitem>

<listitem>
<para><envar>MRG_BYDAY</envar>: [default: blank]</para>
<para> String code that specifies which source category is to use a by-day approach for the hourly input files. It must be set to "M" for a <command>Movesmrg</command> to create an output file for each day.</para>
</listitem>

<listitem>
<para><envar>MRG_GRDOUT_YN</envar>: [default: N]</para>
<para> Determines whether <command>Movesmrg</command> produces a gridded output file.</para>
<itemizedlist>
<listitem><para>Y: Read the gridding matrix produced by the <command>Grdmat</command></para></listitem>
<listitem><para>N: Do not read the gridding matrix.</para></listitem>
</itemizedlist>
</listitem>
<listitem>
<para><envar>MRG_SPCOUT_YN</envar>: [default: N]</para>
<para> Determines whether <command>Movesmrg</command> produces a speciated output file.</para>
<itemizedlist>
<listitem><para>Y: Read the gridding matrix produced by the <command>Spcmat</command></para></listitem>
<listitem><para>N: Do not read the gridding matrix.</para></listitem>
</itemizedlist>
</listitem>
<listitem>
<para><envar>MRG_REPCNY_YN</envar>: [default: N]</para>
<para> Determines whether <command>Movesmrg</command> produces a report of emission totals by county</para>
<itemizedlist>
<listitem><para>Y: Produce the report by <command>Movesmrg</command></para></listitem>
<listitem><para>N: Do not produce the report</para></listitem>
</itemizedlist>
</listitem>
<listitem>
<para><envar>MRG_REPSTA_YN</envar>: [default: N]</para>
<para> Determines whether <command>Movesmrg</command> produces a report of emission totals by state</para>
<itemizedlist>
<listitem><para>Y: Produce the report by <command>Movesmrg</command></para></listitem>
<listitem><para>N: Do not produce the report</para></listitem>
</itemizedlist>
</listitem>
<listitem>
<para><envar>MRG_REPSCC_YN</envar>: [default: N]</para>
<para> Determines whether <command>Movesmrg</command> produces a report of emission totals by SCC</para>
<itemizedlist>
<listitem><para>Y: Produce the report by <command>Movesmrg</command></para></listitem>
<listitem><para>N: Do not produce the report</para></listitem>
</itemizedlist>
</listitem>
<listitem>
<para><envar>MRG_REPSRC_YN</envar>: [default: N]</para>
<para> Determines whether <command>Movesmrg</command> produces a report of emission totals by source.</para>
<itemizedlist>
<listitem><para>Y: Produce the report by <command>Movesmrg</command>. It will reset <envar>MRG_REPCNY_YN</envar> and <envar>MRG_REPSCC_YN</envar> to N to avoid to outputing duplicate information into the report.</para></listitem>
<listitem><para>N: Do not produce the report</para></listitem>
</itemizedlist>
</listitem>
<listitem>
<para>If <envar>MRG_GRDOUT_UNIT</envar> [default: units]</para>
<para>  String code that permits user to change the unit of the gridded output file.</para>
</listitem>
<listitem>
<para>If <envar>MRG_TOTOUT_UNIT</envar> [default: units]</para>
<para>  String code that permits user to change the unit of the state/county total report file.</para>
</listitem>
<listitem>
<para><envar>MTMP_OUTPUT_YN</envar>: [default: N]</para>
<para>Defines whether <command>Temporal</command> outputs the <command>Temporal</command> intermediate output file from <xref linkend="sect_intmed_temporal"/> for <command>Smkreport</command> to create hourly emissions summary report based on hourly gridded emissions estimated by <command>Movesmrg</command>.</para>
<itemizedlist>
<listitem><para>Y: Output Temporal intermediate output file</para></listitem>
<listitem><para>N: Do not output Temporal intermediate output file</para></listitem>
</itemizedlist>
</listitem>

<listitem>
<para><envar>RPD_MODE:</envar> [default: N] </para>
<para>Determines whether <command>Movesmrg</command> processes rate-per-distance emissions.</para>
<itemizedlist>
<listitem><para>Y: Process rate-per-distance emissions</para></listitem>
<listitem><para>N: Do not process rate-per-distance emissions</para></listitem>
</itemizedlist>
</listitem>
<listitem>
<para><envar>RPH_MODE:</envar> [default: N] </para>
<para>Determines whether <command>Movesmrg</command> processes rate-per-hour emissions.</para>
<itemizedlist>
<listitem><para>Y: Process rate-per-hour emissions</para></listitem>
<listitem><para>N: Do not process rate-per-hour emissions</para></listitem>
</itemizedlist>
</listitem>
<listitem>
<para><envar>RPV_MODE</envar>: [default: N] </para>
<para>Determines whether <command>Movesmrg</command> processes rate-per-vehicle emissions.</para>
<itemizedlist>
<listitem><para>Y: Process rate-per-vehicle emissions</para></listitem>
<listitem><para>N: Do not process rate-per-vehicle emissions</para></listitem>
</itemizedlist>
</listitem>
<listitem>
<para><envar>RPP_MODE</envar>: [default: N]</para>
<para> Determines whether <command>Movesmrg</command> processes rate-per-profile emissions.</para>
<itemizedlist>
<listitem><para>Y: Process rate-per-profile emissions</para></listitem>
<listitem><para>N: Do not process rate-per-profile emissions</para></listitem>
</itemizedlist>
</listitem>
<listitem>
<para><envar>SMK_MVSPATH</envar>: [default: blank]</para>
<para>Defines the location of MOVES emission factors lookup tables.</para>
</listitem>
<listitem>
<para><envar>SMK_SOURCE</envar>: [default: blank]</para>
<para>  Sets the types of source category. It must be set to "M" for <command>Movesmrg</command>.</para>
</listitem>

<listitem>
<para><envar>SMK_SRCGROUP_OUTPUT_YN</envar>: [default: N]</para>
<para>Indicates if source apportionment emissions should be output</para>
<itemizedlist>
<listitem><para>Y: Group sources and output source apportionment files</para></listitem>
<listitem><para>N: Do not perform any source apportionment processing</para></listitem>
</itemizedlist>
</listitem>
<listitem>
<para><envar>TEMP_BUFFER_BIN</envar>: [default: 0.0]</para>
<para>Defines the temperature buffer value (°F). This value allows <command>Movesmrg</command> to cover the outside of min/max temperature range in <envar>SMOKE_OUTFILE</envar> from <command>Met4moves</command> for <command>Movesmrg</command> RPP processing. If <envar>TEMP_BUFFER_BIN</envar> is set to 10.0, the original max temperature which is 90.0°F will be treated as 100.0°F, and minimum temperaure (=30°F) will be treated as 20.0°F internally in <command>Movesmrg</command>. Emission rates for those temperatures outside of original temperature range will share the ones from original max/min temperatures.</para>      
</listitem>
<listitem>
<para><envar>TMPVNAME</envar>: [default: TEMP2]</para>
<para>  Name of temperature variable to read from the meteorology files for <command>Movesmrg</command>.</para>
</listitem>
<listitem>
<para><envar>USE_CONTROL_FACTORS</envar>: [default: N]</para>
<para> Allows the user to apply control factor by region, SCC, pollutant, and month.</para>
<itemizedlist>
<listitem><para>Y: Apply control factors to MOVES emission rates from MOVES lookup tables.</para></listitem>
<listitem><para>N: Do not apply control factor.</para></listitem>
</itemizedlist>
</listitem>
<listitem>
<para><envar>USE_EXP_CONTROL_FAC_YN</envar>: [default: N]</para>
<para> Allows the user to optionally apply pollutant/species-specific explict control factor by region, SCC, and month when <envar>USE_CONTROL_FACTORS</envar> is set to Y.</para>
<itemizedlist>
<listitem><para>Y: Apply pollutant/species-specific explicit control factors to MOVES emission rates from MOVES lookup tables.</para></listitem>
<listitem><para>N: Do not apply control factor.</para></listitem>
</itemizedlist>
</listitem>
<listitem>
<para><envar>USE_REF_CONTROL_FAC_YN</envar>: [default: N]</para>
<para> Allows the user to optionally apply reference-county-level control factor by SCC, and month when <envar>USE_CONTROL_FACTORS</envar> is set to Y.</para>
<itemizedlist>
<listitem><para>Y: Apply reference-county-level control factors to MOVES emission rates from MOVES lookup tables.</para></listitem>
<listitem><para>N: Do not apply control factor.</para></listitem>
</itemizedlist>
</listitem>
<listitem>
<para><envar>USE_HOURLY_SPEEDS</envar>: [default: N]</para>
<para>Determine whether processes weekday/weekend hourly speed profiles or not.</para>
<itemizedlist>
<listitem><para>Y: Process weekday/weekend hourly speed profiles</para></listitem>
<listitem><para>N: Do not process hourly speed profiles</para></listitem>
</itemizedlist>
</listitem>
<listitem>
<para><envar>USE_SPCMAT_SPC_YN</envar>: [default: N]</para>
<para>Determine whether estimate air quality model species using chemical speciation profiles or not.</para>
<itemizedlist>
<listitem><para>Y: Estimate model species emissions using GSPRO input file</para></listitem>
<listitem><para>N: Estimate model species emissions directly from MOVES emission rates lookup tables</para></listitem>
</itemizedlist>
</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>MGTS[_S|_L]</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Model Ready Emissions File</entry>
</row>
<row>
<entry><envar>MTMP_INV</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Hourly emissions by source</entry>
</row>
<row>
<entry><envar>REPMGTS[_S|_L]</envar></entry>
<entry>ASCII</entry>
<entry>Report File</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Logfile</entry>
</row>
<row>
<entry><envar>SGINLNTS[_S|_L]</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Emissions by source group, formatted as CMAQ in-line emissions data, produced if <envar>SMK_SRCGROUP_OUTPUT_YN</envar> is set to Y</entry>
</row>
<row>
<entry><envar>SRCGROUPS_OUT</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Source group information, produced if <envar>SMK_SRCGROUP_OUTPUT_YN</envar> is set to Y</entry>
</row>
<row>
<entry><envar>SRCGRP_REPORT</envar></entry>
<entry>ASCII</entry>
<entry>Source group report file, produced if <envar>SMK_SRCGROUP_OUTPUT_YN</envar> is set to Y</entry>
</row>

</tbody>
</tgroup>
</informaltable>

</section>
</section>
</section>

<section id="sect_programs_mrgelev">

<title><command>Mrgelev</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> point</para>

<para>The <command>Mrgelev</command> merges multiple ASCII elevated files created by <command>Smkmerge</command>. The program can also output a binary elevated file needed by CAMx and UAM models. <command>Mrgelev</command> also handles matching PinG sources from different inputs, ensuring that only the top 300 emission sources are marked as PinG sources in the final merged output. For PinG matching, <command>Mrgelev</command> uses <envar>PELV</envar> files output by <command>Elevpoint</command>. <command>Mrgelev</command> uses the environment variable <envar>MRG_DIFF_DAYS</envar> to merge files from different days into a single file.</para>

</section>

<section>

<title>Processing Order</title>

<para><command>Mrgelev</command> is used to merge ASCII elevated files created by <command>Smkmerge</command>. If PinG matching is desired, then output files from <command>Elevpoint</command> are required.</para>

<para>The output binary elevated file from <command>Mrgelev</command> is used when running CAMx or UAM models.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_mrgelev">
<title><command>Mrgelev</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/mrgelev_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/mrgelev_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_mrgelev" /> shows the input and output files for the <command>Mrgelev</command> program. The input files are a list of the ASCII elevated files (<envar>FILELIST</envar>) and optionally a list of <envar>PELV</envar> files created by <command>Elevpoint</command> (<envar>PELVLIST</envar>). In both files, the complete file name including path must be provided. When using the <envar>PELVLIST</envar> file, each file must match the corresponding ASCII elevated file. The program outputs a log file (<envar>LOGFILE</envar>), a merged ASCII elevated file (<envar>OUTFILE</envar>), a merged binary elevated file (<envar>PTSOURCE</envar>), and a report file (<envar>REPMRGELEV</envar>).</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>FILELIST</envar></entry>
<entry>ASCII</entry>
<entry>List of input ASCII elevated files including path and file name</entry>
</row>
<row>
<entry><envar>PELVLIST</envar></entry>
<entry>ASCII</entry>
<entry>List of input <envar>PELV</envar> files including path and file name; leave environment variable unset if not processing PinG sources</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section>

<title>Input Environment Variables</title>

<itemizedlist>
<listitem>
<para><envar>MRG_DIFF_DAYS</envar>: [default: N]</para>

<para>This environment variable allows <command>Mrgelev</command> to merge files with data from different days.</para>

<itemizedlist>
<listitem>
<para>Y: Allow data from different dates to be merged together</para>

<para><command>Mrgelev</command> will use the environment variables <envar>G_STDATE</envar>, <envar>G_STTIME</envar>, <envar>G_RUNLEN</envar>, and <envar>G_TSTEP</envar> to set the start date, start time, length, and time step of the output file. All input files must have the same starting time as <envar>G_STTIME</envar>, the same time step as <envar>G_TSTEP</envar>, and must contain more than <envar>G_RUNLEN</envar> steps of data. For each input file, if it contains data to cover the actual episode requested by <envar>G_STDATE</envar>, <envar>G_STTIME</envar>, and <envar>G_RUNLEN</envar>, then the data for the actual episode will be used; otherwise, data starting at the first time step of the file will be used.</para>
</listitem>
<listitem>
<para>N: Require all merged data to be from the same date</para>

<para><command>Mrgelev</command> will determine the output file time period based on the latest starting input file and the earliest ending input file.</para>
</listitem>
</itemizedlist>

</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Mrgelev</command></entry>
</row>
<row>
<entry><envar>OUTFILE</envar></entry>
<entry>ASCII</entry>
<entry>Merged ASCII elevated file</entry>
</row>
<row>
<entry><envar>PTSOURCE</envar></entry>
<entry>Binary</entry>
<entry>Merged binary elevated file</entry>
</row>
<row>
<entry><envar>REPMRGELEV</envar></entry>
<entry>ASCII</entry>
<entry>Report file summarizing input and output emissions for QA purposes</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

</section>

<section id="sect_programs_mrggrid">

<title><command>Mrggrid</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> all</para>

<para>The purpose of the <command>Mrggrid</command> program is to combine gridded emission data files, which can be speciated or nonspeciated, and hourly or time-independent. It can combine any number of 3-D emissions files with any number of 2-D emissions files. In fact, this program will work with any I/O API NetCDF gridded files and need not be used only for emissions files. The program merges whatever data variables are in the input files. These files can each have different sets of data variables; <command>Mrggrid</command> will sum values only for each variable that is common to two or more files.</para>

<para><command>Mrggrid</command> checks several features of the input files to ensure that the data in these files are appropriate to be merged together. All input files must have use the same time step. <command>Mrggrid</command> compares the units of the variables with the same name and it creates an error message when the units are not identical. It is not sufficient to have units that are the same in meaning but different in syntax. For example, although tons/hour and tons/hr represent the same units, <command>Mrggrid</command> will not recognize this because of the different syntax. The user must resolve unit discrepancies before running the program. In addition, <command>Mrggrid</command> compares the horizontal grid settings across all 2-D and 3-D files, and these settings must be identical in all respects (e.g., number of cells, grid cell size, grid projection). Finally, <command>Mrggrid</command> checks the layer structures across multiple 3-D files. The 3-D files can have a different number of layers, as long as any layer common to two or more files has the same thickness in each of the files; <command>Mrggrid</command> also checks the I/O API type of vertical structures and top height, and these must be identical across all 3-D files.</para>

</section>

<section>

<title>Processing Order</title>

<para><command>Mrggrid</command> can be used with any gridded output files from <command>Smkmerge</command>. It can also be used with other I/O API NetCDF gridded files produced outside of SMOKE.</para>

<para>Output files from <command>Mrggrid</command> are usually moodel-ready input files that will be used in running an AQM.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_mrggrid">
<title><command>Mrggrid</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/mrggrid_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/mrggrid_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_mrggrid" /> shows the input and output files for the <command>Mrggrid</command> program. The input file is simply a list of the logical file names for the files to be merged (<envar>FILELIST</envar>). The program outputs a log file (<envar>LOGFILE</envar>), a gridded, optionally layered, optionally hourly emissions file (<envar>OUTFILE</envar>), and if merging different days, a report file (<envar>REPMRGGRID</envar>).</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>FILELIST</envar></entry>
<entry>ASCII</entry>
<entry>List of <emphasis>logical</emphasis> file name for 2-D and 3-D gridded I/O API NetCDF files; this file cannot contain the full paths and file names. Users should make sure that the logical file names that appear in <envar>FILELIST</envar> are defined prior to running <command>Mrggrid</command>.</entry>
</row>

<row>
<entry><envar>ADJ_FACS</envar><para>(optional)</para></entry>
<entry>ASCII</entry>
<entry><para>File that lists the species name, the logical file name, and the factor to be applied to all grid cells. The species name must be in columns A, the logical file name in column B, and the factor in columns C. SMOKE will ignore the case of the text, treating lower- and uppercase characters as if they were the same. For example, the following <envar>ADJ_FACS</envar> file sample would multiply NO emissions from the MGTS_L file by 1.3 (30% increase) and multiply PAR from the PGTS_L file by 0.6 (40% decrease).<comment>(Note that this file is not documented in Chapter 8.)</comment></para>
<programlisting>NO, MGTS_L, 1.3
PAR, PGTS_L, 0.6</programlisting></entry>
</row>

<row>
<entry><envar>TAG_SPECIES</envar><para>(optional)</para></entry>
<entry>ASCII</entry>
<entry><para>File that lists the logical file name, the species name, and the tag name to be appended. The logical file name in column B, the species name must be in columns B, and the factor in columns C. SMOKE will ignore the case of the text, treating lower- and uppercase characters as if they were the same. For example, the following <envar>TAG_SPECIES</envar> file sample would append a tag (t1) to the NO species from the MGTS_L file and append a tag (t3) to the PAR from the PGTS_L file.<comment>(Note that this file is not documented in Chapter 8.)</comment></para>
<programlisting>MGTS_L, NO,  t1
PGTS_L, PAR, t3</programlisting></entry>

</row>


</tbody>
</tgroup>
</informaltable>

</section>

<section>

<title>Input Environment Variables</title>

<itemizedlist>
<listitem>
<para><envar>MRG_DIFF_DAYS</envar>: [default: N]</para>
<para>This environment variable allows <command>Mrggrid</command> to merge files with data from different days.</para>
<itemizedlist>
<listitem>
<para>Y: Allow data from different dates to be merged together</para>
<para><command>Mrggrid</command> will use the environment variables <envar>G_STDATE</envar>, <envar>G_STTIME</envar>, <envar>G_RUNLEN</envar>, and <envar>G_TSTEP</envar> to set the start date, start time, length, and time step of the output file. All input files must have the same starting time as <envar>G_STTIME</envar>, the same time step as <envar>G_TSTEP</envar>, and must contain more than <envar>G_RUNLEN</envar> steps of data. For each input file, if it contains data to cover the actual episode requested by <envar>G_STDATE</envar>, <envar>G_STTIME</envar>, and <envar>G_RUNLEN</envar>, then the data for the actual episode will be used; otherwise, data starting at the first time step of the file will be used.</para>
</listitem>
<listitem>
<para>N: Require all merged data to be from the same date</para>
<para><command>Mrggrid</command> will determine the output file time period based on the latest starting input file and the earliest ending input file.</para>
</listitem>
</itemizedlist>

</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Mrggrid</command></entry>
</row>
<row>
<entry><envar>OUTFILE</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Gridded, optionally layered, optionally hourly emission file</entry>
</row>
<row>
<entry><envar>REPMRGGRID</envar></entry>
<entry>ASCII</entry>
<entry>Report file generated when <envar>MRG_DIFF_DAYS</envar> is set to Y; the report lists the date and time for each output time step along with the actual date and time of the data read from each file</entry>
</row>
<row>
<entry><envar>REPMERG_ADJ</envar></entry>
<entry>ASCII</entry>
<entry>Report file generated when <envar>ADJ_FACS</envar> is set; the report lists the date, the logical file name, the species name, the factor applied, a daily total of species before and after applying adjustment factor, and the ratio (after/ratio). The report only lists when the ratio is not equal to 1.0 </entry>
</row>
<row>
<entry><envar>REPMERGE_SUM</envar></entry>
<entry>ASCII</entry>
<entry>Report file generated when <envar>ADJ_FACS</envar> is set; the report lists the date, the species name, a daily total of species over all the logical files before and after applying adjustment factors, and the ratio (after/ratio). The report only lists when the ratio is not equal to 1.0 </entry>
</row>
<row>
<entry><envar>REPMERGE_TAG</envar></entry>
<entry>ASCII</entry>
<entry>Report file generated when <envar>TAG_SPECIES</envar> is set; the report lists the logical files name, species name before and after appending the tag</entry>
</row>

</tbody>
</tgroup>
</informaltable>

</section>

</section>

<!--
<section>

<title>Earlier Versions</title>

<para><command>Mrggrid</command> was first released with SMOKE v1.3.</para>

</section>
-->

</section>


<section id="sect_programs_mrgpt">

<title><command>Mrgpt</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> Point</para>

<para>The purpose of the <command>Mrgpt</command> program is to combine inline-mode model-ready multiple point speciated hourly emission data files (not gridded) created by <command>Smkmerge</command> and ASCII elevated files created by <command>Elevpoint</command>. The program merges whatever data variables are in the input files. These files can each have different sets of data variables; <command>Mrgpt</command> will sum values only for each variable that is common to two or more files.</para>

<para><command>Mrgpt</command> checks several features of the input files to ensure that the data in these files are appropriate to be merged together. All input files must have use the same time step. <command>Mrgpt</command> compares the units of the variables with the same name and it creates an error message when the units are not identical. It is not sufficient to have units that are the same in meaning but different in syntax. For example, although tons/hour and tons/hr represent the same units, <command>Mrggrid</command> will not recognize this because of the different syntax. The user must resolve unit discrepancies before running the program.</para>

</section>

<section>

<title>Processing Order</title>

<para><command>Mrgpt</command> can be used with any hourly speciated emissions from <command>Smkmerge</command> and any ASCII elevated output files from <command>Elevpoint</command>.</para>

<para>Output files from <command>Mrgpt</command> are inline-model model-ready input files that will be used in running an AQM.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_mrgpt">
<title><command>Mrgpt</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/mrgpt_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/mrgpt_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_mrgpt" /> shows the input and output files for the <command>Mrgpt</command> program. The input files are a list of the logical file names for the speciated hourly emissions files  from <command>Smkmerge</command> to be merged (<envar>FILELIST_INLN</envar>) and a list of the logical file names for the ASCII elevated output files from <command>Elevpoint</command> to be merged (<envar>FILELIST_STACK</envar>). The program outputs a log file (<envar>LOGFILE</envar>), a merged specated hourly emissions file (<envar>OUTFILE_INLN</envar>), a merged ASCII elevated output file (<envar>OUTFILE_STACK</envar>), and if merging different days, a report file (<envar>REPMRGGRID</envar>).</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>FILELIST_INLN</envar></entry>
<entry>ASCII</entry>
<entry>List of <emphasis>logical</emphasis> file name for hourly speciated I/O API NetCDF files; this file cannot contain the full paths and file names. Users should make sure that the logical file names that appear in <envar>FILELIST_INLN</envar> are defined prior to running <command>Mrgpt</command>.</entry>
</row>
<row>
<entry><envar>FILELIST_STACK</envar></entry>
<entry>ASCII</entry>
<entry>List of <emphasis>logical</emphasis> file name for ASCII elevated output files; this file cannot contain the full paths and file names. Users should make sure that the logical file names that appear in <envar>FILELIST_STACK</envar> are defined prior to running <command>Mrgpt</command>.</entry>
</row>

<row>
<entry><envar>ADJ_FACS</envar><para>(optional)</para></entry>
<entry>ASCII</entry>
<entry><para>File that lists the species name, the logical file name, and the factor to be applied to all grid cells. The species name must be in columns A, the logical file name in column B, and the factor in columns C. SMOKE will ignore the case of the text, treating lower- and uppercase characters as if they were the same. For example, the following <envar>ADJ_FACS</envar> file sample would multiply NO emissions from the PTIPMTS_L_INLN file by 1.3 (30% increase) and multiply PAR from the PTNONIPMTS_L_INLN file by 0.6 (40% decrease).</para>
<programlisting>NO, PTNONIPMTS_L_INLN, 1.3
PAR, PTIPMTS_L_INLN, 0.6</programlisting></entry>
</row>

</tbody>
</tgroup>
</informaltable>

</section>

<section>

<title>Input Environment Variables</title>

<itemizedlist>
<listitem>
<para><envar>MRG_DIFF_DAYS</envar>: [default: N]</para>
<para>This environment variable allows <command>Mrgpt</command> to merge files with data from different days.</para>
<itemizedlist>
<listitem>
<para>Y: Allow data from different dates to be merged together</para>
<para><command>Mrgpt</command> will use the environment variables <envar>G_STDATE</envar>, <envar>G_STTIME</envar>, <envar>G_RUNLEN</envar>, and <envar>G_TSTEP</envar> to set the start date, start time, length, and time step of the output file. All input files must have the same starting time as <envar>G_STTIME</envar>, the same time step as <envar>G_TSTEP</envar>, and must contain more than <envar>G_RUNLEN</envar> steps of data. For each input file, if it contains data to cover the actual episode requested by <envar>G_STDATE</envar>, <envar>G_STTIME</envar>, and <envar>G_RUNLEN</envar>, then the data for the actual episode will be used; otherwise, data starting at the first time step of the file will be used.</para>
</listitem>
<listitem>
<para>N: Require all merged data to be from the same date</para>
<para><command>Mrgpt</command> will determine the output file time period based on the latest starting input file and the earliest ending input file.</para>
</listitem>
</itemizedlist>

</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Mrgpt</command></entry>
</row>
<row>
<entry><envar>OUTFILE_INLN</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Merged inline-mode hourly speciated emission file</entry>
</row>
<row>
<entry><envar>OUTFILE_STACK</envar></entry>
<entry>ASCII</entry>
<entry>Merged inline-mode ASCII point elevated file</entry>
</row>
<row>
<entry><envar>REPMRGGRID</envar></entry>
<entry>ASCII</entry>
<entry>Report file generated when <envar>MRG_DIFF_DAYS</envar> is set to Y; the report lists the date and time for each output time step along with the actual date and time of the data read from each file</entry>
</row>
<row>
<entry><envar>REPMERG_ADJ</envar></entry>
<entry>ASCII</entry>
<entry>Report file generated when <envar>ADJ_FACS</envar> is set; the report lists the date, the logical file name, the species name, the factor applied, a daily total of species before and after applying adjustment factor, and the ratio (after/ratio). The report only lists when the ratio is not equal to 1.0 </entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

<!--
<section>

<title>Earlier Versions</title>

<para><command>Mrggrid</command> was first released with SMOKE v1.3.</para>

</section>
-->

</section>

<section id="sect_programs_normbeis3">

<title><command>Normbeis3</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> biogenic</para>

<para>
<command>Normbeis3</command> reads gridded land use data and emissions factors and produces gridded normalized biogenic emissions. <command>Normbeis3</command> is the first program in the SMOKE-BEIS3 model. The gridded land use includes various number of land use types. Emissions factors are provided for each land use type. The output gridded domain is the same as the input domain for the land use data. Emission fluxes are normalized to 30 &deg;C, and isoprene and methyl-butenol fluxes are also normalized to a photosynthetic active radiation (PAR) of 1000 &micro;mol/m<superscript>2</superscript>s. <command>Normbeis3</command> also computes normalized emissions for winter months, using a winter factor read in from the emissions factor table.
</para>

<para>For BEIS version 3.14 and 3.60, <command>Normbeis3</command> outputs winter and summer normalized emissions for the 35 species/compounds (including 14 monoterpenes and 1 sesquiterpene) listed below, as well as winter and summer leaf area indices (LAI). The output units for NO are grams of nitrogen per hour; the output units for LAI are meters squared per meters squared; the units for all other species/compounds are grams of carbon per hour.</para>

<informaltable>
<tgroup cols="2">
<colspec colwidth="30*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>Variable Name</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry>ISOP</entry>
<entry>Isoprene</entry>
</row>
<row>
<entry>MBO</entry>
<entry>2-methyl-3-buten-2-ol</entry>
</row>
<row>
<entry>METH</entry>
<entry>Methanol</entry>
</row>
<row>
<entry>ETHE</entry>
<entry>Ethene</entry>
</row>
<row>
<entry>PROPE</entry>
<entry>Propene</entry>
</row>
<row>
<entry>ETHO</entry>
<entry>Ethanol</entry>
</row>
<row>
<entry>ACET</entry>
<entry>Acetone</entry>
</row>
<row>
<entry>HEXA</entry>
<entry>Hexanal</entry>
</row>
<row>
<entry>HEXE</entry>
<entry>Hexenol</entry>
</row>
<row>
<entry>HEXY</entry>
<entry>Hexenylacetate</entry>
</row>
<row>
<entry>FORM</entry>
<entry>Formaldehyde</entry>
</row>
<row>
<entry>ACTAL</entry>
<entry>Acetaldehyde</entry>
</row>
<row>
<entry>BUTE</entry>
<entry>Butene</entry>
</row>
<row>
<entry>ETHA</entry>
<entry>Ethane</entry>
</row>
<row>
<entry>FORAC</entry>
<entry>Formic acid</entry>
</row>
<row>
<entry>ACTAC</entry>
<entry>Acetic acid</entry>
</row>
<row>
<entry>BUTO</entry>
<entry>Butenone (aka methyl vinyl ketone)</entry>
</row>
<row>
<entry>CO</entry>
<entry>Carbon monoxide</entry>
</row>
<row>
<entry>ORVOC</entry>
<entry>Other reactive VOCs</entry>
</row>
<row>
<entry>NO</entry>
<entry>Nitric oxide</entry>
</row>
<row>
<entry>LAI</entry>
<entry>Leaf area indices</entry>
</row>
<row>
<entry>SESQT</entry>
<entry>Sesquiterpene</entry>
</row>
<row>
<entry>MONO</entry>
<entry><emphasis>Monoterpenes</emphasis></entry>
</row>
<row>
<entry>APIN</entry>
<entry>Alpha-pinene</entry>
</row>
<row>
<entry>BPIN</entry>
<entry>Beta-pinene</entry>
</row>
<row>
<entry>D3CAR</entry>
<entry>Delta-3-carene</entry>
</row>
<row>
<entry>DLIM</entry>
<entry>D-limonene</entry>
</row>
<row>
<entry>CAMPH</entry>
<entry>Camphene</entry>
</row>
<row>
<entry>MYRC</entry>
<entry>Myrcene</entry>
</row>
<row>
<entry>ATERP</entry>
<entry>Alpha-terpinene</entry>
</row>
<row>
<entry>BPHE</entry>
<entry>Beta-phellandrene</entry>
</row>
<row>
<entry>SABI</entry>
<entry>Sabinene</entry>
</row>
<row>
<entry>PCYM</entry>
<entry>P-cymene</entry>
</row>
<row>
<entry>OCIM</entry>
<entry>Ocimene</entry>
</row>
<row>
<entry>ATHU</entry>
<entry>Alpha-thujene</entry>
</row>
<row>
<entry>TRPO</entry>
<entry>Terpinolene</entry>
</row>
<row>
<entry>GTERP</entry>
<entry>Gamma-terpinene</entry>
</row>

</tbody>
</tgroup>
</informaltable>

</section>

<section>

<title>Processing Order</title>

<para><command>Normbeis3</command> is the first program for processing biogenic emissions using the SMOKE-BEIS3 prototype.  <command>Normbeis3</command> must be executed before <command>Tmpbeis3</command>.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_normbeis3">
<title><command>Normbeis3</command> input and output files for BEIS v3.14</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/normbeis3_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/normbeis3_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_normbeis360" /> shows the input and output files for the <command>Normbeis3</command> program for BEIS v3.14. The input files are the emission factors file (<envar>B3FAC</envar>), the gridded land use file for the first 120 land use types (<envar>BELD3_A</envar>), the gridded land use types for the next 110 types (<envar>BELD3_B</envar>), and the land use totals data file (<envar>BELD3_TOT</envar>).</para>

<figure id="fig_programs_normbeis360">
<title><command>Normbeis3</command> input and output files for BEIS v3.60</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/normbeis360_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/normbeis360_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_normbeis3" /> shows the input and output files for the <command>Normbeis3</command> program for BEIS v3.60. The input files are the emission factors file (<envar>B360FAC</envar>), the gridded land use file for the first 286 land use types (<envar>BELD4</envar>).</para>

<para><command>Normbeis3</command> outputs a gridded, normalized biogenic emissions file (<envar>B3GRD</envar>) and a log file (<envar>LOGFILE</envar>).</para>

<section>

<title>Input Files</title>

<para>Gridded land use data can be created using GIS software, such as ArcInfo. Another tool that can be used to generate gridded land use data is the SMOKE Tool in Models-3 (see Models-3 documentation). The typical database used to generate the <envar>BELD3_A</envar>, <envar>BELD3_B</envar>, and <envar>BELD3_TOT</envar> files is the BELD3. Future versions of SMOKE may include a method for creating land use files for use with <command>Normbeis3</command>.</para>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>B3FAC</envar></entry>
<entry>ASCII</entry>
<entry>Emission factors file for BEIS v3.14</entry>
</row>
<row>
<entry><envar>BELD3_A</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Gridded land use (first 120 land use types) for BEIS v3.14</entry>
</row>
<row>
<entry><envar>BELD3_B</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Gridded land use (last 110 land use types) for BEIS v3.14</entry>
</row>
<row>
<entry><envar>BELD3_TOT</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Land use totals data for BEIS v3.14</entry>
</row>
<row>
<entry><envar>B360FAC</envar></entry>
<entry>ASCII</entry>
<entry>Emission factors file for BEIS v3.60</entry>
</row>
<row>
<entry><envar>BELD4</envar></entry>
<entry>ASCII</entry>
<entry>Gridded 286 land use for BEIS v3.60</entry>
</row>


</tbody>
</tgroup>
</informaltable>

</section>

<section>

<title>Input Environment Variables</title>

<para>None</para>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>B3GRD</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Gridded, normalized biogenic emissions (in grams of carbon or nitrogen per hour, depending on the species) and LAI: contains both summer and winter normalized emissions</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Normbeis3</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

<!--
<section>

<title>Earlier Versions</title>

<para>SMOKE v1.4 marked the initial release of the <command>Normbeis3</command> program, which together with the <command>Tmpbeis3</command> program make up the SMOKE-BEIS3 modeling system.</para>

</section>
-->

</section>

<section id="sect_programs_smkinven">

<title><command>Smkinven</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> area, mobile, point</para>

<para><command>Smkinven</command> reads in the raw input data, sorts the records, and creates the SMOKE inventory files that are required by most of the SMOKE programs. The program is run separately for area-, mobile-, and point-source processing. <command>Smkinven</command> reads annual, average-day, day-specific, and hour-specific inventory files. The annual and average-day inventory data are combined into a single inventory. The output also indicates whether the data started out as annual or average-day data; such <quote>temporal origin</quote> information is needed by the <command>Temporal</command> program to determine whether to apply monthly adjustments. <command>Smkinven</command> can also import gridded one-layer annual or average-day emissions in I/O API NetCDF or CF-compliant NetCDF format as an area sourc.</para>

<para><command>Smkinven</command> writes several SMOKE inventory files for each source category: an ASCII file containing all character-string fields from the inventory, individual I/O API NetCDF files containing emissions data for each output pollutant, and an ASCII map file listing the names and locations of each file. The character string fields cannot be stored in the I/O API NetCDF file because of limitations of the I/O API library. When day-specific and hour-specific data are available (this applies only for point sources), <command>Smkinven</command> can also read these data, and produce separate I/O API NetCDF files for each data type (day-specific or hour-specific).</para>

<para><command>Smkinven</command> supports the following input file formats and source categories:</para>

<itemizedlist>
<listitem>
<para>SMOKE one-record-per-line (ORL) format for nonpoint, nonroad mobile, on-road mobile, and point sources</para>
</listitem>
<listitem>
<para>SMOKE one-record-per-line (ORL) format for fire point sources (modified to support wildfires and prescribed fires characteristics and pollutants)</para>
</listitem>
<listitem>
<para>Special mobile link format</para>
</listitem>
<listitem>
<para>FF10 (Flat File 10) format for many different source categories including day-specific, hour-specific, monthly and annual for nonpoint, nonroad mobile, on-road mobile, and point sources (comma or semicolon delimited) </para>
</listitem>
<listitem>
<para>ASCII Continuous Emissions Monitoring (CEM) format (hour-specific point-source emissions)</para>
</listitem>
<listitem>
<para>List format (for combining multiple files of the same or compatible formats) for area, mobile, and point</para>
</listitem>
<listitem>
	<para>LIST GRID format (for reading multiple gridded one-layer annual CF-compliant NetCDF inventory data) as area sources</para>
</listitem>
<listitem>
<para>Gridded one-layer annual or average-day NetCDF I/O API or CF-compliant NetCDF emissions data (must be treated as an area source)</para>
</listitem>
</itemizedlist>

<para>It is not possible to import only day- or hour-specific data from FF10 input files. If only such data are to be used, mock annual files must be created; see <xref linkend="sect_input_ptday" /> and <xref linkend="sect_input_pthour" /> for more information on the required formats.</para>

<para>The list format is simply a list of file names with paths with a special format identifier that allows all files in the list to be processed together. To use a list format, all input files must have the same or compatible formats.</para>

<para>The list grid format is simply a list of CF-compliant NetCDF file names with paths with a special format identifier that allows all files in the list to be processed together. To use a list grid format, all input files must have the same or compatible formats with inventory data from the same year.</para>
<para>When using CEM data, you are encouraged to preprocess your data to prepare them down to the dates and/or sources in the domain. <comment>However, SMOKE can do this if you do not. The dates can be extracted with the DATERANGE header in the <envar>PTHOUR</envar> file (see <envar>PTHOUR</envar> file documentation).</comment> The sources in the grid will be selected based on matching to the inventory (if the inventory is for only states within the modeling grid) and/or by the <command>Grdmat</command> program, which will remove sources outside the grid from the model-ready results.</para>

<para><command>Smkinven</command> also can process the hourly CEM data in a more sophisticated way. Hourly heat input from the CEM data are used to allocate annual emissons to hourly emission data. More information are available at (<xref linkend="sect_utilities_cemscan" />) and (<xref linkend="sect_concepts_inventory_import" />)</para>

<para>If new sources are added to the input files or sources are removed, <command>Smkinven</command> must be rerun for that type of source. However, <command>Smkinven</command> does not need to be rerun when processing additional control scenarios, growth projections, speciation profiles, or modeling grids.</para>

<para>By default, <command>Smkinven</command> will fill in missing average-day data with annual data when possible. To fill in missing annual data with average-day data, use the <envar>FILL_ANNUAL</envar> setting.</para>

<comment>list default stack parameters and give details about how the filling in is done - this is described in chapter 2 sect_concepts_check_stack_params</comment>

</section>

<section>

<title>Processing Order</title>

<para><command>Smkinven</command> must be run for a given processing type (i.e., area, mobile, point) before any other SMOKE programs for that processing type can be run.</para>

<para>When processing CEM data, the utility program <command>CEMScan</command> must be run before <command>Smkinven</command>.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_smkinven_area">
<title><command>Smkinven</command> input and output files for area sources</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/smkinven_area_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/smkinven_area_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_smkinven_area" /> shows the input and output files for <command>Smkinven</command> for area sources. If importing gridded data, <command>Smkinven</command> reads the <envar>AG</envar> file; for the annual inventory, <command>Smkinven</command> reads the <envar>ARINV</envar> file. The <envar>ARTOPNT</envar> file is used to assign point-source locations to area sources, and either the <envar>COSTCY</envar> or <envar>GEOCODE_LEVEL4</envar> file is used to assign time zones to the annual inventory data. <command>Smkinven</command> also uses the inventory data table (<envar>INVTABLE</envar>), the optional NONHAP exclusions file (<envar>NHAPEXCLUDE</envar>), and the SCC description file (<envar>SCCDESC</envar>) if processing area-to-point sources.</para>

<para><command>Smkinven</command> outputs an annual and average-day inventory emissions file (<envar>AREA</envar>), a file listing the inventory SCCs (<envar>ASCC</envar>), a log file (<envar>LOGFILE</envar>), and a report containing various information about the processed inventory (<envar>REPINVEN</envar>).</para>

<figure id="fig_programs_smkinven_mobile">
<title><command>Smkinven</command> input and output files for mobile sources</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/smkinven_mobile_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/smkinven_mobile_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_smkinven_mobile" /> shows the input and output files for <command>Smkinven</command> for mobile sources. The input files include the country, state and county codes file (<envar>COSTCY</envar>), the inventory data table (<envar>INVTABLE</envar>), the raw inventory file (<envar>MBINV</envar>), and the SCC reference input file (<envar>SCCXREF</envar>) created by <link linkend="sect_moves_gen_sccxref"><envar>Gen_8digit_scc.pl</envar></link>.</para>

<para><command>Smkinven</command> outputs a log file (<envar>LOGFILE</envar>), an annual and average-day inventory emissions file (<envar>MOBL</envar>), a file listing the inventory SCCs (<envar>MSCC</envar>), and a report containing various information about the processed inventory (<envar>REPINVEN</envar>).</para>

<figure id="fig_programs_smkinven_point">
<title><command>Smkinven</command> input and output files for point sources</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/smkinven_point_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/smkinven_point_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_smkinven_point" /> shows the input and output files for <command>Smkinven</command> for point sources. The input files include the optional CEM summary file (<envar>CEMSUM</envar>) created by <command>CEMScan</command>, the country, state and county codes file (<envar>COSTCY</envar>), the inventory data table (<envar>INVTABLE</envar>), and the optional NONHAP exclusions file (<envar>NHAPEXCLUDE</envar>). If importing hour-specific data, the ORIS facility description file <envar>ORISDESC</envar> is used. The <envar>PSTK</envar> file provides replacement stack parameters. Day-specific data is read from the <envar>PTDAY</envar> file, while hour-specific data comes from the <envar>PTHOUR</envar> file; the <envar>PTINV</envar> file provides the raw inventory data. For hour-specific data, the SCC description file (<envar>SCCDESC</envar>) is also needed.</para>

<para><command>Smkinven</command> outputs a log file (<envar>LOGFILE</envar>), and optional day-specific inventory (<envar>PDAY</envar>), and an optional hour-spceific inventory (<envar>PHOUR</envar>). The annual and average-day inventory emissions are stored in the <envar>PNTS</envar> file and the <envar>PSCC</envar> file lists the inventory SCCs. Finally, the <envar>REPINVEN</envar> report contains various information about the processed inventory.</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="4">
<colspec colwidth="25*" />
<colspec colwidth="18*" />
<colspec colwidth="10*" />
<colspec colwidth="47*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Source Type</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>AG</envar> (optional)</entry>
<entry>I/O API NetCDF</entry>
<entry>A</entry>
<entry>Gridded annual or average-day data; this file can be created by <command>Smkmerge</command> and must be time-independent</entry>
</row>
<row>
<entry><envar>[AR|MB|PT]INV</envar></entry>
<entry>ASCII</entry>
<entry>A, M, P</entry>
<entry>Annual and average-day emissions and source characteristics raw inventory data</entry>
</row>
<row>
<entry><envar>ARTOPNT</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>A</entry>
<entry>Area-to-point cross-reference file for assigning X and Y locations to area sources</entry>
</row>
<row>
<entry><envar>CEMSUM</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>P</entry>
<entry>CEM summary data produced by <command>CEMScan</command></entry>
</row>
<row>
<entry><envar>COSTCY</envar></entry>
<entry>ASCII</entry>
<entry>A, M, P</entry>
<entry>Country, state, and county codes file, with time zones</entry>
</row>
<row>
<entry><link linkend="sect_input_geocode"><envar>GEOCODE_LEVEL[1-4]</envar></link></entry>
<entry>ASCII</entry>
<entry>A, B, M, P</entry>
<entry>Geographical level codes and descriptions for gridded inventories, only when USE_EXP_GEO_CODES is set to Y, (COSTCY is ignored when <link linkend="sect_input_geocode"><envar>GEOCODE_LEVEL[1-4]</envar></link> files are used)</entry>
</row>
<row>
<entry><envar>GRIDMASK</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>A, B, M, P</entry>
<entry>Defines an integer geocode to specify the predominant country and state code covered by each grid cell (<envar>GEOCODE_LEVEL</envar>) and an integer <envar>TZONES</envar> to specify the predominant Time Zone for each grid cell.</entry>
</row>
<row>
<entry><envar>INVTABLE</envar></entry>
<entry>ASCII</entry>
<entry>A, M, P</entry>
<entry>Inventory data table listing pollutant and activity names</entry>
</row>
<row>
<entry><envar>NHAPEXCLUDE</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>A, M, P</entry>
<entry>List of counties and SCCs to exclude from toxics integration</entry>
</row>
<row>
<entry><envar>ORISDESC</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>P</entry>
<entry>ORIS facility descriptions, needed for getting ORIS facility names for reporting purposes when CEM hour-specific data are read</entry>
</row>
<row>
<entry><envar>PSTK</envar></entry>
<entry>ASCII</entry>
<entry>P</entry>
<entry>Replacement stack parameters file</entry>
</row>
<row>
<entry><envar>PTDAY</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>P</entry>
<entry>Day-specific raw inventory data</entry>
</row>
<row>
<entry><envar>PTHOUR</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>P</entry>
<entry>Hour-specific raw inventory data</entry>
</row>
<row>
<entry><envar>SCCDESC</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>P</entry>
<entry>SCC descriptions, needed for reading CEM hour-specific data only, to select electric generator facilities in the inventory</entry>
</row>
<row>
<entry><envar>SCCXREF</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>M</entry>
<entry>SCC cross reference input file created by <link linkend="sect_moves_gen_sccxref"><envar>Gen_8digit_scc.pl</envar></link>. It maps aggregated mobile activity SCC8 to full SCC10.</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section id="sect_programs_smkinven_envar">

<title>Input Environment Variables</title>

<itemizedlist>
<listitem>
<para><envar>USE_EXP_GEO_CODES</envar>: [default: N]</para>
<para>If set to Y then use GEOCODE_LEVEL[1-4] files instead of the COSTCY file to define expanded geographical detail such as country-level(GEOCODE_LEVEL1), country/state-level (GEOCODE_LEVEL2), country/state/county-level (GEOCODE_LEVEL3) or country/state/county/tribal-level (GEOCODE_LEVEL4).</para>
</listitem>
<listitem>
<para><envar>ALLOW_NEGATIVE</envar>: [default: N]</para>
<para>Indicates if <command>Smkinven</command> should permit negative emissions values to be input from inventory files and output to <envar>SMOKE</envar> intermediate files.</para>
<itemizedlist>
<listitem>
<para>Y: Accept negative emissions values and will allow compute variables (from the <envar>SMKINVEN_FORMULA</envar> variable) to be negative. <command>Smkinven</command> gives warnings for each negative value in the inventory input and each computed value, until triggering the <envar>SMK_MAXWARNING</envar> setting's values.</para>
</listitem>
<listitem>
<para>N: Do not permit negative emissions values. Accept negative emissions values in the input inventory files, and will give errors for these.  <command>Smkinven</command> will reset all negative computed values (from the <envar>SMKINVEN_FORMULA</envar> variable) to zero.  <command>Smkinven</command> gives warnings for each negative computed value and indicates that the value was reset to zero.</para>
</listitem>
</itemizedlist>

</listitem>

<listitem>
<para><envar>CHECK_STACKS_YN</envar>: [default: Y]</para>

<para>Indicates if stack parameter values should be checked for missing or out-of-range values; only checked if <envar>SMK_SOURCE</envar> is set to P.</para>

<itemizedlist>
<listitem>
<para>Y: Check input stack parameters for missing or out-of-range values</para>
</listitem>
<listitem>
<para>N: Do not check input stack parameter values</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>DAY_SPECIFIC_YN</envar>: [default: N]</para>
<para>Defines whether to import day-specific inventory data.</para>
<itemizedlist>
<listitem>
<para>Y: Import day-specific data</para>
</listitem>
<listitem>
<para>N: Do not import day-specific data</para>
</listitem>
</itemizedlist>
</listitem>

<listitem>
<para><envar>EXCLUDE_REF_SCC_YN</envar>: [default: N]</para>
<para>Defines whether to exclude a list of SCCs that are not listed in <xref linkend="sect_input_sccxref"/>. This option is only applicable when <envar>USE_REF_SCC_YN</envar> is set to Y.</para>
<itemizedlist>
<listitem>
<para>Y: Import day-specific data</para>
</listitem>
<listitem>
<para>N: Do not import day-specific data</para>
</listitem>
</itemizedlist>
</listitem>

<listitem>
<para><envar>FF10_AVEDAY_ANNINV_YN</envar>: [default N]</para>
<para>Uses area daily or hourly FF10-formatted invenotry as annual data. This will allow users to process ARDAY or ARHOUR invenotry data independently without artifical annual inventory data.</para>
<itemizedlist>
<listitem>
<para>Y: Use daily or hourly FF10-formatted inventory as annual data.</para>
</listitem>
<listitem>
<para>N: Do not use daily or hourly FF10-formatted inventory as annual data. Just it as daily or hourly FF10-formatted inventory data.</para>
</listitem>
</itemizedlist>
</listitem>

<listitem>
<para><envar>FILL_ANNUAL</envar>: [default N]</para>
<para>Allows annual data to be filled in with average-day data.</para>
<itemizedlist>
<listitem>
<para>Y: Use <quote>Y</quote> when annual emission numbers are blank for some records of the inventory but not all records. The emissions values will be filled in using the average-day emissions field, by multiplying the average-day number by the number of days in the inventory year (365 or 366). This option is useful when some sources have only annual data and some sources have only average-day data. Although the annual number will be filled in using the average-day one, the average-day emissions will be output from SMOKE as a whole.</para>
</listitem>
<listitem>
<para>N: Do not fill in annual data based on average-day emissions values.</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>FLOW_RATE_FACTOR</envar>: [default: 0.0 ft<superscript>3</superscript>/MMBTU]</para>

<para>Used to calculate hourly flow rates from hourly heat input when reading CEM data. If <envar>FLOW_RATE_FACTOR</envar> is set to zero or unset, then <command>Smkinven</command> will not calculate hourly flow rates. Detail information is described in <xref linkend="sect_concepts_hour_specific_cem" /></para>

<para>hourly flow rate (m<superscript>3</superscript>/s) = [<envar>FLOW_RATE_FACTOR</envar> (ft<superscript>3</superscript>/MMBTU) * hourly heat input (MMBTU/hr) * 0.02831 m<superscript>3</superscript>/ft<superscript>3</superscript>] / 3600 s/hr</para>

</listitem>

<listitem>
<para><envar>FULLSCC_ONLY</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" />. In this context, this option affects cross-referencing for the <envar>ARTOPNT</envar>, and <envar>NHAPEXCLUDE</envar> files by preventing left-7 SCC assignments. It also prevents left-2 and left-4 SCC assignments for NHAPEXCLUDE.</para>
</listitem>

<listitem>
<para><envar>HOUR_SPECIFIC_YN</envar>: [default: N]</para>

<para>Defines whether to import hour-specific inventory data.</para>

<itemizedlist>
<listitem>
<para>Y: Import hour-specific data</para>
</listitem>
<listitem>
<para>N: Do not import hour-specific data</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>HOURLY_TO_DAILY</envar>: [default: N]</para>

<para>Defines whether to treat the hour-specific inputs as day-specific data.</para>

<itemizedlist>
<listitem>
<para>Y: Use daily-total column only from hour-specific input file, and process as day-specific data. <emphasis>This setting does not work for input of hour-specific data using CEM format.</emphasis></para>
</listitem>
<listitem>
<para>N: Treat hourly file as hourly data</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>HOURLY_TO_PROFILE</envar>: [default: N]</para>

<para>Defines whether to treat the hour-specific inputs as hour-specific temporal profiles.</para>

<itemizedlist>
<listitem>
<para>Y: Treat hourly data as temporal profile, and divide each hourly value by value in the daily total column of the file. The values are not renormalized. The resulting hour-specific output file will be recognized by the <command>Temporal</command> program as containing hourly profiles. <emphasis>This setting does not work for input of hour-specific data using CEM format.</emphasis></para>
</listitem>
<listitem>
<para>N: Treat hourly file as hourly data</para>
</listitem>
</itemizedlist>

</listitem>

<listitem>
<para><envar>IMPORT_AVEINV_YN</envar>: [default: Y]</para>

<para>Defines whether to import the annual and average-day inventory data. This is set to N to import day-specific or hour-specific data after <command>Smkinven</command> has previously been run for the annual and average-day data.</para>

<itemizedlist>
<listitem>
<para>Y: Import annual and average-day inventory data from <envar>PTINV</envar> file</para>
</listitem>
<listitem>
<para>N: Use SMOKE inventory files from a previous run of <command>Smkinven</command> to get the SMOKE source characteristics to match with the day-specific and hour-specific sources</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>IMPORT_GRDIOAPI_YN</envar>: [default: N]</para>

<para>Defines whether the program will import a gridded I/O API NetCDF inventory file. This setting can be used only with area-source processing, and it overrides all other program settings for importing data (e.g., day- and hour-specific data import will be shut off).</para>

<itemizedlist>
<listitem>
<para>Y: Import gridded I/O API data</para>
</listitem>
<listitem>
<para>N: Do not import gridded I/O API data</para>
</listitem>
</itemizedlist>

</listitem>

<listitem>
<para><envar>INVNAME1</envar>: [default: none]</para>

<para>Sets root for naming output map inventory file</para>

</listitem>
<listitem>
<para><envar>INVNAME2</envar>: [default: none]</para>
<para>Sets root for naming output ASCII inventory file</para>
</listitem>

<listitem>
<para><envar>MIN_STK_HEIGHT</envar>: [default: 0.5]</para>
<para>Define minimum stack height in unit of meter</para>
</listitem>
<listitem>
<para><envar>MAX_STK_HEIGHT</envar>: [default: 5100.0]</para>
<para>Define maximum stack height in unit of meter</para>
</listitem>
<listitem>
<para><envar>MIN_STK_DIAMETER</envar>: [default: 0.01]</para>
<para>Define minimum stack diameter in unit of meter</para>
</listitem>
<listitem>
<para><envar>MAX_STK_DIAMETER</envar>: [default: 100.0]</para>
<para>Define maximum stack diameter in unit of meter</para>
</listitem>
<listitem>
<para><envar>MIN_STK_TEMPERATURE</envar>: [default: 260.0]</para>
<para>Define minimum stack exit temperature in unit of Kelvin</para>
</listitem>
<listitem>
<para><envar>MAX_STK_TEMPERATURE</envar>: [default: 2000.0]</para>
<para>Define maximum stack exit temperature in unit of Kelvin</para>
</listitem>
<listitem>
<para><envar>MIN_STK_VELOCITY</envar>: [default: 0.0001]</para>
<para>Define minimum stack exit velocity in unit of m/sec</para>
</listitem>
<listitem>
<para><envar>MAX_STK_VELOCITY</envar>: [default: 0.0001]</para>
<para>Define maximum stack exit velocity in unit of m/sec</para>
</listitem>

<listitem>
<para><envar>NONHAP_TYPE</envar>: [default: VOC]</para>
<para>Define the name of organic compound inventory pollutant VOC or TOG for a proper integration between VOC or TOG, and hazardous air pollutants (HAPs) to compute NONHAPVOC or NONHAPTOG. See <xref linkend="sect_concepts_combine_toxics" /> for a more detail description of criteria/HAP VOC integration. This option will be used only when <envar>SMK_PROCESS_HAPS</envar> is set. </para>
</listitem>

<listitem>
<para><envar>NO_STACK_REPLACE_FUGITIVE</envar>: [default: N]</para>

<para>Defines whether the program skips correcting any missing and/or out-of-range stack parameters.</para>

<itemizedlist>
<listitem>
<para>Y: Skip correcting any missing and/or out-of-range stack parameters</para>
</listitem>
<listitem>
<para>N: Do not skip correcting any missing and/or out-of-range stack parameters</para>
</listitem>
</itemizedlist>
</listitem>

<listitem>
<para><envar>OUTPUT_LOCAL_TIME</envar>: [default: N]</para>

<para>Defines whether the program processes daily/hourly inventories in local time or not.</para>

<itemizedlist>
<listitem>
<para>Y: Process daily/hourly inventories in local time. No time zone shift.</para>
</listitem>
<listitem>
<para>N: Apply time zone shift.</para>
</listitem>
</itemizedlist>
</listitem>

<listitem>
<para><envar>RAW_DUP_CHECK</envar>: [default: N]</para>

<para>Defines whether the program checks for duplicate records in the input file.</para>

<itemizedlist>
<listitem>
<para>Y: Check for duplicates, and produce a fatal error if found</para>
</listitem>
<listitem>
<para>N: Do not check for duplicates, and add emissions from duplicate records</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>SMK_ARTOPNT_YN</envar>: [default: N]</para>

<itemizedlist>
<listitem>
<para>Y: Assign X and Y coordinates to specified sources based on the <envar>ARTOPNT</envar> cross-reference file</para>
</listitem>
<listitem>
<para>N: Do not perform area-to-point processing</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>SMK_BASEYR_OVERRIDE</envar>: [default: 0]</para>

<para>Used to override the base year determined by the inventory.</para>
</listitem>
<listitem>
<para><envar>SMK_DEFAULT_TZONE</envar>: [default: 5]</para>

<para>Defines the default time zone to use for sources that do not match entries in the <envar>COSTCY</envar> or the <envar>GEOCODE_LEVEL4</envar> file.</para>
</listitem>

<listitem>
<para><envar>SMK_MAXERROR</envar>: [default: 100]</para>

<para>Defines the maximum number of ERROR statements to be displayed by SMOKE.</para>
</listitem>
<listitem>
<para><envar>SMK_MAXWARNING</envar>: [default: 100]</para>

<para>Defines the maximum number of WARNING statements to be displayed by SMOKE.</para>
</listitem>

<listitem>
<para><envar>SMK_PROCESS_HAPS</envar>: [default: blank]</para>
<para>Defines how to treat sources for combining criteria VOC and hazardous air pollutants (HAP) together. See <xref linkend="sect_concepts_combine_toxics" /> for more detail. </para>
<itemizedlist>
<listitem>
<para>ALL: Treat all sources as integrated if a toxics inventory has been provided. Does not require an <envar>NHAPEXCLUDE</envar> file</para>
</listitem>
<listitem>
<para>NONE: Treat all sources as non-integrate if a toxics inventory has been provided. Does not require an <envar>NHAPEXCLUDE</envar> file</para>
</listitem>
<listitem>
<para>PARTIAL: Read the <envar>NHAPEXCLUDE</envar> cross-reference file and either include or exclude the specified sources from the NONHAP[VOC|TOG] calculation depending on the header of the <envar>NHAPEXCLUDE</envar> file. See <xref linkend="sect_input_nhapexclude" />.</para>
</listitem>
</itemizedlist>
</listitem>

<listitem>
<para><envar>SMK_SOURCE</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" /></para>
</listitem>
<listitem>
<para><envar>SMK_TMPDIR</envar>: [default: <filename class="directory">.</filename>]</para>

<para>Sets the path for writing temporary files needed when importing the inventory.</para>
</listitem>
<listitem>
<para><envar>SMKINVEN_FORMULA</envar>: [default: blank]</para>

<para>Allows the user to specify a formula for computing one or more pollutant values from the values of other pollutants. To use, users should set the value of <envar>SMKINVEN_FORMULA</envar> to a double-quote-enclosed string of 512 characters or less, using a comma-delimited list of formulas.  No spaces are necessary in the formula list. Only formulas of a specific structure are accepted. Specifically, one of the following:</para>

<itemizedlist>
<listitem>
OUTPUT = INPUT1 + INPUT2
</listitem>
<listitem>
OUTPUT = INPUT1 - INPUT2
</listitem>
</itemizedlist>
<para>For example, if the formula is set to <quote>PMC=PM10-PM2_5,EXH__PMC=EXH__PM10-EXH__PM2_5</quote>, then <command>Smkinven</command> will compute two new variables: (1) PMC, as the difference between PM<subscript>10</subscript> and PM<subscript>2.5</subscript> and (2) EXH__PMC as the difference between exhaust PM<subscript>10</subscript> and exhaust PM<subscript>2.5</subscript>. The pollutant units are taken from the first variable in each formula. The variables used as input in the formula will still be output to the SMOKE inventory file. If the formula is not set, no additional variables will be written to the SMOKE inventory file. An output from one formula may not be used as an input to another formula. In the OUTPUT pollutant name is the same as an INPUT pollutant name from the inventory file, Smkinven will give an error indicating that the second pollutant could not be written (e.g. if computing PMC when PMC is already in the raw inventory data). If INPUT2 is ommitted, an error will also occur.  Formulas using multiplication and division are not yet implemented.</para>
</listitem>

<listitem>
<para><envar>SMKINVEN_MONTH</envar>: [default: 0 ]</para>
<para>Defines the number of month to process. The integer month number will allow users to pick monthly total inventory data in area FF10-formatted invenotry data listed at <xref linkend="tbl_input_arinv_ff10" />.</para> 
</listitem>

<listitem>
<para><envar>USE_REF_SCC_YN</envar>: [default: N]</para>
<para>Defines whether use reference SCC (i.e., SCC8) to full SCC (i.e., SCC10) mapping input file to convert reference SCC-level inventory to full SCC inventory. See detail from <xref linkend="sect_input_sccxref"/></para>
<itemizedlist>
<listitem>
<para>Y: Use reference SCC mapping input file to convert reference SCCs to full SCCs.</para>
</listitem>
<listitem>
<para>N: Do not use SCCXREF input file.</para>
</listitem>
</itemizedlist>

</listitem>

<listitem>
<para><envar>VELOC_RECALC</envar>: [default: N]</para>
<para>Defines whether stack velocity is recalculated in order to make the velocity consistent with the reported flow and diameter.</para>
<itemizedlist>
<listitem>
<para>Y: Recalculate stack velocity</para>
</listitem>
<listitem>
<para>N: Output the input stack velocity </para>
</listitem>
</itemizedlist>

</listitem>

<listitem>
<para><envar>WEST_HSPHERE</envar>: [default: Y]</para>

<para>Defines how spatial coordinates are interpreted.</para>
<itemizedlist>
<listitem>
<para>Y: Convert longitudinal coordinates for the Western Hemisphere (positive values are converted to negative values)</para>
</listitem>
<listitem>
<para>N: Do not convert longitude values (positive values are not changed)</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>WKDAY_NORMALIZE</envar>: [default: N]</para>

<para>Clarifies the nature of the <quote>average-day</quote> data read in by <command>Smkinven</command> and will impact the <command>Temporal</command> program processing of average-day data for all formats.</para>

<itemizedlist>
<listitem>
<para>Y: Average-day emissions input to <command>Smkinven</command> are based on weekday emissions only. In <command>Temporal</command>, these emissions will be adjusted with weekly profiles normalized with weekdays only (Monday through Friday)</para>
</listitem>
<listitem>
<para>N: Average-day emissions input to <command>Smkinven</command> are based on <emphasis>all days of the week</emphasis>. In <command>Temporal</command>, these emissions will be adjusted with weekly profiles normalized with all days of the week.</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>WRITE_ANN_ZERO</envar>: [default: N]</para>

<para>Indicates if annual emission values equal to zero should be written to the intermediate inventory file</para>

<itemizedlist>
<listitem>
<para>Y: Write zero emission values; this option makes the intermediate inventory file larger but is sometimes necessary when only daily or hourly data is provided and the entries in the annual inventory are dummy values</para>
</listitem>
<listitem>
<para>N: Do not write zero values</para>
</listitem>
</itemizedlist>

</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="25*" />
<colspec colwidth="18*" />
<colspec colwidth="57*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[AREA|MOBL|PNTS]</envar></entry>
<entry>SMOKE map</entry>
<entry>Annual and average-day inventory emissions and source characteristics</entry>
</row>
<row>
<entry><envar>[ASCC|MSCC|PSCC]</envar></entry>
<entry>ASCII</entry>
<entry>List of SCCs appearing in the raw inventory file</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>ADAY | PDAY</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Day-specific inventory emissions assigned to sources in annual/average-day files (optional)</entry>
</row>
<row>
<entry><envar>AHOUR | PHOUR</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Hour-specific inventory emissions assigned to sources in annual/average day files (optional)</entry>
</row>
<row>
<entry><envar>REPINVEN</envar> (optional)</entry>
<entry>ASCII</entry>
<entry><para>Inventory report file; contents depend on the inventory being processed, but can include:</para>

<para>CEM section:</para>

<itemizedlist spacing="compact">
<listitem>ORIS IDs from the CEM matched to the inventory</listitem>
<listitem>ORIS IDs from the CEM not matched to the inventory</listitem>
<listitem>Power-generating inventory sources not matched to the CEM</listitem>
</itemizedlist>

<para>Toxics section:</para>

<itemizedlist spacing="compact">
<listitem>Total emissions and number of inventory records by CAS number</listitem>
<listitem>Total emissions before and after aggregation by CAS number</listitem>
</itemizedlist>

<para>Area-to-point section:</para>

<itemizedlist spacing="compact">
<listitem>SCCs in the <envar>ARTOPNT</envar> file but not in the inventory</listitem>
<listitem>Total emissions before and after area-to-point processing by pollutant, state, and SCC</listitem>
</itemizedlist>
</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

</section>

<section id="sect_programs_smkmerge">

<title><command>Smkmerge</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> area, biogenic, mobile, point</para>

<para>The <command>Smkmerge</command> program combines the matrices produced by the other SMOKE programs to produce the emissions files for input to the AQM. The <command>Smkmerge</command> program may be run on any combination of source types and may incorporate temporal, speciation, projection, and spatial processing.</para>

<para>If <command>Smkmerge</command> is run to produce the input files to the AQM, all the other SMOKE programs must already have been run. However, you can also run <command>Smkmerge</command> to produce specialized reports. In that instance, only the required subset of SMOKE programs must have been run prior to <command>Smkmerge</command>.</para>

<para><command>Smkmerge</command> can be used to create 2-D or 3-D gridded, hourly, speciated files. It also outputs the hourly emissions file for PinG sources needed by CMAQ. Finally, it outputs an ASCII elevated point sources file, suitable for postprocessing with the Ptsrce program of EPS2.0/EPS2.5. If PinG sources have been selected and an ASCII elevated sources file is output, then SMOKE will set the stack diameters to negative values for the PinG sources.</para>

<section>

<title>By-day processing</title>

<para><command>Smkmerge</command> can use a by-day processing approach, to read in one-day hourly files for each day of the week. When the <envar>MRG_BYDAY</envar> environment variable is set to A, M, P, or any combination of those letters, <command>Smkmerge</command> reads a different logical file name for each day of the week for the hourly emission input files for the indicated sources.</para>

<para>For example, if the <envar>MRG_SOURCE</envar> environment variable is set to AMBP, <command>Smkmerge</command> will expect the following hourly input files: <envar>ATMP</envar>, <envar>BGTS_[S|L]</envar>, <envar>MTMP</envar>, and <envar>PTMP</envar>, for area, biogenic, mobile, and point source types respectively. If, in addition, <envar>MRG_BYDAY</envar> is set to <quote>A</quote>, then the hourly input files expected by <command>Smkmerge</command> for area sources would be the <envar>ATMP_{day}</envar> files. The files for the other source types would remain the same.</para>

<para>The <envar>MRG_BYDAY</envar> option is useful for implementing a Monday-weekday-Saturday-Sunday (MWSS) approach to save processing time for long episodes. This approach is applicable when weekly temporal profiles used by an inventory do not have variation between the five weekdays. In the MWSS approach, Monday is processed separately, because time zone differences across a large domain cause some Sunday emissions for some time zones to be in the Monday file. Additional environment variables other than the defaults in the Assigns file need to be set when this option is applied. <command>Smkmerge</command> will prompt for a different file for each day of the week, but the logical file names for Tuesday through Friday can be defined as the same file when implementing the MWSS approach.</para>

</section>

</section>

<section>

<title>Processing Order</title>

<para>All other SMOKE core programs except the optional program <command>Mrggrid</command> prepare input for the <command>Smkmerge</command> program. <command>Smkmerge</command> is the last nonoptional SMOKE program to be run.</para>

<para>Individual output files from <command>Smkmerge</command> can be merged using <command>Mrggrid</command> if desired.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_smkmerge_area">
<title><command>Smkmerge</command> input and output files for area sources</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/smkmerge_area_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/smkmerge_area_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_smkmerge_area" /> shows the input and output files for the <command>Smkmerge</command> program for area sources. The inputs include the optional multiplicative control matrix from <command>Cntlmat</command> (<envar>ACMAT</envar>), the gridding matrix from <command>Grdmat</command> (<envar>AGMAT</envar>), the inventory file output from <command>Smkinven</command> (<envar>AREA</envar>), the optional reactivity matrix from <command>Cntlmat</command> (<envar>ARMAT</envar>), and the optional speciation matrix from <command>Spcmat</command> (<envar>ASMAT</envar>). <command>Smkmerge</command> can also use hourly emissions from <command>Temporal</command>, either a single file (<envar>PTMP</envar>) or hourly emissions for each day of the week (<envar>ATMP_{day}</envar>). The last three input files are the country, state, and county codes file (<envar>COSTCY</envar>), the inventory data table (<envar>INVTABLE</envar>), and the grid description file (<envar>GRIDDESC</envar>).</para>

<para><command>Smkmerge</command> outputs a data file that is determined by the inputs and can be a model-ready emissions file (<envar>AG[T][S][C]_L</envar> or <envar>AG[T][S][C]_S</envar>), a log file (<envar>LOGFILE</envar>), and an optional report file (<envar>REPAG[T][S][C]_L</envar> or <envar>REPAG[T][S][C]_S</envar>).</para>

<para>When using source apportionment (see <xref linkend="sect_scripts_source_apportionment" />), <command>Smkmerge</command> will also read the source grouping file (<envar>SOURCE_GROUPS</envar>) and output the source group information <envar>SRCGROUPS_OUT</envar>, the emissions for each source group <envar>SGINLNTS_L</envar> or <envar>SGINLNTS_S</envar>, and a source group report file <envar>SRCGRP_REPORT</envar>.</para>

<figure id="fig_programs_smkmerge_biogenic">
<title><command>Smkmerge</command> input and output files for biogenic sources</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/smkmerge_biogenic_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/smkmerge_biogenic_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_smkmerge_biogenic" /> shows the input and output files for the <command>Smkmerge</command> program for biogenic sources. The inputs are the optional surrogates file (<envar>BGPRO</envar>), the model-ready emissions file (<envar>BGTS</envar>), the country, state, and county file (<envar>COSTCY</envar>), the grid description file (<envar>GRIDDESC</envar>), and the inventory data table (<envar>INVTABLE</envar>).</para> 

<para><command>Smkmerge</command> outputs either a mole-based emissions file (<envar>BGTS_L_O</envar>) or a mass-based emissions file (<envar>BGTS_S_O</envar>). Note that _O is appended to the output file name to distinguish it from the input file. The program also writes a log file (<envar>LOGFILE</envar>) and an optional report file (<envar>REPBGTS_L</envar> or <envar>REPBGTS_S</envar>).</para>

<para>When using source apportionment (see <xref linkend="sect_scripts_source_apportionment" />), <command>Smkmerge</command> will also read the source grouping file (<envar>SOURCE_GROUPS</envar>) and output the source group information <envar>SRCGROUPS_OUT</envar>, the emissions for each source group <envar>SGINLNTS_L</envar> or <envar>SGINLNTS_S</envar>, and a source group report file <envar>SRCGRP_REPORT</envar>.</para>

<figure id="fig_programs_smkmerge_mobile">
<title><command>Smkmerge</command> input and output files for mobile sources</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/smkmerge_mobile_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/smkmerge_mobile_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_smkmerge_mobile" /> shows the input and output files for the <command>Smkmerge</command> program for mobile sources. The inputs include the country, state and county codes file (<envar>COSTCY</envar>), the inventory data table (<envar>INVTABLE</envar>), and the grid description file (<envar>GRIDDESC</envar>). <command>Smkmerge</command> also reads the optional multiplicative control matrix from <command>Cntlmat</command> (<envar>MCMAT</envar>), the gridding matrix from <command>Grdmat</command> (<envar>MGMAT</envar>), the inventory file output from <command>Smkinven</command> (<envar>MOBL</envar>), the optional reactivity matrix from <command>Cntlmat</command> (<envar>MRMAT</envar>), and the optional speciation matrix from <command>Spcmat</command> (<envar>MSMAT_L</envar> or <envar>MSMAT_S</envar>). Hourly emissions can be input either as a single file (<envar>MTMP</envar>) or as hourly emissions for each day of the week (<envar>MTMP_{day}</envar>).</para>

<para><command>Smkmerge</command> outputs a log file (<envar>LOGFILE</envar>), a data file that is determined by the inputs and can be a model-ready emissions file (<envar>MG[T][S][C]_L</envar> or <envar>MG[T][S][C]_S</envar>), and an optional report file (<envar>REPMG[T][S][C]_L</envar> or <envar>REPMG[T][S][C]_S</envar>).</para>

<para>When using source apportionment (see <xref linkend="sect_scripts_source_apportionment" />), <command>Smkmerge</command> will also read the source grouping file (<envar>SOURCE_GROUPS</envar>) and output the source group information <envar>SRCGROUPS_OUT</envar>, the emissions for each source group <envar>SGINLNTS_L</envar> or <envar>SGINLNTS_S</envar>, and a source group report file <envar>SRCGRP_REPORT</envar>.</para>

<figure id="fig_programs_smkmerge_point">
<title><command>Smkmerge</command> input and output files for point sources</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/smkmerge_point_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/smkmerge_point_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_smkmerge_point" /> shows the input and output files for the <command>Smkmerge</command> program for point sources. The inputs include the country, state, and county codes file (<envar>COSTCY</envar>), the inventory data table (<envar>INVTABLE</envar>), the grid description file (<envar>GRIDDESC</envar>), and the optional multiplicative control matrix from <command>Cntlmat</command> (<envar>PCMAT</envar>). If using PinG or elevated sources, the <envar>PELV</envar> file is used. <command>Smkmerge</command> reads the gridding matrix output from <command>Grdmat</command> (<envar>PGMAT</envar>). The <envar>PLAY</envar> file is used to merge layer fractions, while the <envar>PLAY_EX</envar> file is used for explicit plumes. Other <command>Smkmerge</command> input files include the inventory file output from <command>Smkinven</command> (<envar>PNTS</envar>), the optional reactivity matrix from <command>Cntlmat</command> (<envar>PRMAT</envar>), and the optional speciation matrix from <command>Spcmat</command> (<envar>PSMAT</envar>). The hourly emissions from <command>Temporal</command> are provided either as the <envar>PTMP</envar> file or as hourly emissions for each day of the week (<envar>PTMP_{day}</envar>). Finally, <command>Smkmerge</command> can read the optional elevated stack groups file (<envar>STACK_GROUPS</envar>).</para>

<para><command>Smkmerge</command> can output an elevated sources file (<envar>ELEV[T]S[_S|_L]</envar>) if requested. Like all other SMOKE programs, <command>Smkmerge</command> outputs a log file (<envar>LOGFILE</envar>) detailing the program&rsquo;s execution. The main data file is determined by the inputs and can be include a model-ready emissions file (<envar>PG[T][S][C][3D]_L</envar> or <envar>PG[T][S][C][3D]_S</envar>). Other output files can be a PinG file (<envar>PING[T][S][C][_S][_L]</envar> and a report file (<envar>REPPG[T][S][C]_L</envar> or <envar>REPPG[T][S][C]_S</envar>).</para>

<para>When using source apportionment (see <xref linkend="sect_scripts_source_apportionment" />), <command>Smkmerge</command> will also read the source grouping file (<envar>SOURCE_GROUPS</envar>) and the stack groups file (<envar>STACK_GROUPS</envar>), and output the source group information <envar>SRCGROUPS_OUT</envar>, the emissions for each source group <envar>SGINLNTS_L</envar> or <envar>SGINLNTS_S</envar>, and a source group report file <envar>SRCGRP_REPORT</envar>.</para>

<figure id="fig_programs_smkmerge_all">
<title><command>Smkmerge</command> input and output files for all source categories</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/smkmerge_all_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/smkmerge_all_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_smkmerge_all" /> shows the input and output files for the <command>Smkmerge</command> program for all sources. The input and output files are a combination of those found in the previous four figures.</para>

<section>

<title>Input Files</title>

<para>The input files needed depend upon the input environment variables that are set for this program. For example, if only area sources are being merged, then only area-source-related inputs are required. Similarly, if <command>Smkmerge</command> is being executed to produce speciated, gridded, temporally allocated area and point sources, then all area- and point-related inputs for area and point sources, speciation matrices, gridding matrices, and temporal matrices are required.</para>

<informaltable>
<tgroup cols="4">
<colspec colwidth="30*" />
<colspec colwidth="18*" />
<colspec colwidth="10*" />
<colspec colwidth="42*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Source Type</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[A|M|P]CMAT</envar> (optional)</entry>
<entry>I/O API NetCDF</entry>
<entry>A, M, P</entry>
<entry>Multiplicative control matrix, output by <command>Cntlmat</command> (used when <envar>MRG_CTLMAT_MULT</envar> is set)</entry>
</row>
<row>
<entry><envar>[A|M|P]GMAT</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>A, M, P</entry>
<entry>Gridding matrix from <command>Grdmat</command></entry>
</row>
<row>
<entry><envar>[A|M|P]RMAT</envar> (optional)</entry>
<entry>I/O API NetCDF</entry>
<entry>A, M, P</entry>
<entry>Mass- or mole-based reactivity matrix, output by <command>Cntlmat</command> (used when <envar>MRG_CTLMAT_REAC</envar> is set)</entry>
</row>
<row>
<entry><envar>[A|M|P]SMAT</envar> (optional)</entry>
<entry>I/O API NetCDF</entry>
<entry>A, M, P</entry>
<entry>Mass- or mole-based speciation matrix from <command>Spcmat</command> (used when <envar>MRG_SPCMAT_YN</envar> = Y)</entry>
</row>
<row>
<entry><envar>[A|M|P]TMP</envar> (optional)</entry>
<entry>I/O API NetCDF</entry>
<entry>A, M, P</entry>
<entry>Hourly emissions from <command>Temporal</command> (used when <envar>MRG_TEMPORAL_YN</envar> = Y and <envar>MRG_BYDAY</envar> is not set)</entry>
</row>
<row>
<entry><envar>[A|M|P]TMP_{day}</envar> (optional)</entry>
<entry>I/O API NetCDF</entry>
<entry>A, M, P</entry>
<entry>Hourly emissions from <command>Temporal</command> by day, where {day} = MON, TUE, WED, THU, FRI, SAT, SUN (used when <envar>MRG_TEMPORAL_YN</envar> = Y and <envar>MRG_BYDAY</envar> is set)</entry>
</row>
<row>
<entry><envar>[AREA|MOBL|PNTS]</envar></entry>
<entry>SMOKE map</entry>
<entry>A, M, P</entry>
<entry>Intermediate area-, mobile-, or point-source inventory created by <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>BGPRO</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>B</entry>
<entry>Gridding surrogates for computing biogenic state and county totals from gridded biogenic inputs</entry>
</row>
<row>
<entry><envar>BGTS</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>B</entry>
<entry>Biogenic model-ready emissions, to be input only when merging with other source categories, or when computing biogenic state and county totals, produced by <command>Tmpbio</command> or <command>Tmpbeis3</command></entry>
</row>
<row>
<entry><envar>COSTCY</envar></entry>
<entry>ASCII</entry>
<entry>A, B, M, P</entry>
<entry>Country, state, and county file with time zones</entry>
</row>
<row>
<entry><link linkend="sect_input_geocode"><envar>GEOCODE_LEVEL[1-4]</envar></link></entry>
<entry>ASCII</entry>
<entry>A, B, M, P</entry>
<entry>Geographical level codes and descriptions for gridded inventories, only when USE_EXP_GEO_CODES is set to Y, (COSTCY is ignored when <link linkend="sect_input_geocode"><envar>GEOCODE_LEVEL[1-4]</envar></link> files are used)</entry>
</row>
<row>
<entry><envar>INVTABLE</envar></entry>
<entry>ASCII</entry>
<entry>A, B, M, P</entry>
<entry>Inventory data table containing activity and pollutant names</entry>
</row>
<row>
<entry><envar>GRIDDESC</envar></entry>
<entry>ASCII</entry>
<entry>A, B, M, P</entry>
<entry>Description of the modeling grid</entry>
</row>
<row>
<entry><envar>PELV</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>P</entry>
<entry>Elevated point sources identification file, output by <command>Elevpoint</command></entry>
</row>
<row>
<entry><envar>PLAY</envar> (optional)</entry>
<entry>I/O API NetCDF</entry>
<entry>P</entry>
<entry>Hourly plume rise layer fractions, output by <command>Laypoint</command> (used when <envar>MRG_LAYERS_YN</envar> = Y and <envar>EXPLICIT_PLUMES_YN</envar> = N)</entry>
</row>
<row>
<entry><envar>PLAY_EX</envar> (optional)</entry>
<entry>I/O API NetCDF</entry>
<entry>P</entry>
<entry>Hourly plume rise layer fractions for explicit sources, output by <command>Laypoint</command> (used when <envar>MRG_LAYERS_YN</envar> = Y and <envar>EXPLICIT_PLUMES_YN</envar> = Y)</entry>
</row>
<row>
<entry><envar>STACK_GROUPS</envar> (optional)</entry>
<entry>I/O API NetCDF</entry>
<entry>P</entry>
<entry>Elevated sources stack parameters file, output by <command>Elevpoint</command></entry>
</row>
<row>
<entry><link linkend="sect_input_smkmerge_groups"><envar>SOURCE_GROUPS</envar></link> (optional)</entry>
<entry>ASCII</entry>
<entry>A, B, M, P</entry>
<entry>Source apportionment groups</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section>

<title>Input Environment Variables</title>

<para>NOTE: At least one of the <envar>MRG_GRDOUT_YN</envar>, <envar>MRG_REPSTA_YN</envar>, or <envar>MRG_REPCNY_YN</envar> environment variables must be set to Y.</para>

<itemizedlist>
<listitem>
<para><envar>AREA_SURROGATE_NUM</envar>: [default: 60]</para>

<para>Surrogate code of the area surrogate in the <envar>BGPRO</envar> file, to use for totals of biogenic emissions by state and county.</para>
</listitem>
<listitem>
<para><envar>EXPLICIT_PLUMES_YN</envar>: [default: N]</para>

<para>Indicates whether only explicit plume rise sources should be merged.</para>

<itemizedlist>
<listitem>
<para>Y: Merge only explicit plume rise sources; uses <envar>PLAY_EX</envar> file</para>
</listitem>
<listitem>
<para>N: Merge all plume rise sources; uses <envar>PLAY</envar> file</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>USE_EXP_GEO_CODES</envar>: [default: N]</para>
<para>If set to Y, then use GEOCODE_LEVEL[1-4] files instead of the COSTCY file to define expanded geographical detail such as country-level(GEOCODE_LEVEL1), country/state-level (GEOCODE_LEVEL2), country/state/county-level (GEOCODE_LEVEL3) or country/state/county/tribal-level (GEOCODE_LEVEL4).</para>
</listitem>

<listitem>
<para><envar>MRG_BYDAY</envar>: [default: blank]</para>

<para>String code that specifies which source categories (if any) are to use a by-day approach for the hourly input files (see <quote>Description</quote> section above for more information on this approach). Valid settings include A, M, P, or any combination. For example, set this environment variable to <quote>AMP</quote> to have <command>Smkmerge</command> read the area-, mobile-, and point-source hourly emissions files individually for each day.</para>
</listitem>
<listitem>
<para><envar>MRG_CTLMAT_MULT</envar>: [default: blank]</para>

<para>String code that specifies which source categories (if any) are to be processed using a multiplicative control matrix. Valid settings include A, M, P, or any combination. For example, set this environment variable to <quote>M</quote> to have <command>Smkmerge</command> read the mobile-source multiplicative control matrix.</para>
</listitem>
<listitem>
<para><envar>MRG_CTLMAT_REAC</envar>: [default: blank]</para>

<para>String code that specifies which source categories (if any) are to be processed using a reactivity control matrix. Valid settings include A, M, P, or any combination. For example, set this environment variable to <quote>MP</quote> to have <command>Smkmerge</command> read the mobile- and point-source reactivity control matrices.</para>
</listitem>
<listitem>
<para><envar>MRG_GRDOUT_UNIT</envar>: [default: input file units]</para>

<para>String code that permits the user to change the units of the gridded output file. For example, <quote>kg/hr</quote> would convert the output emissions to kilograms per hour, before outputting the emissions data file. Not all conversions are known to SMOKE. Valid numerators are: <quote>tons</quote>, <quote>kg</quote>, <quote>moles</quote>, and <quote>g</quote>; note that molar emissions cannot be output without the mole-based speciation matrices. Valid denominators are <quote>yr</quote>, <quote>dy</quote>, <quote>hr</quote>, and <quote>s</quote>. Note that if annual output is requested but not available in the input file, leap year adjustments are not made.</para>

<para>Units required by CMAQ are moles/s and most other air quality models are moles/hr.</para>
</listitem>
<listitem>
<para><envar>MRG_GRDOUT_YN</envar>: [default: N]</para>

<para>Defines whether the program produces a gridded output file.</para>

<itemizedlist>
<listitem>
<para>Y: Produce the file</para>
</listitem>
<listitem>
<para>N: Do not produce the file</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>MRG_LAYERS_YN</envar>: [default: N]</para>

<para>Defines whether the program uses the layer fractions file.</para>

<itemizedlist>
<listitem>
<para>Y: Use the layer fractions file</para>
</listitem>
<listitem>
<para>N: Do not use the layer fractions file</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>MRG_MARKETPEN_YN</envar>: [default: Y]</para>

<para>Defines whether the program uses market penetration from reactivity matrices.</para>

<itemizedlist>
<listitem>
<para>Y: Use market penetration</para>
</listitem>
<listitem>
<para>N: Do not use market penetration</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>MRG_METCHK_YN</envar>: [default: Y]</para>

<para>Defines whether the program checks consistency of headers in the meteorology file.</para>

<itemizedlist>
<listitem>
<para>Y: Check contents of meteorology file headers</para>
</listitem>
<listitem>
<para>N: Do not check headers</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>MRG_REPCNY_YN</envar>: [default: N]</para>

<para>Defines whether the program produces a report of emission totals by county.</para>

<itemizedlist>
<listitem>
<para>Y: Produce county-total emissions report</para>
</listitem>
<listitem>
<para>N: Do not produce the report</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>MRG_REPCTL_YN</envar>: [default: N]</para>

<para>Defines whether the program reports controlled emissions or not.</para>

<itemizedlist>
<listitem>
<para>Y: Report controlled emissions</para>
</listitem>
<listitem>
<para>N: Do not report controlled emissions</para>
</listitem>
</itemizedlist>

</listitem>

<comment>
<listitem>
<para><envar>MRG_REPINV_YN</envar>: [default: Y]</para>

<para>Defines whether the program creates a report using inventory emissions. <remark>This option is not available in the current version of SMOKE.</remark></para>

<itemizedlist>
<listitem>
<para>Y: Report inventory emissions</para>
</listitem>
<listitem>
<para>N: Do not report inventory emissions</para>
</listitem>
</itemizedlist>

</listitem>
</comment>

<comment>
<listitem>
<para><envar>MRG_REPSPC_YN</envar>: [default: Y]</para>

<para>Defines whether the program creates a report using speciated emissions. <remark>This option is not available in the current version of SMOKE.</remark></para>

<itemizedlist>
<listitem>
<para>Y: Report speciated emissions</para>
</listitem>
<listitem>
<para>N: Do not report speciated emissions</para>
</listitem>
</itemizedlist>

</listitem>
</comment>

<listitem>
<para><envar>MRG_REPSTA_YN</envar>: [default: N]
Defines whether the program produces a report of emission totals by state.</para>

<itemizedlist>
<listitem>
<para>Y: Produce state-total emissions report</para>
</listitem>
<listitem>
<para>N: Do not produce the report</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>MRG_SOURCE</envar>: [default: blank (processing halts)]</para>

<para>Series of character codes representing the type(s) of sources to be merged.</para>

<itemizedlist>
<listitem>
<para>A: Area sources</para>
</listitem>
<listitem>
<para>B: Biogenic sources</para>
</listitem>
<listitem>
<para>M: Mobile sources</para>
</listitem>
<listitem>
<para>P: Point sources</para>
</listitem>
<listitem>
<para>AP: Area and point sources</para>
</listitem>
<listitem>
<para>AM: Area and mobile sources</para>
</listitem>
<listitem>
<para>etc.</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>MRG_SPCMAT_YN</envar>: [default: N]</para>

<para>Defines whether the program produces speciated output.</para>

<itemizedlist>
<listitem>
<para>Y: Read the speciation matrix produced by the <command>Spcmat</command> program</para>
</listitem>
<listitem>
<para>N: Do not read the speciation matrix</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>MRG_TEMPORAL_YN</envar>: [default: N]</para>

<para>Defines whether the program produces temporally allocated output.</para>

<itemizedlist>
<listitem>
<para>Y: Read the temporal matrix produced by the <command>Temporal</command> program</para>
</listitem>
<listitem>
<para>N: Do not read the temporal matrix</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>MRG_TOTOUT_UNIT</envar>: [default: input file units, or per day if hourly input is used]</para>

<para>This variable is like the <envar>MRG_GRDOUT_UNIT</envar> variable, except that it controls the state and county totals reports separately from the gridded outputs. The only difference is the temporal resolution of <envar>MRG_TOTOUT_UNIT</envar>, which always outputs the emission values as daily totals, no matter what units are used.</para>
</listitem>
<listitem>
<para><envar>SMK_ASCIIELEV_YN</envar>: [default: N]</para>

<para>Defines whether the program produces an ASCII elevated point sources file, suitable for postprocessing with the Ptsrce program in EPS2.0/EPS2.5.</para>

<itemizedlist>
<listitem>
<para>Y: Create the ASCII elevated point sources file</para>
</listitem>
<listitem>
<para>N: Do not create the ASCII elevated point sources file</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>SMK_AVEDAY_YN</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" /></para>

<para>NOTE: This setting affects the <command>Smkmerge</command> results only when hourly emissions are not merged. To use hourly average-day emissions in <command>Smkmerge</command>, this variable must be set to Y for the <command>Temporal</command> program, so that average-day emissions will be used in creating the hourly emissions.</para>
</listitem>
<listitem>
<para><envar>SMK_EMLAYS</envar>: See description in <xref linkend="sect_programs_laypoint_envar" /></para>

<para>Used to set the default value for <envar>UAM_LAYERS</envar> when the <command>Smkmerge</command> output is to be used in UAM-V elevated-point-source output processing.</para>
</listitem>
<listitem>
<para><envar>SMK_PING_METHOD</envar>: See description in <xref linkend="sect_programs_elevpoint_envar" /></para>

<para>Creates CMAQ PinG file or flags PinG sources in UAM-style elevated ASCII file (when the <envar>SMK_ASCIIELEV_YN</envar> environment variable is set to Y).</para>
</listitem>
<listitem>
<para><envar>SMK_REPORT_TIME</envar>: [default: 230000]</para>

<para>Time for writing daily reports from program (HHMMSS).</para>
</listitem>

<listitem>
<para><envar>SMK_SRCGROUP_OUTPUT_YN</envar>: [default: N]</para>
<para>Indicates if source apportionment emissions should be output</para>
<itemizedlist>
<listitem><para>Y: Group sources and output source apportionment files</para></listitem>
<listitem><para>N: Do not perform any source apportionment processing</para></listitem>
</itemizedlist>
</listitem>

<listitem>
<para><envar>SMKMERGE_CUSTOM_OUTPUT</envar>: [default: N]</para>

<para>Defines his/her own output file names from <command>Smkmerge</command>. Manually define environment variables for those output file names below:</para>

<itemizedlist>
<listitem>
<para><envar>[E|A|M|P]OUT</envar> : Processing source output file</para>
</listitem>
<listitem>
<para><envar>ELEV</envar> : Elevated-point-sources file, produced if <envar>SMK_ASCIIELEV_YN</envar> is set to Y; if PinG sources have also been selected, then the stack diameters listed in this file will be set to the negative value of their actual value.</para>
</listitem>
<listitem>
<para><envar>PING</envar> : CMAQ PinG file, produced if <envar>SMK_PING_METHOD</envar> is set to 1</para>
</listitem>
<listitem>
<para><envar>INLN</envar> : CMAQ 2-D surface layer emissions file, produced if <envar>SMK_ELEV_METHOD</envar> is set to 2. For in-line processing plume rise processing, <envar>MRG_LAYERS_YN</envar> must set to N to create hourly speciated 2-D surface layer emissions file for CMAQ version 4.7 or later.</para>
</listitem>
<listitem>
<para><envar>REP[E|A|M|P]G</envar> : Emission total report file, produced if either <envar>MRG_REPSTA_YN</envar> or <envar>MRG_REPCNY_YN</envar> is set to Y</para>
</listitem>
</itemizedlist>

</listitem>
</itemizedlist>

<para>The rest of the variables in this list are relevant only when the <envar>SMK_ASCIIELEV_YN</envar> environment variable is set to Y. The UAM-style elevated-point-source file referenced in the following descriptions is produced by <command>Smkmerge</command> and used as input to the UAM preprocessor Ptsrce.</para>

<itemizedlist>
<listitem>
<para><envar>UAM_LAYERS</envar>: [default: set by value of <envar>SMK_EMLAYS</envar>]</para>

<para>Number of layers to output to the elevated-point-source file.</para>
</listitem>
<listitem>
<para><envar>UAM_NOTE</envar>: [default: <quote>UAM elev pt emis from Smkmerge</quote>]</para>

<para>Message to appear as a note in the elevated-point-source file.</para>
</listitem>
<listitem>
<para><envar>UAM_NPARAM</envar>: [default: 20]</para>

<para>Number of parameters for control packet to appear in the elevated-point-source file.</para>
</listitem>
<listitem>
<para><envar>UAM_PRINT_LOCATIONS</envar>: [default: 0]</para>

<para>Flag printed in the elevated-point-source file to control whether Ptsrce will print the locations table. 0=No; 1=Yes.</para>
</listitem>
<listitem>
<para><envar>UAM_PRINT_METHODS</envar>: [default: 0]</para>

<para>Flag printed in the elevated-point-source file to control whether Ptsrce will print the methods table. 0=No; 1=Yes.</para>
</listitem>
<listitem>
<para><envar>UAM_PRINT_OUTGRD</envar>: [default: 0]</para>

<para>Flag printed in the elevated-point-source file to control whether Ptsrce will print the output grid. 0=No; 1=Yes.</para>
</listitem>
<listitem>
<para><envar>UAM_PRINT_UNITS</envar>: [default: 0]</para>

<para>Flag printed in the elevated-point-source file to control whether Ptsrce will print the units table. 0=No; 1=Yes.</para>
</listitem>
<listitem>
<para><envar>UAM_PRINT_VALUES</envar>: [default: 0]</para>

<para>Flag printed in the elevated-point-source file to control whether Ptsrce will print the values table. 0=No; 1=Yes.</para>
</listitem>
<listitem>
<para><envar>UAM_PRINT_VERTMETH</envar>: [default: 0]</para>

<para>Flag printed in the elevated-point-source file to control whether Ptsrce will print the vertical methods table. 0=No; 1=Yes.</para>
</listitem>
<listitem>
<para><envar>UAM_PTSRCE_OUTUNIT</envar>: [default: 20]</para>

<para>Ptsrce output file unit number in the elevated-point-source file.</para>
</listitem>
<listitem>
<para><envar>UAM_VERTICAL_METHOD</envar>: [default: STACKHGT]</para>

<para>Vertical method in the elevated-point-source file. Appropriate values are STACKHGT and PLUMERISE.</para>
</listitem>
<listitem>
<para><envar>UAM4_DIFFBREAK_UNIT</envar>: [default: 0]</para>

<para>DIFFBREAK file unit number in the elevated-point-source file.</para>
</listitem>
<listitem>
<para><envar>UAM4_HTLOWR</envar>: [default: 20]</para>

<para>Minimum height (in meters) of cells between the surface and the <quote>diffbreak</quote> in the elevated-point-source file.</para>
</listitem>
<listitem>
<para><envar>UAM4_HTSFC</envar>: [default: 0]</para>

<para>Height of the surface layer (in meters) in the elevated-point-source file.</para>
</listitem>
<listitem>
<para><envar>UAM4_HTUPPR</envar>: [default: 100]</para>

<para>Minimum height (in meters) of cells between the <quote>diffbreak</quote> and the top of the model in the elevated-point-source file.</para>
</listitem>
<listitem>
<para><envar>UAM4_LAYABOVE</envar>: [default: <envar>UAM_LAYERS</envar> - <envar>UAM4_LAYBELOW</envar>]</para>

<para>Number of layers above the <quote>diffbreak</quote> in the elevated-point-source file.</para>
</listitem>
<listitem>
<para><envar>UAM4_LAYBELOW</envar>: [default: 3]</para>

<para>Number of layers below the <quote>diffbreak</quote> in the elevated-point-source file.</para>
</listitem>
<listitem>
<para><envar>UAM4_METSCALARS_UNIT</envar>: [default: 15]</para>

<para>METSCALARS file unit number in the elevated-point-source file. Used only for <envar>UAM_VERTICAL_METHOD</envar> set to <quote>PLUMERISE</quote>.</para>
</listitem>
<listitem>
<para><envar>UAM4_REGIONTOP_UNIT</envar>: [default: 0]</para>

<para>REGIONTOP file unit number in the elevated-point-source file.</para>
</listitem>
<listitem>
<para><envar>UAM4_TEMPERATUR_UNIT</envar>: [default: 14]</para>

<para>TEMPERATUR file unit number in the elevated-point-source file. Used only for <envar>UAM_VERTICAL_METHOD</envar> set to <quote>PLUMERISE</quote>.</para>
</listitem>
<listitem>
<para><envar>UAM4_WIND_UNIT</envar>: [default: 16]</para>

<para>WIND file unit number in the elevated-point-source file. Used only for <envar>UAM_VERTICAL_METHOD</envar> set to <quote>PLUMERISE</quote>.</para>
</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>

<para>The output files produced by <command>Smkmerge</command> are determined by the values of the input environment variables.</para>

<informaltable>
<tgroup cols="3">
<colspec colwidth="37*" />
<colspec colwidth="18*" />
<colspec colwidth="45*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[A|B|M|P|E]G[T][S][C][3D][_S|_L][_O]</envar></entry>
<entry>I/O API NetCDF</entry>
<entry><para>Merged emission file, produced when <envar>MRG_GRDOUT_YN</envar> is set to Y; actual file name is determined by the environment variables used to configure <command>Smkmerge</command>, as follows:</para>

<itemizedlist spacing="compact">
<listitem>[area|biogenic|mobile|point|every] (<envar>MRG_SOURCE</envar>)</listitem>
<listitem>T = temporally allocated (<envar>MRG_TEMPORAL_YN</envar>)</listitem>
<listitem>S = speciated (<envar>MRG_SPCMAT_YN</envar>)</listitem>
<listitem>C = controlled (<envar>MRG_CTLMAT_MULT</envar> or <envar>MRG_CTLMAT_REAC</envar>)</listitem>
<listitem>3D = layered (<envar>MRG_LAYERS_YN</envar>)</listitem>
<listitem>_S = mass-based speciation (<envar>SPC_INPUT</envar>)</listitem>
<listitem>_L = mole-based speciation (<envar>SPC_INPUT</envar>)</listitem>
<listitem>_O = used when only merging biogenic sources (<envar>MRG_SOURCE</envar> = B)</listitem>
</itemizedlist>

</entry>
</row>
<row>
<entry><envar>ELEV[T]S[C][_S|_L]</envar></entry>
<entry>ASCII</entry>
<entry>Elevated-point-sources file, produced if <envar>SMK_ASCIIELEV_YN</envar> is set to Y; if PinG sources have also been selected, then the stack diameters listed in this file will be set to the negative value of their actual value</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Smkmerge</command></entry>
</row>
<row>
<entry><envar>PING[T][S][C][_S|_L]</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>CMAQ PinG file, produced if <envar>SMK_PING_METHOD</envar> is set to 1</entry>
</row>
<row>
<entry><envar>REP[A|B|M|P|E]G[T][S][C][_S|_L]</envar></entry>
<entry>ASCII</entry>
<entry>Emission totals report file, produced if either <envar>MRG_REPSTA_YN</envar> or <envar>MRG_REPCNY_YN</envar> is set to Y</entry>
</row>
<row>
<entry><envar>SGINLNTS[_S|_L]</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Emissions by source group, formatted as CMAQ in-line emissions data, produced if <envar>SMK_SRCGROUP_OUTPUT_YN</envar> is set to Y</entry>
</row>
<row>
<entry><envar>SRCGROUPS_OUT</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Source group information, produced if <envar>SMK_SRCGROUP_OUTPUT_YN</envar> is set to Y</entry>
</row>
<row>
<entry><envar>SRCGRP_REPORT</envar></entry>
<entry>ASCII</entry>
<entry>Source group report file, produced if <envar>SMK_SRCGROUP_OUTPUT_YN</envar> is set to Y</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

<!--
<section>

<title>Earlier Versions</title>

<para>The SMOKE prototype used a series of merge programs: CSELEV for elevated point sources, SDGMERGE for low-level sources, CSGLMERGE for layered output, SMK2EMIS for UAM-ready lower-level emissions, SMK2PTS for UAM-ready elevated point sources, SMK2SAQM for SAQM-ready emissions, and CSGLDAYMERGE. The new <command>Smkmerge</command> program replaces all these special-purpose programs.</para>

</section>
-->

</section>

<section id="sect_programs_spcmat">

<title><command>Spcmat</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> area, mobile, point</para>

<para>An emission inventory is built and reported for a variety of compounds or chemical classes such as CO, NO<subscript>x</subscript>, VOC, PM<subscript>10</subscript>, and SO<subscript>2</subscript>. However, AQM photochemical mechanisms (e.g., CB6, SAPRC) contain a simplified set of equations that use representative <quote>model species</quote> to represent atmospheric chemistry. Therefore, factors are needed to convert the emissions from the chemical classes in the emission inventory to the species in the intended photochemical mechanism. The <command>Spcmat</command> program produces matrices that contain the factors for performing this conversion.</para>

<para>The speciation factors are provided to <command>Spcmat</command> using "speciation profiles", which are applied to the inventory's sources using a "speciation cross-reference".  For inventories that contain VOC mass,  an additional factor is needed that converts the VOC mass to Total Organic Gases (TOG) mass, since the profiles used for VOC are actually computed based on TOG. The TOG profiles are used (instead of VOC profiles) since some of the TOG mass gets assigned to model species. Using VOC-only profiles would underestimate the volatile mass being emitted.  Historically in SMOKE, the VOC-to-TOG conversion factors have been assigned by SCC or FIPS and SCC. Starting with SMOKE version 2.3, however, these factors can optionally be assigned by speciation profile ID codes. In fact, since the VOC-to-TOG factors come directly from the raw data used to create speciation profiles factors (such as the SPECIATE4.0 database), the most consistent way to assign these factors is actually by speciation profile ID. SMOKE version 2.3 is backward compatible with existing GSCNV file formats.</para>

<para><command>Spcmat</command> outputs both mass-based and mole-based speciation factors for all sources. Previous systems have assumed that the average molecular weight of the model species was sufficient to represent the molecular weight of a species emitted by a specific source. In fact, the actual molecular weight of a model species is different for different types of emission processes. To represent the mass values more accurately, the mass and mole factors are input, applied, and output separately by Spcmat.</para>

<para>The speciation cross-reference file input to <command>Spcmat</command> specifies the speciation profile to be used for transforming the inventory pollutants to the model species for each source or type of source. <command>Spcmat</command> permits profiles to be assigned based on the country, state, and county code, the SCC, and other source characteristics. In the hierarchical system used to apply the profiles, the most specific assignments are applied first, followed by the next most specific, and so on. This system ensures that the most-specific matches override the less-specific ones.</para>

<para>For stationary area/nonpoint sources, the available combinations and their order are the following, starting with the most specific. <quote>Left <emphasis>x</emphasis> of SCC</quote> refers to an 8- or 10-digit SCC with all digits except the first <emphasis>x</emphasis> set to 0. <quote>Left 2 of SIC code</quote> refers to a 4-digit SIC code with the third and fourth digits set to 0.The maximum field width in SMOKE and its input files for SCC is 20 characters as of SMOKE v4.0. The 8 or 10 digit SCC are still supported, but if the SCC is greater than 10 digits the SCC hierarchial approach will not be supported. The SIC may also be up to 20 characters in length, but if the SIC is larger than 4 characters then the hierarchial approach will not be used. (NOTE: only for SCC less than or equal to 10 characters and SIC less than or equal to 4 characters)</para>

<orderedlist spacing="compact">
<listitem>
<para>Country/state/county code, MACT code, and 8- or 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state/county code and MACT code</para>
</listitem>
<listitem>
<para>Country/state code, MACT code, and 8- or 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state code and MACT code</para>
</listitem>
<listitem>
<para>MACT code and 8- or 10-digit SCC</para>
</listitem>
<listitem>
<para>MACT code</para>
</listitem>
<listitem>
<para>Country/state/county code and 4-digit SIC code</para>
</listitem>
<listitem>
<para>Country/state/county code and left 2 of SIC code</para>
</listitem>
<listitem>
<para>Country/state code and 4-digit SIC code</para>
</listitem>
<listitem>
<para>Country/state code and left 2 of SIC code</para>
</listitem>
<listitem>
<para>4-digit SIC code</para>
</listitem>
<listitem>
<para>Left 2 of SIC code</para>
</listitem>
<listitem>
<para>Country/state/county code and 8- or 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state/county code and left 6 or left 7 of SCC</para>
</listitem>
<listitem>
<para>Country/state code and 8- or 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state code and left 6 or left 7 of SCC</para>
</listitem>
<listitem>
<para>8- or 10-digit SCC</para>
</listitem>
<listitem>
<para>Left 6 or left 7 of SCC</para>
</listitem>
<listitem>
<para>Country/state/county code</para>
</listitem>
<listitem>
<para>Country/state code</para>
</listitem>
<listitem>
<para>Ultimate default (country/state/county code = 0, SCC = 0)</para>
</listitem>
</orderedlist>

<para>For nonroad sources, the available combinations and their order are:</para>

<orderedlist spacing="compact">
<listitem>
<para>Country/state/county code and 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state/county code and left 7 of SCC</para>
</listitem>
<listitem>
<para>Country/state code and 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state code and left 7 of SCC</para>
</listitem>
<listitem>
<para>10-digit SCC</para>
</listitem>
<listitem>
<para>Left 7 of SCC</para>
</listitem>
<listitem>
<para>Country/state/county code</para>
</listitem>
<listitem>
<para>Country/state code</para>
</listitem>
<listitem>
<para>Ultimate default (country/state/county code = 0, SCC = 0)</para>
</listitem>
</orderedlist>

<comment>
<para>For mobile sources, the available combinations and their order are:</para>
<orderedlist spacing="compact">
<listitem>
<para>Country/state/county code, road class, vehicle type, and process</para>
</listitem>
<listitem>
<para>Country/state/county code, road class, and vehicle type</para>
</listitem>
<listitem>
<para>Country/state/county code, road class, and process</para>
</listitem>
<listitem>
<para>Country/state/county code and road class</para>
</listitem>
<listitem>
<para>Country/state/county code, vehicle type, and process</para>
</listitem>
<listitem>
<para>Country/state/county code and vehicle type</para>
</listitem>
<listitem>
<para>Country/state code, road class, vehicle type, and process</para>
</listitem>
<listitem>
<para>Country/state code, road class, and vehicle type</para>
</listitem>
<listitem>
<para>Country/state code and road class</para>
</listitem>
<listitem>
<para>Country/state code, vehicle type, and process</para>
</listitem>
<listitem>
<para>Country/state code and vehicle type</para>
</listitem>
<listitem>
<para>Road class, vehicle type, and process</para>
</listitem>
<listitem>
<para>Road class and vehicle type</para>
</listitem>
<listitem>
<para>Road class</para>
</listitem>
<listitem>
<para>Vehicle type and process</para>
</listitem>
<listitem>
<para>Vehicle type</para>
</listitem>
<listitem>
<para>Country/state/county code and process</para>
</listitem>
<listitem>
<para>Country/state/county code</para>
</listitem>
<listitem>
<para>Country/state code and process</para>
</listitem>
<listitem>
<para>Country/state/county code</para>
</listitem>
<listitem>
<para>Process-specific ultimate default (country/state/county code = 0, SCC = 0)</para>
</listitem>
<listitem>
<para>Ultimate default (no process, country/state/county code = 0, SCC = 0)</para>
</listitem>
</orderedlist>
</comment>

<para>For point sources, the available combinations depend on the source definition. A header in the speciation cross-reference file format allows you to indicate the source definition. For inventories, a source is defined as the unique combination of country/state/county code, plant ID, point ID, stack ID, segment, and SCC. For point sources, the available combinations and their order are:</para>

<orderedlist spacing="compact">
<listitem>
<para>Country/state/county code, plant ID, point ID, stack ID, segment ID, SCC, and pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, plant ID, point ID, stack ID, segment ID, and pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, plant ID, point ID, stack ID, and pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, plant ID, point ID, and pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, plant ID, SCC, and pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code and plant ID</para>
</listitem>
<listitem>
<para>Country/state/county code, MACT code, and SCC</para>
</listitem>
<listitem>
<para>Country/state/county code and MACT code</para>
</listitem>
<listitem>
<para>Country/state code, MACT code, and SCC</para>
</listitem>
<listitem>
<para>Country/state code and MACT code</para>
</listitem>
<listitem>
<para>MACT code and SCC</para>
</listitem>
<listitem>
<para>MACT code</para>
</listitem>
<listitem>
<para>Country/state/county code and 4-digit SIC code</para>
</listitem>
<listitem>
<para>Country/state/county code and left 2 of SIC code</para>
</listitem>
<listitem>
<para>Country/state code and 4-digit SIC code</para>
</listitem>
<listitem>
<para>Country/state code and left 2 of SIC code</para>
</listitem>
<listitem>
<para>4-digit SIC code</para>
</listitem>
<listitem>
<para>Left 2 of SIC code</para>
</listitem>
<listitem>
<para>Country/state/county code and SCC</para>
</listitem>
<listitem>
<para>Country/state/county code and left 6 of SCC </para>
</listitem>
<listitem>
<para>Country/state/county code and left 3 of SCC </para>
</listitem>
<listitem>
<para>Country/state/county code and left 1 of SCC</para>
</listitem>
<listitem>
<para>Country/state code and SCC</para>
</listitem>
<listitem>
<para>Country/state code and left 6 of SCC </para>
</listitem>
<listitem>
<para>Country/state code and left 3 of SCC </para>
</listitem>
<listitem>
<para>Country/state code and left 1 of SCC</para>
</listitem>
<listitem>
<para>SCC</para>
</listitem>
<listitem>
<para>Left 6 of SCC</para>
</listitem>
<listitem>
<para>Left 3 of SCC</para>
</listitem>
<listitem>
<para>Left 1 of SCC</para>
</listitem>
<listitem>
<para>Country/state/county code</para>
</listitem>
<listitem>
<para>Country/state code</para>
</listitem>
<listitem>
<para>Ultimate default (country/state/county code = 0, SCC = 0)</para>
</listitem>
</orderedlist>

</section>

<section>

<title>Processing Order</title>

<para><command>Smkinven</command> must be run before <command>Spcmat</command>.</para>

<para><command>Spcmat</command> must be executed before speciated emissions can be produced by <command>Smkmerge</command>.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_spcmat">
<title><command>Spcmat</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/spcmat_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/spcmat_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_spcmat" /> shows the input and output files for the <command>Spcmat</command> program. The input files include the inventory file output from <command>Smkinven</command> (<envar>AREA</envar>, <envar>MOBL</envar>, or <envar>PNTS</envar>), the optional pollutant conversion file (<envar>GSCNV</envar>), the speciation profiles file (<envar>GSPRO</envar>), the speciation cross-reference file (<envar>GSREF</envar>), the combination speciation profiles file (<envar>GSPRO_COMBO</envar>), and the inventory data table (<envar>INVTABLE</envar>). For mobile sources only, <command>Spcmat</command> uses the mobile emission processes file (<envar>MEPROC</envar>). More informaton of <envar>GSPRO_COMBO</envar> file is available at <xref linkend="sect_input_gspro_combo" />.</para>

<para><command>Spcmat</command> outputs a mole-based speciation matrix file (<envar>ASMAT_L</envar>, <envar>MSMAT_L</envar>, or <envar>PSMAT_L</envar>) and a mass-based speciation matrix file (<envar>ASMAT_S</envar>, <envar>MSMAT_S</envar>, or <envar>PSMAT_S</envar>). The program also outputs a speciation supplemental file (<envar>ASSUP</envar>, <envar>MSSUP</envar>, or <envar>PSSUP</envar>) and a log file (<envar>LOGFILE</envar>).</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[AREA|MOBL|PNTS]</envar></entry>
<entry>SMOKE map</entry>
<entry>Intermediate inventory file produced by <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>GSCNV</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Pollutant conversion file, used only if <envar>POLLUTANT_CONVERSION</envar> = Y.</entry>
</row>
<row>
<entry><envar>GSPRO</envar></entry>
<entry>ASCII</entry>
<entry>Speciation profiles</entry>
</row>
<row>
<entry><envar>GSREF</envar></entry>
<entry>ASCII</entry>
<entry>Speciation cross-reference file</entry>
</row>
<row>
<entry><envar>INVTABLE</envar></entry>
<entry>ASCII</entry>
<entry>Inventory data table listing activity and pollutant names</entry>
</row>
<row>
<entry><envar>MEPROC</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Mobile emission processes file</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section>

<title>Input Environment Variables</title>

<itemizedlist>

<listitem>
<para><envar>CMB_CHKFRACS</envar>: [default: Y]</para>
<para>Check whether the sum of multiple speciation profile split factors is equal to 1.0 or not.</para>
<itemizedlist>
<listitem>
<para>Y: Gives an error if the sume of split factors is not 1.0</para>
</listitem>
<listitem>
<para>N: Do not check the sume of split factors</para>
</listitem>
</itemizedlist>
</listitem>


<listitem>
<para><envar>FULLSCC_ONLY</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" />. In this context, this option affects cross-referencing for the speciation cross-reference files by preventing left-7 SCC assignments. The application GSCNV files are not affected by this option when using FIPS/SCC assignments, and will continue to use left-7 SCC assignments even when FULLSCC_ONLY is set to "Y".</para>
</listitem>

<listitem>
<para><envar>NO_SPC_ZERO_EMIS</envar>: [default: N]</para>
<para>Defines whether the program applies the speciation profiles to zero emission sources.</para>
<itemizedlist>
<listitem>
<para>Y: Skip applying speciation profile to zero emission source</para>
</listitem>
<listitem>
<para>N: Do not skip</para>
</listitem>
</itemizedlist>
</listitem>

<listitem>
<para><envar>POLLUTANT_CONVERSION</envar>: [default: N]</para>

<para>Defines whether the program uses the pollutant-to-pollutant conversion file (<xref linkend="sect_input_gscnv" />).</para>

<itemizedlist>
<listitem>
<para>Y: Use conversion file</para>
</listitem>
<listitem>
<para>N: Do not use conversion file</para>
</listitem>
</itemizedlist>

</listitem>
<listitem>
<para><envar>REPORT_DEFAULTS</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" /></para>
</listitem>
<listitem>
<para><envar>SMK_SOURCE</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" /></para>
</listitem>

<listitem>
<para><envar>SPCMAT_PERIOD</envar>: [default:1]</para>
<para>Defines period number which could be month. It must match to the period number in (<xref linkend="sect_input_gspro_combo" />).</para>
</listitem>

<listitem>
<para><envar>SRC_TAGGING</envar>: [default: N]</para>
<para>Defines whether the program uses the speciation tagging cross-reference file or not (<xref linkend="sect_input_gstag" />).</para>
<itemizedlist>
<listitem>
<para>Y: Use speciation tagging cross-reference file</para>
</listitem>
<listitem>
<para>N: Do not use speciation tagging cross-reference file</para>
</listitem>
</itemizedlist>
</listitem>

<listitem>
<para><envar>DEFAULT_CONV_FAC_ERROR</envar>: [default: N]</para>
<para>Defines whether the program treats as an error when there is no matched VOC to TOG conversion factor available in the pollutant-to-pollutant conversion file (<xref linkend="sect_input_gscnv" />).</para>
<itemizedlist>
<listitem>
<para>Y: Use speciation tagging cross-reference file</para>
</listitem>
<listitem>
<para>N: Do not use speciation tagging cross-reference file</para>
</listitem>
</itemizedlist>
</listitem>

</itemizedlist>

</section>


<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[A|M|P]SMAT_L</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Mole-based speciation matrix</entry>
</row>
<row>
<entry><envar>[A|M|P]SMAT_S</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Mass-based speciation matrix</entry>
</row>
<row>
<entry><envar>[A|M|P]SSUP</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Speciation supplemental file</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Spcmat</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

<!--
<section>

<title>Earlier Versions</title>

<para>The SMOKE prototype used separate programs for each type of emission source: SPCAMAT for area sources, SPCMMAT for mobile sources, and SPCPMAT for point sources. Also, the SMOKE prototype output only mole-based speciation matrices.</para>

<para>Version 2.0 added the ability to assign speciation profiles by MACT and SIC codes. Also, species of differing types (i.e., gaseous and particulate) can be created from the same pollutant.</para>

<para>Versions prior to version 2.3 do not support the using a GSCNV file assign to the sources based on the Speciation Profile ID assigned to that source. Version 2.3 is backward compatible with previous file formats.</para>

</section>
-->

</section>

<section id="sect_programs_temporal">

<title><command>Temporal</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> area, mobile, point</para>

<para>The <command>Temporal</command> program produces a file with hourly inventory pollutant emissions. Unlike the SMOKE matrices produced by <command>Cntlmat</command>, <command>Grdmat</command>, and <command>Spcmat</command>, the output file from <command>Temporal</command> contains the actual emissions data. For all source categories, it uses temporal profiles, temporal cross-references, and the time zone of each source to create the hourly emissions output file. It can also read in day-specific and hour-specific inventory data in SMOKE format, and it uses the most detailed data it can when multiple types of data are available for the same source. For example, if a source had annual, day-specific, and hour-specific data, <command>Temporal</command> would use the hour-specific emissions. The program can also apply source-specific hourly profiles from the hour-specific data file, and it can override all temporal profiles and use temporally uniform profiles for all sources.</para>

<para><command>Temporal</command> treats the temporal profiles as <emphasis>local</emphasis> profiles. In other words, the profile applied to the source is adjusted based on the difference between the time zone of the source (determined by the <envar>COSTCY</envar> file) and the output time zone (determined by the <envar>OUTZONE</envar> environment variable). SMOKE automatically considers Daylight Saving time when converting from a region&rsquo;s standard time zone to the output time zone, and SMOKE can exclude regions that never use Daylight Saving time based on the <envar>COSTCY</envar> file. Note that <command>Temporal</command> has been tested for time zones in the Western Hemisphere, but we have not tested it for time zones in the Eastern Hemisphere.</para>

<para>Within the <command>Temporal</command> program, the processing occurs as follows:</para>

<itemizedlist>
<listitem>
<para>Temporal profiles are assigned for all sources.</para>
</listitem>
<listitem>
<para>Monthly (year-to-month) temporal profiles can be applied.</para>
</listitem>
<listitem>
<para>Daily (month-to-day) temporal profiles can be applied.</para>
</listitem>
<listitem>
<para>Weekly (month-to-weekly) temporal profiles can be applied.</para>
</listitem>
<listitem>
<para>Day-of-week specific hourly diurnal temporal profiles (Monday,,,Sunday, Weekday, Weekend, or All days) are applied.</para>
</listitem>
<listitem>
<para>Date-specific hourly diurnal temporal profiles (year-to-hour, month-to-hour or day-to-hour) can be applied.</para>
</listitem>
<listitem>
<para>Day-specific emissions or activities are read in and used to overwrite daily emissions for the appropriate sources</para>
</listitem>
<listitem>
<para>Hour-specific emissions or activities are read in and used to overwrite hourly emissions for the appropriate sources.</para>
</listitem>
</itemizedlist>

<para>Hourly temporal profiles can be applied for weekdays and weekend days by default in the system. By breaking up the processing into different periods, you can apply different temporal profiles for different days of the week. A future version of SMOKE will permit different hourly profiles for every day of the week in a single run of the <command>Temporal</command> program.</para>

<para>A special holidays file should be provided so that holidays can receive special treatment. This file specifies which daily profiles should be applied to holidays.</para>

<para>A many-step hierarchy is used in applying the temporal cross-referencing. SMOKE preferentially matches each source to the most specific line in the cross-reference file. When there are missing entries in the cross-reference file, <command>Temporal</command> first looks for cross-reference entries for other species at the same level in the search hierarchy before descending to the next level in the hierarchy. For example, if a source has a temporal cross-reference entry for CO but not for NO<subscript>x</subscript>, <command>Temporal</command> uses the source-specific CO temporal cross reference entry for allocating NO<subscript>x</subscript> from that source in preference to using a default NO<subscript>x</subscript> temporal profile.</para>

<para>For area sources, the available combinations are the following, starting with the most specific. <quote>7-digit SCC</quote> means a 10-digit SCC with the last three digits set to zero. The maximum field width in SMOKE and its input files for SCC is 20 characters as of SMOKE v4.0. The 8 or 10 digit SCC are still supported, but if the SCC is greater than 10 digits the SCC hierarchial approach will not be supported. The SIC may also be up to 20 characters in length, but if the SIC is larger than 4 characters then the hierarchial approach will not be used. (NOTE: only for SCC less than or equal to 10 characters and SIC less than or equal to 4 characters)</para>

<orderedlist spacing="compact">
<listitem>
<para>Country/state/county code, 10-digit SCC, and pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, 7-digit SCC, and pollutant </para>
</listitem>
<listitem>
<para>Country/state code, 10-digit SCC, and pollutant</para>
</listitem>
<listitem>
<para>Country/state code, 7-digit SCC, and pollutant</para>
</listitem>
<listitem>
<para>10-digit SCC and pollutant</para>
</listitem>
<listitem>
<para>7-digit SCC and pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code and 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state/county code and 7-digit SCC</para>
</listitem>
<listitem>
<para>Country/state code and 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state code and 7-digit SCC</para>
</listitem>
<listitem>
<para>10-digit SCC</para>
</listitem>
<listitem>
<para>7-digit SCC</para>
</listitem>
<listitem>
<para>Country/state/county code</para>
</listitem>
<listitem>
<para>Country/state code</para>
</listitem>
<listitem>
<para>Ultimate default (no pollutant, country/state/county code = 0, SCC = 0)</para>
</listitem>
</orderedlist>

<comment>
<para>For mobile sources, the available combinations are given below. To specify an entry that is to match by vehicle type, the road class part of the SCC must be filled with zeros. If any warnings or errors are written during the read of the mobile temporal cross-reference file, the messages will use the mobile internal SCCs.</para>

<orderedlist spacing="compact">
<listitem>
<para>Country/state/county code, road class, vehicle type, and process/pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, road class, and process/pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, vehicle type, and process/pollutant</para>
</listitem>
<listitem>
<para>Country/state code, road class, vehicle type, and process/pollutant</para>
</listitem>
<listitem>
<para>Country/state code, road class, and process/pollutant</para>
</listitem>
<listitem>
<para>Country/state code, vehicle type, and process/pollutant</para>
</listitem>
<listitem>
<para>Road class, vehicle type, and process/pollutant</para>
</listitem>
<listitem>
<para>Road class and process/pollutant</para>
</listitem>
<listitem>
<para>Vehicle type and process/pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, road class, vehicle type</para>
</listitem>
<listitem>
<para>Country/state/county code, road class</para>
</listitem>
<listitem>
<para>Country/state/county code, vehicle type</para>
</listitem>
<listitem>
<para>Country/state code, road class, vehicle type</para>
</listitem>
<listitem>
<para>Country/state code, road class</para>
</listitem>
<listitem>
<para>Country/state code, vehicle type</para>
</listitem>
<listitem>
<para>Road class, vehicle type</para>
</listitem>
<listitem>
<para>Road class</para>
</listitem>
<listitem>
<para>Vehicle type</para>
</listitem>
<listitem>
<para>Country/state/county code</para>
</listitem>
<listitem>
<para>Country/state code</para>
</listitem>
<listitem>
<para>Ultimate default (all values = 0)</para>
</listitem>
</orderedlist>
</comment>

<para>For point sources, the available combinations depend on the source definition. A header is used in the file to indicate the source definition. For inventories, a source is defined as the unique combination of country/state/county code, plant ID, point ID, stack ID, segment, and SCC. <quote>5-digit SCC</quote> means a 10-digit SCC with the last 5 digits set to zero. If only 8-digit SCCs are available, these can be used and SMOKE will assume leading zeros. In this case, the <quote>5-digit SCC</quote> becomes a <quote>3-digit SCC</quote>. The maximum field width in SMOKE and its input files for SCC is 20 characters as of SMOKE v4.0. The 8 or 10 digit SCC are still supported, but if the SCC is greater than 10 digits the SCC hierarchial approach will not be supported. The SIC may also be up to 20 characters in length, but if the SIC is larger than 4 characters then the hierarchial approach will not be used.</para>

<para>The hierarchy of cross-referencing is the following. (NOTE: only for SCC less than or equal to 10 characters, SIC less than or equal to 4 characters)</para>

<orderedlist spacing="compact">
<listitem>
<para>Country/state/county code, 10-digit SCC, plant ID, point ID, stack ID, segment, and pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, 10-digit SCC, plant ID, point ID, stack ID, and pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, 10-digit SCC, plant ID, point ID, and pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, 10-digit SCC, plant ID, and pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, 10-digit SCC, plant ID, point ID, stack ID, and segment</para>
</listitem>
<listitem>
<para>Country/state/county code, 10-digit SCC, plant ID, point ID, and stack ID</para>
</listitem>
<listitem>
<para>Country/state/county code, 10-digit SCC, plant ID, and point ID</para>
</listitem>
<listitem>
<para>Country/state/county code, 10-digit SCC, and plant ID</para>
</listitem>
<listitem>
<para>Country/state/county code, and plant ID</para>
</listitem>
<listitem>
<para>Country/state/county code, 10-digit SCC, and pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code, 5-digit SCC, and pollutant</para>
</listitem>
<listitem>
<para>Country/state code, 10-digit SCC, and pollutant</para>
</listitem>
<listitem>
<para>Country/state code, 5-digit SCC, and pollutant</para>
</listitem>
<listitem>
<para>10-digit SCC and pollutant</para>
</listitem>
<listitem>
<para>5-digit SCC and pollutant</para>
</listitem>
<listitem>
<para>Country/state/county code and 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state/county code and 5-digit SCC</para>
</listitem>
<listitem>
<para>Country/state code and 10-digit SCC</para>
</listitem>
<listitem>
<para>Country/state code and 5-digit SCC</para>
</listitem>
<listitem>
<para>10-digit SCC</para>
</listitem>
<listitem>
<para>5-digit SCC</para>
</listitem>
<listitem>
<para>Country/state/county code</para>
</listitem>
<listitem>
<para>Country/state code</para>
</listitem>
<listitem>
<para>Ultimate default (all values = 0)</para>
</listitem>
</orderedlist>

</section>

<section>

<title>Processing Order</title>

<para><command>Smkinven</command> must be run before <command>Temporal</command>.</para>

<para><command>Temporal</command> must be run before gridded, hour-specific emissions can be produced using the <command>Smkmerge</command> program.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_temporal_area">
<title><command>Temporal</command> input and output files for area sources</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/temporal_area_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/temporal_area_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_temporal_area" /> shows the input and output files for the <command>Temporal</command> program for area sources. The input files include the inventory file output from <command>Smkinven</command> (<envar>AREA</envar>), the temporal profiles file (<envar>ATPRO</envar>), the temporal cross-reference file (<envar>ATREF</envar>), the country, state, and county codes file (<envar>COSTCY</envar>), the holidays file <envar>HOLIDAYS</envar>), and optional process date file (<envar>PROCDATES</envar>).</para>

<para><command>Temporal</command> outputs an hourly emissions file (<envar>ATMP</envar>), a temporal allocation supplemental file (<envar>ATSUP</envar>), and a log file (<envar>LOGFILE</envar>).</para>

<figure id="fig_programs_temporal_mobile">
<title><command>Temporal</command> input and output files for mobile sources</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/temporal_mobile_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/temporal_mobile_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_temporal_mobile" /> shows the input and output files for the <command>Temporal</command> program for mobile sources. The input files include the country, state, and county codes file (<envar>COSTCY</envar>), the holidays file (<envar>HOLIDAYS</envar>), the optional process date file (<envar>PROCDATES</envar>) and, if activity data are used, the inventory data table (<envar>INVTABLE</envar>). <command>Temporal</command> also uses the inventory file output from <command>Smkinven</command> (<envar>MOBL</envar>), the temporal profiles file (<envar>MTPRO</envar>), and the temporal cross-reference file (<envar>MTREF</envar>).</para>

<para><command>Temporal</command> outputs a log file (<envar>LOGFILE</envar>), an hourly emissions file (<envar>MTMP</envar>), and a temporal allocation supplemental file (<envar>MTSUP</envar>).</para>

<figure id="fig_programs_temporal_point">
<title><command>Temporal</command> input and output files for point sources</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/temporal_point_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/temporal_point_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_temporal_point" /> shows the input and output files for the <command>Temporal</command> program for point sources. The input files include the country, state, and county codes file (<envar>COSTCY</envar>), the holidays file (<envar>HOLIDAYS</envar>) and the optional process date file (<envar>PROCDATES</envar>). If using day-specific data, the <envar>PDAY</envar> file is read, and the <envar>PHOUR</envar> file is read when using hour-specific data. <command>Temporal</command> also uses the inventory file output from <command>Smkinven</command> (<envar>PNTS</envar>), the temporal profiles file (<envar>PTPRO</envar>), and the temporal cross-reference file (<envar>PTREF</envar>).</para>

<para><command>Temporal</command> outputs a log file (<envar>LOGFILE</envar>), an hourly emissions file (<envar>PTMP</envar>), and a temporal allocation supplemental file (<envar>PTSUP</envar>).</para>

<para>Optionally, <command>Temporal</command> may be run using <envar>PROCDATES</envar>.  This enables the processing of sequential or non-sequential user specified days. If <envar>PROCDATES</envar> is not assigned, the defaults apply. When running <command>Temporal</command> interactively, the following inputs will be requested. The default values for these are set by the <envar>G_STDATE</envar>, <envar>G_STTIME</envar>, and <envar>G_RUNLEN</envar> environment variables.</para>

<itemizedlist>
<listitem>
<para>Start date: Starting date of simulation in Julian (YYYYDDD) or Gregorian (YYYYMMDD) formats</para>
</listitem>
<listitem>
<para>Start Time: Starting time of simulation in HHMMSS</para>
</listitem>
<listitem>
<para>Duration: Simulation duration in hours</para>
</listitem>
</itemizedlist>

<para><envar>PROCDATES</envar>: See description in <xref linkend="sect_input_procdates" />.</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[AREA|MOBL|PNTS]</envar></entry>
<entry>SMOKE map</entry>
<entry>Intermediate inventory file produced by <command>Smkinven</command></entry>
</row>
<row>
<entry><envar>[A|M|P]TPRO_MONTHLY</envar></entry>
<entry>ASCII</entry>
<entry>Monthly Temporal profiles</entry>
</row>
<row>
<entry><envar>[A|M|P]TPRO_DAILY</envar></entry>
<entry>ASCII</entry>
<entry>Month-to-day Temporal profiles</entry>
</row>
<row>
<entry><envar>[A|M|P]TPRO_WEEKLY</envar></entry>
<entry>ASCII</entry>
<entry>Weekly Temporal profiles</entry>
</row>
<row>
<entry><envar>[A|M|P]TPRO_HOURLY</envar></entry>
<entry>ASCII</entry>
<entry>Day-to-hour Temporal profiles</entry>
</row>
<row>
<entry><envar>[A|M|P]TPRO_HOURLY_NCF</envar></entry>
<entry>ASCII</entry>
<entry>Meteorological-based hourly Temporal profiles</entry>
</row>
<row>
<entry><envar>[A|M|P]TREF</envar></entry>
<entry>ASCII</entry>
<entry>Temporal cross-reference file</entry>
</row>
<row>
<entry><envar>COSTCY</envar></entry>
<entry>ASCII</entry>
<entry>Country/state/county codes file, used to determine counties that do not use Daylight Saving time.</entry>
</row>
<row>
<entry><link linkend="sect_input_geocode"><envar>GEOCODE_LEVEL[1-4]</envar></link></entry>
<entry>ASCII</entry>
<entry>Geographical level codes and descriptions for gridded inventories, only when USE_EXP_GEO_CODES is set to Y, (COSTCY is ignored when <link linkend="sect_input_geocode"><envar>GEOCODE_LEVEL[1-4]</envar></link> files are used)</entry>
</row>
<row>
<entry><envar>HOLIDAYS</envar></entry>
<entry>ASCII</entry>
<entry>Holidays file by Gregorian date, for applying holiday temporal profiles. </entry>
</row>
<row>
<entry><envar>PROCDATES</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Processes user specified Gregorian dates</entry>
</row>
<row>
<entry><envar>INVTABLE</envar> (optional)</entry>
<entry>ASCII</entry>
<entry>Inventory data table listing pollutant and activity names; required only if activity data are used</entry>
</row>
<row>
<entry><envar>PDAY</envar> (optional)</entry>
<entry>I/O API NetCDF</entry>
<entry>Day-specific intermediate inventory file created by <command>Smkinven</command> (required if <envar>DAY_SPECIFIC_YN</envar> is set to Y)</entry>
</row>
<row>
<entry><envar>PHOUR</envar> (optional)</entry>
<entry>I/O API NetCDF</entry>
<entry>Hour-specific intermediate inventory file created by <command>Smkinven</command> (required if <envar>HOUR_SPECIFIC_YN</envar> is set to Y)</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section id="sect_programs_temporal_envar">

<title>Input Environment Variables</title>

<itemizedlist>
<listitem>
<para><envar>DAY_SPECIFIC_YN</envar>: See description in <xref linkend="sect_programs_smkinven_envar" /></para>
</listitem>
<listitem>
<para><envar>FULLSCC_ONLY</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" />. In this context, this option affects cross-referencing for the temporal cross-reference files by preventing left-7 SCC assignments.</para>
</listitem>
<listitem>
<para><envar>USE_EXP_GEO_CODES</envar>: [default: N]</para>
<para>If set to Y then use GEOCODE_LEVEL[1-4] files instead of the COSTCY file to define expanded geographical detail such as country-level(GEOCODE_LEVEL1), country/state-level (GEOCODE_LEVEL2), country/state/county-level (GEOCODE_LEVEL3) or country/state/county/tribal-level (GEOCODE_LEVEL4).</para>
</listitem>
<listitem>
<para><envar>HOUR_SPECIFIC_YN</envar>: See description in <xref linkend="sect_programs_smkinven_envar" /></para>
</listitem>

<listitem>
<para><envar>HOURLY_TPROF_BASE</envar>: [default: blank]</para>
<para>Defines the base of hourly temporal profiles. This flag is only applicable when hourly temporal profiles generated by <command>Gentpro</command> is available for <command>Temporal</command> to use. For a proper processing of hourly temporal profiles from <command>Gentpro</command>, user must let <command>Temporal</command> know the basis of hourly temporal profiles (i.e., hour of day, hour of month or hour of year). <command>Gentpro</command> outputs hourly temporal profiles IDs into temporal cross-reference input file (<envar>[A|M|P]TREF</envar>). See detail information at <xref linkend="sect_input_amptref"/>. If <envar>HOUR_PROFID</envar> column is filled by <command>Gentpro</command>, user must define the base of hourly profiles to correctly convert annual/monthly/daily inventories. If processing monthly inventory, user must set it to 'MONTH'.</para>
<itemizedlist>
<listitem>
<para>YEAR: Convert raw annual inventory to hourly inventory values.</para>
</listitem>
<listitem>
<para>MONTH: Convert calculated monthly inventory to hourly inventory values.</para>
</listitem>
</itemizedlist>
</listitem>

<listitem>
<para><envar>OUTPUT_LOCAL_TIME</envar>: [default: N]</para>

<para>Defines whether the program processes daily/hourly inventories in local time or not.</para>

<itemizedlist>
<listitem>
<para>Y: Process daily/hourly inventories in local time. No time zone shift.</para>
</listitem>
<listitem>
<para>N: Apply time zone shift.</para>
</listitem>
</itemizedlist>
</listitem>

<listitem>
<para><envar>OUTZONE</envar>: : [default: 0]</para>
<para>Indicates offset from Greenwich Mean Time (GMT) for episode start date and time. <envar>OUTZONE</envar> should be set to the standard time for the time zone of interest; SMOKE will adjust to Daylight Saving time for episodes that are during periods and in regions where Daylight Saving time applies.</para>

<para><xref linkend="tbl_concepts_outzone" /> provides allowed values for <envar>OUTZONE</envar>. The CMAQ model expects <envar>OUTZONE</envar> to be 0, while other models such as UAM-IV, UAM-V and CAM<subscript>X</subscript> often use time zone 5. All models expect that the emissions and the meteorology data provided to the model will have a consistent time zone. SMOKE expects that the meteorology data will be in GMT.</para>
<para>Note that SMOKE expects <envar>OUTZONE</envar> to be set as a positive number for time zones in the Western Hemisphere, although standard notation would list these as negative values. For example, Eastern Standard Time is -5:00 hours from GMT, but <envar>OUTZONE</envar> for EST in SMOKE is 5.</para>
</listitem>
<listitem>
<para><envar>RENORM_TPROF</envar>: [default: Y]</para>
<para>Defines whether <command>Temporal</command> normalizes the temporal profiles or uses them as they exist in the data file. If the profiles are specified as decimal values and sum to 1, then specify N. Otherwise, specify Y and the program will sum the values associated with each profile and then divide each value by the sum, thereby creating a normalized profile.</para>
<itemizedlist>
<listitem>
<para>Y: Normalize the temporal profiles</para>
</listitem>
<listitem>
<para>N: Use the temporal profile values as they exist in the data file</para>
</listitem>
</itemizedlist>
</listitem>

<listitem>
<para><envar>REPORT_DEFAULTS</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" /></para>
</listitem>
<listitem>
<para><envar>SMK_AVEDAY_YN</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" /></para>
</listitem>
<listitem>
<para><envar>SMK_EF_MODEL</envar>: [default:blank]</para>
<para>Name of the emission factor model to use. NOTE: User must set it to MOVES when processing activity inventory data (i.e., VMT, VPOP and SPEED).</para>
</listitem>
<listitem>
<para><envar>SMK_MAXERROR</envar>: See description in <xref linkend="sect_programs_smkinven_envar" /></para>
</listitem>
<listitem>
<para><envar>SMK_MAXWARNING</envar>: See description in <xref linkend="sect_programs_smkinven_envar" /></para>
</listitem>
<listitem>
<para><envar>SMK_SOURCE</envar>: See description in <xref linkend="sect_programs_cntlmat_envar" /></para>
</listitem>
<listitem>
<para><envar>UNIFORM_TPROF_YN</envar>: [default: N]</para>

<para>Defines whether to use uniform temporal profiles for all sources.</para>

<itemizedlist>
<listitem>
<para>Y: Use uniform temporal profiles</para>
</listitem>
<listitem>
<para>N: Use temporal profiles file and temporal cross-reference file</para>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<para><envar>ZONE4WM</envar>: [default: Y]</para>

<para>Defines whether <command>Temporal</command> applies weekly and monthly temporal profiles using time zones. If SMOKE does not apply the profiles using the sources&rsquo; time zones, then all sources change from one day to the next or one month to the next at the same hour. This is what other emission processing systems have typically done, and it is a minor distinction in most cases.</para>

<itemizedlist>
<listitem>
<para>Y: Use time zones</para>
</listitem>
<listitem>
<para>N: Do not use time zones</para>
</listitem>
</itemizedlist>

</listitem>
</itemizedlist>

</section>

<section>

<title>Output Files</title>
<para>As of SMOKE version 2.3, two new environmental variables <envar>[A|M|P]TMPNAME</envar> and <envar>[A|M|P]TSUPNAME</envar> are required to set the directory and file prefix used to dynamically name the output files <envar>[A|M|P]TMP</envar> and <envar>[A|M|P]TSUP</envar>.</para>
<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>[A|M|P]TMP</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Hourly emissions by source; if using elevated point sources as part of point-source processing, this file contains only the layer-1 emissions</entry>
</row>
<row>
<entry><envar>[A|M|P]TSUP</envar></entry>
<entry>ASCII</entry>
<entry>Temporal allocation supplemental file</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Temporal</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

</section>

<!--
<section>

<title>Earlier Versions</title>

<para>The SMOKE prototype used separate programs for each type of emission source: TMPAREA for area sources, TMPMOBIL for mobile sources, and TMPPOINT for point sources. The TMPAREA, TMPMOBIL, and TMPPOINT programs used <envar>ESDATE</envar>, <envar>STIME</envar>, and <envar>DURATION</envar> environment variables to set the default date, time, and duration; SMOKE now uses the <envar>G_STDATE</envar>, <envar>G_STTIME</envar>, and <envar>G_RUNLEN</envar> environment variables used by other programs in the Models-3 environment.</para>

<para>Also, the SMOKE prototype permitted pollutant-specific temporal profiles for point and mobile sources, but not for area sources. Starting with SMOKE v1.0, area, mobile, and point sources can all use pollutant-specific temporal profiles.</para>

<para>SMOKE v1.0 and later handle pollutants other than CO, NO<subscript>x</subscript>, and VOC or ROG.</para>

</section>
-->

</section>

<section id="sect_programs_tmpbeis3">

<title><command>Tmpbeis3</command></title>

<section>

<title>Description</title>

<para><emphasis>Processing categories:</emphasis> biogenic</para>

<para><command>Tmpbeis3</command> uses version 3.14 or version 3.60 of the BEIS3 model. <command>Tmpbeis3</command> reads the gridded, normalized emissions file <envar>B3GRD</envar> and meteorological data from <envar>MET_FILE1</envar> and optionally <envar>MET_FILE2</envar> (these files may be either <envar>MET_CRO_2D</envar> or <envar>MET_CRO_3D</envar>). Note that <command>Tmpbeis3</command> uses temperature and surface pressure data that must be in <envar>MET_FILE1</envar>, and radiation/cloud data that may be in <envar>MET_FILE1</envar> or <envar>MET_FILE2</envar>. Within <command>Tmpbeis3</command>, speciation profiles are used to speciate biogenic pollutants for appropriate chemical mechanisms. Various speciation profiles for the CB6, and SAPRC mechanisms are available for BEIS3 modeling. The normalized emissions and meteorological data are used to produce gridded, speciated, hourly biogenic emissions. Additionally, an optional seasonal switch file, <envar>BIOSEASON</envar>, can be used to determine when and where to use summer or winter normalized emissions data on a daily basis.</para>

</section>

<section>

<title>Processing Order</title>

<para>The <command>Normbeis3</command> program must be executed before <command>Tmpbeis3</command>.</para>

<para>If you are using the seasonal switch option, the seasonal switch file (<envar>BIOSEASON</envar>) must be created using the utility program <command>Metscan</command> before running <command>Tmpbeis3</command>.</para>

<para><command>Tmpbeis3</command> must be executed before biogenic emissions can be used in <command>Smkmerge</command>.</para>

</section>

<section>

<title>Files and Environment Variables</title>

<figure id="fig_programs_tmpbeis3">
<title><command>Tmpbeis3</command> input and output files</title>
<mediaobject>
<imageobject role="pdf">
<imagedata width="6.5in" fileref="images/programs/tmpbeis3_pdf.jpg" />
</imageobject>
<imageobject role="html">
<imagedata fileref="images/programs/tmpbeis3_html.jpg" />
</imageobject>
</mediaobject>
</figure>

<para><xref linkend="fig_programs_tmpbeis3" /> shows the input and output files for the <command>Tmpbeis3</command> program. The input files include the gridded, normalized biogenic emissions from <command>Normbeis3</command> (<envar>B3GRD</envar>) and, if <envar>BIOSW_YN</envar> = Y, then a gridded, seasonal switch file output from <command>Metscan</command> is required (<envar>BIOSEASON</envar>). The biogenic speciation profiles are read from the <envar>GSPRO</envar> file and the <envar>GRID_CRO_2D</envar> contains the latitude and longitute for each grid cell. <command>Tmpbeis3</command> reads surface pressure and radiation/cloud data from <envar>MET_FILE1</envar> and optionally from <envar>MET_FILE2</envar> if <envar>BIOMET_SAME</envar> = N.</para>

<para><command>Tmpbeis3</command> outputs gridded, speciated, hourly biogenic emissions files in moles/hour (<envar>B3GTS_L</envar>) and tons/hour (<envar>B3GTS_S</envar>). The program also outputs an execution log file (<envar>LOGFILE</envar>).</para>

<section>

<title>Input Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="25*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>B3GRD</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Gridded, normalized biogenic emissions, output from <command>Normbeis3</command></entry>
</row>
<row>
<entry><envar>BIOSEASON</envar> (optional)</entry>
<entry>I/O API NetCDF</entry>
<entry>Gridded seasonal switch file containing daily data, with <quote>0</quote> meaning use winter normalized emissions and <quote>1</quote> meaning use the summer normalized emissions, produced by <command>Metscan</command></entry>
</row>
<row>
<entry><envar>GSPRO</envar></entry>
<entry>ASCII</entry>
<entry>Speciation profiles file (<emphasis role="bold">use <quote>BV309</quote> for CB04 speciation profile or <quote>B10C5</quote> for CB05 speciation profile.</emphasis>)</entry>
</row>
<row>
<entry><envar>GRID_CRO_2D</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Meteorology file containing latitude and longitude coordinates for each grid cell</entry>
</row>
<row>
<entry><envar>MET_FILE1</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Meteorology file containing temperature and surface pressure data and possibly radiation/cloud data as well (see <envar>BIOMET_SAME</envar> environment variable)</entry>
</row>
<row>
<entry><envar>MET_FILE2</envar> (optional)</entry>
<entry>I/O API NetCDF</entry>
<entry>Meteorology file containing radiation/cloud data if not in <envar>MET_FILE1</envar></entry>
</row>
<row>
<entry><envar>SOILINP</envar> (optional)</entry>
<entry>I/O API NetCDF</entry>
<entry>Gridded soil restart file ( use if <envar>INITIAL_RUN = N</envar>)</entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>

<section>

<title>Input Environment Variables</title>

<itemizedlist>

<listitem>
<para><envar>BEIS_VERSION</envar>: [default: 3.60]</para>
<para>Specifies which version of BEIS3 to use.</para>
<itemizedlist>
<listitem>
<para>3.60: Use BEIS version 3.60.</para>
</listitem>
<listitem>
<para>3.14: Use BEIS version 3.14.</para>
</listitem>
</itemizedlist>
</listitem>

<listitem>
<para><envar>BG_CLOUD_TYPE</envar>: [default: 1]</para>
<para>Specifies which meteorological data to use.</para>
<itemizedlist>
<listitem>
<para>1: Use RGND or RSD (solar radiation reaching the ground) from MM5 to calculate PAR. No other options are supported at this time.</para>
</listitem>
</itemizedlist>
</listitem>

<listitem>
<para><envar>BIOG_SPRO</envar>: [default: BV310]</para>
<para>Specifies the speciation profile for biogenic emissions from GSPRO.</para>
<itemizedlist>
<listitem>
<para>B3V10: Use BEIS version 3.60.</para>
</listitem>
<listitem>
<para>BV313: Use BEIS version 3.14.</para>
</listitem>
</itemizedlist>
</listitem>

<listitem>
<para><envar>BIOMET_SAME</envar>: [default: N]</para>
<para>Defines whether the radiation/cloud data are in the same file as the temperature data (<envar>MET_FILE1</envar>) or in a different file (<envar>MET_FILE2</envar>).</para>
</listitem>

<listitem>
<para><envar>BIOSW_YN</envar>: [default: Y]</para>
<para>Indicates whether to use a gridded seasonal switch file.</para>
<itemizedlist>
<listitem>
<para>Y: Use gridded seasonal switch file <envar>BIOSEASON</envar></para>
</listitem>
<listitem>
<para>N: Use environment variable <envar>SUMMER_YN</envar> to determine season</para>
</listitem>
</itemizedlist>
</listitem>

<listitem>
<para><envar>INITIAL_RUN</envar>: [default: N]</para>
<para>Indicates whether a particular day is the first day in a sequence of simulations.</para>
<itemizedlist>
<listitem>
<para>Y: Use for the first day in a sequence of simulations. Use if the <envar>SOILINP</envar> file does not yet exist (i.e., the soil NO calculations will not depend on the previous day&rsquo;s rainfall).</para>
</listitem>
<listitem>
<para>N: Use for subsequent days in a sequence of simulations. Use if the <envar>SOILINP</envar> file exists.</para>
</listitem>
</itemizedlist>
<para>Note that BEIS3 will create a <envar>SOILINP</envar> file for days subsequent to the first day in a sequence of simulations.</para>
</listitem>

<listitem>
<para><envar>ISLTYP_VAR</envar>: [default: SLTYP]</para>
<para>Specifies the soil type variable name used if <envar>PX_VERSION = Y.</envar></para>
</listitem>

<listitem>
<para><envar>LAI_VAR</envar>: [default: LAI]</para>
<para>Specifies the variable name for the leaf area index from the me model (e.g. WRF) used for the leaf temperature algorithm (Only for BEIS version 3.60)</para>
</listitem>

<listitem>
<para><envar>OUTZONE</envar>: See description in <xref linkend="sect_programs_temporal_envar" /></para>
</listitem>

<listitem>
<para><envar>OUT_UNITS</envar>: [default: 1]</para>
<para>Specifies units for the output variables.</para>
<itemizedlist>
<listitem>
<para>1: moles per hour.</para>
</listitem>
<listitem>
<para>2: moles per second.</para>
</listitem>
</itemizedlist>
</listitem>

<listitem>
<para><envar>PRES_VAR</envar>: [default: PRSFC]</para>
<para>Specifies the variable name for surface pressure data to extract from <envar>MET_FILE1</envar>.</para>
</listitem>

<listitem>
<para><envar>PX_VERSION</envar>: [default: N]</para>
<para>Indicates whether the Pleim-Xiu land surface model was used in the MM5 simulations.</para>
<itemizedlist>
<listitem>
<para>Y: Use if the Pleim-Xiu land surface model was used in the MM5 simulations. Indicates that <envar>MET_FILE1</envar> contains soil temperature, soil moisture and soil type fields that can be used, along with rainfall data, for NO soil emission calculations in <command>Tmpbeis3</command>.</para>
</listitem>
<listitem>
<para>N: Use if the Pleim-Xiu land surface model was not used in the MM5 simulations. Indicates that <command>Tmpbeis3</command> will calculate NO soil emissions using only rainfall data.</para>
</listitem>
</itemizedlist>
</listitem>

<listitem>
<para><envar>Q2_VAR</envar>: [default: Q2]</para>
<para>Specifies the variable name for the two meter water vapor mixing ratio (kg/kg) used for the leaf temperature algorithm (Only for BEIS version 3.60).</para>
</listitem>

<listitem>
<para><envar>RAD_VAR</envar>: [default: RGRND]</para>
<para>Specifies the variable name for radiation/cloud data to extract from either <envar>MET_FILE1</envar> or optional <envar>MET_FILE2</envar>.</para>
</listitem>

<listitem>
<para><envar>RADYNI_VAR</envar>: [default: RADYNI]</para>
<para>Specifies the variable name for the aerodynamic resistance variable (s/m) used for the leaf temperature algorithm (Only for BEIS version 3.60).</para>
</listitem>

<listitem>
<para><envar>RGRND_VAR</envar>: [default: RGRND]</para>
<para>Specifies the variable name for the solar radiation reaching the ground used for the leaf temperature algorithm (Only for BEIS version 3.60).</para>
</listitem>

<listitem>
<para><envar>RSTOMI_VAR</envar>: [default: RSTOMI]</para>
<para>Specifies the variable name for the inverse of the stomatal resistance variable (m/s) used for the leaf temperature algorithm (Only for BEIS version 3.60).</para>
</listitem>

<listitem>
<para><envar>RC_VAR</envar>: [default: RC]</para>
<para>Specifies the convective rainfall variable name used in <envar>MET_FILE1</envar>.</para>
</listitem>

<listitem>
<para><envar>RN_VAR</envar>: [default: RN]</para>
<para>Specifies the non-convective rainfall variable name used in <envar>MET_FILE1</envar>.</para>
</listitem>

<listitem>
<para><envar>SOILM_VAR</envar>: [default: SOIM1]</para>
<para>Specifies the soil moisture variable name used if <envar>PX_VERSION = Y</envar>.</para>
</listitem>

<listitem>
<para><envar>SOILT_VAR</envar>: [default: SOIT1]</para>
<para>Specifies the soil temperature variable name used if <envar>PX_VERSION = Y</envar>.</para>
</listitem>

<listitem>
<para><envar>SUMMER_YN</envar>: [default: Y]</para>
<para>Indicates whether summer or winter normalized emissions should be used; only used when <envar>BIOSW_YN</envar> is N.</para>
<itemizedlist>
<listitem>
<para>Y: Use summer normalized emissions</para>
</listitem>
<listitem>
<para>N: Use winter normalized emissions</para>
</listitem>
</itemizedlist>
</listitem>

<listitem>
<para><envar>TEMPG_VAR</envar>: [default: TEMPG]</para>
<para>Specifies the skin temperature at the ground level (K) used for the leaf temperature algorithm (Only for BEIS version 3.60).</para>
</listitem>

<listitem>
<para><envar>TMPR_VAR</envar>: [default: TA]</para>
<para>Specifies the variable name for temperature to extract from <envar>MET_FILE1</envar>.</para>
</listitem>

<listitem>
<para><envar>USTAR_VAR</envar>: [default: USTAR]</para>
<para>Specifies the variable name for the surface friction velocity (m/s) used for the leaf temperature algorithm (Only for BEIS version 3.60).</para>
</listitem>

</itemizedlist>

</section>

<section>

<title>Output Files</title>

<informaltable>
<tgroup cols="3">
<colspec colwidth="20*" />
<colspec colwidth="18*" />
<colspec colwidth="62*" />

<thead>
<row>
<entry>File Name</entry>
<entry>Format</entry>
<entry>Description</entry>
</row>
</thead>

<tbody>
<row>
<entry><envar>B3GTS_L</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Gridded, speciated, hourly biogenic emissions, in moles/hour</entry>
</row>
<row>
<entry><envar>B3GTS_S</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Gridded, speciated, hourly biogenic emissions, in tons/hour</entry>
</row>
<row>
<entry><envar>SOILOUT</envar></entry>
<entry>I/O API NetCDF</entry>
<entry>Gridded soil restart file</entry>
</row>
<row>
<entry><envar>LOGFILE</envar></entry>
<entry>ASCII</entry>
<entry>Log generated from executing <command>Tmpbeis3</command></entry>
</row>
</tbody>
</tgroup>
</informaltable>

</section>


<section>

<title>Processing Multiple Days with BEIS3</title>
<para>The user must point to the <envar>SOILOUT</envar> file from one day&rsquo;s simulation as the <envar>SOILINP</envar> file for the next day. The user must also decide whether to write over <envar>SOILOUT</envar> files from previous days or create a uniquely named <envar>SOILOUT</envar> file for each day. The latter approach is recommended if the user wishes to retain the capability to restart simulations in the middle of a sequence of simulations.</para>

</section>

</section>

<!--
<section>

<title>Earlier Versions</title>

<para><command>Tmpbeis3</command> was first released with SMOKE v1.4.</para>

</section>
-->

</section>

</chapter>
